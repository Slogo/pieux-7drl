{"mappings":"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","sources":["./node_modules/@parcel/runtime-js/lib/bundle-manifest.js","./node_modules/@parcel/runtime-js/lib/JSRuntime.js","./src/ui/handlers.ts","./src/ui/ui.ts","./src/core/Colors.js","./src/ui/input/Button.ts","./src/ui/helpers.ts","./src/ui/input/keyOnClick.ts","./src/ui/containers/Container.ts","./src/ui/panels/Panel.ts","./node_modules/rot-js/lib/rng.js","./node_modules/rot-js/lib/display/backend.js","./node_modules/rot-js/lib/display/canvas.js","./node_modules/rot-js/lib/display/hex.js","./node_modules/rot-js/lib/util.js","./node_modules/rot-js/lib/display/rect.js","./node_modules/rot-js/lib/display/tile.js","./node_modules/rot-js/lib/color.js","./node_modules/rot-js/lib/display/tile-gl.js","./node_modules/process/browser.js","./node_modules/rot-js/lib/display/term.js","./node_modules/rot-js/lib/text.js","./node_modules/rot-js/lib/display/display.js","./node_modules/rot-js/lib/constants.js","./node_modules/rot-js/lib/noise/simplex.js","./src/ui/RotDisplay.ts","./src/ui/scene.ts","./node_modules/@parcel/runtime-js/lib/bundle-url.js","./node_modules/@parcel/runtime-js/lib/relative-path.js","./src/tiles.ts","./src/core/ui/home/homeComponent.ts","./src/ui/input/CharButton.ts","./src/engine/logger/logger.ts","./src/engine/logger/LogList.ts","./src/ui/containers/Modal.ts","./src/ui/panels/PanelGroup.ts","./src/debug/ifDev.ts","./src/debug/index.ts","./src/debug/throwOrLog.ts","./src/debug/logger.ts","./src/core/commands/commandNames.ts","./src/engine/inputActions/keyHandler.ts","./src/core/commands/inputKeys.ts","./src/engine/inputActions/InputState.ts","./src/core/GameManager.ts","./src/core/commands/commands.ts","./src/engine/space/directions.ts","./src/core/actions/Action.ts","./src/engine/map/LevelMap.ts","./src/core/map/Map.ts","./src/core/map/Movement.ts","./src/engine/anims/Particle.ts","./node_modules/tslib/tslib.es6.js","./node_modules/hey-listen/dist/hey-listen.es.js","./node_modules/style-value-types/dist/style-value-types.es.js","./node_modules/framesync/dist/framesync.es.js","./node_modules/popmotion/dist/popmotion.es.js","./src/core/anims/particleSystem.ts","./src/core/anims/particles/HitParticle.ts","./src/engine/entity/Entity.ts","./src/engine/entity/Breed.ts","./src/core/actors/Actor.ts","./src/lib/sparseMap.ts","./src/core/items/formulas.ts","./src/core/messages/AttackMessages.ts","./src/core/actors/weaponHelper.ts","./src/core/actions/ActionAttacks.ts","./src/core/anims/particles/FootstepParticle.ts","./src/core/items/Item.ts","./src/core/items/armorTypes.ts","./src/core/items/consumableTypes.ts","./src/core/anims/particles/FontParticle.ts","./src/core/items/furnitureTypes.ts","./src/core/anims/particles/StaggeredParticle.ts","./src/core/actors/breeds.ts","./src/ui/type/TextType.ts","./src/core/ui/endConds/death.ts","./src/core/anims/particles/AttackingParticle.ts","./src/core/map/Pathfinding.ts","./src/core/actors/controllers/aiHelpers.ts","./src/core/actors/controllers/genericController.ts","./src/core/actors/xpLevels.ts","./src/core/map/generation.ts","./src/core/map/carving/Carving.ts","./src/core/map/graph/buildMinSpanTree.ts","./src/lib/heap/heap.ts","./src/core/map/graph/BSPGenerator.ts","./src/lib/shuffle/shuffle.ts","./src/core/map/placement/MonsterPlacement.ts","./src/core/map/placement/placement.ts","./src/core/map/placement/ShrinePlacement.ts","./src/core/map/placement/ItemPlacement.ts","./src/core/map/ShrineMap.ts","./src/core/ui/endConds/victory.ts","./src/core/items/shieldTypes.ts","./src/core/items/weaponTypes.ts","./src/core/items/itemsTypes.ts","./src/core/EntityManager.ts","./src/core/actions/ActionMovement.ts","./src/lib/dMap/dMap.ts","./src/core/anims/particles/LookParticle.ts","./src/core/ui/cheat/CheatModal.ts","./src/ui/input/Input.ts","./src/ui/input/PromptInput.ts","./src/core/ui/cheat/PlayerPosition.ts","./src/core/ui/level/LevelModal.ts","./src/core/ui/keyHelper.ts","./src/lib/rng.ts","./src/core/gameState.ts","./src/core/AsyncManager.ts","./src/core/map/Visibility.ts","./src/core/map/pathfinding.ts","./src/core/actors/systems/Regen.ts","./src/ui/map/MapUI.ts","./src/ui/dataInfo/Bar.ts","./src/ui/dataInfo/LabeledBar.ts","./src/core/ui/info/stats/StatsPanel.ts","./src/core/ui/info/stats/XPBar.ts","./src/core/ui/TileContents.ts","./src/ui/containers/TabbedContent.ts","./src/core/ui/info/EquipmentPanel.ts","./src/core/ui/info/wieldable/attackDetails.ts","./src/core/ui/inventory/ContainsPanel.ts","./src/core/actions/ActionItems.ts","./src/core/messages/ItemMessages.ts","./src/core/ui/info/WearableModal.ts","./src/core/ui/info/wearable/ArmorDisplay.ts","./src/core/ui/info/WieldableModal.ts","./src/core/ui/info/wieldable/WeaponDisplay.ts","./src/core/ui/inventory/DropModal.ts","./src/core/ui/inventory/ItemInfoDisplay.ts","./src/core/ui/inventory/PickupModal.ts","./src/core/ui/inventory/UseModal.ts","./src/core/ui/inventory/InventoryControls.ts","./src/core/ui/inventory/InventoryPanel.ts","./src/core/ui/TopInfo.ts","./src/core/ui/home/HelpModal.ts","./src/core/ui/home/helpComponent.ts","./src/core/scenes/game.ts","./src/core/scenes/main.ts","./src/index.ts"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _plugin = require(\"@parcel/plugin\");\n\nvar _utils = require(\"@parcel/utils\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _nullthrows = _interopRequireDefault(require(\"nullthrows\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// List of browsers that support dynamic import natively\n// https://caniuse.com/#feat=es6-module-dynamic-import\nconst DYNAMIC_IMPORT_BROWSERS = {\n  edge: '76',\n  firefox: '67',\n  chrome: '63',\n  safari: '11.1',\n  opera: '50'\n};\nconst LOADERS = {\n  browser: {\n    css: './loaders/browser/css-loader',\n    html: './loaders/browser/html-loader',\n    js: './loaders/browser/js-loader',\n    wasm: './loaders/browser/wasm-loader',\n    IMPORT_POLYFILL: './loaders/browser/import-polyfill'\n  },\n  worker: {\n    js: './loaders/worker/js-loader',\n    wasm: './loaders/worker/wasm-loader',\n    IMPORT_POLYFILL: false\n  },\n  node: {\n    css: './loaders/node/css-loader',\n    html: './loaders/node/html-loader',\n    js: './loaders/node/js-loader',\n    wasm: './loaders/node/wasm-loader',\n    IMPORT_POLYFILL: null\n  }\n};\n\nfunction getLoaders(ctx) {\n  if (ctx.isWorker()) return LOADERS.worker;\n  if (ctx.isBrowser()) return LOADERS.browser;\n  if (ctx.isNode()) return LOADERS.node;\n  return null;\n}\n\nvar _default = new _plugin.Runtime({\n  apply({\n    bundle,\n    bundleGraph,\n    options\n  }) {\n    // Dependency ids in code replaced with referenced bundle names\n    // Loader runtime added for bundle groups that don't have a native loader (e.g. HTML/CSS/Worker - isURL?),\n    // and which are not loaded by a parent bundle.\n    // Loaders also added for modules that were moved to a separate bundle because they are a different type\n    // (e.g. WASM, HTML). These should be preloaded prior to the bundle being executed. Replace the entry asset(s)\n    // with the preload module.\n    if (bundle.type !== 'js') {\n      return;\n    }\n\n    let asyncDependencies = [];\n    let otherDependencies = [];\n    bundle.traverse(node => {\n      if (node.type !== 'dependency') {\n        return;\n      }\n\n      let dependency = node.value;\n\n      if (dependency.isAsync && !dependency.isURL) {\n        asyncDependencies.push(dependency);\n      } else {\n        otherDependencies.push(dependency);\n      }\n    });\n    let assets = [];\n\n    for (let dependency of asyncDependencies) {\n      let resolved = bundleGraph.resolveExternalDependency(dependency, bundle);\n\n      if (resolved == null) {\n        continue;\n      }\n\n      if (resolved.type === 'asset') {\n        // If this bundle already has the asset this dependency references,\n        // return a simple runtime of `Promise.resolve(require(\"path/to/asset\"))`.\n        assets.push({\n          filePath: _path.default.join(options.projectRoot, 'JSRuntime.js'),\n          // Using Promise['resolve'] to prevent Parcel from inferring this is an async dependency.\n          // TODO: Find a better way of doing this.\n          code: `module.exports = Promise['resolve'](require(${JSON.stringify('./' + _path.default.relative(options.projectRoot, resolved.value.filePath))}))`,\n          dependency\n        });\n      } else {\n        assets.push(...getLoaderRuntimes({\n          bundle,\n          dependency,\n          bundleGraph,\n          bundleGroup: resolved.value\n        }));\n      }\n    }\n\n    for (let dependency of otherDependencies) {\n      let resolved = bundleGraph.resolveExternalDependency(dependency, bundle);\n\n      if (dependency.isURL && resolved == null) {\n        // If a URL dependency was not able to be resolved, add a runtime that\n        // exports the original moduleSpecifier.\n        assets.push({\n          filePath: __filename,\n          code: `module.exports = ${JSON.stringify(dependency.moduleSpecifier)}`,\n          dependency\n        });\n        continue;\n      }\n\n      if (resolved == null || resolved.type !== 'bundle_group') {\n        continue;\n      }\n\n      let bundleGroup = resolved.value;\n      let mainBundle = (0, _nullthrows.default)(bundleGraph.getBundlesInBundleGroup(bundleGroup).find(b => {\n        let main = b.getMainEntry();\n        return main && bundleGroup.entryAssetId === main.id;\n      }));\n\n      if (mainBundle.isInline) {\n        assets.push({\n          filePath: _path.default.join(__dirname, `/bundles/${mainBundle.id}.js`),\n          code: `module.exports = ${JSON.stringify(dependency.id)};`,\n          dependency\n        });\n        continue;\n      } // URL dependency or not, fall back to including a runtime that exports the url\n\n\n      assets.push(getURLRuntime(dependency, bundle, mainBundle));\n    }\n\n    if (shouldUseRuntimeManifest(bundle) && bundleGraph.getChildBundles(bundle).length > 0 && isNewContext(bundle, bundleGraph)) {\n      assets.push({\n        filePath: __filename,\n        code: getRegisterCode(bundle, bundleGraph),\n        isEntry: true\n      });\n    }\n\n    return assets;\n  }\n\n});\n\nexports.default = _default;\n\nfunction getLoaderRuntimes({\n  bundle,\n  dependency,\n  bundleGroup,\n  bundleGraph\n}) {\n  let assets = []; // Sort so the bundles containing the entry asset appear last\n\n  let externalBundles = bundleGraph.getBundlesInBundleGroup(bundleGroup).filter(bundle => !bundle.isInline).sort(bundle => bundle.getEntryAssets().map(asset => asset.id).includes(bundleGroup.entryAssetId) ? 1 : -1); // CommonJS is a synchronous module system, so there is no need to load bundles in parallel.\n  // Importing of the other bundles will be handled by the bundle group entry.\n  // Do the same thing in library mode for ES modules, as we are building for another bundler\n  // and the imports for sibling bundles will be in the target bundle.\n\n  if (bundle.env.outputFormat === 'commonjs' || bundle.env.isLibrary) {\n    externalBundles = externalBundles.slice(-1);\n  }\n\n  let loaders = getLoaders(bundle.env); // Determine if we need to add a dynamic import() polyfill, or if all target browsers support it natively.\n\n  let needsDynamicImportPolyfill = false;\n\n  if (bundle.env.isBrowser() && bundle.env.outputFormat === 'esmodule') {\n    needsDynamicImportPolyfill = !bundle.env.matchesEngines(DYNAMIC_IMPORT_BROWSERS);\n  }\n\n  let loaderModules = loaders ? externalBundles.map(to => {\n    let loader = loaders[to.type];\n\n    if (!loader) {\n      return;\n    }\n\n    let relativePathExpr = getRelativePathExpr(bundle, to); // Use esmodule loader if possible\n\n    if (to.type === 'js' && to.env.outputFormat === 'esmodule') {\n      if (!needsDynamicImportPolyfill) {\n        return `import(\"./\" + ${relativePathExpr})`;\n      }\n\n      loader = (0, _nullthrows.default)(loaders.IMPORT_POLYFILL, `No import() polyfill available for context '${bundle.env.context}'`);\n    } else if (to.type === 'js' && to.env.outputFormat === 'commonjs') {\n      return `Promise.resolve(require(\"./\" + ${relativePathExpr}))`;\n    }\n\n    return `require(${JSON.stringify(loader)})(require('./bundle-url').getBundleURL() + ${relativePathExpr})`;\n  }).filter(Boolean) : [];\n\n  if (loaderModules.length > 0) {\n    let loaders = loaderModules.join(', ');\n\n    if (loaderModules.length > 1 && (bundle.env.outputFormat === 'global' || !externalBundles.every(b => b.type === 'js'))) {\n      loaders = `Promise.all([${loaders}])`;\n\n      if (bundle.env.outputFormat !== 'global') {\n        loaders += `.then(r => r[r.length - 1])`;\n      }\n    } else {\n      loaders = `(${loaders})`;\n    }\n\n    if (bundle.env.outputFormat === 'global') {\n      loaders += `.then(() => parcelRequire('${bundleGroup.entryAssetId}')${// In global output with scope hoisting, functions return exports are\n      // always returned. Otherwise, the exports are returned.\n      bundle.env.scopeHoist ? '()' : ''})`;\n    }\n\n    assets.push({\n      filePath: __filename,\n      code: `module.exports = ${loaders};`,\n      dependency\n    });\n  }\n\n  return assets;\n}\n\nfunction isNewContext(bundle, bundleGraph) {\n  return bundle.isEntry || bundleGraph.getParentBundles(bundle).some(parent => parent.env.context !== bundle.env.context || parent.type !== 'js');\n}\n\nfunction getURLRuntime(dependency, from, to) {\n  let relativePathExpr = getRelativePathExpr(from, to);\n\n  if (dependency.meta.webworker === true) {\n    return {\n      filePath: __filename,\n      code: `module.exports = require('./get-worker-url')(${relativePathExpr});`,\n      dependency\n    };\n  }\n\n  return {\n    filePath: __filename,\n    code: `module.exports = require('./bundle-url').getBundleURL() + ${relativePathExpr}`,\n    dependency\n  };\n}\n\nfunction getRegisterCode(entryBundle, bundleGraph) {\n  let idToName = {};\n  bundleGraph.traverseBundles((bundle, _, actions) => {\n    if (bundle.isInline) {\n      return;\n    }\n\n    idToName[getPublicBundleId(bundle)] = (0, _nullthrows.default)(bundle.name);\n\n    if (bundle !== entryBundle && isNewContext(bundle, bundleGraph)) {\n      // New contexts have their own manifests, so there's no need to continue.\n      actions.skipChildren();\n    }\n  }, entryBundle);\n  return \"require('./bundle-manifest').register(JSON.parse(\" + JSON.stringify(JSON.stringify(idToName)) + '));';\n}\n\nfunction getRelativePathExpr(from, to) {\n  if (shouldUseRuntimeManifest(from)) {\n    return `require('./relative-path')(${JSON.stringify(getPublicBundleId(from))}, ${JSON.stringify(getPublicBundleId(to))})`;\n  }\n\n  return JSON.stringify((0, _utils.relativeBundlePath)(from, to, {\n    leadingDotSlash: false\n  }));\n}\n\nfunction shouldUseRuntimeManifest(bundle) {\n  let env = bundle.env;\n  return !env.isLibrary && env.outputFormat === 'global' && env.isBrowser();\n}\n\nfunction getPublicBundleId(bundle) {\n  return bundle.id.slice(-16);\n}","import { Bounds } from \"../engine/space/bounds\";\r\nimport {\r\n  bound,\r\n  boundsAreSame,\r\n  ComponentO,\r\n  isOver,\r\n  KeyEvents,\r\n  MouseEvents,\r\n} from \"./ui\";\r\n\r\nfunction findMouseHandlers(\r\n  ui: ComponentO,\r\n  eventType: keyof MouseEvents,\r\n  pos: [number, number]\r\n) {\r\n  const handlers: (() => void)[] = [];\r\n  const findHandlers = (com: ComponentO, o?: Bounds) => {\r\n    const b = o ? bound(o, com.bounds) : com.bounds;\r\n    if (isOver(pos, b)) {\r\n      if (com.handlers[eventType] != null) {\r\n        handlers.push(com.handlers[eventType]!);\r\n      }\r\n      com.getChildren().forEach((c) => findHandlers(c, b));\r\n    }\r\n  };\r\n  findHandlers(ui);\r\n  return handlers;\r\n}\r\n\r\nexport function handleMouseEvent(\r\n  ui: ComponentO,\r\n  eventType: keyof MouseEvents,\r\n  pos: [number, number]\r\n) {\r\n  const handlers = findMouseHandlers(ui, eventType, pos);\r\n  if (handlers.length) {\r\n    handlers[handlers.length - 1]();\r\n  }\r\n}\r\n\r\nfunction getHovered(ui: ComponentO, pos: [number, number]) {\r\n  const elements: ComponentO[] = [];\r\n  const findHovered = (com: ComponentO, o?: Bounds) => {\r\n    const b = o ? bound(o, com.bounds) : com.bounds;\r\n    if (isOver(pos, b)) {\r\n      elements.push(com);\r\n      const children = com.getChildren();\r\n      if (children) {\r\n        children.forEach((c) => findHovered(c, b));\r\n      }\r\n    }\r\n  };\r\n  findHovered(ui);\r\n  return elements;\r\n}\r\n\r\nlet hoveredTiles: ComponentO[] = [];\r\nlet selectedTile: [number, number];\r\n\r\nexport function handleHover(ui: ComponentO, pos: [number, number]) {\r\n  if (\r\n    !selectedTile ||\r\n    pos[0] !== selectedTile[0] ||\r\n    pos[1] !== selectedTile[1]\r\n  ) {\r\n    const hovered = getHovered(ui, pos);\r\n    const over = hovered.filter(\r\n      (el) =>\r\n        !hoveredTiles.find(\r\n          (t) => t.type === el.type && boundsAreSame(el.bounds, t.bounds)\r\n        )\r\n    );\r\n\r\n    const out = hoveredTiles.filter(\r\n      (el) =>\r\n        !hovered.find(\r\n          (t) => t.type === el.type && boundsAreSame(el.bounds, t.bounds)\r\n        )\r\n    );\r\n    over.forEach((el) => {\r\n      if (el.handlers.hover) {\r\n        el.handlers.hover();\r\n      }\r\n    });\r\n    out.forEach((el) => {\r\n      if (el.handlers.out) {\r\n        el.handlers.out();\r\n      }\r\n    });\r\n\r\n    hoveredTiles = hovered;\r\n  }\r\n}\r\n\r\nfunction findKeyHandlers(ui: ComponentO, eventType: keyof KeyEvents) {\r\n  const handlers: ((key: string, shift: boolean) => boolean)[] = [];\r\n  const findHandlers = (com: ComponentO) => {\r\n    if (com.handlers[eventType] != null) {\r\n      handlers.push(com.handlers[eventType]!);\r\n    }\r\n    com.getChildren().forEach((c) => findHandlers(c));\r\n  };\r\n  findHandlers(ui);\r\n  return handlers;\r\n}\r\n\r\nexport function handleKeyEvent(\r\n  ui: ComponentO,\r\n  eventType: keyof KeyEvents,\r\n  key: string,\r\n  shift: boolean\r\n) {\r\n  const handlers = findKeyHandlers(ui, eventType);\r\n  if (handlers.length) {\r\n    for (let i = handlers.length - 1; 0 <= i; i--) {\r\n      if (handlers[i](key, shift)) {\r\n        return;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Bounds } from \"../engine/space/bounds\";\r\nimport { ButtonComp } from \"./input/Button\";\r\nimport { Panel } from \"./panels/Panel\";\r\nimport { RDisplay } from \"./RotDisplay\";\r\n\r\nexport type MouseEvents = {\r\n  press: () => void;\r\n  release: () => void;\r\n  hover: () => void;\r\n  out: () => void;\r\n};\r\n\r\nexport type KeyEvents = {\r\n  keypress: (key: string, shift: boolean) => boolean;\r\n};\r\n\r\nexport type UIEvents = Partial<MouseEvents & KeyEvents>;\r\n\r\nexport function bound<\r\n  T extends { x: number; y: number; h?: number; w?: number }\r\n>(o: Bounds, t: T): T {\r\n  const result: any = { x: o.x + t.x, y: o.y + t.y };\r\n  if (t.w != null) {\r\n    result.w = t.w;\r\n    result.h = t.h;\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function boundsAreSame(o: Bounds, t: Bounds) {\r\n  return o.x === t.x && o.y === t.y && o.w === t.w && o.h === t.h;\r\n}\r\n\r\nexport const isOver = (p: [number, number], b: Bounds) =>\r\n  b.x <= p[0] && p[0] < b.x + b.w && b.y <= p[1] && p[1] < b.y + b.h;\r\n\r\nexport const LayerComp: ComponentF<any> = () => {\r\n  return [\r\n    createElement(\r\n      Panel,\r\n      { x: 0, y: 0, w: 29, h: 29 },\r\n      { children: [createElement(ButtonComp, { x: 2, y: 2, w: 5, h: 5 })] }\r\n    ),\r\n  ];\r\n};\r\n\r\nexport type ContextO = {\r\n  display: RDisplay;\r\n  bounds: Bounds;\r\n  handlers: UIEvents;\r\n  useMount: (f: () => void) => void;\r\n  useState: (\r\n    initialValue: any\r\n  ) => readonly [\r\n    Record<string, any>,\r\n    (value: Record<string, any>) => Record<string, any>\r\n  ];\r\n};\r\n\r\nexport type ComponentO = {\r\n  (display: RDisplay, bounds?: Bounds, prevState?: Record<string, any>): void;\r\n  getChildren: () => ComponentO[];\r\n  setChildren: (children: ComponentO[]) => void;\r\n  getState: () => Record<string, any>;\r\n  type: ComponentF<any>;\r\n  bounds: Bounds;\r\n  handlers: UIEvents;\r\n};\r\n\r\nexport type ComponentF<P> = (C: ContextO, props: P) => ComponentO[] | void;\r\n\r\nexport const createElement = (\r\n  el: ComponentF<any>,\r\n  bounds: Bounds,\r\n  props: any = {}\r\n): ComponentO => {\r\n  let initialized = false;\r\n\r\n  let state = {};\r\n  const setState = (value: Record<string, any>) => Object.assign(state, value);\r\n  const useState = (initialValue: any) => {\r\n    if (!initialized) {\r\n      Object.assign(state, initialValue);\r\n      initialized = true;\r\n    }\r\n    return [state, setState] as const;\r\n  };\r\n  const handlers = {};\r\n\r\n  let mounted = false;\r\n  const useMount = (f: () => void) => {\r\n    if (!mounted) {\r\n      mounted = true;\r\n      f();\r\n    }\r\n  };\r\n  let children: ComponentO[] = [];\r\n  const r = (\r\n    display: RDisplay,\r\n    origin?: Bounds,\r\n    prevState?: Record<string, any>\r\n  ) => {\r\n    if (prevState) {\r\n      initialized = true;\r\n      state = prevState;\r\n    }\r\n    const worldBounds = origin ? bound(origin, bounds) : bounds;\r\n    const newChildren =\r\n      el(\r\n        {\r\n          useMount,\r\n          useState,\r\n          display,\r\n          handlers,\r\n          bounds: worldBounds,\r\n        },\r\n        props\r\n      ) || [];\r\n    newChildren.forEach((child, index) => {\r\n      if (index < children.length && child.type === children[index].type) {\r\n        child.setChildren(children[index].getChildren());\r\n        child(display, worldBounds, children[index].getState());\r\n      } else {\r\n        child(display, worldBounds);\r\n      }\r\n    });\r\n    children = newChildren;\r\n  };\r\n\r\n  const getState = () => state;\r\n  const setChildren = (c: ComponentO[]) => (children = c);\r\n  const getChildren = () => children;\r\n\r\n  return Object.assign(r, {\r\n    type: el,\r\n    getChildren,\r\n    setChildren,\r\n    getState,\r\n    bounds,\r\n    handlers,\r\n  });\r\n};\r\n\r\nexport const focusComponent = (root: ComponentO, current: ComponentO) => {\r\n  const children = [...root.getChildren()];\r\n  while (children.length) {\r\n    const child = children.pop()!;\r\n    if (child.getState().uiFocus) {\r\n      child.getState().uiFocus = false;\r\n      current.getState().uiFocus = true;\r\n    }\r\n    const newChildren = child?.getChildren();\r\n    children.push(...newChildren);\r\n  }\r\n};\r\n","export default {\r\n  BLACK: \"#01001d\",\r\n  GREY_1: \"#0d0d0d\",\r\n  GREY_2: \"#1d1d1f\",\r\n  GREY_3: \"#333334\",\r\n  B_GREY_1: \"#443752\",\r\n  B_GREY_2: \"#5f5473\",\r\n  B_GREY_3: \"#827d9a\", \r\n  B_GREY_4: \"#a5a4ba\",\r\n  B_GREY_5: \"#dcdce6\",\r\n\r\n  RED_1: \"#702931\",\r\n  RED_2: \"#994639\",\r\n  RED_4: \"#e0c270\",\r\n\r\n  BROWN_4: \"#9e7762\",\r\n\r\n  BLUE_1: \"#45538f\",\r\n\r\n  BROWN_1: \"#523839\",\r\n  BROWN_2: \"#78524d\",\r\n  BROWN_3: \"#9e7762\"\r\n};","import Colors from \"../../core/Colors\";\r\nimport { floodFill } from \"../helpers\";\r\nimport { ComponentF } from \"../ui\";\r\nimport { handleKeyOnClick } from \"./keyOnClick\";\r\n\r\nexport const ButtonComp: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  showKey: boolean;\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({ hover: false });\r\n  floodFill(C.display, C.bounds, state.hover ? \"#45538f\" : Colors.B_GREY_1);\r\n  let x = C.bounds.x;\r\n  if (props.showKey) {\r\n    C.display.drawOver(\r\n      x,\r\n      C.bounds.y,\r\n      Array.isArray(props.keys) ? props.keys[0] : props.keys,\r\n      Colors.RED_4,\r\n      null\r\n    );\r\n    x += 2;\r\n  }\r\n\r\n  for (let i = 0; i < props.title.length; i++) {\r\n    C.display.drawOver(\r\n      i + x,\r\n      C.bounds.y,\r\n      props.title[i],\r\n      Colors.B_GREY_5,\r\n      null\r\n    );\r\n  }\r\n  C.handlers.hover = () => {\r\n    setState({ hover: true });\r\n  };\r\n  C.handlers.out = () => {\r\n    setState({ hover: false });\r\n  };\r\n\r\n  C.handlers.press = () => {\r\n    props.onClick();\r\n  };\r\n  handleKeyOnClick(C, props);\r\n};\r\n","import { Bounds } from \"../engine/space/bounds\";\r\nimport { RDisplay } from \"./RotDisplay\";\r\n\r\nexport const floodFill = (display: RDisplay, o: Bounds, bg: string) => {\r\n  const right = o.x + o.w;\r\n  const bottom = o.y + o.h;\r\n  for (let y = o.y; y < bottom; y++) {\r\n    for (let x = o.x; x < right; x++) {\r\n      display.draw(x, y, \" \", null, bg);\r\n    }\r\n  }\r\n};\r\n\r\nexport const borderFill = (display: RDisplay, o: Bounds) => {\r\n  const right = o.x + o.w - 1;\r\n  const bottom = o.y + o.h - 1;\r\n\r\n  display.draw(o.x, o.y, \"+\", null, null);\r\n  display.draw(o.x, bottom, \"+\", null, null);\r\n  display.draw(right, o.y, \"+\", null, null);\r\n  display.draw(right, bottom, \"+\", null, null);\r\n\r\n  for (let y = o.y + 1; y < bottom; y++) {\r\n    display.draw(o.x, y, \"|\", null, null);\r\n    display.draw(right, y, \"|\", null, null);\r\n  }\r\n  for (let x = o.x + 1; x < right; x++) {\r\n    display.draw(x, o.y, \"-\", null, null);\r\n    display.draw(x, bottom, \"-\", null, null);\r\n  }\r\n};\r\n\r\nexport const lineDraw = (display: RDisplay, o: Bounds, text?: string) => {\r\n  const right = o.x + o.w - 1;\r\n  for (let x = o.x; x <= right; x++) {\r\n    display.draw(x, o.y, \"-\", null, null);\r\n  }\r\n\r\n  if (text) {\r\n    const center = o.x + Math.floor((o.w - text.length) / 2);\r\n    const lx = Math.max(o.x, center);\r\n    display.drawText(lx, o.y, text);\r\n  }\r\n};\r\n\r\nexport const vertLineDraw = (display: RDisplay, o: Bounds) => {\r\n  const bot = o.y + o.h - 1;\r\n  for (let y = o.y; y <= bot; y++) {\r\n    display.draw(o.x, y, \"|\", null, null);\r\n  }\r\n};\r\n","import { ContextO } from \"../ui\";\r\n\r\nexport function handleKeyOnClick(\r\n  C: ContextO,\r\n  props: { keys: string | string[]; onClick: () => void }\r\n) {\r\n  if (props.keys) {\r\n    C.handlers.keypress = (key) => {\r\n      if (Array.isArray(props.keys)) {\r\n        for (let i = props.keys.length; i >= 0; i--) {\r\n          if (props.keys[i] === key) {\r\n            props.onClick();\r\n            return true;\r\n          }\r\n        }\r\n      } else if (props.keys === key) {\r\n        props.onClick();\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    };\r\n  }\r\n}\r\n","import { ComponentF, ComponentO } from \"../ui\";\r\n\r\nexport const Container: ComponentF<{ children: ComponentO[] }> = (C, props) => {\r\n  return props.children;\r\n};\r\n","import { Container } from \"../containers/Container\";\r\nimport { borderFill } from \"../helpers\";\r\nimport { ComponentF, ComponentO, createElement } from \"../ui\";\r\n\r\nexport const Panel: ComponentF<{ children: ComponentO[] }> = (C, props) => {\r\n  borderFill(C.display, C.bounds);\r\n  return [\r\n    createElement(\r\n      Container,\r\n      { x: 1, y: 1, w: C.bounds.w - 2, h: C.bounds.h - 2 },\r\n      props\r\n    ),\r\n  ];\r\n};\r\n","/**\n * This code is an implementation of Alea algorithm; (C) 2010 Johannes Baagøe.\n * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.\n */\nconst FRAC = 2.3283064365386963e-10; /* 2^-32 */\nclass RNG {\n    constructor() {\n        this._seed = 0;\n        this._s0 = 0;\n        this._s1 = 0;\n        this._s2 = 0;\n        this._c = 0;\n    }\n    getSeed() { return this._seed; }\n    /**\n     * Seed the number generator\n     */\n    setSeed(seed) {\n        seed = (seed < 1 ? 1 / seed : seed);\n        this._seed = seed;\n        this._s0 = (seed >>> 0) * FRAC;\n        seed = (seed * 69069 + 1) >>> 0;\n        this._s1 = seed * FRAC;\n        seed = (seed * 69069 + 1) >>> 0;\n        this._s2 = seed * FRAC;\n        this._c = 1;\n        return this;\n    }\n    /**\n     * @returns Pseudorandom value [0,1), uniformly distributed\n     */\n    getUniform() {\n        let t = 2091639 * this._s0 + this._c * FRAC;\n        this._s0 = this._s1;\n        this._s1 = this._s2;\n        this._c = t | 0;\n        this._s2 = t - this._c;\n        return this._s2;\n    }\n    /**\n     * @param lowerBound The lower end of the range to return a value from, inclusive\n     * @param upperBound The upper end of the range to return a value from, inclusive\n     * @returns Pseudorandom value [lowerBound, upperBound], using ROT.RNG.getUniform() to distribute the value\n     */\n    getUniformInt(lowerBound, upperBound) {\n        let max = Math.max(lowerBound, upperBound);\n        let min = Math.min(lowerBound, upperBound);\n        return Math.floor(this.getUniform() * (max - min + 1)) + min;\n    }\n    /**\n     * @param mean Mean value\n     * @param stddev Standard deviation. ~95% of the absolute values will be lower than 2*stddev.\n     * @returns A normally distributed pseudorandom value\n     */\n    getNormal(mean = 0, stddev = 1) {\n        let u, v, r;\n        do {\n            u = 2 * this.getUniform() - 1;\n            v = 2 * this.getUniform() - 1;\n            r = u * u + v * v;\n        } while (r > 1 || r == 0);\n        let gauss = u * Math.sqrt(-2 * Math.log(r) / r);\n        return mean + gauss * stddev;\n    }\n    /**\n     * @returns Pseudorandom value [1,100] inclusive, uniformly distributed\n     */\n    getPercentage() {\n        return 1 + Math.floor(this.getUniform() * 100);\n    }\n    /**\n     * @returns Randomly picked item, null when length=0\n     */\n    getItem(array) {\n        if (!array.length) {\n            return null;\n        }\n        return array[Math.floor(this.getUniform() * array.length)];\n    }\n    /**\n     * @returns New array with randomized items\n     */\n    shuffle(array) {\n        let result = [];\n        let clone = array.slice();\n        while (clone.length) {\n            let index = clone.indexOf(this.getItem(clone));\n            result.push(clone.splice(index, 1)[0]);\n        }\n        return result;\n    }\n    /**\n     * @param data key=whatever, value=weight (relative probability)\n     * @returns whatever\n     */\n    getWeightedValue(data) {\n        let total = 0;\n        for (let id in data) {\n            total += data[id];\n        }\n        let random = this.getUniform() * total;\n        let id, part = 0;\n        for (id in data) {\n            part += data[id];\n            if (random < part) {\n                return id;\n            }\n        }\n        // If by some floating-point annoyance we have\n        // random >= total, just return the last id.\n        return id;\n    }\n    /**\n     * Get RNG state. Useful for storing the state and re-setting it via setState.\n     * @returns Internal state\n     */\n    getState() { return [this._s0, this._s1, this._s2, this._c]; }\n    /**\n     * Set a previously retrieved state.\n     */\n    setState(state) {\n        this._s0 = state[0];\n        this._s1 = state[1];\n        this._s2 = state[2];\n        this._c = state[3];\n        return this;\n    }\n    /**\n     * Returns a cloned RNG\n     */\n    clone() {\n        let clone = new RNG();\n        return clone.setState(this.getState());\n    }\n}\nexport default new RNG().setSeed(Date.now());\n","/**\n * @class Abstract display backend module\n * @private\n */\nexport default class Backend {\n    getContainer() { return null; }\n    setOptions(options) { this._options = options; }\n}\n","import Backend from \"./backend.js\";\nexport default class Canvas extends Backend {\n    constructor() {\n        super();\n        this._ctx = document.createElement(\"canvas\").getContext(\"2d\");\n    }\n    schedule(cb) { requestAnimationFrame(cb); }\n    getContainer() { return this._ctx.canvas; }\n    setOptions(opts) {\n        super.setOptions(opts);\n        const style = (opts.fontStyle ? `${opts.fontStyle} ` : ``);\n        const font = `${style} ${opts.fontSize}px ${opts.fontFamily}`;\n        this._ctx.font = font;\n        this._updateSize();\n        this._ctx.font = font;\n        this._ctx.textAlign = \"center\";\n        this._ctx.textBaseline = \"middle\";\n    }\n    clear() {\n        this._ctx.fillStyle = this._options.bg;\n        this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n    }\n    eventToPosition(x, y) {\n        let canvas = this._ctx.canvas;\n        let rect = canvas.getBoundingClientRect();\n        x -= rect.left;\n        y -= rect.top;\n        x *= canvas.width / rect.width;\n        y *= canvas.height / rect.height;\n        if (x < 0 || y < 0 || x >= canvas.width || y >= canvas.height) {\n            return [-1, -1];\n        }\n        return this._normalizedEventToPosition(x, y);\n    }\n}\n","import Canvas from \"./canvas.js\";\nimport { mod } from \"../util.js\";\n/**\n * @class Hexagonal backend\n * @private\n */\nexport default class Hex extends Canvas {\n    constructor() {\n        super();\n        this._spacingX = 0;\n        this._spacingY = 0;\n        this._hexSize = 0;\n    }\n    draw(data, clearBefore) {\n        let [x, y, ch, fg, bg] = data;\n        let px = [\n            (x + 1) * this._spacingX,\n            y * this._spacingY + this._hexSize\n        ];\n        if (this._options.transpose) {\n            px.reverse();\n        }\n        if (clearBefore) {\n            this._ctx.fillStyle = bg;\n            this._fill(px[0], px[1]);\n        }\n        if (!ch) {\n            return;\n        }\n        this._ctx.fillStyle = fg;\n        let chars = [].concat(ch);\n        for (let i = 0; i < chars.length; i++) {\n            this._ctx.fillText(chars[i], px[0], Math.ceil(px[1]));\n        }\n    }\n    computeSize(availWidth, availHeight) {\n        if (this._options.transpose) {\n            availWidth += availHeight;\n            availHeight = availWidth - availHeight;\n            availWidth -= availHeight;\n        }\n        let width = Math.floor(availWidth / this._spacingX) - 1;\n        let height = Math.floor((availHeight - 2 * this._hexSize) / this._spacingY + 1);\n        return [width, height];\n    }\n    computeFontSize(availWidth, availHeight) {\n        if (this._options.transpose) {\n            availWidth += availHeight;\n            availHeight = availWidth - availHeight;\n            availWidth -= availHeight;\n        }\n        let hexSizeWidth = 2 * availWidth / ((this._options.width + 1) * Math.sqrt(3)) - 1;\n        let hexSizeHeight = availHeight / (2 + 1.5 * (this._options.height - 1));\n        let hexSize = Math.min(hexSizeWidth, hexSizeHeight);\n        // compute char ratio\n        let oldFont = this._ctx.font;\n        this._ctx.font = \"100px \" + this._options.fontFamily;\n        let width = Math.ceil(this._ctx.measureText(\"W\").width);\n        this._ctx.font = oldFont;\n        let ratio = width / 100;\n        hexSize = Math.floor(hexSize) + 1; // closest larger hexSize\n        // FIXME char size computation does not respect transposed hexes\n        let fontSize = 2 * hexSize / (this._options.spacing * (1 + ratio / Math.sqrt(3)));\n        // closest smaller fontSize\n        return Math.ceil(fontSize) - 1;\n    }\n    _normalizedEventToPosition(x, y) {\n        let nodeSize;\n        if (this._options.transpose) {\n            x += y;\n            y = x - y;\n            x -= y;\n            nodeSize = this._ctx.canvas.width;\n        }\n        else {\n            nodeSize = this._ctx.canvas.height;\n        }\n        let size = nodeSize / this._options.height;\n        y = Math.floor(y / size);\n        if (mod(y, 2)) { /* odd row */\n            x -= this._spacingX;\n            x = 1 + 2 * Math.floor(x / (2 * this._spacingX));\n        }\n        else {\n            x = 2 * Math.floor(x / (2 * this._spacingX));\n        }\n        return [x, y];\n    }\n    /**\n     * Arguments are pixel values. If \"transposed\" mode is enabled, then these two are already swapped.\n     */\n    _fill(cx, cy) {\n        let a = this._hexSize;\n        let b = this._options.border;\n        const ctx = this._ctx;\n        ctx.beginPath();\n        if (this._options.transpose) {\n            ctx.moveTo(cx - a + b, cy);\n            ctx.lineTo(cx - a / 2 + b, cy + this._spacingX - b);\n            ctx.lineTo(cx + a / 2 - b, cy + this._spacingX - b);\n            ctx.lineTo(cx + a - b, cy);\n            ctx.lineTo(cx + a / 2 - b, cy - this._spacingX + b);\n            ctx.lineTo(cx - a / 2 + b, cy - this._spacingX + b);\n            ctx.lineTo(cx - a + b, cy);\n        }\n        else {\n            ctx.moveTo(cx, cy - a + b);\n            ctx.lineTo(cx + this._spacingX - b, cy - a / 2 + b);\n            ctx.lineTo(cx + this._spacingX - b, cy + a / 2 - b);\n            ctx.lineTo(cx, cy + a - b);\n            ctx.lineTo(cx - this._spacingX + b, cy + a / 2 - b);\n            ctx.lineTo(cx - this._spacingX + b, cy - a / 2 + b);\n            ctx.lineTo(cx, cy - a + b);\n        }\n        ctx.fill();\n    }\n    _updateSize() {\n        const opts = this._options;\n        const charWidth = Math.ceil(this._ctx.measureText(\"W\").width);\n        this._hexSize = Math.floor(opts.spacing * (opts.fontSize + charWidth / Math.sqrt(3)) / 2);\n        this._spacingX = this._hexSize * Math.sqrt(3) / 2;\n        this._spacingY = this._hexSize * 1.5;\n        let xprop;\n        let yprop;\n        if (opts.transpose) {\n            xprop = \"height\";\n            yprop = \"width\";\n        }\n        else {\n            xprop = \"width\";\n            yprop = \"height\";\n        }\n        this._ctx.canvas[xprop] = Math.ceil((opts.width + 1) * this._spacingX);\n        this._ctx.canvas[yprop] = Math.ceil((opts.height - 1) * this._spacingY + 2 * this._hexSize);\n    }\n}\n","/**\n * Always positive modulus\n * @param x Operand\n * @param n Modulus\n * @returns x modulo n\n */\nexport function mod(x, n) {\n    return (x % n + n) % n;\n}\nexport function clamp(val, min = 0, max = 1) {\n    if (val < min)\n        return min;\n    if (val > max)\n        return max;\n    return val;\n}\nexport function capitalize(string) {\n    return string.charAt(0).toUpperCase() + string.substring(1);\n}\n/**\n * Format a string in a flexible way. Scans for %s strings and replaces them with arguments. List of patterns is modifiable via String.format.map.\n * @param {string} template\n * @param {any} [argv]\n */\nexport function format(template, ...args) {\n    let map = format.map;\n    let replacer = function (match, group1, group2, index) {\n        if (template.charAt(index - 1) == \"%\") {\n            return match.substring(1);\n        }\n        if (!args.length) {\n            return match;\n        }\n        let obj = args[0];\n        let group = group1 || group2;\n        let parts = group.split(\",\");\n        let name = parts.shift() || \"\";\n        let method = map[name.toLowerCase()];\n        if (!method) {\n            return match;\n        }\n        obj = args.shift();\n        let replaced = obj[method].apply(obj, parts);\n        let first = name.charAt(0);\n        if (first != first.toLowerCase()) {\n            replaced = capitalize(replaced);\n        }\n        return replaced;\n    };\n    return template.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi, replacer);\n}\nformat.map = {\n    \"s\": \"toString\"\n};\n","import Canvas from \"./canvas.js\";\n/**\n * @class Rectangular backend\n * @private\n */\nlet Rect = /** @class */ (() => {\n    class Rect extends Canvas {\n        constructor() {\n            super();\n            this._spacingX = 0;\n            this._spacingY = 0;\n            this._canvasCache = {};\n        }\n        setOptions(options) {\n            super.setOptions(options);\n            this._canvasCache = {};\n        }\n        draw(data, clearBefore) {\n            if (Rect.cache) {\n                this._drawWithCache(data);\n            }\n            else {\n                this._drawNoCache(data, clearBefore);\n            }\n        }\n        _drawWithCache(data) {\n            let [x, y, ch, fg, bg] = data;\n            let hash = \"\" + ch + fg + bg;\n            let canvas;\n            if (hash in this._canvasCache) {\n                canvas = this._canvasCache[hash];\n            }\n            else {\n                let b = this._options.border;\n                canvas = document.createElement(\"canvas\");\n                let ctx = canvas.getContext(\"2d\");\n                canvas.width = this._spacingX;\n                canvas.height = this._spacingY;\n                ctx.fillStyle = bg;\n                ctx.fillRect(b, b, canvas.width - b, canvas.height - b);\n                if (ch) {\n                    ctx.fillStyle = fg;\n                    ctx.font = this._ctx.font;\n                    ctx.textAlign = \"center\";\n                    ctx.textBaseline = \"middle\";\n                    let chars = [].concat(ch);\n                    for (let i = 0; i < chars.length; i++) {\n                        ctx.fillText(chars[i], this._spacingX / 2, Math.ceil(this._spacingY / 2));\n                    }\n                }\n                this._canvasCache[hash] = canvas;\n            }\n            this._ctx.drawImage(canvas, x * this._spacingX, y * this._spacingY);\n        }\n        _drawNoCache(data, clearBefore) {\n            let [x, y, ch, fg, bg] = data;\n            if (clearBefore) {\n                let b = this._options.border;\n                this._ctx.fillStyle = bg;\n                this._ctx.fillRect(x * this._spacingX + b, y * this._spacingY + b, this._spacingX - b, this._spacingY - b);\n            }\n            if (!ch) {\n                return;\n            }\n            this._ctx.fillStyle = fg;\n            let chars = [].concat(ch);\n            for (let i = 0; i < chars.length; i++) {\n                this._ctx.fillText(chars[i], (x + 0.5) * this._spacingX, Math.ceil((y + 0.5) * this._spacingY));\n            }\n        }\n        computeSize(availWidth, availHeight) {\n            let width = Math.floor(availWidth / this._spacingX);\n            let height = Math.floor(availHeight / this._spacingY);\n            return [width, height];\n        }\n        computeFontSize(availWidth, availHeight) {\n            let boxWidth = Math.floor(availWidth / this._options.width);\n            let boxHeight = Math.floor(availHeight / this._options.height);\n            /* compute char ratio */\n            let oldFont = this._ctx.font;\n            this._ctx.font = \"100px \" + this._options.fontFamily;\n            let width = Math.ceil(this._ctx.measureText(\"W\").width);\n            this._ctx.font = oldFont;\n            let ratio = width / 100;\n            let widthFraction = ratio * boxHeight / boxWidth;\n            if (widthFraction > 1) { /* too wide with current aspect ratio */\n                boxHeight = Math.floor(boxHeight / widthFraction);\n            }\n            return Math.floor(boxHeight / this._options.spacing);\n        }\n        _normalizedEventToPosition(x, y) {\n            return [Math.floor(x / this._spacingX), Math.floor(y / this._spacingY)];\n        }\n        _updateSize() {\n            const opts = this._options;\n            const charWidth = Math.ceil(this._ctx.measureText(\"W\").width);\n            this._spacingX = Math.ceil(opts.spacing * charWidth);\n            this._spacingY = Math.ceil(opts.spacing * opts.fontSize);\n            if (opts.forceSquareRatio) {\n                this._spacingX = this._spacingY = Math.max(this._spacingX, this._spacingY);\n            }\n            this._ctx.canvas.width = opts.width * this._spacingX;\n            this._ctx.canvas.height = opts.height * this._spacingY;\n        }\n    }\n    Rect.cache = false;\n    return Rect;\n})();\nexport default Rect;\n","import Canvas from \"./canvas.js\";\n/**\n * @class Tile backend\n * @private\n */\nexport default class Tile extends Canvas {\n    constructor() {\n        super();\n        this._colorCanvas = document.createElement(\"canvas\");\n    }\n    draw(data, clearBefore) {\n        let [x, y, ch, fg, bg] = data;\n        let tileWidth = this._options.tileWidth;\n        let tileHeight = this._options.tileHeight;\n        if (clearBefore) {\n            if (this._options.tileColorize) {\n                this._ctx.clearRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n            else {\n                this._ctx.fillStyle = bg;\n                this._ctx.fillRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n        }\n        if (!ch) {\n            return;\n        }\n        let chars = [].concat(ch);\n        let fgs = [].concat(fg);\n        let bgs = [].concat(bg);\n        for (let i = 0; i < chars.length; i++) {\n            let tile = this._options.tileMap[chars[i]];\n            if (!tile) {\n                throw new Error(`Char \"${chars[i]}\" not found in tileMap`);\n            }\n            if (this._options.tileColorize) { // apply colorization\n                let canvas = this._colorCanvas;\n                let context = canvas.getContext(\"2d\");\n                context.globalCompositeOperation = \"source-over\";\n                context.clearRect(0, 0, tileWidth, tileHeight);\n                let fg = fgs[i];\n                let bg = bgs[i];\n                context.drawImage(this._options.tileSet, tile[0], tile[1], tileWidth, tileHeight, 0, 0, tileWidth, tileHeight);\n                if (fg != \"transparent\") {\n                    context.fillStyle = fg;\n                    context.globalCompositeOperation = \"source-atop\";\n                    context.fillRect(0, 0, tileWidth, tileHeight);\n                }\n                if (bg != \"transparent\") {\n                    context.fillStyle = bg;\n                    context.globalCompositeOperation = \"destination-over\";\n                    context.fillRect(0, 0, tileWidth, tileHeight);\n                }\n                this._ctx.drawImage(canvas, x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n            else { // no colorizing, easy\n                this._ctx.drawImage(this._options.tileSet, tile[0], tile[1], tileWidth, tileHeight, x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n        }\n    }\n    computeSize(availWidth, availHeight) {\n        let width = Math.floor(availWidth / this._options.tileWidth);\n        let height = Math.floor(availHeight / this._options.tileHeight);\n        return [width, height];\n    }\n    computeFontSize() {\n        throw new Error(\"Tile backend does not understand font size\");\n    }\n    _normalizedEventToPosition(x, y) {\n        return [Math.floor(x / this._options.tileWidth), Math.floor(y / this._options.tileHeight)];\n    }\n    _updateSize() {\n        const opts = this._options;\n        this._ctx.canvas.width = opts.width * opts.tileWidth;\n        this._ctx.canvas.height = opts.height * opts.tileHeight;\n        this._colorCanvas.width = opts.tileWidth;\n        this._colorCanvas.height = opts.tileHeight;\n    }\n}\n","import { clamp } from \"./util.js\";\nimport RNG from \"./rng.js\";\nexport function fromString(str) {\n    let cached, r;\n    if (str in CACHE) {\n        cached = CACHE[str];\n    }\n    else {\n        if (str.charAt(0) == \"#\") { // hex rgb\n            let matched = str.match(/[0-9a-f]/gi) || [];\n            let values = matched.map((x) => parseInt(x, 16));\n            if (values.length == 3) {\n                cached = values.map((x) => x * 17);\n            }\n            else {\n                for (let i = 0; i < 3; i++) {\n                    values[i + 1] += 16 * values[i];\n                    values.splice(i, 1);\n                }\n                cached = values;\n            }\n        }\n        else if ((r = str.match(/rgb\\(([0-9, ]+)\\)/i))) { // decimal rgb\n            cached = r[1].split(/\\s*,\\s*/).map((x) => parseInt(x));\n        }\n        else { // html name\n            cached = [0, 0, 0];\n        }\n        CACHE[str] = cached;\n    }\n    return cached.slice();\n}\n/**\n * Add two or more colors\n */\nexport function add(color1, ...colors) {\n    let result = color1.slice();\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            result[i] += colors[j][i];\n        }\n    }\n    return result;\n}\n/**\n * Add two or more colors, MODIFIES FIRST ARGUMENT\n */\nexport function add_(color1, ...colors) {\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            color1[i] += colors[j][i];\n        }\n    }\n    return color1;\n}\n/**\n * Multiply (mix) two or more colors\n */\nexport function multiply(color1, ...colors) {\n    let result = color1.slice();\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            result[i] *= colors[j][i] / 255;\n        }\n        result[i] = Math.round(result[i]);\n    }\n    return result;\n}\n/**\n * Multiply (mix) two or more colors, MODIFIES FIRST ARGUMENT\n */\nexport function multiply_(color1, ...colors) {\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            color1[i] *= colors[j][i] / 255;\n        }\n        color1[i] = Math.round(color1[i]);\n    }\n    return color1;\n}\n/**\n * Interpolate (blend) two colors with a given factor\n */\nexport function interpolate(color1, color2, factor = 0.5) {\n    let result = color1.slice();\n    for (let i = 0; i < 3; i++) {\n        result[i] = Math.round(result[i] + factor * (color2[i] - color1[i]));\n    }\n    return result;\n}\nexport const lerp = interpolate;\n/**\n * Interpolate (blend) two colors with a given factor in HSL mode\n */\nexport function interpolateHSL(color1, color2, factor = 0.5) {\n    let hsl1 = rgb2hsl(color1);\n    let hsl2 = rgb2hsl(color2);\n    for (let i = 0; i < 3; i++) {\n        hsl1[i] += factor * (hsl2[i] - hsl1[i]);\n    }\n    return hsl2rgb(hsl1);\n}\nexport const lerpHSL = interpolateHSL;\n/**\n * Create a new random color based on this one\n * @param color\n * @param diff Set of standard deviations\n */\nexport function randomize(color, diff) {\n    if (!(diff instanceof Array)) {\n        diff = Math.round(RNG.getNormal(0, diff));\n    }\n    let result = color.slice();\n    for (let i = 0; i < 3; i++) {\n        result[i] += (diff instanceof Array ? Math.round(RNG.getNormal(0, diff[i])) : diff);\n    }\n    return result;\n}\n/**\n * Converts an RGB color value to HSL. Expects 0..255 inputs, produces 0..1 outputs.\n */\nexport function rgb2hsl(color) {\n    let r = color[0] / 255;\n    let g = color[1] / 255;\n    let b = color[2] / 255;\n    let max = Math.max(r, g, b), min = Math.min(r, g, b);\n    let h = 0, s, l = (max + min) / 2;\n    if (max == min) {\n        s = 0; // achromatic\n    }\n    else {\n        let d = max - min;\n        s = (l > 0.5 ? d / (2 - max - min) : d / (max + min));\n        switch (max) {\n            case r:\n                h = (g - b) / d + (g < b ? 6 : 0);\n                break;\n            case g:\n                h = (b - r) / d + 2;\n                break;\n            case b:\n                h = (r - g) / d + 4;\n                break;\n        }\n        h /= 6;\n    }\n    return [h, s, l];\n}\nfunction hue2rgb(p, q, t) {\n    if (t < 0)\n        t += 1;\n    if (t > 1)\n        t -= 1;\n    if (t < 1 / 6)\n        return p + (q - p) * 6 * t;\n    if (t < 1 / 2)\n        return q;\n    if (t < 2 / 3)\n        return p + (q - p) * (2 / 3 - t) * 6;\n    return p;\n}\n/**\n * Converts an HSL color value to RGB. Expects 0..1 inputs, produces 0..255 outputs.\n */\nexport function hsl2rgb(color) {\n    let l = color[2];\n    if (color[1] == 0) {\n        l = Math.round(l * 255);\n        return [l, l, l];\n    }\n    else {\n        let s = color[1];\n        let q = (l < 0.5 ? l * (1 + s) : l + s - l * s);\n        let p = 2 * l - q;\n        let r = hue2rgb(p, q, color[0] + 1 / 3);\n        let g = hue2rgb(p, q, color[0]);\n        let b = hue2rgb(p, q, color[0] - 1 / 3);\n        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\n    }\n}\nexport function toRGB(color) {\n    let clamped = color.map(x => clamp(x, 0, 255));\n    return `rgb(${clamped.join(\",\")})`;\n}\nexport function toHex(color) {\n    let clamped = color.map(x => clamp(x, 0, 255).toString(16).padStart(2, \"0\"));\n    return `#${clamped.join(\"\")}`;\n}\nconst CACHE = {\n    \"black\": [0, 0, 0],\n    \"navy\": [0, 0, 128],\n    \"darkblue\": [0, 0, 139],\n    \"mediumblue\": [0, 0, 205],\n    \"blue\": [0, 0, 255],\n    \"darkgreen\": [0, 100, 0],\n    \"green\": [0, 128, 0],\n    \"teal\": [0, 128, 128],\n    \"darkcyan\": [0, 139, 139],\n    \"deepskyblue\": [0, 191, 255],\n    \"darkturquoise\": [0, 206, 209],\n    \"mediumspringgreen\": [0, 250, 154],\n    \"lime\": [0, 255, 0],\n    \"springgreen\": [0, 255, 127],\n    \"aqua\": [0, 255, 255],\n    \"cyan\": [0, 255, 255],\n    \"midnightblue\": [25, 25, 112],\n    \"dodgerblue\": [30, 144, 255],\n    \"forestgreen\": [34, 139, 34],\n    \"seagreen\": [46, 139, 87],\n    \"darkslategray\": [47, 79, 79],\n    \"darkslategrey\": [47, 79, 79],\n    \"limegreen\": [50, 205, 50],\n    \"mediumseagreen\": [60, 179, 113],\n    \"turquoise\": [64, 224, 208],\n    \"royalblue\": [65, 105, 225],\n    \"steelblue\": [70, 130, 180],\n    \"darkslateblue\": [72, 61, 139],\n    \"mediumturquoise\": [72, 209, 204],\n    \"indigo\": [75, 0, 130],\n    \"darkolivegreen\": [85, 107, 47],\n    \"cadetblue\": [95, 158, 160],\n    \"cornflowerblue\": [100, 149, 237],\n    \"mediumaquamarine\": [102, 205, 170],\n    \"dimgray\": [105, 105, 105],\n    \"dimgrey\": [105, 105, 105],\n    \"slateblue\": [106, 90, 205],\n    \"olivedrab\": [107, 142, 35],\n    \"slategray\": [112, 128, 144],\n    \"slategrey\": [112, 128, 144],\n    \"lightslategray\": [119, 136, 153],\n    \"lightslategrey\": [119, 136, 153],\n    \"mediumslateblue\": [123, 104, 238],\n    \"lawngreen\": [124, 252, 0],\n    \"chartreuse\": [127, 255, 0],\n    \"aquamarine\": [127, 255, 212],\n    \"maroon\": [128, 0, 0],\n    \"purple\": [128, 0, 128],\n    \"olive\": [128, 128, 0],\n    \"gray\": [128, 128, 128],\n    \"grey\": [128, 128, 128],\n    \"skyblue\": [135, 206, 235],\n    \"lightskyblue\": [135, 206, 250],\n    \"blueviolet\": [138, 43, 226],\n    \"darkred\": [139, 0, 0],\n    \"darkmagenta\": [139, 0, 139],\n    \"saddlebrown\": [139, 69, 19],\n    \"darkseagreen\": [143, 188, 143],\n    \"lightgreen\": [144, 238, 144],\n    \"mediumpurple\": [147, 112, 216],\n    \"darkviolet\": [148, 0, 211],\n    \"palegreen\": [152, 251, 152],\n    \"darkorchid\": [153, 50, 204],\n    \"yellowgreen\": [154, 205, 50],\n    \"sienna\": [160, 82, 45],\n    \"brown\": [165, 42, 42],\n    \"darkgray\": [169, 169, 169],\n    \"darkgrey\": [169, 169, 169],\n    \"lightblue\": [173, 216, 230],\n    \"greenyellow\": [173, 255, 47],\n    \"paleturquoise\": [175, 238, 238],\n    \"lightsteelblue\": [176, 196, 222],\n    \"powderblue\": [176, 224, 230],\n    \"firebrick\": [178, 34, 34],\n    \"darkgoldenrod\": [184, 134, 11],\n    \"mediumorchid\": [186, 85, 211],\n    \"rosybrown\": [188, 143, 143],\n    \"darkkhaki\": [189, 183, 107],\n    \"silver\": [192, 192, 192],\n    \"mediumvioletred\": [199, 21, 133],\n    \"indianred\": [205, 92, 92],\n    \"peru\": [205, 133, 63],\n    \"chocolate\": [210, 105, 30],\n    \"tan\": [210, 180, 140],\n    \"lightgray\": [211, 211, 211],\n    \"lightgrey\": [211, 211, 211],\n    \"palevioletred\": [216, 112, 147],\n    \"thistle\": [216, 191, 216],\n    \"orchid\": [218, 112, 214],\n    \"goldenrod\": [218, 165, 32],\n    \"crimson\": [220, 20, 60],\n    \"gainsboro\": [220, 220, 220],\n    \"plum\": [221, 160, 221],\n    \"burlywood\": [222, 184, 135],\n    \"lightcyan\": [224, 255, 255],\n    \"lavender\": [230, 230, 250],\n    \"darksalmon\": [233, 150, 122],\n    \"violet\": [238, 130, 238],\n    \"palegoldenrod\": [238, 232, 170],\n    \"lightcoral\": [240, 128, 128],\n    \"khaki\": [240, 230, 140],\n    \"aliceblue\": [240, 248, 255],\n    \"honeydew\": [240, 255, 240],\n    \"azure\": [240, 255, 255],\n    \"sandybrown\": [244, 164, 96],\n    \"wheat\": [245, 222, 179],\n    \"beige\": [245, 245, 220],\n    \"whitesmoke\": [245, 245, 245],\n    \"mintcream\": [245, 255, 250],\n    \"ghostwhite\": [248, 248, 255],\n    \"salmon\": [250, 128, 114],\n    \"antiquewhite\": [250, 235, 215],\n    \"linen\": [250, 240, 230],\n    \"lightgoldenrodyellow\": [250, 250, 210],\n    \"oldlace\": [253, 245, 230],\n    \"red\": [255, 0, 0],\n    \"fuchsia\": [255, 0, 255],\n    \"magenta\": [255, 0, 255],\n    \"deeppink\": [255, 20, 147],\n    \"orangered\": [255, 69, 0],\n    \"tomato\": [255, 99, 71],\n    \"hotpink\": [255, 105, 180],\n    \"coral\": [255, 127, 80],\n    \"darkorange\": [255, 140, 0],\n    \"lightsalmon\": [255, 160, 122],\n    \"orange\": [255, 165, 0],\n    \"lightpink\": [255, 182, 193],\n    \"pink\": [255, 192, 203],\n    \"gold\": [255, 215, 0],\n    \"peachpuff\": [255, 218, 185],\n    \"navajowhite\": [255, 222, 173],\n    \"moccasin\": [255, 228, 181],\n    \"bisque\": [255, 228, 196],\n    \"mistyrose\": [255, 228, 225],\n    \"blanchedalmond\": [255, 235, 205],\n    \"papayawhip\": [255, 239, 213],\n    \"lavenderblush\": [255, 240, 245],\n    \"seashell\": [255, 245, 238],\n    \"cornsilk\": [255, 248, 220],\n    \"lemonchiffon\": [255, 250, 205],\n    \"floralwhite\": [255, 250, 240],\n    \"snow\": [255, 250, 250],\n    \"yellow\": [255, 255, 0],\n    \"lightyellow\": [255, 255, 224],\n    \"ivory\": [255, 255, 240],\n    \"white\": [255, 255, 255]\n};\n","import Backend from \"./backend.js\";\nimport * as Color from \"../color.js\";\n/**\n * @class Tile backend\n * @private\n */\nexport default class TileGL extends Backend {\n    constructor() {\n        super();\n        this._uniforms = {};\n        try {\n            this._gl = this._initWebGL();\n        }\n        catch (e) {\n            alert(e.message);\n        }\n    }\n    static isSupported() {\n        return !!document.createElement(\"canvas\").getContext(\"webgl2\", { preserveDrawingBuffer: true });\n    }\n    schedule(cb) { requestAnimationFrame(cb); }\n    getContainer() { return this._gl.canvas; }\n    setOptions(opts) {\n        super.setOptions(opts);\n        this._updateSize();\n        let tileSet = this._options.tileSet;\n        if (tileSet && \"complete\" in tileSet && !tileSet.complete) {\n            tileSet.addEventListener(\"load\", () => this._updateTexture(tileSet));\n        }\n        else {\n            this._updateTexture(tileSet);\n        }\n    }\n    draw(data, clearBefore) {\n        const gl = this._gl;\n        const opts = this._options;\n        let [x, y, ch, fg, bg] = data;\n        let scissorY = gl.canvas.height - (y + 1) * opts.tileHeight;\n        gl.scissor(x * opts.tileWidth, scissorY, opts.tileWidth, opts.tileHeight);\n        if (clearBefore) {\n            if (opts.tileColorize) {\n                gl.clearColor(0, 0, 0, 0);\n            }\n            else {\n                gl.clearColor(...parseColor(bg));\n            }\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n        if (!ch) {\n            return;\n        }\n        let chars = [].concat(ch);\n        let bgs = [].concat(bg);\n        let fgs = [].concat(fg);\n        gl.uniform2fv(this._uniforms[\"targetPosRel\"], [x, y]);\n        for (let i = 0; i < chars.length; i++) {\n            let tile = this._options.tileMap[chars[i]];\n            if (!tile) {\n                throw new Error(`Char \"${chars[i]}\" not found in tileMap`);\n            }\n            gl.uniform1f(this._uniforms[\"colorize\"], opts.tileColorize ? 1 : 0);\n            gl.uniform2fv(this._uniforms[\"tilesetPosAbs\"], tile);\n            if (opts.tileColorize) {\n                gl.uniform4fv(this._uniforms[\"tint\"], parseColor(fgs[i]));\n                gl.uniform4fv(this._uniforms[\"bg\"], parseColor(bgs[i]));\n            }\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        }\n        /*\n        \n        \n                for (let i=0;i<chars.length;i++) {\n        \n                    if (this._options.tileColorize) { // apply colorization\n                        let canvas = this._colorCanvas;\n                        let context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n                        context.globalCompositeOperation = \"source-over\";\n                        context.clearRect(0, 0, tileWidth, tileHeight);\n        \n                        let fg = fgs[i];\n                        let bg = bgs[i];\n        \n                        context.drawImage(\n                            this._options.tileSet!,\n                            tile[0], tile[1], tileWidth, tileHeight,\n                            0, 0, tileWidth, tileHeight\n                        );\n        \n                        if (fg != \"transparent\") {\n                            context.fillStyle = fg;\n                            context.globalCompositeOperation = \"source-atop\";\n                            context.fillRect(0, 0, tileWidth, tileHeight);\n                        }\n        \n                        if (bg != \"transparent\") {\n                            context.fillStyle = bg;\n                            context.globalCompositeOperation = \"destination-over\";\n                            context.fillRect(0, 0, tileWidth, tileHeight);\n                        }\n        \n                        this._ctx.drawImage(canvas, x*tileWidth, y*tileHeight, tileWidth, tileHeight);\n                    } else { // no colorizing, easy\n                        this._ctx.drawImage(\n                            this._options.tileSet!,\n                            tile[0], tile[1], tileWidth, tileHeight,\n                            x*tileWidth, y*tileHeight, tileWidth, tileHeight\n                        );\n                    }\n                }\n        \n        */\n    }\n    clear() {\n        const gl = this._gl;\n        gl.clearColor(...parseColor(this._options.bg));\n        gl.scissor(0, 0, gl.canvas.width, gl.canvas.height);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n    computeSize(availWidth, availHeight) {\n        let width = Math.floor(availWidth / this._options.tileWidth);\n        let height = Math.floor(availHeight / this._options.tileHeight);\n        return [width, height];\n    }\n    computeFontSize() {\n        throw new Error(\"Tile backend does not understand font size\");\n    }\n    eventToPosition(x, y) {\n        let canvas = this._gl.canvas;\n        let rect = canvas.getBoundingClientRect();\n        x -= rect.left;\n        y -= rect.top;\n        x *= canvas.width / rect.width;\n        y *= canvas.height / rect.height;\n        if (x < 0 || y < 0 || x >= canvas.width || y >= canvas.height) {\n            return [-1, -1];\n        }\n        return this._normalizedEventToPosition(x, y);\n    }\n    _initWebGL() {\n        let gl = document.createElement(\"canvas\").getContext(\"webgl2\", { preserveDrawingBuffer: true });\n        window.gl = gl;\n        let program = createProgram(gl, VS, FS);\n        gl.useProgram(program);\n        createQuad(gl);\n        UNIFORMS.forEach(name => this._uniforms[name] = gl.getUniformLocation(program, name));\n        this._program = program;\n        gl.enable(gl.BLEND);\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n        gl.enable(gl.SCISSOR_TEST);\n        return gl;\n    }\n    _normalizedEventToPosition(x, y) {\n        return [Math.floor(x / this._options.tileWidth), Math.floor(y / this._options.tileHeight)];\n    }\n    _updateSize() {\n        const gl = this._gl;\n        const opts = this._options;\n        const canvasSize = [opts.width * opts.tileWidth, opts.height * opts.tileHeight];\n        gl.canvas.width = canvasSize[0];\n        gl.canvas.height = canvasSize[1];\n        gl.viewport(0, 0, canvasSize[0], canvasSize[1]);\n        gl.uniform2fv(this._uniforms[\"tileSize\"], [opts.tileWidth, opts.tileHeight]);\n        gl.uniform2fv(this._uniforms[\"targetSize\"], canvasSize);\n    }\n    _updateTexture(tileSet) {\n        createTexture(this._gl, tileSet);\n    }\n}\nconst UNIFORMS = [\"targetPosRel\", \"tilesetPosAbs\", \"tileSize\", \"targetSize\", \"colorize\", \"bg\", \"tint\"];\nconst VS = `\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}`.trim();\nconst FS = `\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}`.trim();\nfunction createProgram(gl, vss, fss) {\n    const vs = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vs, vss);\n    gl.compileShader(vs);\n    if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\n        throw new Error(gl.getShaderInfoLog(vs) || \"\");\n    }\n    const fs = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fs, fss);\n    gl.compileShader(fs);\n    if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\n        throw new Error(gl.getShaderInfoLog(fs) || \"\");\n    }\n    const p = gl.createProgram();\n    gl.attachShader(p, vs);\n    gl.attachShader(p, fs);\n    gl.linkProgram(p);\n    if (!gl.getProgramParameter(p, gl.LINK_STATUS)) {\n        throw new Error(gl.getProgramInfoLog(p) || \"\");\n    }\n    return p;\n}\nfunction createQuad(gl) {\n    const pos = new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]);\n    const buf = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buf);\n    gl.bufferData(gl.ARRAY_BUFFER, pos, gl.STATIC_DRAW);\n    gl.enableVertexAttribArray(0);\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n}\nfunction createTexture(gl, data) {\n    let t = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, t);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 0);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n    return t;\n}\nlet colorCache = {};\nfunction parseColor(color) {\n    if (!(color in colorCache)) {\n        let parsed;\n        if (color == \"transparent\") {\n            parsed = [0, 0, 0, 0];\n        }\n        else if (color.indexOf(\"rgba\") > -1) {\n            parsed = (color.match(/[\\d.]+/g) || []).map(Number);\n            for (let i = 0; i < 3; i++) {\n                parsed[i] = parsed[i] / 255;\n            }\n        }\n        else {\n            parsed = Color.fromString(color).map($ => $ / 255);\n            parsed.push(1);\n        }\n        colorCache[color] = parsed;\n    }\n    return colorCache[color];\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import Backend from \"./backend.js\";\nimport * as Color from \"../color.js\";\nfunction clearToAnsi(bg) {\n    return `\\x1b[0;48;5;${termcolor(bg)}m\\x1b[2J`;\n}\nfunction colorToAnsi(fg, bg) {\n    return `\\x1b[0;38;5;${termcolor(fg)};48;5;${termcolor(bg)}m`;\n}\nfunction positionToAnsi(x, y) {\n    return `\\x1b[${y + 1};${x + 1}H`;\n}\nfunction termcolor(color) {\n    const SRC_COLORS = 256.0;\n    const DST_COLORS = 6.0;\n    const COLOR_RATIO = DST_COLORS / SRC_COLORS;\n    let rgb = Color.fromString(color);\n    let r = Math.floor(rgb[0] * COLOR_RATIO);\n    let g = Math.floor(rgb[1] * COLOR_RATIO);\n    let b = Math.floor(rgb[2] * COLOR_RATIO);\n    return r * 36 + g * 6 + b * 1 + 16;\n}\nexport default class Term extends Backend {\n    constructor() {\n        super();\n        this._offset = [0, 0];\n        this._cursor = [-1, -1];\n        this._lastColor = \"\";\n    }\n    schedule(cb) { setTimeout(cb, 1000 / 60); }\n    setOptions(options) {\n        super.setOptions(options);\n        let size = [options.width, options.height];\n        let avail = this.computeSize();\n        this._offset = avail.map((val, index) => Math.floor((val - size[index]) / 2));\n    }\n    clear() {\n        process.stdout.write(clearToAnsi(this._options.bg));\n    }\n    draw(data, clearBefore) {\n        // determine where to draw what with what colors\n        let [x, y, ch, fg, bg] = data;\n        // determine if we need to move the terminal cursor\n        let dx = this._offset[0] + x;\n        let dy = this._offset[1] + y;\n        let size = this.computeSize();\n        if (dx < 0 || dx >= size[0]) {\n            return;\n        }\n        if (dy < 0 || dy >= size[1]) {\n            return;\n        }\n        if (dx !== this._cursor[0] || dy !== this._cursor[1]) {\n            process.stdout.write(positionToAnsi(dx, dy));\n            this._cursor[0] = dx;\n            this._cursor[1] = dy;\n        }\n        // terminals automatically clear, but if we're clearing when we're\n        // not otherwise provided with a character, just use a space instead\n        if (clearBefore) {\n            if (!ch) {\n                ch = \" \";\n            }\n        }\n        // if we're not clearing and not provided with a character, do nothing\n        if (!ch) {\n            return;\n        }\n        // determine if we need to change colors\n        let newColor = colorToAnsi(fg, bg);\n        if (newColor !== this._lastColor) {\n            process.stdout.write(newColor);\n            this._lastColor = newColor;\n        }\n        if (ch != '\\t') {\n            // write the provided symbol to the display\n            let chars = [].concat(ch);\n            process.stdout.write(chars[0]);\n        }\n        // update our position, given that we wrote a character\n        this._cursor[0]++;\n        if (this._cursor[0] >= size[0]) {\n            this._cursor[0] = 0;\n            this._cursor[1]++;\n        }\n    }\n    computeFontSize() { throw new Error(\"Terminal backend has no notion of font size\"); }\n    eventToPosition(x, y) { return [x, y]; }\n    computeSize() { return [process.stdout.columns, process.stdout.rows]; }\n}\n","/**\n * @namespace\n * Contains text tokenization and breaking routines\n */\nconst RE_COLORS = /%([bc]){([^}]*)}/g;\n// token types\nexport const TYPE_TEXT = 0;\nexport const TYPE_NEWLINE = 1;\nexport const TYPE_FG = 2;\nexport const TYPE_BG = 3;\n/**\n * Measure size of a resulting text block\n */\nexport function measure(str, maxWidth) {\n    let result = { width: 0, height: 1 };\n    let tokens = tokenize(str, maxWidth);\n    let lineWidth = 0;\n    for (let i = 0; i < tokens.length; i++) {\n        let token = tokens[i];\n        switch (token.type) {\n            case TYPE_TEXT:\n                lineWidth += token.value.length;\n                break;\n            case TYPE_NEWLINE:\n                result.height++;\n                result.width = Math.max(result.width, lineWidth);\n                lineWidth = 0;\n                break;\n        }\n    }\n    result.width = Math.max(result.width, lineWidth);\n    return result;\n}\n/**\n * Convert string to a series of a formatting commands\n */\nexport function tokenize(str, maxWidth) {\n    let result = [];\n    /* first tokenization pass - split texts and color formatting commands */\n    let offset = 0;\n    str.replace(RE_COLORS, function (match, type, name, index) {\n        /* string before */\n        let part = str.substring(offset, index);\n        if (part.length) {\n            result.push({\n                type: TYPE_TEXT,\n                value: part\n            });\n        }\n        /* color command */\n        result.push({\n            type: (type == \"c\" ? TYPE_FG : TYPE_BG),\n            value: name.trim()\n        });\n        offset = index + match.length;\n        return \"\";\n    });\n    /* last remaining part */\n    let part = str.substring(offset);\n    if (part.length) {\n        result.push({\n            type: TYPE_TEXT,\n            value: part\n        });\n    }\n    return breakLines(result, maxWidth);\n}\n/* insert line breaks into first-pass tokenized data */\nfunction breakLines(tokens, maxWidth) {\n    if (!maxWidth) {\n        maxWidth = Infinity;\n    }\n    let i = 0;\n    let lineLength = 0;\n    let lastTokenWithSpace = -1;\n    while (i < tokens.length) { /* take all text tokens, remove space, apply linebreaks */\n        let token = tokens[i];\n        if (token.type == TYPE_NEWLINE) { /* reset */\n            lineLength = 0;\n            lastTokenWithSpace = -1;\n        }\n        if (token.type != TYPE_TEXT) { /* skip non-text tokens */\n            i++;\n            continue;\n        }\n        /* remove spaces at the beginning of line */\n        while (lineLength == 0 && token.value.charAt(0) == \" \") {\n            token.value = token.value.substring(1);\n        }\n        /* forced newline? insert two new tokens after this one */\n        let index = token.value.indexOf(\"\\n\");\n        if (index != -1) {\n            token.value = breakInsideToken(tokens, i, index, true);\n            /* if there are spaces at the end, we must remove them (we do not want the line too long) */\n            let arr = token.value.split(\"\");\n            while (arr.length && arr[arr.length - 1] == \" \") {\n                arr.pop();\n            }\n            token.value = arr.join(\"\");\n        }\n        /* token degenerated? */\n        if (!token.value.length) {\n            tokens.splice(i, 1);\n            continue;\n        }\n        if (lineLength + token.value.length > maxWidth) { /* line too long, find a suitable breaking spot */\n            /* is it possible to break within this token? */\n            let index = -1;\n            while (1) {\n                let nextIndex = token.value.indexOf(\" \", index + 1);\n                if (nextIndex == -1) {\n                    break;\n                }\n                if (lineLength + nextIndex > maxWidth) {\n                    break;\n                }\n                index = nextIndex;\n            }\n            if (index != -1) { /* break at space within this one */\n                token.value = breakInsideToken(tokens, i, index, true);\n            }\n            else if (lastTokenWithSpace != -1) { /* is there a previous token where a break can occur? */\n                let token = tokens[lastTokenWithSpace];\n                let breakIndex = token.value.lastIndexOf(\" \");\n                token.value = breakInsideToken(tokens, lastTokenWithSpace, breakIndex, true);\n                i = lastTokenWithSpace;\n            }\n            else { /* force break in this token */\n                token.value = breakInsideToken(tokens, i, maxWidth - lineLength, false);\n            }\n        }\n        else { /* line not long, continue */\n            lineLength += token.value.length;\n            if (token.value.indexOf(\" \") != -1) {\n                lastTokenWithSpace = i;\n            }\n        }\n        i++; /* advance to next token */\n    }\n    tokens.push({ type: TYPE_NEWLINE }); /* insert fake newline to fix the last text line */\n    /* remove trailing space from text tokens before newlines */\n    let lastTextToken = null;\n    for (let i = 0; i < tokens.length; i++) {\n        let token = tokens[i];\n        switch (token.type) {\n            case TYPE_TEXT:\n                lastTextToken = token;\n                break;\n            case TYPE_NEWLINE:\n                if (lastTextToken) { /* remove trailing space */\n                    let arr = lastTextToken.value.split(\"\");\n                    while (arr.length && arr[arr.length - 1] == \" \") {\n                        arr.pop();\n                    }\n                    lastTextToken.value = arr.join(\"\");\n                }\n                lastTextToken = null;\n                break;\n        }\n    }\n    tokens.pop(); /* remove fake token */\n    return tokens;\n}\n/**\n * Create new tokens and insert them into the stream\n * @param {object[]} tokens\n * @param {int} tokenIndex Token being processed\n * @param {int} breakIndex Index within current token's value\n * @param {bool} removeBreakChar Do we want to remove the breaking character?\n * @returns {string} remaining unbroken token value\n */\nfunction breakInsideToken(tokens, tokenIndex, breakIndex, removeBreakChar) {\n    let newBreakToken = {\n        type: TYPE_NEWLINE\n    };\n    let newTextToken = {\n        type: TYPE_TEXT,\n        value: tokens[tokenIndex].value.substring(breakIndex + (removeBreakChar ? 1 : 0))\n    };\n    tokens.splice(tokenIndex + 1, 0, newBreakToken, newTextToken);\n    return tokens[tokenIndex].value.substring(0, breakIndex);\n}\n","import Hex from \"./hex.js\";\nimport Rect from \"./rect.js\";\nimport Tile from \"./tile.js\";\nimport TileGL from \"./tile-gl.js\";\nimport Term from \"./term.js\";\nimport * as Text from \"../text.js\";\nimport { DEFAULT_WIDTH, DEFAULT_HEIGHT } from \"../constants.js\";\nconst BACKENDS = {\n    \"hex\": Hex,\n    \"rect\": Rect,\n    \"tile\": Tile,\n    \"tile-gl\": TileGL,\n    \"term\": Term\n};\nconst DEFAULT_OPTIONS = {\n    width: DEFAULT_WIDTH,\n    height: DEFAULT_HEIGHT,\n    transpose: false,\n    layout: \"rect\",\n    fontSize: 15,\n    spacing: 1,\n    border: 0,\n    forceSquareRatio: false,\n    fontFamily: \"monospace\",\n    fontStyle: \"\",\n    fg: \"#ccc\",\n    bg: \"#000\",\n    tileWidth: 32,\n    tileHeight: 32,\n    tileMap: {},\n    tileSet: null,\n    tileColorize: false\n};\n/**\n * @class Visual map display\n */\nlet Display = /** @class */ (() => {\n    class Display {\n        constructor(options = {}) {\n            this._data = {};\n            this._dirty = false; // false = nothing, true = all, object = dirty cells\n            this._options = {};\n            options = Object.assign({}, DEFAULT_OPTIONS, options);\n            this.setOptions(options);\n            this.DEBUG = this.DEBUG.bind(this);\n            this._tick = this._tick.bind(this);\n            this._backend.schedule(this._tick);\n        }\n        /**\n         * Debug helper, ideal as a map generator callback. Always bound to this.\n         * @param {int} x\n         * @param {int} y\n         * @param {int} what\n         */\n        DEBUG(x, y, what) {\n            let colors = [this._options.bg, this._options.fg];\n            this.draw(x, y, null, null, colors[what % colors.length]);\n        }\n        /**\n         * Clear the whole display (cover it with background color)\n         */\n        clear() {\n            this._data = {};\n            this._dirty = true;\n        }\n        /**\n         * @see ROT.Display\n         */\n        setOptions(options) {\n            Object.assign(this._options, options);\n            if (options.width || options.height || options.fontSize || options.fontFamily || options.spacing || options.layout) {\n                if (options.layout) {\n                    let ctor = BACKENDS[options.layout];\n                    this._backend = new ctor();\n                }\n                this._backend.setOptions(this._options);\n                this._dirty = true;\n            }\n            return this;\n        }\n        /**\n         * Returns currently set options\n         */\n        getOptions() { return this._options; }\n        /**\n         * Returns the DOM node of this display\n         */\n        getContainer() { return this._backend.getContainer(); }\n        /**\n         * Compute the maximum width/height to fit into a set of given constraints\n         * @param {int} availWidth Maximum allowed pixel width\n         * @param {int} availHeight Maximum allowed pixel height\n         * @returns {int[2]} cellWidth,cellHeight\n         */\n        computeSize(availWidth, availHeight) {\n            return this._backend.computeSize(availWidth, availHeight);\n        }\n        /**\n         * Compute the maximum font size to fit into a set of given constraints\n         * @param {int} availWidth Maximum allowed pixel width\n         * @param {int} availHeight Maximum allowed pixel height\n         * @returns {int} fontSize\n         */\n        computeFontSize(availWidth, availHeight) {\n            return this._backend.computeFontSize(availWidth, availHeight);\n        }\n        computeTileSize(availWidth, availHeight) {\n            let width = Math.floor(availWidth / this._options.width);\n            let height = Math.floor(availHeight / this._options.height);\n            return [width, height];\n        }\n        /**\n         * Convert a DOM event (mouse or touch) to map coordinates. Uses first touch for multi-touch.\n         * @param {Event} e event\n         * @returns {int[2]} -1 for values outside of the canvas\n         */\n        eventToPosition(e) {\n            let x, y;\n            if (\"touches\" in e) {\n                x = e.touches[0].clientX;\n                y = e.touches[0].clientY;\n            }\n            else {\n                x = e.clientX;\n                y = e.clientY;\n            }\n            return this._backend.eventToPosition(x, y);\n        }\n        /**\n         * @param {int} x\n         * @param {int} y\n         * @param {string || string[]} ch One or more chars (will be overlapping themselves)\n         * @param {string} [fg] foreground color\n         * @param {string} [bg] background color\n         */\n        draw(x, y, ch, fg, bg) {\n            if (!fg) {\n                fg = this._options.fg;\n            }\n            if (!bg) {\n                bg = this._options.bg;\n            }\n            let key = `${x},${y}`;\n            this._data[key] = [x, y, ch, fg, bg];\n            if (this._dirty === true) {\n                return;\n            } // will already redraw everything \n            if (!this._dirty) {\n                this._dirty = {};\n            } // first!\n            this._dirty[key] = true;\n        }\n        /**\n         * Draws a text at given position. Optionally wraps at a maximum length. Currently does not work with hex layout.\n         * @param {int} x\n         * @param {int} y\n         * @param {string} text May contain color/background format specifiers, %c{name}/%b{name}, both optional. %c{}/%b{} resets to default.\n         * @param {int} [maxWidth] wrap at what width?\n         * @returns {int} lines drawn\n         */\n        drawText(x, y, text, maxWidth) {\n            let fg = null;\n            let bg = null;\n            let cx = x;\n            let cy = y;\n            let lines = 1;\n            if (!maxWidth) {\n                maxWidth = this._options.width - x;\n            }\n            let tokens = Text.tokenize(text, maxWidth);\n            while (tokens.length) { // interpret tokenized opcode stream\n                let token = tokens.shift();\n                switch (token.type) {\n                    case Text.TYPE_TEXT:\n                        let isSpace = false, isPrevSpace = false, isFullWidth = false, isPrevFullWidth = false;\n                        for (let i = 0; i < token.value.length; i++) {\n                            let cc = token.value.charCodeAt(i);\n                            let c = token.value.charAt(i);\n                            if (this._options.layout === \"term\") {\n                                let cch = cc >> 8;\n                                let isCJK = cch === 0x11 || (cch >= 0x2e && cch <= 0x9f) || (cch >= 0xac && cch <= 0xd7) || (cc >= 0xA960 && cc <= 0xA97F);\n                                if (isCJK) {\n                                    this.draw(cx + 0, cy, c, fg, bg);\n                                    this.draw(cx + 1, cy, \"\\t\", fg, bg);\n                                    cx += 2;\n                                    continue;\n                                }\n                            }\n                            // Assign to `true` when the current char is full-width.\n                            isFullWidth = (cc > 0xff00 && cc < 0xff61) || (cc > 0xffdc && cc < 0xffe8) || cc > 0xffee;\n                            // Current char is space, whatever full-width or half-width both are OK.\n                            isSpace = (c.charCodeAt(0) == 0x20 || c.charCodeAt(0) == 0x3000);\n                            // The previous char is full-width and\n                            // current char is nether half-width nor a space.\n                            if (isPrevFullWidth && !isFullWidth && !isSpace) {\n                                cx++;\n                            } // add an extra position\n                            // The current char is full-width and\n                            // the previous char is not a space.\n                            if (isFullWidth && !isPrevSpace) {\n                                cx++;\n                            } // add an extra position\n                            this.draw(cx++, cy, c, fg, bg);\n                            isPrevSpace = isSpace;\n                            isPrevFullWidth = isFullWidth;\n                        }\n                        break;\n                    case Text.TYPE_FG:\n                        fg = token.value || null;\n                        break;\n                    case Text.TYPE_BG:\n                        bg = token.value || null;\n                        break;\n                    case Text.TYPE_NEWLINE:\n                        cx = x;\n                        cy++;\n                        lines++;\n                        break;\n                }\n            }\n            return lines;\n        }\n        /**\n         * Timer tick: update dirty parts\n         */\n        _tick() {\n            this._backend.schedule(this._tick);\n            if (!this._dirty) {\n                return;\n            }\n            if (this._dirty === true) { // draw all\n                this._backend.clear();\n                for (let id in this._data) {\n                    this._draw(id, false);\n                } // redraw cached data \n            }\n            else { // draw only dirty \n                for (let key in this._dirty) {\n                    this._draw(key, true);\n                }\n            }\n            this._dirty = false;\n        }\n        /**\n         * @param {string} key What to draw\n         * @param {bool} clearBefore Is it necessary to clean before?\n         */\n        _draw(key, clearBefore) {\n            let data = this._data[key];\n            if (data[4] != this._options.bg) {\n                clearBefore = true;\n            }\n            this._backend.draw(data, clearBefore);\n        }\n    }\n    Display.Rect = Rect;\n    Display.Hex = Hex;\n    Display.Tile = Tile;\n    Display.TileGL = TileGL;\n    Display.Term = Term;\n    return Display;\n})();\nexport default Display;\n","/** Default with for display and map generators */\nexport let DEFAULT_WIDTH = 80;\n/** Default height for display and map generators */\nexport let DEFAULT_HEIGHT = 25;\nexport const DIRS = {\n    4: [[0, -1], [1, 0], [0, 1], [-1, 0]],\n    8: [[0, -1], [1, -1], [1, 0], [1, 1], [0, 1], [-1, 1], [-1, 0], [-1, -1]],\n    6: [[-1, -1], [1, -1], [2, 0], [1, 1], [-1, 1], [-2, 0]]\n};\nexport const KEYS = {\n    /** Cancel key. */\n    VK_CANCEL: 3,\n    /** Help key. */\n    VK_HELP: 6,\n    /** Backspace key. */\n    VK_BACK_SPACE: 8,\n    /** Tab key. */\n    VK_TAB: 9,\n    /** 5 key on Numpad when NumLock is unlocked. Or on Mac, clear key which is positioned at NumLock key. */\n    VK_CLEAR: 12,\n    /** Return/enter key on the main keyboard. */\n    VK_RETURN: 13,\n    /** Reserved, but not used. */\n    VK_ENTER: 14,\n    /** Shift key. */\n    VK_SHIFT: 16,\n    /** Control key. */\n    VK_CONTROL: 17,\n    /** Alt (Option on Mac) key. */\n    VK_ALT: 18,\n    /** Pause key. */\n    VK_PAUSE: 19,\n    /** Caps lock. */\n    VK_CAPS_LOCK: 20,\n    /** Escape key. */\n    VK_ESCAPE: 27,\n    /** Space bar. */\n    VK_SPACE: 32,\n    /** Page Up key. */\n    VK_PAGE_UP: 33,\n    /** Page Down key. */\n    VK_PAGE_DOWN: 34,\n    /** End key. */\n    VK_END: 35,\n    /** Home key. */\n    VK_HOME: 36,\n    /** Left arrow. */\n    VK_LEFT: 37,\n    /** Up arrow. */\n    VK_UP: 38,\n    /** Right arrow. */\n    VK_RIGHT: 39,\n    /** Down arrow. */\n    VK_DOWN: 40,\n    /** Print Screen key. */\n    VK_PRINTSCREEN: 44,\n    /** Ins(ert) key. */\n    VK_INSERT: 45,\n    /** Del(ete) key. */\n    VK_DELETE: 46,\n    /***/\n    VK_0: 48,\n    /***/\n    VK_1: 49,\n    /***/\n    VK_2: 50,\n    /***/\n    VK_3: 51,\n    /***/\n    VK_4: 52,\n    /***/\n    VK_5: 53,\n    /***/\n    VK_6: 54,\n    /***/\n    VK_7: 55,\n    /***/\n    VK_8: 56,\n    /***/\n    VK_9: 57,\n    /** Colon (:) key. Requires Gecko 15.0 */\n    VK_COLON: 58,\n    /** Semicolon (;) key. */\n    VK_SEMICOLON: 59,\n    /** Less-than (<) key. Requires Gecko 15.0 */\n    VK_LESS_THAN: 60,\n    /** Equals (=) key. */\n    VK_EQUALS: 61,\n    /** Greater-than (>) key. Requires Gecko 15.0 */\n    VK_GREATER_THAN: 62,\n    /** Question mark (?) key. Requires Gecko 15.0 */\n    VK_QUESTION_MARK: 63,\n    /** Atmark (@) key. Requires Gecko 15.0 */\n    VK_AT: 64,\n    /***/\n    VK_A: 65,\n    /***/\n    VK_B: 66,\n    /***/\n    VK_C: 67,\n    /***/\n    VK_D: 68,\n    /***/\n    VK_E: 69,\n    /***/\n    VK_F: 70,\n    /***/\n    VK_G: 71,\n    /***/\n    VK_H: 72,\n    /***/\n    VK_I: 73,\n    /***/\n    VK_J: 74,\n    /***/\n    VK_K: 75,\n    /***/\n    VK_L: 76,\n    /***/\n    VK_M: 77,\n    /***/\n    VK_N: 78,\n    /***/\n    VK_O: 79,\n    /***/\n    VK_P: 80,\n    /***/\n    VK_Q: 81,\n    /***/\n    VK_R: 82,\n    /***/\n    VK_S: 83,\n    /***/\n    VK_T: 84,\n    /***/\n    VK_U: 85,\n    /***/\n    VK_V: 86,\n    /***/\n    VK_W: 87,\n    /***/\n    VK_X: 88,\n    /***/\n    VK_Y: 89,\n    /***/\n    VK_Z: 90,\n    /***/\n    VK_CONTEXT_MENU: 93,\n    /** 0 on the numeric keypad. */\n    VK_NUMPAD0: 96,\n    /** 1 on the numeric keypad. */\n    VK_NUMPAD1: 97,\n    /** 2 on the numeric keypad. */\n    VK_NUMPAD2: 98,\n    /** 3 on the numeric keypad. */\n    VK_NUMPAD3: 99,\n    /** 4 on the numeric keypad. */\n    VK_NUMPAD4: 100,\n    /** 5 on the numeric keypad. */\n    VK_NUMPAD5: 101,\n    /** 6 on the numeric keypad. */\n    VK_NUMPAD6: 102,\n    /** 7 on the numeric keypad. */\n    VK_NUMPAD7: 103,\n    /** 8 on the numeric keypad. */\n    VK_NUMPAD8: 104,\n    /** 9 on the numeric keypad. */\n    VK_NUMPAD9: 105,\n    /** * on the numeric keypad. */\n    VK_MULTIPLY: 106,\n    /** + on the numeric keypad. */\n    VK_ADD: 107,\n    /***/\n    VK_SEPARATOR: 108,\n    /** - on the numeric keypad. */\n    VK_SUBTRACT: 109,\n    /** Decimal point on the numeric keypad. */\n    VK_DECIMAL: 110,\n    /** / on the numeric keypad. */\n    VK_DIVIDE: 111,\n    /** F1 key. */\n    VK_F1: 112,\n    /** F2 key. */\n    VK_F2: 113,\n    /** F3 key. */\n    VK_F3: 114,\n    /** F4 key. */\n    VK_F4: 115,\n    /** F5 key. */\n    VK_F5: 116,\n    /** F6 key. */\n    VK_F6: 117,\n    /** F7 key. */\n    VK_F7: 118,\n    /** F8 key. */\n    VK_F8: 119,\n    /** F9 key. */\n    VK_F9: 120,\n    /** F10 key. */\n    VK_F10: 121,\n    /** F11 key. */\n    VK_F11: 122,\n    /** F12 key. */\n    VK_F12: 123,\n    /** F13 key. */\n    VK_F13: 124,\n    /** F14 key. */\n    VK_F14: 125,\n    /** F15 key. */\n    VK_F15: 126,\n    /** F16 key. */\n    VK_F16: 127,\n    /** F17 key. */\n    VK_F17: 128,\n    /** F18 key. */\n    VK_F18: 129,\n    /** F19 key. */\n    VK_F19: 130,\n    /** F20 key. */\n    VK_F20: 131,\n    /** F21 key. */\n    VK_F21: 132,\n    /** F22 key. */\n    VK_F22: 133,\n    /** F23 key. */\n    VK_F23: 134,\n    /** F24 key. */\n    VK_F24: 135,\n    /** Num Lock key. */\n    VK_NUM_LOCK: 144,\n    /** Scroll Lock key. */\n    VK_SCROLL_LOCK: 145,\n    /** Circumflex (^) key. Requires Gecko 15.0 */\n    VK_CIRCUMFLEX: 160,\n    /** Exclamation (!) key. Requires Gecko 15.0 */\n    VK_EXCLAMATION: 161,\n    /** Double quote () key. Requires Gecko 15.0 */\n    VK_DOUBLE_QUOTE: 162,\n    /** Hash (#) key. Requires Gecko 15.0 */\n    VK_HASH: 163,\n    /** Dollar sign ($) key. Requires Gecko 15.0 */\n    VK_DOLLAR: 164,\n    /** Percent (%) key. Requires Gecko 15.0 */\n    VK_PERCENT: 165,\n    /** Ampersand (&) key. Requires Gecko 15.0 */\n    VK_AMPERSAND: 166,\n    /** Underscore (_) key. Requires Gecko 15.0 */\n    VK_UNDERSCORE: 167,\n    /** Open parenthesis (() key. Requires Gecko 15.0 */\n    VK_OPEN_PAREN: 168,\n    /** Close parenthesis ()) key. Requires Gecko 15.0 */\n    VK_CLOSE_PAREN: 169,\n    /* Asterisk (*) key. Requires Gecko 15.0 */\n    VK_ASTERISK: 170,\n    /** Plus (+) key. Requires Gecko 15.0 */\n    VK_PLUS: 171,\n    /** Pipe (|) key. Requires Gecko 15.0 */\n    VK_PIPE: 172,\n    /** Hyphen-US/docs/Minus (-) key. Requires Gecko 15.0 */\n    VK_HYPHEN_MINUS: 173,\n    /** Open curly bracket ({) key. Requires Gecko 15.0 */\n    VK_OPEN_CURLY_BRACKET: 174,\n    /** Close curly bracket (}) key. Requires Gecko 15.0 */\n    VK_CLOSE_CURLY_BRACKET: 175,\n    /** Tilde (~) key. Requires Gecko 15.0 */\n    VK_TILDE: 176,\n    /** Comma (,) key. */\n    VK_COMMA: 188,\n    /** Period (.) key. */\n    VK_PERIOD: 190,\n    /** Slash (/) key. */\n    VK_SLASH: 191,\n    /** Back tick (`) key. */\n    VK_BACK_QUOTE: 192,\n    /** Open square bracket ([) key. */\n    VK_OPEN_BRACKET: 219,\n    /** Back slash (\\) key. */\n    VK_BACK_SLASH: 220,\n    /** Close square bracket (]) key. */\n    VK_CLOSE_BRACKET: 221,\n    /** Quote (''') key. */\n    VK_QUOTE: 222,\n    /** Meta key on Linux, Command key on Mac. */\n    VK_META: 224,\n    /** AltGr key on Linux. Requires Gecko 15.0 */\n    VK_ALTGR: 225,\n    /** Windows logo key on Windows. Or Super or Hyper key on Linux. Requires Gecko 15.0 */\n    VK_WIN: 91,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_KANA: 21,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_HANGUL: 21,\n    /** 英数 key on Japanese Mac keyboard. Requires Gecko 15.0 */\n    VK_EISU: 22,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_JUNJA: 23,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_FINAL: 24,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_HANJA: 25,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_KANJI: 25,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_CONVERT: 28,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_NONCONVERT: 29,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_ACCEPT: 30,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_MODECHANGE: 31,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_SELECT: 41,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_PRINT: 42,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_EXECUTE: 43,\n    /** Linux support for this keycode was added in Gecko 4.0.\t */\n    VK_SLEEP: 95\n};\n","import Noise from \"./noise.js\";\nimport RNG from \"../rng.js\";\nimport { mod } from \"../util.js\";\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\nconst G2 = (3 - Math.sqrt(3)) / 6;\n/**\n * A simple 2d implementation of simplex noise by Ondrej Zara\n *\n * Based on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\n * Which is based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * With Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n */\nexport default class Simplex extends Noise {\n    /**\n     * @param gradients Random gradients\n     */\n    constructor(gradients = 256) {\n        super();\n        this._gradients = [\n            [0, -1],\n            [1, -1],\n            [1, 0],\n            [1, 1],\n            [0, 1],\n            [-1, 1],\n            [-1, 0],\n            [-1, -1]\n        ];\n        let permutations = [];\n        for (let i = 0; i < gradients; i++) {\n            permutations.push(i);\n        }\n        permutations = RNG.shuffle(permutations);\n        this._perms = [];\n        this._indexes = [];\n        for (let i = 0; i < 2 * gradients; i++) {\n            this._perms.push(permutations[i % gradients]);\n            this._indexes.push(this._perms[i] % this._gradients.length);\n        }\n    }\n    get(xin, yin) {\n        let perms = this._perms;\n        let indexes = this._indexes;\n        let count = perms.length / 2;\n        let n0 = 0, n1 = 0, n2 = 0, gi; // Noise contributions from the three corners\n        // Skew the input space to determine which simplex cell we're in\n        let s = (xin + yin) * F2; // Hairy factor for 2D\n        let i = Math.floor(xin + s);\n        let j = Math.floor(yin + s);\n        let t = (i + j) * G2;\n        let X0 = i - t; // Unskew the cell origin back to (x,y) space\n        let Y0 = j - t;\n        let x0 = xin - X0; // The x,y distances from the cell origin\n        let y0 = yin - Y0;\n        // For the 2D case, the simplex shape is an equilateral triangle.\n        // Determine which simplex we are in.\n        let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n        if (x0 > y0) {\n            i1 = 1;\n            j1 = 0;\n        }\n        else { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n            i1 = 0;\n            j1 = 1;\n        } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n        // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n        // c = (3-sqrt(3))/6\n        let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n        let y1 = y0 - j1 + G2;\n        let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n        let y2 = y0 - 1 + 2 * G2;\n        // Work out the hashed gradient indices of the three simplex corners\n        let ii = mod(i, count);\n        let jj = mod(j, count);\n        // Calculate the contribution from the three corners\n        let t0 = 0.5 - x0 * x0 - y0 * y0;\n        if (t0 >= 0) {\n            t0 *= t0;\n            gi = indexes[ii + perms[jj]];\n            let grad = this._gradients[gi];\n            n0 = t0 * t0 * (grad[0] * x0 + grad[1] * y0);\n        }\n        let t1 = 0.5 - x1 * x1 - y1 * y1;\n        if (t1 >= 0) {\n            t1 *= t1;\n            gi = indexes[ii + i1 + perms[jj + j1]];\n            let grad = this._gradients[gi];\n            n1 = t1 * t1 * (grad[0] * x1 + grad[1] * y1);\n        }\n        let t2 = 0.5 - x2 * x2 - y2 * y2;\n        if (t2 >= 0) {\n            t2 *= t2;\n            gi = indexes[ii + 1 + perms[jj + 1]];\n            let grad = this._gradients[gi];\n            n2 = t2 * t2 * (grad[0] * x2 + grad[1] * y2);\n        }\n        // Add contributions from each corner to get the final noise value.\n        // The result is scaled to return values in the interval [-1,1].\n        return 70 * (n0 + n1 + n2);\n    }\n}\n","import { Display } from \"rot-js\";\r\nimport { DisplayOptions } from \"rot-js/lib/display/types\";\r\n\r\nexport class RDisplay extends Display {\r\n  constructor(opts: Partial<DisplayOptions> | undefined) {\r\n    super(opts);\r\n  }\r\n\r\n  drawOver(\r\n    x: number,\r\n    y: number,\r\n    ch: string | null,\r\n    fg: string | null,\r\n    bg: string | null\r\n  ) {\r\n    const key = `${x},${y}`;\r\n    const existing = this._data[key];\r\n    if (existing) {\r\n      existing[2] = ch || existing[2];\r\n      existing[3] = fg || existing[3];\r\n      existing[4] = bg || existing[4];\r\n    } else {\r\n      this.draw(x, y, ch, fg, bg);\r\n    }\r\n  }\r\n\r\n  drawAppend(\r\n    x: number,\r\n    y: number,\r\n    ch: string,\r\n    fg: string | null,\r\n    bg: string | null\r\n  ) {\r\n    const key = `${x},${y}`;\r\n    const existing = this._data[key];\r\n    if (existing) {\r\n      existing[2] = Array.isArray(existing[2])\r\n        ? [...existing[2], ch]\r\n        : [existing[2], ch];\r\n      existing[3] = Array.isArray(existing[3])\r\n        ? [...existing[3], fg]\r\n        : [existing[3], fg];\r\n      existing[4] = Array.isArray(existing[4])\r\n        ? [...existing[4], bg]\r\n        : [existing[4], bg];\r\n    } else {\r\n      this.draw(x, y, ch, fg, bg);\r\n    }\r\n  }\r\n\r\n  drawOverFirst(\r\n    x: number,\r\n    y: number,\r\n    ch: string | null,\r\n    fg: string | null,\r\n    bg: string | null\r\n  ) {\r\n    const key = `${x},${y}`;\r\n    const existing = this._data[key];\r\n    if (existing) {\r\n      if (\r\n        Array.isArray(existing[2]) &&\r\n        Array.isArray(existing[3]) &&\r\n        Array.isArray(existing[4])\r\n      ) {\r\n        existing[2][0] = ch || existing[2][0];\r\n        existing[3][0] = fg || existing[3][0];\r\n        existing[4][0] = fg || existing[4][0];\r\n      } else {\r\n        this.drawOver(x, y, ch, fg, bg);\r\n      }\r\n    } else {\r\n      this.draw(x, y, ch || \" \", fg, bg);\r\n    }\r\n  }\r\n  drawOverLast(\r\n    x: number,\r\n    y: number,\r\n    ch: string | null,\r\n    fg: string | null,\r\n    bg: string | null\r\n  ) {\r\n    const key = `${x},${y}`;\r\n    const existing = this._data[key];\r\n    if (existing) {\r\n      if (\r\n        Array.isArray(existing[2]) &&\r\n        Array.isArray(existing[3]) &&\r\n        Array.isArray(existing[4])\r\n      ) {\r\n        const idx = existing[2].length - 1;\r\n        existing[2][idx] = ch || existing[2][idx];\r\n        existing[3][idx] = fg || existing[3][idx];\r\n        existing[4][idx] = bg || existing[4][idx];\r\n      } else {\r\n        this.drawOver(x, y, ch, fg, bg);\r\n      }\r\n    } else {\r\n      this.draw(x, y, ch || \" \", fg, bg);\r\n    }\r\n  }\r\n}\r\n","import { Container } from \"./containers/Container\";\r\nimport { RDisplay } from \"./RotDisplay\";\r\nimport { ComponentO, createElement } from \"./ui\";\r\n\r\nexport abstract class Scene {\r\n  abstract ui: ComponentO;\r\n\r\n  update(rotDisplay: RDisplay, elapsed: number) {\r\n    return;\r\n  }\r\n\r\n  render(rotDisplay: RDisplay) {\r\n    this.ui(rotDisplay);\r\n  }\r\n\r\n  destroy() {\r\n    //empty\r\n  }\r\n  create() {\r\n    //empty\r\n  }\r\n}\r\n\r\nclass EmptyScene extends Scene {\r\n  ui = createElement(Container, { x: 0, y: 0, w: 0, h: 0 });\r\n}\r\n\r\nlet currentScene: Scene = new EmptyScene();\r\n\r\nexport function setScene(scene: Scene) {\r\n  currentScene.destroy();\r\n  currentScene = scene;\r\n  currentScene.create();\r\n}\r\n\r\nexport function getScene() {\r\n  return currentScene;\r\n}\r\n","\"use strict\";\n\n/* globals document:readonly */\nvar bundleURL = null;\n\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  let matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","\"use strict\";\n\nvar resolve = require('./bundle-manifest').resolve;\n\nmodule.exports = function (fromId, toId) {\n  return relative(dirname(resolve(fromId)), resolve(toId));\n};\n\nfunction dirname(_filePath) {\n  if (_filePath === '') {\n    return '.';\n  }\n\n  var filePath = _filePath[_filePath.length - 1] === '/' ? _filePath.slice(0, _filePath.length - 1) : _filePath;\n  var slashIndex = filePath.lastIndexOf('/');\n  return slashIndex === -1 ? '.' : filePath.slice(0, slashIndex);\n}\n\nfunction relative(from, to) {\n  if (from === to) {\n    return '';\n  }\n\n  var fromParts = from.split('/');\n\n  if (fromParts[0] === '.') {\n    fromParts.shift();\n  }\n\n  var toParts = to.split('/');\n\n  if (toParts[0] === '.') {\n    toParts.shift();\n  } // Find where path segments diverge.\n\n\n  var i;\n  var divergeIndex;\n\n  for (i = 0; (i < toParts.length || i < fromParts.length) && divergeIndex == null; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      divergeIndex = i;\n    }\n  } // If there are segments from \"from\" beyond the point of divergence,\n  // return back up the path to that point using \"..\".\n\n\n  var parts = [];\n\n  for (i = 0; i < fromParts.length - divergeIndex; i++) {\n    parts.push('..');\n  } // If there are segments from \"to\" beyond the point of divergence,\n  // continue using the remaining segments.\n\n\n  if (toParts.length > divergeIndex) {\n    parts.push.apply(parts, toParts.slice(divergeIndex));\n  }\n\n  return parts.join('/');\n}\n\nmodule.exports._dirname = dirname;\nmodule.exports._relative = relative;","import tiles from \"url:../public/16x16_sm.png\";\r\nimport Colors from \"./core/Colors\";\r\n\r\nconst SET_START = 176;\r\nconst SET_END = SET_START + 17;\r\n\r\nexport const TILE_TYPES = {\r\n  EMPTY: String.fromCharCode(SET_START),\r\n\r\n  UL_: String.fromCharCode(SET_START),\r\n  U_: String.fromCharCode(SET_START + 2),\r\n  L_: String.fromCharCode(SET_START + 1),\r\n\r\n  _L: String.fromCharCode(SET_START + 3),\r\n  _U: String.fromCharCode(SET_START + 4),\r\n  _R: String.fromCharCode(SET_START + 5),\r\n  _D: String.fromCharCode(SET_START + 6),\r\n};\r\n\r\nconst tileSet = document.createElement(\"img\");\r\ntileSet.src = tiles;\r\n\r\nconst tileSetPromise = new Promise((r) => (tileSet.onload = r));\r\nconst T_SIZE = 16;\r\nconst START_C = 32;\r\nconst END_C = 126;\r\n\r\nconst tileMap: Record<string, [number, number]> = {};\r\n//Add Common symbols and alpha numerics\r\nfor (let i = START_C; i <= END_C; i++) {\r\n  tileMap[String.fromCharCode(i)] = [\r\n    (i % 16) * T_SIZE,\r\n    Math.floor(i / 16) * T_SIZE,\r\n  ];\r\n}\r\ntileMap[\" \"] = [0, 0];\r\n\r\nfor (let i = SET_START; i <= SET_END; i++) {\r\n  tileMap[String.fromCharCode(i)] = [\r\n    (i % 16) * T_SIZE,\r\n    Math.floor(i / 16) * T_SIZE,\r\n  ];\r\n}\r\n\r\nexport const getTileOptions = async () => {\r\n  await tileSetPromise;\r\n  return {\r\n    layout: \"tile-gl\",\r\n    tileColorize: true,\r\n    fg: Colors.B_GREY_4,\r\n    bg: Colors.BLACK,\r\n    tileWidth: T_SIZE,\r\n    tileHeight: T_SIZE,\r\n    tileMap,\r\n    tileSet,\r\n  } as const;\r\n};\r\n","import { floodFill } from \"../../../ui/helpers\";\r\nimport { setScene } from \"../../../ui/scene\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\nimport { GameScene } from \"../../scenes/game\";\r\nimport { HelpComponent } from \"./helpComponent\";\r\n\r\nexport const HomeComponent: ComponentF<void> = (C) => {\r\n  floodFill(C.display, { x: 8, y: 0, h: C.bounds.h, w: 4 }, Colors.B_GREY_1);\r\n  floodFill(C.display, { x: 0, y: 7, h: 3, w: C.bounds.w }, Colors.B_GREY_1);\r\n\r\n  C.display.drawText(\r\n    C.bounds.x + 12,\r\n    C.bounds.y + 8,\r\n    `%b{${Colors.B_GREY_1}}Pieux`,\r\n    16\r\n  );\r\n\r\n  C.display.drawText(\r\n    C.bounds.x + C.bounds.w / 2 - 9,\r\n    C.bounds.y + C.bounds.h - 2,\r\n    `%c{${Colors.RED_4}}Enter%c{} - Start Game`\r\n  );\r\n\r\n  C.handlers.keypress = (key) => {\r\n    if (key === \"Enter\") {\r\n      setScene(new GameScene());\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  return [\r\n    createElement(HelpComponent, {\r\n      x: 14,\r\n      y: 12,\r\n      w: C.bounds.w - 14,\r\n      h: C.bounds.h - 10,\r\n    }),\r\n  ];\r\n};\r\n","import { ComponentF } from \"../ui\";\r\nimport { handleKeyOnClick } from \"./keyOnClick\";\r\n\r\nexport const CharButton: ComponentF<{\r\n  disabled?: boolean;\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({ hover: false });\r\n  C.display.draw(\r\n    C.bounds.x,\r\n    C.bounds.y,\r\n    props.title,\r\n    props.disabled ? \"#555555\" : state.hover ? \"#FFFFFF\" : \"#AAAAAA\",\r\n    null\r\n  );\r\n\r\n  if (!props.disabled) {\r\n    C.handlers.hover = () => {\r\n      setState({ hover: true });\r\n    };\r\n\r\n    C.handlers.out = () => {\r\n      setState({ hover: false });\r\n    };\r\n\r\n    C.handlers.press = () => {\r\n      props.onClick();\r\n    };\r\n  }\r\n\r\n  handleKeyOnClick(C, props);\r\n};\r\n","import { measure } from \"rot-js/lib/text\";\r\n\r\nconst MAX_LOG_SIZE = 200;\r\nlet logs: string[] = [];\r\nexport function clearLog() {\r\n  logs = [];\r\n}\r\n\r\nexport function log(msg: string) {\r\n  if (logs.length === MAX_LOG_SIZE) {\r\n    logs.unshift();\r\n  }\r\n  logs.push(msg);\r\n}\r\n\r\nexport function getLog() {\r\n  return logs;\r\n}\r\n\r\nexport function getLogSize() {\r\n  return logs.length;\r\n}\r\n\r\nexport function lineCount(msg: string, width: number) {\r\n  return measure(msg, width).height;\r\n}\r\n","import { CharButton } from \"../../ui/input/CharButton\";\r\nimport { ComponentF, createElement } from \"../../ui/ui\";\r\nimport { getLog, getLogSize, lineCount } from \"./logger\";\r\n\r\nexport const LogContents: ComponentF<{ offset: number }> = (C, props) => {\r\n  const entries = getLog();\r\n  let logIndex = entries.length - 1 + props.offset;\r\n  const top = C.bounds.y;\r\n  let y = C.bounds.y + C.bounds.h;\r\n  while (y > top && logIndex >= 0) {\r\n    const lines = lineCount(entries[logIndex], C.bounds.w);\r\n    y = y - lines;\r\n    if (y >= top) {\r\n      C.display.drawText(C.bounds.x, y, entries[logIndex], C.bounds.w);\r\n      logIndex -= 1;\r\n    }\r\n  }\r\n};\r\n\r\nexport const LogList: ComponentF<any> = (C) => {\r\n  const [state, setState] = C.useState({ offset: 0 });\r\n\r\n  const logSize = getLogSize();\r\n  const canScrollUp =\r\n    -1 * state.offset < logSize && C.bounds.h - 1 < logSize + state.offset;\r\n  const canScrollDown = state.offset < 0;\r\n  const scrollUp = () => {\r\n    if (canScrollUp) {\r\n      setState({ offset: state.offset - 1 });\r\n    }\r\n  };\r\n\r\n  const scrollDown = () => {\r\n    if (canScrollDown) {\r\n      setState({ offset: state.offset + 1 });\r\n    }\r\n  };\r\n\r\n  C.handlers.keypress = (key) => {\r\n    if (key === \"+\" || key === \"=\") {\r\n      scrollDown();\r\n      return true;\r\n    } else if (key === \"-\" || key === \"_\") {\r\n      scrollUp();\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  return [\r\n    createElement(\r\n      LogContents,\r\n      {\r\n        x: 0,\r\n        y: 0,\r\n        w: C.bounds.w - 2,\r\n        h: C.bounds.h,\r\n      },\r\n      { offset: state.offset }\r\n    ),\r\n    createElement(\r\n      CharButton,\r\n      { x: C.bounds.w - 1, y: 0, w: 1, h: 1 },\r\n      {\r\n        disabled: !canScrollUp,\r\n        title: \"-\",\r\n        onClick: scrollUp,\r\n      }\r\n    ),\r\n    createElement(\r\n      CharButton,\r\n      { x: C.bounds.w - 1, y: C.bounds.h - 1, w: 1, h: 1 },\r\n      {\r\n        disabled: !canScrollDown,\r\n        title: \"+\",\r\n        onClick: scrollDown,\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import { borderFill } from \"../helpers\";\r\nimport { ComponentF, ComponentO, createElement } from \"../ui\";\r\nimport { Container } from \"./Container\";\r\n\r\nlet id = 0;\r\nlet modals: { id: number; content: ComponentO }[] = [];\r\n\r\nexport const openModal = (content: ComponentO) => {\r\n  const used = id;\r\n  id += 1;\r\n  modals.push({ id: used, content });\r\n  return used;\r\n};\r\n\r\nexport const closeModal = (id?: number) => {\r\n  if (id != null) {\r\n    modals = modals.filter((m) => m.id !== id);\r\n  } else {\r\n    modals.pop();\r\n  }\r\n};\r\n\r\nconst ModalContents: ComponentF<{ content: ComponentO }> = (C, { content }) => {\r\n  borderFill(C.display, C.bounds);\r\n  return [\r\n    createElement(\r\n      Container,\r\n      {\r\n        x: 1,\r\n        y: 1,\r\n        w: C.bounds.w - 2,\r\n        h: C.bounds.h - 2,\r\n      },\r\n      { children: [content] }\r\n    ),\r\n  ];\r\n};\r\n\r\nexport const Modal: ComponentF<null> = (C) => {\r\n  return modals.map(({ content }) => {\r\n    const width = content.bounds.w;\r\n    const height = content.bounds.h;\r\n    const b = {\r\n      x: C.bounds.x + Math.floor((C.bounds.w - (content.bounds.w + 2)) / 2),\r\n      y: C.bounds.y + Math.floor((C.bounds.h - (content.bounds.h + 2)) / 2),\r\n      w: width + 2,\r\n      h: height + 2,\r\n    };\r\n    return createElement(ModalContents, b, { content });\r\n  });\r\n};\r\n","import { borderFill, lineDraw } from \"../helpers\";\r\nimport { ComponentF, ComponentO, createElement } from \"../ui\";\r\n\r\nconst PanelContents: ComponentF<{ children: ComponentO[] }> = (C, props) => {\r\n  return props.children;\r\n};\r\n\r\nexport const PanelGroup: ComponentF<{\r\n  children: { title?: string; value: ComponentO }[];\r\n}> = (C, props) => {\r\n  borderFill(C.display, C.bounds);\r\n  let curHeight = 0;\r\n  return props.children.map(({ title, value }) => {\r\n    lineDraw(\r\n      C.display,\r\n      {\r\n        x: 1,\r\n        y: curHeight,\r\n        w: C.bounds.w - 2,\r\n        h: 1,\r\n      },\r\n      title\r\n    );\r\n    const el = createElement(\r\n      PanelContents,\r\n      {\r\n        x: 1,\r\n        y: curHeight + 1,\r\n        w: C.bounds.w - 2,\r\n        h: value.bounds.h,\r\n      },\r\n      {\r\n        children: [value],\r\n      }\r\n    );\r\n    curHeight = curHeight + value.bounds.h + 1;\r\n    return el;\r\n  });\r\n};\r\n","export default function(cb: (...args: any[]) => any) {\r\n  return (...args: any[]) => {\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      return cb.apply(this, args);\r\n    }\r\n  };\r\n}\r\n","import ifDev from \"./ifDev\";\r\n\r\nexport { throwOrLog } from \"./throwOrLog\";\r\nexport { logInDev, infoInDev, warnInDev } from \"./logger\";\r\nexport { ifDev };\r\n","/* tslint:disable:no-console */\r\nexport const throwOrLog = (message: string) =>\r\n  process.env.NODE_ENV === \"development\"\r\n    ? (() => {\r\n        throw message;\r\n      })()\r\n    : console.error(message);\r\n","/* tslint:disable:no-console */\r\nexport const logInDev = (message: string) =>\r\n  process.env.NODE_ENV === \"development\" && console.log(message);\r\n\r\nexport const infoInDev = (message: string) =>\r\n  process.env.NODE_ENV === \"development\" && console.info(message);\r\n\r\nexport const warnInDev = (message: string) =>\r\n  process.env.NODE_ENV === \"development\" && console.warn(message);\r\n","export default {\r\n  base: {\r\n    look: [\"look\", null],\r\n  },\r\n  move: {\r\n    up: [\"move\", { x: 0, y: -1 }],\r\n    left: [\"move\", { x: -1, y: 0 }],\r\n    right: [\"move\", { x: 1, y: 0 }],\r\n    down: [\"move\", { x: 0, y: 1 }],\r\n    mouseTile: [\"mouseTileMove\", null],\r\n    sUp: [\"sprint\", { x: 0, y: -1 }],\r\n    sLeft: [\"sprint\", { x: -1, y: 0 }],\r\n    sRight: [\"sprint\", { x: 1, y: 0 }],\r\n    sDown: [\"sprint\", { x: 0, y: 1 }],\r\n  },\r\n  focusMove: {\r\n    up: [\"focusMove\", { x: 0, y: -1 }],\r\n    left: [\"focusMove\", { x: -1, y: 0 }],\r\n    right: [\"focusMove\", { x: 1, y: 0 }],\r\n    down: [\"focusMove\", { x: 0, y: 1 }],\r\n    mouseTile: [\"mouseTileMove\", null],\r\n  },\r\n  playerActions: {\r\n    cheat: [\"cheat\", null],\r\n    wait: [\"wait\", null],\r\n  },\r\n} as const;\r\n","import actions from \"../../core/commands/commandNames\";\r\nimport keybinds from \"../../core/commands/inputKeys\";\r\nimport { warnInDev } from \"../../debug\";\r\n\r\nexport function getEntryFromConfig<T>(\r\n  config: Record<string, Record<string, T>>,\r\n  bindings: string | string[],\r\n  value = \"\"\r\n): T | undefined {\r\n  let binding;\r\n  if (Array.isArray(bindings)) {\r\n    let name;\r\n    const length = bindings.length;\r\n    for (let i = 0; i < length; i++) {\r\n      binding = config[bindings[i]];\r\n      if (binding) {\r\n        name = binding[value] || binding.any;\r\n        if (name) {\r\n          return name;\r\n        }\r\n      } else {\r\n        warnInDev(`Invalid binding: ${bindings[i]} provided`);\r\n      }\r\n    }\r\n  } else {\r\n    binding = config[bindings];\r\n    return binding[value] || binding.any;\r\n  }\r\n}\r\n\r\nexport const getInputNameForKey = (\r\n  bindings: string | string[],\r\n  keyCode: string\r\n) => getEntryFromConfig(keybinds, bindings, keyCode);\r\n\r\nexport const getActionNameFromInput = (\r\n  bindings: string | string[],\r\n  input: string | undefined\r\n) => getEntryFromConfig(actions, bindings, input);\r\n","const buildDirectional = (key: string[][], handlerNames: string[]) => {\r\n  const result: Record<string, string> = {};\r\n  key.forEach((directionSet) => {\r\n    directionSet.forEach((key, index) => {\r\n      result[key] = handlerNames[index];\r\n    });\r\n  });\r\n  return result;\r\n};\r\n\r\nexport default {\r\n  cancel: {\r\n    Escape: \"cancel\",\r\n    Backspace: \"cancel\",\r\n  },\r\n  advance: {\r\n    \" \": \"advance\",\r\n    Enter: \"advance\",\r\n  },\r\n  graphMovement: {\r\n    ...buildDirectional(\r\n      [\r\n        [\"w\", \"a\", \"s\", \"d\"],\r\n        [\"k\", \"h\", \"l\", \"j\"],\r\n        [\"ArrowUp\", \"ArrowLeft\", \"ArrowDown\", \"ArrowRight\"],\r\n      ],\r\n      [\"up\", \"left\", \"down\", \"right\"]\r\n    ),\r\n    ...buildDirectional(\r\n      [\r\n        [\"W\", \"A\", \"S\", \"D\"],\r\n        [\"K\", \"H\", \"L\", \"J\"],\r\n        [\"SArrowUp\", \"SArrowLeft\", \"SArrowDown\", \"SArrowRight\"],\r\n      ],\r\n      [\"sUp\", \"sLeft\", \"sDown\", \"sRight\"]\r\n    ),\r\n  },\r\n  baseActions: {\r\n    v: \"look\",\r\n  },\r\n  playerActions: {\r\n    \"\\\\\": \"cheat\",\r\n    \".\": \"wait\",\r\n  },\r\n  DEBUG_MENUS: {\r\n    p: \"DEBUG_MAP\",\r\n  },\r\n} as const;\r\n","import { logInDev } from \"../../debug\";\r\nimport { getActionNameFromInput, getInputNameForKey } from \"./keyHandler\";\r\n\r\ntype MouseHandler = (inputName: string, args?: any) => void;\r\n\r\nclass InputState {\r\n  keyHandlers: Array<string[] | string>;\r\n  inputHandlers: Array<string[] | string>;\r\n  mouseHandler?: MouseHandler;\r\n  constructor() {\r\n    this.keyHandlers = [];\r\n    this.inputHandlers = [];\r\n  }\r\n\r\n  addMouseHandler(fn: MouseHandler) {\r\n    this.mouseHandler = fn;\r\n  }\r\n\r\n  pushKeyHandler(handlers: string | string[]) {\r\n    logInDev(\r\n      `Adding Key Handlers ${\r\n        Array.isArray(handlers) ? handlers.join(\",\") : handlers\r\n      }`\r\n    );\r\n    this.keyHandlers.push(handlers);\r\n  }\r\n\r\n  popKeyHandler() {\r\n    this.keyHandlers.pop();\r\n  }\r\n\r\n  pushInputHandler(handlers: string | string[]) {\r\n    logInDev(\r\n      `Adding Input Handlers ${\r\n        Array.isArray(handlers) ? handlers.join(\",\") : handlers\r\n      }`\r\n    );\r\n    this.inputHandlers.push(handlers);\r\n  }\r\n\r\n  popInputHandler() {\r\n    this.inputHandlers.pop();\r\n  }\r\n\r\n  keyToAction(keyCode: string) {\r\n    if (!this.inputHandlers.length || !this.keyHandlers.length) {\r\n      return;\r\n    }\r\n    return getActionNameFromInput(\r\n      this.inputHandlers[this.inputHandlers.length - 1],\r\n      getInputNameForKey(this.keyHandlers[this.keyHandlers.length - 1], keyCode)\r\n    );\r\n  }\r\n\r\n  inputToActionName(inputName: string) {\r\n    return getActionNameFromInput(\r\n      this.inputHandlers[this.inputHandlers.length - 1],\r\n      inputName\r\n    );\r\n  }\r\n\r\n  triggerMouseAction(inputName: string, args?: any) {\r\n    this.mouseHandler && this.mouseHandler(inputName, args);\r\n  }\r\n}\r\n\r\nexport default new InputState();\r\n","import { warnInDev } from \"../debug\";\r\nimport InputState from \"../engine/inputActions/InputState\";\r\nimport { RDisplay } from \"../ui/RotDisplay\";\r\nimport { Commands } from \"./commands/commands\";\r\nimport { buildState } from \"./gameState\";\r\nimport { Bounds } from \"../engine/space/bounds\";\r\nimport EntityManager from \"./EntityManager\";\r\nimport { Action, ActionSpeed, runAction } from \"./actions/Action\";\r\nimport AsyncManager from \"./AsyncManager\";\r\nimport { getPlayerVisibility } from \"./map/Visibility\";\r\nimport { createDMap } from \"../lib/dMap\";\r\nimport { moveIn } from \"./map/pathfinding\";\r\nimport { generateMap } from \"./map/generation\";\r\nimport { ParticleManager } from \"./anims/particleSystem\";\r\nimport { endOfTurnEffects } from \"./actors/systems/Regen\";\r\nimport { clearLog, log } from \"../engine/logger/logger\";\r\nimport Colors from \"./Colors\";\r\n\r\nexport let gameData = buildState();\r\n\r\nexport const initializeState = () => {\r\n  clearLog();\r\n  log(\r\n    `%c{${Colors.B_GREY_3}}Welcome to Pieux move with wasd, hjkl, or arrow keys.`\r\n  );\r\n  log(`%c{${Colors.B_GREY_3}}Shift + movement keys will sprint if available.`);\r\n  log(\"As you awaken, the world has shifted around you\");\r\n  log(\r\n    `With your flask of restoration (%c{${Colors.RED_4}}u%c{}), you set out.`\r\n  );\r\n  gameData = buildState();\r\n  InputState.pushKeyHandler([\r\n    \"baseActions\",\r\n    \"playerActions\",\r\n    \"graphMovement\",\r\n    \"advance\",\r\n    \"cancel\",\r\n  ]);\r\n  InputState.pushInputHandler([\"base\", \"move\", \"playerActions\"]);\r\n\r\n  const rng = gameData.seedRng.getRNG();\r\n  generateMap(rng, gameData.current);\r\n  getPlayerVisibility(\r\n    gameData.current.width,\r\n    gameData.player.x,\r\n    gameData.player.y,\r\n    7,\r\n    gameData.fov\r\n  );\r\n  gameData.dMapPlayer = createDMap([gameData.player], moveIn, 20);\r\n  EntityManager.actorPlan();\r\n};\r\n\r\nconst mapArrows = (key: string) => {\r\n  return key.startsWith(\"Arrow\") ? `S${key}` : key;\r\n};\r\n\r\nexport const handleInput = (key: string, shiftKey: boolean) => {\r\n  if (shiftKey) {\r\n    key = mapArrows(key);\r\n  }\r\n\r\n  if (!gameData.actionPending) {\r\n    const actionResult = InputState.keyToAction(key);\r\n    if (actionResult) {\r\n      const [actionName, args] = actionResult;\r\n      const result = Commands[actionName](args);\r\n      if (result) {\r\n        if (Array.isArray(result)) {\r\n          result.forEach((a) => {\r\n            switch (a.speed) {\r\n              case ActionSpeed.FAST:\r\n                gameData.quickActionQueue.unshift(a);\r\n                break;\r\n              case ActionSpeed.MEDIUM:\r\n                gameData.actionQueue.unshift(a);\r\n                break;\r\n              case ActionSpeed.SLOW:\r\n                gameData.slowActionQueue.unshift(a);\r\n                break;\r\n            }\r\n          });\r\n        } else {\r\n          switch (result.speed) {\r\n            case ActionSpeed.FAST:\r\n              gameData.quickActionQueue.unshift(result);\r\n              break;\r\n            case ActionSpeed.MEDIUM:\r\n              gameData.actionQueue.unshift(result);\r\n              break;\r\n            case ActionSpeed.SLOW:\r\n              gameData.slowActionQueue.unshift(result);\r\n              break;\r\n          }\r\n        }\r\n        advanceTurn();\r\n      }\r\n      return true;\r\n    } else {\r\n      warnInDev(`No action for input: ${key}`);\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\nexport const runPlayerAction = (action: Action<any>) => {\r\n  switch (action.speed) {\r\n    case ActionSpeed.FAST:\r\n      gameData.quickActionQueue.unshift(action);\r\n      break;\r\n    case ActionSpeed.MEDIUM:\r\n      gameData.actionQueue.unshift(action);\r\n      break;\r\n    case ActionSpeed.SLOW:\r\n      gameData.slowActionQueue.unshift(action);\r\n      break;\r\n  }\r\n  advanceTurn();\r\n};\r\n\r\nexport const advanceTurn = async () => {\r\n  ParticleManager.clearStartOfTurn();\r\n  gameData.actionPending = true;\r\n  await runActionQueue();\r\n  getPlayerVisibility(\r\n    gameData.current.width,\r\n    gameData.player.x,\r\n    gameData.player.y,\r\n    5,\r\n    gameData.fov\r\n  );\r\n  gameData.dMapPlayer = createDMap([gameData.player], moveIn, 20);\r\n  ParticleManager.clearEndOfTurn();\r\n  endOfTurnEffects();\r\n  EntityManager.actorPlan();\r\n  gameData.actionPending = false;\r\n};\r\n\r\nexport const runActionQueue = async () => {\r\n  while (gameData.quickActionQueue.length) {\r\n    await runAction(gameData.quickActionQueue.shift() as Action<any>);\r\n  }\r\n  while (gameData.actionQueue.length) {\r\n    await runAction(gameData.actionQueue.shift() as Action<any>);\r\n  }\r\n  while (gameData.slowActionQueue.length) {\r\n    await runAction(gameData.slowActionQueue.shift() as Action<any>);\r\n  }\r\n  await AsyncManager.waitForPending();\r\n};\r\n\r\nexport const drawWorld = (display: RDisplay, bounds: Bounds, view: Bounds) => {\r\n  gameData.current.draw(display, bounds, view, gameData.fov);\r\n  gameData.gibs.forEach((particle) => {\r\n    particle.render(display, bounds, view);\r\n  });\r\n  EntityManager.drawEntities(display, bounds, view);\r\n  gameData.particles.forEach((particle) => {\r\n    particle.render(display, bounds, view);\r\n  });\r\n};\r\n\r\nexport const findActorForPosition = (x: number, y: number) => {\r\n  return gameData.actors.find((actor) => actor.x === x && actor.y === y);\r\n};\r\n\r\nexport const getItemsForPosition = (x: number, y: number) => {\r\n  return gameData.items.filter((item) => item.x === x && item.y === y);\r\n};\r\n","import InputState from \"../../engine/inputActions/InputState\";\r\nimport { log } from \"../../engine/logger/logger\";\r\nimport { getDirectionFromVector } from \"../../engine/space/directions\";\r\nimport { openModal } from \"../../ui/containers/Modal\";\r\nimport { createElement } from \"../../ui/ui\";\r\nimport { Action, ActionSpeed, createAction } from \"../actions/Action\";\r\nimport { attackTowards, blockAttacks } from \"../actions/ActionAttacks\";\r\nimport { moveTowards, sprintTowards, wait } from \"../actions/ActionMovement\";\r\nimport { getActiveAttack } from \"../actors/weaponHelper\";\r\nimport { LookParticle } from \"../anims/particles/LookParticle\";\r\nimport { ParticleManager } from \"../anims/particleSystem\";\r\nimport { findActorForPosition, gameData } from \"../GameManager\";\r\nimport { CheckMovement } from \"../map/Movement\";\r\nimport { CheatModal } from \"../ui/cheat/CheatModal\";\r\nimport {\r\n  getActorWeight,\r\n  getWeightLevel,\r\n  hasStrength,\r\n  weightToActionSpeed,\r\n} from \"../items/formulas\";\r\nimport { Encumbrance } from \"../actors/Actor\";\r\n\r\nexport const Commands: {\r\n  [key: string]: (args?: any) => void | Action<any> | Action<any>[];\r\n} = {\r\n  cheat: () => {\r\n    openModal(createElement(CheatModal, { x: 0, y: 0, w: 40, h: 20 }));\r\n  },\r\n  wait: () => {\r\n    return createAction(wait, gameData.player, null);\r\n  },\r\n  move: (direction: { x: number; y: number }) => {\r\n    const player = gameData.player;\r\n    const dir = getDirectionFromVector(direction);\r\n    const tile =\r\n      gameData.current.tiles[player.x + player.y * gameData.current.width];\r\n\r\n    if (dir && CheckMovement[dir](tile)) {\r\n      const target = findActorForPosition(\r\n        player.x + direction.x,\r\n        player.y + direction.y\r\n      );\r\n      if (target) {\r\n        const attack = getActiveAttack(gameData.player);\r\n        if (gameData.player.stamina.current < attack.stamina) {\r\n          log(\"Not enough stamina to attack\");\r\n        } else if (!hasStrength(gameData.player, attack)) {\r\n          log(\"You are not strong enough to use this attack\");\r\n        } else {\r\n          if (attack.blocks) {\r\n            return createAction(\r\n              blockAttacks,\r\n              gameData.player,\r\n              null,\r\n              ActionSpeed.FAST\r\n            );\r\n          } else {\r\n            return createAction(attackTowards, gameData.player, {\r\n              dir,\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        return createAction(\r\n          moveTowards,\r\n          gameData.player,\r\n          {\r\n            dir,\r\n          },\r\n          weightToActionSpeed(\r\n            getWeightLevel(\r\n              getActorWeight(gameData.player),\r\n              gameData.player.attributes.weight\r\n            )\r\n          )\r\n        );\r\n      }\r\n    } else {\r\n      log(\"You cannot move or attack in that direction.\");\r\n    }\r\n  },\r\n  sprint: (direction: { x: number; y: number }) => {\r\n    const player = gameData.player;\r\n    const weightLevel = getWeightLevel(\r\n      getActorWeight(player),\r\n      player.attributes.weight\r\n    );\r\n    if (weightLevel === Encumbrance.HEAVY) {\r\n      log(\"You cannot sprint while slow (75%+ carry load)\");\r\n      return;\r\n    }\r\n\r\n    if (\r\n      (weightLevel === Encumbrance.LIGHT && 15 < player.stamina.current) ||\r\n      (weightLevel === Encumbrance.MEDIUM && 30 < player.stamina.current)\r\n    ) {\r\n      const dir = getDirectionFromVector(direction);\r\n      const tile =\r\n        gameData.current.tiles[player.x + player.y * gameData.current.width];\r\n\r\n      if (dir && CheckMovement[dir](tile)) {\r\n        const target = findActorForPosition(\r\n          player.x + direction.x,\r\n          player.y + direction.y\r\n        );\r\n        if (target) {\r\n          log(\"You cannot sprint directly into enemies.\");\r\n        } else {\r\n          return createAction(sprintTowards, gameData.player, { dir });\r\n        }\r\n      }\r\n    } else {\r\n      log(\"Not enough stamina to sprint.\");\r\n    }\r\n  },\r\n  look: () => {\r\n    if (gameData.looking) {\r\n      InputState.popInputHandler();\r\n      gameData.looking = false;\r\n      gameData.targetFocus?.finish();\r\n      gameData.targetFocus = null;\r\n    } else {\r\n      InputState.pushInputHandler([\"base\", \"focusMove\"]);\r\n      gameData.looking = true;\r\n      gameData.targetFocus = ParticleManager.createParticle(\r\n        LookParticle,\r\n        gameData.player.x,\r\n        gameData.player.y\r\n      );\r\n    }\r\n  },\r\n  focusMove: (direction: { x: number; y: number }) => {\r\n    if (gameData.targetFocus) {\r\n      gameData.targetFocus.x += direction.x;\r\n      gameData.targetFocus.y += direction.y;\r\n    }\r\n  },\r\n};\r\n","import { Point } from \"./bounds\";\r\n\r\nexport enum Directions {\r\n  UpLeft,\r\n  Up,\r\n  UpRight,\r\n  DownLeft,\r\n  Down,\r\n  DownRight,\r\n  Left,\r\n  Right,\r\n}\r\n\r\nexport const allDirections = [\r\n  Directions.Up,\r\n  Directions.Down,\r\n  Directions.Left,\r\n  Directions.Right,\r\n];\r\n\r\nexport const allDirectionWithDiagonals = [\r\n  Directions.UpLeft,\r\n  Directions.Up,\r\n  Directions.UpRight,\r\n  Directions.Left,\r\n  Directions.Right,\r\n  Directions.DownLeft,\r\n  Directions.Down,\r\n  Directions.DownRight,\r\n];\r\n\r\nexport function getOppositeDirection(direction: Directions) {\r\n  switch (direction) {\r\n    case Directions.Up:\r\n      return Directions.Down;\r\n    case Directions.Left:\r\n      return Directions.Right;\r\n    case Directions.Down:\r\n      return Directions.Up;\r\n    case Directions.Right:\r\n      return Directions.Left;\r\n    case Directions.UpLeft:\r\n      return Directions.DownRight;\r\n    case Directions.UpRight:\r\n      return Directions.DownLeft;\r\n    case Directions.DownRight:\r\n      return Directions.UpLeft;\r\n  }\r\n\r\n  ((): never => {\r\n    throw new Error(\"Unrecognized direction\");\r\n  })();\r\n}\r\n\r\nexport function getInDirection(position: Point, direction: Directions): Point {\r\n  switch (direction) {\r\n    case Directions.Up:\r\n      return { x: position.x, y: position.y - 1 };\r\n    case Directions.Left:\r\n      return { x: position.x - 1, y: position.y };\r\n    case Directions.Down:\r\n      return { x: position.x, y: position.y + 1 };\r\n    case Directions.Right:\r\n      return { x: position.x + 1, y: position.y };\r\n    case Directions.UpLeft:\r\n      return { x: position.x - 1, y: position.y - 1 };\r\n    case Directions.UpRight:\r\n      return { x: position.x + 1, y: position.y - 1 };\r\n    case Directions.DownLeft:\r\n      return { x: position.x - 1, y: position.y + 1 };\r\n    case Directions.DownRight:\r\n      return { x: position.x + 1, y: position.y + 1 };\r\n  }\r\n\r\n  ((): never => {\r\n    throw new Error(\"Unrecognized direction\");\r\n  })();\r\n}\r\n\r\n// TODO: This function can throw if source === target\r\nexport function getDirectionTowards(source: Point, target: Point) {\r\n  if (source.x > target.x) {\r\n    return Directions.Left;\r\n  } else if (source.x < target.x) {\r\n    return Directions.Right;\r\n  } else if (source.y > target.y) {\r\n    return Directions.Up;\r\n  } else if (source.y < target.y) {\r\n    return Directions.Down;\r\n  } else {\r\n    throw new Error(\"Unrecognized direction\");\r\n  }\r\n}\r\n\r\nexport function getDirectionFromVector(vector: Point) {\r\n  if (vector.x < 0) {\r\n    return vector.y === 0\r\n      ? Directions.Left\r\n      : vector.y < 0\r\n      ? Directions.UpLeft\r\n      : Directions.DownLeft;\r\n  } else if (vector.x > 0) {\r\n    return vector.y === 0\r\n      ? Directions.Right\r\n      : vector.y < 0\r\n      ? Directions.UpRight\r\n      : Directions.DownRight;\r\n  } else if (vector.y < 0) {\r\n    return Directions.Up;\r\n  } else if (vector.y > 0) {\r\n    return Directions.Down;\r\n  }\r\n}\r\n\r\nexport function getAllDirections(position: Point) {\r\n  return [\r\n    { x: position.x, y: position.y - 1 },\r\n    { x: position.x - 1, y: position.y },\r\n    { x: position.x, y: position.y + 1 },\r\n    { x: position.x + 1, y: position.y },\r\n  ];\r\n}\r\n\r\nexport function getAllWithDiagonal(position: Point) {\r\n  return [\r\n    { x: position.x, y: position.y - 1 },\r\n    { x: position.x - 1, y: position.y - 1 },\r\n    { x: position.x - 1, y: position.y },\r\n    { x: position.x - 1, y: position.y + 1 },\r\n    { x: position.x, y: position.y + 1 },\r\n    { x: position.x + 1, y: position.y + 1 },\r\n    { x: position.x + 1, y: position.y },\r\n    { x: position.x + 1, y: position.y - 1 },\r\n  ];\r\n}\r\n\r\nexport function* genAllDirections(position: Point): IterableIterator<Point> {\r\n  yield { x: position.x, y: position.y - 1 };\r\n  yield { x: position.x - 1, y: position.y };\r\n  yield { x: position.x, y: position.y + 1 };\r\n  yield { x: position.x + 1, y: position.y };\r\n}\r\n\r\nexport function* genAllWithDiagonal(position: Point): IterableIterator<Point> {\r\n  yield { x: position.x, y: position.y - 1 };\r\n  yield { x: position.x - 1, y: position.y - 1 };\r\n  yield { x: position.x - 1, y: position.y };\r\n  yield { x: position.x - 1, y: position.y + 1 };\r\n  yield { x: position.x, y: position.y + 1 };\r\n  yield { x: position.x + 1, y: position.y + 1 };\r\n  yield { x: position.x + 1, y: position.y };\r\n  yield { x: position.x + 1, y: position.y - 1 };\r\n}\r\n","import { Actor } from \"../actors/Actor\";\r\n\r\nexport enum ActionSpeed {\r\n  SLOW,\r\n  MEDIUM,\r\n  FAST,\r\n}\r\n\r\nexport type ActionResult = {\r\n  valid: boolean;\r\n};\r\n\r\nexport type Performer<T> = (\r\n  actor: Actor,\r\n  options: T\r\n) => ActionResult | Promise<ActionResult>;\r\n\r\nexport type Action<T> = {\r\n  actor: Actor;\r\n  options: T;\r\n  perform: Performer<T>;\r\n  speed?: ActionSpeed;\r\n};\r\n\r\nexport function createAction<T>(\r\n  performer: Performer<T>,\r\n  actor: Actor,\r\n  options: T,\r\n  speed = ActionSpeed.MEDIUM\r\n): Action<T> {\r\n  return {\r\n    perform: performer,\r\n    options,\r\n    actor,\r\n    speed,\r\n  };\r\n}\r\n\r\nexport function runAction<T>(action: Action<T>) {\r\n  if (action.actor.alive && !action.actor.status.staggered) {\r\n    return action.perform(action.actor, action.options);\r\n  }\r\n}\r\n","import { Bounds } from \"../space/bounds\";\r\nimport { RDisplay } from \"../../ui/RotDisplay\";\r\nimport { gameData } from \"../../core/GameManager\";\r\n\r\nexport enum TileVisibility {\r\n  VISIBLE,\r\n  SEEN,\r\n  HIDDEN,\r\n}\r\n\r\nexport class WorldTile<T, S> {\r\n  seen = false;\r\n  z = 1;\r\n\r\n  constructor(\r\n    public type: T,\r\n    public adj: {\r\n      up: S;\r\n      left: S;\r\n      right: S;\r\n      down: S;\r\n    }\r\n  ) {}\r\n}\r\n\r\nexport type DrawTileFn = (\r\n  display: RDisplay,\r\n  x: number,\r\n  y: number,\r\n  tile: WorldTile<T, S>,\r\n  visibility: TileVisibility\r\n) => void;\r\n\r\nexport class LevelMap<T, S> {\r\n  tiles: WorldTile<T, S>[];\r\n  constructor(\r\n    public drawTile: DrawTileFn,\r\n    public width: number,\r\n    public height: number\r\n  ) {\r\n    this.tiles = [];\r\n  }\r\n\r\n  draw(\r\n    display: RDisplay,\r\n    bounds: Bounds,\r\n    view: Bounds,\r\n    visible: Map<number, boolean>\r\n  ) {\r\n    for (let y = view.y; y < view.h + view.y; y++) {\r\n      for (let x = view.x; x < view.w + view.x; x++) {\r\n        const t = this.tiles[y * this.width + x];\r\n        t &&\r\n          this.drawTile(\r\n            display,\r\n            x + bounds.x - view.x,\r\n            y + bounds.y - view.y,\r\n            t,\r\n            visible.has(x + y * this.width)\r\n              ? TileVisibility.VISIBLE\r\n              : t.seen\r\n              ? TileVisibility.SEEN\r\n              : TileVisibility.HIDDEN\r\n          );\r\n\r\n        /**const dMapVal = gameData.dMapPlayer?.get({ x: x, y: y });\r\n        if (dMapVal) {\r\n          const dString = dMapVal.toString(16);\r\n          display.drawAppend(\r\n            x + bounds.x - view.x,\r\n            y + bounds.y - view.y,\r\n            dString[dString.length - 1],\r\n            \"#FFFFFF\",\r\n            \"transparent\"\r\n          );\r\n        }**/\r\n      }\r\n    }\r\n  }\r\n\r\n  fillAll(makeFillTile: () => WorldTile<T, S>) {\r\n    this.tiles = [];\r\n    const size = this.height * this.width;\r\n    for (let i = 0; i < size; i++) {\r\n      this.tiles.push(makeFillTile());\r\n    }\r\n  }\r\n}\r\n","import { TileVisibility, WorldTile } from \"../../engine/map/LevelMap\";\r\nimport { TILE_TYPES } from \"../../tiles\";\r\nimport { RDisplay } from \"../../ui/RotDisplay\";\r\nimport Colors from \"../Colors\";\r\nimport { gameData } from \"../GameManager\";\r\n\r\nexport enum FloorTypes {\r\n  EMPTY,\r\n  CHASM,\r\n  OOB,\r\n}\r\n\r\nexport enum AdjTypes {\r\n  OPEN,\r\n  WALL,\r\n  ONE_OUT,\r\n  ONE_IN,\r\n  Z_OUT,\r\n  Z_IN,\r\n}\r\n\r\nconst VISIBLE_THEME = {\r\n  wall: Colors.B_GREY_5,\r\n  floor: Colors.BROWN_1,\r\n  bgs: [Colors.BROWN_1, Colors.BROWN_2, Colors.BROWN_3, Colors.RED_2],\r\n};\r\n\r\nconst SEEN_THEME = {\r\n  wall: Colors.B_GREY_5,\r\n  floor: Colors.GREY_1,\r\n  bgs: [Colors.GREY_1, Colors.GREY_2, Colors.GREY_3, Colors.RED_2],\r\n};\r\n\r\nexport const drawTile = (\r\n  display: RDisplay,\r\n  x: number,\r\n  y: number,\r\n  tile: WorldTile<FloorTypes, AdjTypes>,\r\n  visibility: TileVisibility\r\n) => {\r\n  //if (visibility === TileVisibility.HIDDEN) {\r\n  //  return;\r\n  //}\r\n  const theme =\r\n    visibility === TileVisibility.VISIBLE || gameData.seeAll\r\n      ? VISIBLE_THEME\r\n      : SEEN_THEME;\r\n\r\n  switch (tile.type) {\r\n    case FloorTypes.EMPTY:\r\n      display.draw(x, y, TILE_TYPES.EMPTY, theme.floor, theme.bgs[tile.z]);\r\n      break;\r\n    case FloorTypes.OOB:\r\n      display.draw(x, y, \" \", Colors.BLACK, Colors.BLACK); //Draw oob tile for background color\r\n      break;\r\n  }\r\n\r\n  let wallType = null;\r\n  if (tile.adj.up === AdjTypes.WALL && tile.adj.left === AdjTypes.WALL) {\r\n    wallType = TILE_TYPES.UL_;\r\n  } else if (tile.adj.up === AdjTypes.WALL) {\r\n    wallType = TILE_TYPES.U_;\r\n  } else if (tile.adj.left === AdjTypes.WALL) {\r\n    wallType = TILE_TYPES.L_;\r\n  }\r\n\r\n  if (wallType) {\r\n    display.drawAppend(x, y, wallType, theme.wall, \"transparent\");\r\n  }\r\n\r\n  if (tile.adj.left === AdjTypes.Z_IN) {\r\n    display.drawAppend(\r\n      x,\r\n      y,\r\n      TILE_TYPES._L,\r\n      theme.bgs[tile.z + 1],\r\n      \"transparent\"\r\n    );\r\n  }\r\n  if (tile.adj.up === AdjTypes.Z_IN) {\r\n    display.drawAppend(\r\n      x,\r\n      y,\r\n      TILE_TYPES._U,\r\n      theme.bgs[tile.z + 1],\r\n      \"transparent\"\r\n    );\r\n  }\r\n  if (tile.adj.right === AdjTypes.Z_IN) {\r\n    display.drawAppend(\r\n      x,\r\n      y,\r\n      TILE_TYPES._R,\r\n      theme.bgs[tile.z + 1],\r\n      \"transparent\"\r\n    );\r\n  }\r\n  if (tile.adj.down === AdjTypes.Z_IN) {\r\n    display.drawAppend(\r\n      x,\r\n      y,\r\n      TILE_TYPES._D,\r\n      theme.bgs[tile.z + 1],\r\n      \"transparent\"\r\n    );\r\n  }\r\n};\r\n","import { WorldTile } from \"../../engine/map/LevelMap\";\r\nimport { Directions } from \"../../engine/space/directions\";\r\nimport { AdjTypes, FloorTypes } from \"./Map\";\r\n\r\nexport const adjInCheck = (adj: AdjTypes) =>\r\n  adj !== AdjTypes.WALL && adj !== AdjTypes.ONE_OUT;\r\n\r\nexport const adjOutCheck = (adj: AdjTypes) =>\r\n  adj !== AdjTypes.WALL && adj !== AdjTypes.ONE_IN;\r\n\r\nexport const CheckMovement = {\r\n  [Directions.Left]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.left),\r\n  [Directions.Up]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.up),\r\n  [Directions.Right]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.right),\r\n  [Directions.Down]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.down),\r\n  [Directions.UpLeft]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.up) && adjOutCheck(tile.adj.left),\r\n  [Directions.UpRight]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.up) && adjOutCheck(tile.adj.right),\r\n  [Directions.DownRight]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.down) && adjOutCheck(tile.adj.right),\r\n  [Directions.DownLeft]: (tile: WorldTile<FloorTypes, AdjTypes>) =>\r\n    adjOutCheck(tile.adj.down) && adjOutCheck(tile.adj.left),\r\n} as const;\r\n","import { animate, AnimationOptions, Driver } from \"popmotion\";\r\nimport { Bounds } from \"../space/bounds\";\r\nimport { RDisplay } from \"../../ui/RotDisplay\";\r\n\r\nexport function awaitAnimate<V>(options: AnimationOptions<V>) {\r\n  return new Promise<void>((r) => {\r\n    animate({ onComplete: r, ...options });\r\n  });\r\n}\r\n\r\nconst FINISHED = new Promise<void>((r) => r());\r\n\r\nexport class Animatable {\r\n  status: Promise<void> = FINISHED;\r\n  updatable: (elapsed: number) => void = () => null;\r\n  driver: Driver = (updateFn) => {\r\n    return {\r\n      start: () => (this.updatable = updateFn),\r\n      stop: () => (this.updatable = () => null),\r\n    };\r\n  };\r\n\r\n  update(elapsed: number) {\r\n    this.updatable(elapsed);\r\n  }\r\n}\r\n\r\nexport enum ParticleModes {\r\n  DRAW,\r\n  DRAW_OVER,\r\n  DRAW_APPEND,\r\n  DRAW_OVER_FIRST,\r\n  DRAW_OVER_LAST,\r\n}\r\n\r\nexport class Particle<T> extends Animatable {\r\n  mode: ParticleModes;\r\n  char: string | null;\r\n  fg: string | null;\r\n  bg: string | null;\r\n  _end?: () => void;\r\n  constructor(\r\n    breed: ParticleBreed<T>,\r\n    public id: number,\r\n    public x: number,\r\n    public y: number,\r\n    public options?: T\r\n  ) {\r\n    super();\r\n    this.mode = breed.mode;\r\n    this.char = breed.char;\r\n    this.fg = breed.fg;\r\n    this.bg = breed.bg;\r\n\r\n    const endSwitch = new Promise<void>((r) => (this._end = r));\r\n    this.status = Promise.race([breed.animate(this), endSwitch]);\r\n  }\r\n\r\n  finish() {\r\n    this._end && this._end();\r\n  }\r\n\r\n  render(display: RDisplay, bounds: Bounds, view: Bounds) {\r\n    //TODO: Switch on Draw ModeParticle\r\n    let drawFn: keyof RDisplay;\r\n    let ch = this.char;\r\n    switch (this.mode) {\r\n      case ParticleModes.DRAW:\r\n        drawFn = \"draw\";\r\n        break;\r\n      case ParticleModes.DRAW_OVER:\r\n        drawFn = \"drawOver\";\r\n        break;\r\n      case ParticleModes.DRAW_APPEND:\r\n        drawFn = \"drawAppend\";\r\n        ch = ch || \"\";\r\n        break;\r\n      case ParticleModes.DRAW_OVER_FIRST:\r\n        drawFn = \"drawOverFirst\";\r\n        break;\r\n      case ParticleModes.DRAW_OVER_LAST:\r\n        drawFn = \"drawOverLast\";\r\n        break;\r\n    }\r\n\r\n    display[drawFn](\r\n      this.x + bounds.x - view.x,\r\n      this.y + bounds.y - view.y,\r\n      ch,\r\n      this.fg,\r\n      this.bg\r\n    );\r\n  }\r\n}\r\n\r\nexport type ParticleBreed<T> = {\r\n  mode: ParticleModes;\r\n  char: string | null;\r\n  fg: string | null;\r\n  bg: string | null;\r\n  animate: (particle: Particle<T>) => Promise<void>;\r\n};\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","var warning = function () { };\r\nvar invariant = function () { };\r\nif (process.env.NODE_ENV !== 'production') {\r\n    warning = function (check, message) {\r\n        if (!check && typeof console !== 'undefined') {\r\n            console.warn(message);\r\n        }\r\n    };\r\n    invariant = function (check, message) {\r\n        if (!check) {\r\n            throw new Error(message);\r\n        }\r\n    };\r\n}\n\nexport { invariant, warning };\n","import { __assign } from 'tslib';\n\nvar clamp = function (min, max) { return function (v) {\r\n    return Math.max(Math.min(v, max), min);\r\n}; };\r\nvar sanitize = function (v) { return (v % 1 ? Number(v.toFixed(5)) : v); };\r\nvar floatRegex = /(-)?([\\d]*\\.?[\\d])+/g;\r\nvar colorRegex = /(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\\((-?[\\d\\.]+%?[,\\s]+){2,3}\\s*\\/*\\s*[\\d\\.]+%?\\))/gi;\r\nvar singleColorRegex = /^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\\((-?[\\d\\.]+%?[,\\s]+){2,3}\\s*\\/*\\s*[\\d\\.]+%?\\))$/i;\r\nfunction isString(v) {\r\n    return typeof v === 'string';\r\n}\n\nvar number = {\r\n    test: function (v) { return typeof v === 'number'; },\r\n    parse: parseFloat,\r\n    transform: function (v) { return v; },\r\n};\r\nvar alpha = __assign(__assign({}, number), { transform: clamp(0, 1) });\r\nvar scale = __assign(__assign({}, number), { default: 1 });\n\nvar createUnitType = function (unit) { return ({\r\n    test: function (v) {\r\n        return isString(v) && v.endsWith(unit) && v.split(' ').length === 1;\r\n    },\r\n    parse: parseFloat,\r\n    transform: function (v) { return \"\" + v + unit; },\r\n}); };\r\nvar degrees = createUnitType('deg');\r\nvar percent = createUnitType('%');\r\nvar px = createUnitType('px');\r\nvar vh = createUnitType('vh');\r\nvar vw = createUnitType('vw');\r\nvar progressPercentage = __assign(__assign({}, percent), { parse: function (v) { return percent.parse(v) / 100; }, transform: function (v) { return percent.transform(v * 100); } });\n\nvar isColorString = function (type, testProp) { return function (v) {\r\n    return ((isString(v) && singleColorRegex.test(v) && v.startsWith(type)) ||\r\n        (testProp && Object.prototype.hasOwnProperty.call(v, testProp)));\r\n}; };\r\nvar splitColor = function (aName, bName, cName) { return function (v) {\r\n    var _a;\r\n    if (!isString(v))\r\n        return v;\r\n    var _b = v.match(floatRegex), a = _b[0], b = _b[1], c = _b[2], alpha = _b[3];\r\n    return _a = {},\r\n        _a[aName] = parseFloat(a),\r\n        _a[bName] = parseFloat(b),\r\n        _a[cName] = parseFloat(c),\r\n        _a.alpha = alpha !== undefined ? parseFloat(alpha) : 1,\r\n        _a;\r\n}; };\n\nvar hsla = {\r\n    test: isColorString('hsl', 'hue'),\r\n    parse: splitColor('hue', 'saturation', 'lightness'),\r\n    transform: function (_a) {\r\n        var hue = _a.hue, saturation = _a.saturation, lightness = _a.lightness, _b = _a.alpha, alpha$1 = _b === void 0 ? 1 : _b;\r\n        return ('hsla(' +\r\n            Math.round(hue) +\r\n            ', ' +\r\n            percent.transform(sanitize(saturation)) +\r\n            ', ' +\r\n            percent.transform(sanitize(lightness)) +\r\n            ', ' +\r\n            sanitize(alpha.transform(alpha$1)) +\r\n            ')');\r\n    },\r\n};\n\nvar clampRgbUnit = clamp(0, 255);\r\nvar rgbUnit = __assign(__assign({}, number), { transform: function (v) { return Math.round(clampRgbUnit(v)); } });\r\nvar rgba = {\r\n    test: isColorString('rgb', 'red'),\r\n    parse: splitColor('red', 'green', 'blue'),\r\n    transform: function (_a) {\r\n        var red = _a.red, green = _a.green, blue = _a.blue, _b = _a.alpha, alpha$1 = _b === void 0 ? 1 : _b;\r\n        return 'rgba(' +\r\n            rgbUnit.transform(red) +\r\n            ', ' +\r\n            rgbUnit.transform(green) +\r\n            ', ' +\r\n            rgbUnit.transform(blue) +\r\n            ', ' +\r\n            sanitize(alpha.transform(alpha$1)) +\r\n            ')';\r\n    },\r\n};\n\nfunction parseHex(v) {\r\n    var r = '';\r\n    var g = '';\r\n    var b = '';\r\n    var a = '';\r\n    if (v.length > 5) {\r\n        r = v.substr(1, 2);\r\n        g = v.substr(3, 2);\r\n        b = v.substr(5, 2);\r\n        a = v.substr(7, 2);\r\n    }\r\n    else {\r\n        r = v.substr(1, 1);\r\n        g = v.substr(2, 1);\r\n        b = v.substr(3, 1);\r\n        a = v.substr(4, 1);\r\n        r += r;\r\n        g += g;\r\n        b += b;\r\n        a += a;\r\n    }\r\n    return {\r\n        red: parseInt(r, 16),\r\n        green: parseInt(g, 16),\r\n        blue: parseInt(b, 16),\r\n        alpha: a ? parseInt(a, 16) / 255 : 1,\r\n    };\r\n}\r\nvar hex = {\r\n    test: isColorString('#'),\r\n    parse: parseHex,\r\n    transform: rgba.transform,\r\n};\n\nvar color = {\r\n    test: function (v) { return rgba.test(v) || hex.test(v) || hsla.test(v); },\r\n    parse: function (v) {\r\n        if (rgba.test(v)) {\r\n            return rgba.parse(v);\r\n        }\r\n        else if (hsla.test(v)) {\r\n            return hsla.parse(v);\r\n        }\r\n        else {\r\n            return hex.parse(v);\r\n        }\r\n    },\r\n    transform: function (v) {\r\n        return isString(v)\r\n            ? v\r\n            : v.hasOwnProperty('red')\r\n                ? rgba.transform(v)\r\n                : hsla.transform(v);\r\n    },\r\n};\n\nvar colorToken = '${c}';\r\nvar numberToken = '${n}';\r\nfunction test(v) {\r\n    var _a, _b, _c, _d;\r\n    return (isNaN(v) &&\r\n        isString(v) &&\r\n        ((_b = (_a = v.match(floatRegex)) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) + ((_d = (_c = v.match(colorRegex)) === null || _c === void 0 ? void 0 : _c.length) !== null && _d !== void 0 ? _d : 0) > 0);\r\n}\r\nfunction analyse(v) {\r\n    var values = [];\r\n    var numColors = 0;\r\n    var colors = v.match(colorRegex);\r\n    if (colors) {\r\n        numColors = colors.length;\r\n        v = v.replace(colorRegex, colorToken);\r\n        values.push.apply(values, colors.map(color.parse));\r\n    }\r\n    var numbers = v.match(floatRegex);\r\n    if (numbers) {\r\n        v = v.replace(floatRegex, numberToken);\r\n        values.push.apply(values, numbers.map(number.parse));\r\n    }\r\n    return { values: values, numColors: numColors, tokenised: v };\r\n}\r\nfunction parse(v) {\r\n    return analyse(v).values;\r\n}\r\nfunction createTransformer(v) {\r\n    var _a = analyse(v), values = _a.values, numColors = _a.numColors, tokenised = _a.tokenised;\r\n    var numValues = values.length;\r\n    return function (v) {\r\n        var output = tokenised;\r\n        for (var i = 0; i < numValues; i++) {\r\n            output = output.replace(i < numColors ? colorToken : numberToken, i < numColors ? color.transform(v[i]) : sanitize(v[i]));\r\n        }\r\n        return output;\r\n    };\r\n}\r\nvar convertNumbersToZero = function (v) {\r\n    return typeof v === 'number' ? 0 : v;\r\n};\r\nfunction getAnimatableNone(v) {\r\n    var parsed = parse(v);\r\n    var transformer = createTransformer(v);\r\n    return transformer(parsed.map(convertNumbersToZero));\r\n}\r\nvar complex = { test: test, parse: parse, createTransformer: createTransformer, getAnimatableNone: getAnimatableNone };\n\nvar maxDefaults = new Set(['brightness', 'contrast', 'saturate', 'opacity']);\r\nfunction applyDefaultFilter(v) {\r\n    var _a = v.slice(0, -1).split('('), name = _a[0], value = _a[1];\r\n    if (name === 'drop-shadow')\r\n        return v;\r\n    var number = (value.match(floatRegex) || [])[0];\r\n    if (!number)\r\n        return v;\r\n    var unit = value.replace(number, '');\r\n    var defaultValue = maxDefaults.has(name) ? 1 : 0;\r\n    if (number !== value)\r\n        defaultValue *= 100;\r\n    return name + '(' + defaultValue + unit + ')';\r\n}\r\nvar functionRegex = /([a-z-]*)\\(.*?\\)/g;\r\nvar filter = __assign(__assign({}, complex), { getAnimatableNone: function (v) {\r\n        var functions = v.match(functionRegex);\r\n        return functions ? functions.map(applyDefaultFilter).join(' ') : v;\r\n    } });\n\nexport { alpha, color, complex, degrees, filter, hex, hsla, number, percent, progressPercentage, px, rgbUnit, rgba, scale, vh, vw };\n","var defaultTimestep = 1 / 60 * 1000;\nvar getCurrentTime = typeof performance !== \"undefined\" ? function () {\n    return performance.now();\n} : function () {\n    return Date.now();\n};\nvar onNextFrame = typeof window !== \"undefined\" ? function (callback) {\n    return window.requestAnimationFrame(callback);\n} : function (callback) {\n    return setTimeout(function () {\n        return callback(getCurrentTime());\n    }, defaultTimestep);\n};\n\nfunction createRenderStep(runNextFrame) {\n    var toRun = [];\n    var toRunNextFrame = [];\n    var numToRun = 0;\n    var isProcessing = false;\n    var toKeepAlive = new WeakSet();\n    var step = {\n        schedule: function (callback, keepAlive, immediate) {\n            if (keepAlive === void 0) {\n                keepAlive = false;\n            }\n            if (immediate === void 0) {\n                immediate = false;\n            }\n            var addToCurrentFrame = immediate && isProcessing;\n            var buffer = addToCurrentFrame ? toRun : toRunNextFrame;\n            if (keepAlive) toKeepAlive.add(callback);\n            if (buffer.indexOf(callback) === -1) {\n                buffer.push(callback);\n                if (addToCurrentFrame && isProcessing) numToRun = toRun.length;\n            }\n            return callback;\n        },\n        cancel: function (callback) {\n            var index = toRunNextFrame.indexOf(callback);\n            if (index !== -1) toRunNextFrame.splice(index, 1);\n            toKeepAlive.delete(callback);\n        },\n        process: function (frameData) {\n            var _a;\n            isProcessing = true;\n            _a = [toRunNextFrame, toRun], toRun = _a[0], toRunNextFrame = _a[1];\n            toRunNextFrame.length = 0;\n            numToRun = toRun.length;\n            if (numToRun) {\n                for (var i = 0; i < numToRun; i++) {\n                    var callback = toRun[i];\n                    callback(frameData);\n                    if (toKeepAlive.has(callback)) {\n                        step.schedule(callback);\n                        runNextFrame();\n                    }\n                }\n            }\n            isProcessing = false;\n        }\n    };\n    return step;\n}\n\nvar maxElapsed = 40;\nvar useDefaultElapsed = true;\nvar runNextFrame = false;\nvar isProcessing = false;\nvar frame = {\n    delta: 0,\n    timestamp: 0\n};\nvar stepsOrder = [\"read\", \"update\", \"preRender\", \"render\", \"postRender\"];\nvar steps = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    acc[key] = createRenderStep(function () {\n        return runNextFrame = true;\n    });\n    return acc;\n}, {});\nvar sync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    var step = steps[key];\n    acc[key] = function (process, keepAlive, immediate) {\n        if (keepAlive === void 0) {\n            keepAlive = false;\n        }\n        if (immediate === void 0) {\n            immediate = false;\n        }\n        if (!runNextFrame) startLoop();\n        return step.schedule(process, keepAlive, immediate);\n    };\n    return acc;\n}, {});\nvar cancelSync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    acc[key] = steps[key].cancel;\n    return acc;\n}, {});\nvar processStep = function (stepId) {\n    return steps[stepId].process(frame);\n};\nvar processFrame = function (timestamp) {\n    runNextFrame = false;\n    frame.delta = useDefaultElapsed ? defaultTimestep : Math.max(Math.min(timestamp - frame.timestamp, maxElapsed), 1);\n    frame.timestamp = timestamp;\n    isProcessing = true;\n    stepsOrder.forEach(processStep);\n    isProcessing = false;\n    if (runNextFrame) {\n        useDefaultElapsed = false;\n        onNextFrame(processFrame);\n    }\n};\nvar startLoop = function () {\n    runNextFrame = true;\n    useDefaultElapsed = true;\n    if (!isProcessing) onNextFrame(processFrame);\n};\nvar getFrameData = function () {\n    return frame;\n};\n\nexport default sync;\nexport { cancelSync, getFrameData };\n","import { __rest, __assign, __spreadArrays } from 'tslib';\nimport { warning, invariant } from 'hey-listen';\nimport { hex, rgba, hsla, complex, color } from 'style-value-types';\nimport sync, { cancelSync, getFrameData } from 'framesync';\n\nvar clamp = function (min, max, v) {\n    return Math.min(Math.max(v, min), max);\n};\n\nvar safeMin = 0.001;\nvar minDuration = 0.01;\nvar maxDuration = 10.0;\nvar minDamping = 0.05;\nvar maxDamping = 1;\nfunction findSpring(_a) {\n    var _b = _a.duration,\n        duration = _b === void 0 ? 800 : _b,\n        _c = _a.bounce,\n        bounce = _c === void 0 ? 0.25 : _c,\n        _d = _a.velocity,\n        velocity = _d === void 0 ? 0 : _d,\n        _e = _a.mass,\n        mass = _e === void 0 ? 1 : _e;\n    var envelope;\n    var derivative;\n    warning(duration <= maxDuration * 1000, \"Spring duration must be 10 seconds or less\");\n    var dampingRatio = 1 - bounce;\n    dampingRatio = clamp(minDamping, maxDamping, dampingRatio);\n    duration = clamp(minDuration, maxDuration, duration / 1000);\n    if (dampingRatio < 1) {\n        envelope = function (undampedFreq) {\n            var exponentialDecay = undampedFreq * dampingRatio;\n            var delta = exponentialDecay * duration;\n            var a = exponentialDecay - velocity;\n            var b = calcAngularFreq(undampedFreq, dampingRatio);\n            var c = Math.exp(-delta);\n            return safeMin - a / b * c;\n        };\n        derivative = function (undampedFreq) {\n            var exponentialDecay = undampedFreq * dampingRatio;\n            var delta = exponentialDecay * duration;\n            var d = delta * velocity + velocity;\n            var e = Math.pow(dampingRatio, 2) * Math.pow(undampedFreq, 2) * duration;\n            var f = Math.exp(-delta);\n            var g = calcAngularFreq(Math.pow(undampedFreq, 2), dampingRatio);\n            var factor = -envelope(undampedFreq) + safeMin > 0 ? -1 : 1;\n            return factor * ((d - e) * f) / g;\n        };\n    } else {\n        envelope = function (undampedFreq) {\n            var a = Math.exp(-undampedFreq * duration);\n            var b = (undampedFreq - velocity) * duration + 1;\n            return -safeMin + a * b;\n        };\n        derivative = function (undampedFreq) {\n            var a = Math.exp(-undampedFreq * duration);\n            var b = (velocity - undampedFreq) * (duration * duration);\n            return a * b;\n        };\n    }\n    var initialGuess = 5 / duration;\n    var undampedFreq = approximateRoot(envelope, derivative, initialGuess);\n    if (isNaN(undampedFreq)) {\n        return {\n            stiffness: 100,\n            damping: 10\n        };\n    } else {\n        var stiffness = Math.pow(undampedFreq, 2) * mass;\n        return {\n            stiffness: stiffness,\n            damping: dampingRatio * 2 * Math.sqrt(mass * stiffness)\n        };\n    }\n}\nvar rootIterations = 12;\nfunction approximateRoot(envelope, derivative, initialGuess) {\n    var result = initialGuess;\n    for (var i = 1; i < rootIterations; i++) {\n        result = result - envelope(result) / derivative(result);\n    }\n    return result;\n}\nfunction calcAngularFreq(undampedFreq, dampingRatio) {\n    return undampedFreq * Math.sqrt(1 - dampingRatio * dampingRatio);\n}\n\nvar durationKeys = [\"duration\", \"bounce\"];\nvar physicsKeys = [\"stiffness\", \"damping\", \"mass\"];\nfunction isSpringType(options, keys) {\n    return keys.some(function (key) {\n        return options[key] !== undefined;\n    });\n}\nfunction getSpringOptions(options) {\n    var springOptions = __assign({ velocity: 0.0, stiffness: 100, damping: 10, mass: 1.0, isResolvedFromDuration: false }, options);\n    if (!isSpringType(options, physicsKeys) && isSpringType(options, durationKeys)) {\n        var derived = findSpring(options);\n        springOptions = __assign(__assign(__assign({}, springOptions), derived), { velocity: 0.0, mass: 1.0 });\n        springOptions.isResolvedFromDuration = true;\n    }\n    return springOptions;\n}\nfunction spring(_a) {\n    var _b = _a.from,\n        from = _b === void 0 ? 0.0 : _b,\n        _c = _a.to,\n        to = _c === void 0 ? 1.0 : _c,\n        _d = _a.restSpeed,\n        restSpeed = _d === void 0 ? 2 : _d,\n        restDelta = _a.restDelta,\n        options = __rest(_a, [\"from\", \"to\", \"restSpeed\", \"restDelta\"]);\n    var state = { done: false, value: from };\n    var _e = getSpringOptions(options),\n        stiffness = _e.stiffness,\n        damping = _e.damping,\n        mass = _e.mass,\n        velocity = _e.velocity,\n        isResolvedFromDuration = _e.isResolvedFromDuration;\n    var resolveSpring = zero;\n    var resolveVelocity = zero;\n    function createSpring() {\n        var initialVelocity = velocity ? -(velocity / 1000) : 0.0;\n        var initialDelta = to - from;\n        var dampingRatio = damping / (2 * Math.sqrt(stiffness * mass));\n        var undampedAngularFreq = Math.sqrt(stiffness / mass) / 1000;\n        restDelta !== null && restDelta !== void 0 ? restDelta : restDelta = Math.abs(to - from) <= 1 ? 0.01 : 0.4;\n        if (dampingRatio < 1) {\n            var angularFreq_1 = calcAngularFreq(undampedAngularFreq, dampingRatio);\n            resolveSpring = function (t) {\n                var envelope = Math.exp(-dampingRatio * undampedAngularFreq * t);\n                return to - envelope * ((initialVelocity + dampingRatio * undampedAngularFreq * initialDelta) / angularFreq_1 * Math.sin(angularFreq_1 * t) + initialDelta * Math.cos(angularFreq_1 * t));\n            };\n            resolveVelocity = function (t) {\n                var envelope = Math.exp(-dampingRatio * undampedAngularFreq * t);\n                return dampingRatio * undampedAngularFreq * envelope * (Math.sin(angularFreq_1 * t) * (initialVelocity + dampingRatio * undampedAngularFreq * initialDelta) / angularFreq_1 + initialDelta * Math.cos(angularFreq_1 * t)) - envelope * (Math.cos(angularFreq_1 * t) * (initialVelocity + dampingRatio * undampedAngularFreq * initialDelta) - angularFreq_1 * initialDelta * Math.sin(angularFreq_1 * t));\n            };\n        } else if (dampingRatio === 1) {\n            resolveSpring = function (t) {\n                return to - Math.exp(-undampedAngularFreq * t) * (initialDelta + (initialVelocity + undampedAngularFreq * initialDelta) * t);\n            };\n        } else {\n            var dampedAngularFreq_1 = undampedAngularFreq * Math.sqrt(dampingRatio * dampingRatio - 1);\n            resolveSpring = function (t) {\n                var envelope = Math.exp(-dampingRatio * undampedAngularFreq * t);\n                var freqForT = Math.min(dampedAngularFreq_1 * t, 300);\n                return to - envelope * ((initialVelocity + dampingRatio * undampedAngularFreq * initialDelta) * Math.sinh(freqForT) + dampedAngularFreq_1 * initialDelta * Math.cosh(freqForT)) / dampedAngularFreq_1;\n            };\n        }\n    }\n    createSpring();\n    return {\n        next: function (t) {\n            var current = resolveSpring(t);\n            if (!isResolvedFromDuration) {\n                var currentVelocity = resolveVelocity(t) * 1000;\n                var isBelowVelocityThreshold = Math.abs(currentVelocity) <= restSpeed;\n                var isBelowDisplacementThreshold = Math.abs(to - current) <= restDelta;\n                state.done = isBelowVelocityThreshold && isBelowDisplacementThreshold;\n            } else {\n                state.done = t >= options.duration;\n            }\n            state.value = state.done ? to : current;\n            return state;\n        },\n        flipTarget: function () {\n            var _a;\n            velocity = -velocity;\n            _a = [to, from], from = _a[0], to = _a[1];\n            createSpring();\n        }\n    };\n}\nspring.needsInterpolation = function (a, b) {\n    return typeof a === \"string\" || typeof b === \"string\";\n};\nvar zero = function (_t) {\n    return 0;\n};\n\nvar progress = function (from, to, value) {\n    var toFromDifference = to - from;\n    return toFromDifference === 0 ? 1 : (value - from) / toFromDifference;\n};\n\nvar mix = function (from, to, progress) {\n    return -progress * from + progress * to + from;\n};\n\nvar mixLinearColor = function (from, to, v) {\n    var fromExpo = from * from;\n    var toExpo = to * to;\n    return Math.sqrt(Math.max(0, v * (toExpo - fromExpo) + fromExpo));\n};\nvar colorTypes = [hex, rgba, hsla];\nvar getColorType = function (v) {\n    return colorTypes.find(function (type) {\n        return type.test(v);\n    });\n};\nvar notAnimatable = function (color) {\n    return \"'\" + color + \"' is not an animatable color. Use the equivalent color code instead.\";\n};\nvar mixColor = function (from, to) {\n    var fromColorType = getColorType(from);\n    var toColorType = getColorType(to);\n    invariant(!!fromColorType, notAnimatable(from));\n    invariant(!!toColorType, notAnimatable(to));\n    invariant(fromColorType.transform === toColorType.transform, \"Both colors must be hex/RGBA, OR both must be HSLA.\");\n    var fromColor = fromColorType.parse(from);\n    var toColor = toColorType.parse(to);\n    var blended = __assign({}, fromColor);\n    var mixFunc = fromColorType === hsla ? mix : mixLinearColor;\n    return function (v) {\n        for (var key in blended) {\n            if (key !== \"alpha\") {\n                blended[key] = mixFunc(fromColor[key], toColor[key], v);\n            }\n        }\n        blended.alpha = mix(fromColor.alpha, toColor.alpha, v);\n        return fromColorType.transform(blended);\n    };\n};\n\nvar zeroPoint = {\n    x: 0,\n    y: 0,\n    z: 0\n};\nvar isNum = function (v) {\n    return typeof v === 'number';\n};\n\nvar combineFunctions = function (a, b) {\n    return function (v) {\n        return b(a(v));\n    };\n};\nvar pipe = function () {\n    var transformers = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        transformers[_i] = arguments[_i];\n    }\n    return transformers.reduce(combineFunctions);\n};\n\nfunction getMixer(origin, target) {\n    if (isNum(origin)) {\n        return function (v) {\n            return mix(origin, target, v);\n        };\n    } else if (color.test(origin)) {\n        return mixColor(origin, target);\n    } else {\n        return mixComplex(origin, target);\n    }\n}\nvar mixArray = function (from, to) {\n    var output = __spreadArrays(from);\n    var numValues = output.length;\n    var blendValue = from.map(function (fromThis, i) {\n        return getMixer(fromThis, to[i]);\n    });\n    return function (v) {\n        for (var i = 0; i < numValues; i++) {\n            output[i] = blendValue[i](v);\n        }\n        return output;\n    };\n};\nvar mixObject = function (origin, target) {\n    var output = __assign(__assign({}, origin), target);\n    var blendValue = {};\n    for (var key in output) {\n        if (origin[key] !== undefined && target[key] !== undefined) {\n            blendValue[key] = getMixer(origin[key], target[key]);\n        }\n    }\n    return function (v) {\n        for (var key in blendValue) {\n            output[key] = blendValue[key](v);\n        }\n        return output;\n    };\n};\nfunction analyse(value) {\n    var parsed = complex.parse(value);\n    var numValues = parsed.length;\n    var numNumbers = 0;\n    var numRGB = 0;\n    var numHSL = 0;\n    for (var i = 0; i < numValues; i++) {\n        if (numNumbers || typeof parsed[i] === \"number\") {\n            numNumbers++;\n        } else {\n            if (parsed[i].hue !== undefined) {\n                numHSL++;\n            } else {\n                numRGB++;\n            }\n        }\n    }\n    return { parsed: parsed, numNumbers: numNumbers, numRGB: numRGB, numHSL: numHSL };\n}\nvar mixComplex = function (origin, target) {\n    var template = complex.createTransformer(target);\n    var originStats = analyse(origin);\n    var targetStats = analyse(target);\n    invariant(originStats.numHSL === targetStats.numHSL && originStats.numRGB === targetStats.numRGB && originStats.numNumbers >= targetStats.numNumbers, \"Complex values '\" + origin + \"' and '\" + target + \"' too different to mix. Ensure all colors are of the same type.\");\n    return pipe(mixArray(originStats.parsed, targetStats.parsed), template);\n};\n\nvar mixNumber = function (from, to) {\n    return function (p) {\n        return mix(from, to, p);\n    };\n};\nfunction detectMixerFactory(v) {\n    if (typeof v === 'number') {\n        return mixNumber;\n    } else if (typeof v === 'string') {\n        if (color.test(v)) {\n            return mixColor;\n        } else {\n            return mixComplex;\n        }\n    } else if (Array.isArray(v)) {\n        return mixArray;\n    } else if (typeof v === 'object') {\n        return mixObject;\n    }\n}\nfunction createMixers(output, ease, customMixer) {\n    var mixers = [];\n    var mixerFactory = customMixer || detectMixerFactory(output[0]);\n    var numMixers = output.length - 1;\n    for (var i = 0; i < numMixers; i++) {\n        var mixer = mixerFactory(output[i], output[i + 1]);\n        if (ease) {\n            var easingFunction = Array.isArray(ease) ? ease[i] : ease;\n            mixer = pipe(easingFunction, mixer);\n        }\n        mixers.push(mixer);\n    }\n    return mixers;\n}\nfunction fastInterpolate(_a, _b) {\n    var from = _a[0],\n        to = _a[1];\n    var mixer = _b[0];\n    return function (v) {\n        return mixer(progress(from, to, v));\n    };\n}\nfunction slowInterpolate(input, mixers) {\n    var inputLength = input.length;\n    var lastInputIndex = inputLength - 1;\n    return function (v) {\n        var mixerIndex = 0;\n        var foundMixerIndex = false;\n        if (v <= input[0]) {\n            foundMixerIndex = true;\n        } else if (v >= input[lastInputIndex]) {\n            mixerIndex = lastInputIndex - 1;\n            foundMixerIndex = true;\n        }\n        if (!foundMixerIndex) {\n            var i = 1;\n            for (; i < inputLength; i++) {\n                if (input[i] > v || i === lastInputIndex) {\n                    break;\n                }\n            }\n            mixerIndex = i - 1;\n        }\n        var progressInRange = progress(input[mixerIndex], input[mixerIndex + 1], v);\n        return mixers[mixerIndex](progressInRange);\n    };\n}\nfunction interpolate(input, output, _a) {\n    var _b = _a === void 0 ? {} : _a,\n        _c = _b.clamp,\n        isClamp = _c === void 0 ? true : _c,\n        ease = _b.ease,\n        mixer = _b.mixer;\n    var inputLength = input.length;\n    invariant(inputLength === output.length, 'Both input and output ranges must be the same length');\n    invariant(!ease || !Array.isArray(ease) || ease.length === inputLength - 1, 'Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values.');\n    if (input[0] > input[inputLength - 1]) {\n        input = [].concat(input);\n        output = [].concat(output);\n        input.reverse();\n        output.reverse();\n    }\n    var mixers = createMixers(output, ease, mixer);\n    var interpolator = inputLength === 2 ? fastInterpolate(input, mixers) : slowInterpolate(input, mixers);\n    return isClamp ? function (v) {\n        return interpolator(clamp(input[0], input[inputLength - 1], v));\n    } : interpolator;\n}\n\nvar reverseEasing = function (easing) {\n    return function (p) {\n        return 1 - easing(1 - p);\n    };\n};\nvar mirrorEasing = function (easing) {\n    return function (p) {\n        return p <= 0.5 ? easing(2 * p) / 2 : (2 - easing(2 * (1 - p))) / 2;\n    };\n};\nvar createExpoIn = function (power) {\n    return function (p) {\n        return Math.pow(p, power);\n    };\n};\nvar createBackIn = function (power) {\n    return function (p) {\n        return p * p * ((power + 1) * p - power);\n    };\n};\nvar createAnticipate = function (power) {\n    var backEasing = createBackIn(power);\n    return function (p) {\n        return (p *= 2) < 1 ? 0.5 * backEasing(p) : 0.5 * (2 - Math.pow(2, -10 * (p - 1)));\n    };\n};\n\nvar DEFAULT_OVERSHOOT_STRENGTH = 1.525;\nvar BOUNCE_FIRST_THRESHOLD = 4.0 / 11.0;\nvar BOUNCE_SECOND_THRESHOLD = 8.0 / 11.0;\nvar BOUNCE_THIRD_THRESHOLD = 9.0 / 10.0;\nvar linear = function (p) {\n    return p;\n};\nvar easeIn = /*#__PURE__*/createExpoIn(2);\nvar easeOut = /*#__PURE__*/reverseEasing(easeIn);\nvar easeInOut = /*#__PURE__*/mirrorEasing(easeIn);\nvar circIn = function (p) {\n    return 1 - Math.sin(Math.acos(p));\n};\nvar circOut = /*#__PURE__*/reverseEasing(circIn);\nvar circInOut = /*#__PURE__*/mirrorEasing(circOut);\nvar backIn = /*#__PURE__*/createBackIn(DEFAULT_OVERSHOOT_STRENGTH);\nvar backOut = /*#__PURE__*/reverseEasing(backIn);\nvar backInOut = /*#__PURE__*/mirrorEasing(backIn);\nvar anticipate = /*#__PURE__*/createAnticipate(DEFAULT_OVERSHOOT_STRENGTH);\nvar ca = 4356.0 / 361.0;\nvar cb = 35442.0 / 1805.0;\nvar cc = 16061.0 / 1805.0;\nvar bounceOut = function (p) {\n    if (p === 1 || p === 0) return p;\n    var p2 = p * p;\n    return p < BOUNCE_FIRST_THRESHOLD ? 7.5625 * p2 : p < BOUNCE_SECOND_THRESHOLD ? 9.075 * p2 - 9.9 * p + 3.4 : p < BOUNCE_THIRD_THRESHOLD ? ca * p2 - cb * p + cc : 10.8 * p * p - 20.52 * p + 10.72;\n};\nvar bounceIn = /*#__PURE__*/reverseEasing(bounceOut);\nvar bounceInOut = function (p) {\n    return p < 0.5 ? 0.5 * (1.0 - bounceOut(1.0 - p * 2.0)) : 0.5 * bounceOut(p * 2.0 - 1.0) + 0.5;\n};\n\nfunction defaultEasing(values, easing) {\n    return values.map(function () {\n        return easing || easeInOut;\n    }).splice(0, values.length - 1);\n}\nfunction defaultOffset(values) {\n    var numValues = values.length;\n    return values.map(function (_value, i) {\n        return i !== 0 ? i / (numValues - 1) : 0;\n    });\n}\nfunction convertOffsetToTimes(offset, duration) {\n    return offset.map(function (o) {\n        return o * duration;\n    });\n}\nfunction keyframes(_a) {\n    var _b = _a.from,\n        from = _b === void 0 ? 0 : _b,\n        _c = _a.to,\n        to = _c === void 0 ? 1 : _c,\n        ease = _a.ease,\n        offset = _a.offset,\n        _d = _a.duration,\n        duration = _d === void 0 ? 300 : _d;\n    var state = { done: false, value: from };\n    var values = Array.isArray(to) ? to : [from, to];\n    var times = convertOffsetToTimes(offset && offset.length === values.length ? offset : defaultOffset(values), duration);\n    function createInterpolator() {\n        return interpolate(times, values, {\n            ease: Array.isArray(ease) ? ease : defaultEasing(values, ease)\n        });\n    }\n    var interpolator = createInterpolator();\n    return {\n        next: function (t) {\n            state.value = interpolator(t);\n            state.done = t >= duration;\n            return state;\n        },\n        flipTarget: function () {\n            values.reverse();\n            interpolator = createInterpolator();\n        }\n    };\n}\n\nfunction decay(_a) {\n    var _b = _a.velocity,\n        velocity = _b === void 0 ? 0 : _b,\n        _c = _a.from,\n        from = _c === void 0 ? 0 : _c,\n        _d = _a.power,\n        power = _d === void 0 ? 0.8 : _d,\n        _e = _a.timeConstant,\n        timeConstant = _e === void 0 ? 350 : _e,\n        _f = _a.restDelta,\n        restDelta = _f === void 0 ? 0.5 : _f,\n        modifyTarget = _a.modifyTarget;\n    var state = { done: false, value: from };\n    var amplitude = power * velocity;\n    var ideal = from + amplitude;\n    var target = modifyTarget === undefined ? ideal : modifyTarget(ideal);\n    if (target !== ideal) amplitude = target - from;\n    return {\n        next: function (t) {\n            var delta = -amplitude * Math.exp(-t / timeConstant);\n            state.done = !(delta > restDelta || delta < -restDelta);\n            state.value = state.done ? target : target + delta;\n            return state;\n        },\n        flipTarget: function () {}\n    };\n}\n\nvar types = { keyframes: keyframes, spring: spring, decay: decay };\nfunction detectAnimationFromOptions(config) {\n    if (Array.isArray(config.to)) {\n        return keyframes;\n    } else if (types[config.type]) {\n        return types[config.type];\n    }\n    var keys = new Set(Object.keys(config));\n    if (keys.has(\"ease\") || keys.has(\"duration\") && !keys.has(\"dampingRatio\")) {\n        return keyframes;\n    } else if (keys.has(\"dampingRatio\") || keys.has(\"stiffness\") || keys.has(\"mass\") || keys.has(\"damping\") || keys.has(\"restSpeed\") || keys.has(\"restDelta\")) {\n        return spring;\n    }\n    return keyframes;\n}\n\nfunction loopElapsed(elapsed, duration, delay) {\n    if (delay === void 0) {\n        delay = 0;\n    }\n    return elapsed - duration - delay;\n}\nfunction reverseElapsed(elapsed, duration, delay, isForwardPlayback) {\n    if (delay === void 0) {\n        delay = 0;\n    }\n    if (isForwardPlayback === void 0) {\n        isForwardPlayback = true;\n    }\n    return isForwardPlayback ? loopElapsed(duration + -elapsed, duration, delay) : duration - (elapsed - duration) + delay;\n}\nfunction hasRepeatDelayElapsed(elapsed, duration, delay, isForwardPlayback) {\n    return isForwardPlayback ? elapsed >= duration + delay : elapsed <= -delay;\n}\n\nvar framesync = function (update) {\n    var passTimestamp = function (_a) {\n        var delta = _a.delta;\n        return update(delta);\n    };\n    return {\n        start: function () {\n            return sync.update(passTimestamp, true, true);\n        },\n        stop: function () {\n            return cancelSync.update(passTimestamp);\n        }\n    };\n};\nfunction animate(_a) {\n    var _b, _c;\n    var from = _a.from,\n        _d = _a.autoplay,\n        autoplay = _d === void 0 ? true : _d,\n        _e = _a.driver,\n        driver = _e === void 0 ? framesync : _e,\n        _f = _a.elapsed,\n        elapsed = _f === void 0 ? 0 : _f,\n        _g = _a.repeat,\n        repeatMax = _g === void 0 ? 0 : _g,\n        _h = _a.repeatType,\n        repeatType = _h === void 0 ? \"loop\" : _h,\n        _j = _a.repeatDelay,\n        repeatDelay = _j === void 0 ? 0 : _j,\n        onPlay = _a.onPlay,\n        onStop = _a.onStop,\n        onComplete = _a.onComplete,\n        onRepeat = _a.onRepeat,\n        onUpdate = _a.onUpdate,\n        options = __rest(_a, [\"from\", \"autoplay\", \"driver\", \"elapsed\", \"repeat\", \"repeatType\", \"repeatDelay\", \"onPlay\", \"onStop\", \"onComplete\", \"onRepeat\", \"onUpdate\"]);\n    var to = options.to;\n    var driverControls;\n    var repeatCount = 0;\n    var computedDuration = options.duration;\n    var latest;\n    var isComplete = false;\n    var isForwardPlayback = true;\n    var interpolateFromNumber;\n    var animator = detectAnimationFromOptions(options);\n    if ((_c = (_b = animator).needsInterpolation) === null || _c === void 0 ? void 0 : _c.call(_b, from, to)) {\n        interpolateFromNumber = interpolate([0, 100], [from, to], {\n            clamp: false\n        });\n        from = 0;\n        to = 100;\n    }\n    var animation = animator(__assign(__assign({}, options), { from: from, to: to }));\n    function repeat() {\n        repeatCount++;\n        if (repeatType === \"reverse\") {\n            isForwardPlayback = repeatCount % 2 === 0;\n            elapsed = reverseElapsed(elapsed, computedDuration, repeatDelay, isForwardPlayback);\n        } else {\n            elapsed = loopElapsed(elapsed, computedDuration, repeatDelay);\n            if (repeatType === \"mirror\") animation.flipTarget();\n        }\n        isComplete = false;\n        onRepeat && onRepeat();\n    }\n    function complete() {\n        driverControls.stop();\n        onComplete && onComplete();\n    }\n    function update(delta) {\n        if (!isForwardPlayback) delta = -delta;\n        elapsed += delta;\n        if (!isComplete) {\n            var state = animation.next(Math.max(0, elapsed));\n            latest = state.value;\n            if (interpolateFromNumber) latest = interpolateFromNumber(latest);\n            isComplete = isForwardPlayback ? state.done : elapsed <= 0;\n        }\n        onUpdate === null || onUpdate === void 0 ? void 0 : onUpdate(latest);\n        if (isComplete) {\n            if (repeatCount === 0) computedDuration !== null && computedDuration !== void 0 ? computedDuration : computedDuration = elapsed;\n            if (repeatCount < repeatMax) {\n                hasRepeatDelayElapsed(elapsed, computedDuration, repeatDelay, isForwardPlayback) && repeat();\n            } else {\n                complete();\n            }\n        }\n    }\n    function play() {\n        onPlay === null || onPlay === void 0 ? void 0 : onPlay();\n        driverControls = driver(update);\n        driverControls.start();\n    }\n    autoplay && play();\n    return {\n        stop: function () {\n            onStop === null || onStop === void 0 ? void 0 : onStop();\n            driverControls.stop();\n        }\n    };\n}\n\nfunction velocityPerSecond(velocity, frameDuration) {\n    return frameDuration ? velocity * (1000 / frameDuration) : 0;\n}\n\nfunction inertia(_a) {\n    var _b = _a.from,\n        from = _b === void 0 ? 0 : _b,\n        _c = _a.velocity,\n        velocity = _c === void 0 ? 0 : _c,\n        min = _a.min,\n        max = _a.max,\n        _d = _a.power,\n        power = _d === void 0 ? 0.8 : _d,\n        _e = _a.timeConstant,\n        timeConstant = _e === void 0 ? 750 : _e,\n        _f = _a.bounceStiffness,\n        bounceStiffness = _f === void 0 ? 500 : _f,\n        _g = _a.bounceDamping,\n        bounceDamping = _g === void 0 ? 10 : _g,\n        _h = _a.restDelta,\n        restDelta = _h === void 0 ? 1 : _h,\n        modifyTarget = _a.modifyTarget,\n        driver = _a.driver,\n        onUpdate = _a.onUpdate,\n        onComplete = _a.onComplete;\n    var currentAnimation;\n    function isOutOfBounds(v) {\n        return min !== undefined && v < min || max !== undefined && v > max;\n    }\n    function boundaryNearest(v) {\n        if (min === undefined) return max;\n        if (max === undefined) return min;\n        return Math.abs(min - v) < Math.abs(max - v) ? min : max;\n    }\n    function startAnimation(options) {\n        currentAnimation === null || currentAnimation === void 0 ? void 0 : currentAnimation.stop();\n        currentAnimation = animate(__assign(__assign({}, options), { driver: driver, onUpdate: function (v) {\n                var _a;\n                onUpdate === null || onUpdate === void 0 ? void 0 : onUpdate(v);\n                (_a = options.onUpdate) === null || _a === void 0 ? void 0 : _a.call(options, v);\n            }, onComplete: onComplete }));\n    }\n    function startSpring(options) {\n        startAnimation(__assign({ type: \"spring\", stiffness: bounceStiffness, damping: bounceDamping, restDelta: restDelta }, options));\n    }\n    if (isOutOfBounds(from)) {\n        startSpring({ from: from, velocity: velocity, to: boundaryNearest(from) });\n    } else {\n        var target = power * velocity + from;\n        if (typeof modifyTarget !== \"undefined\") target = modifyTarget(target);\n        var boundary_1 = boundaryNearest(target);\n        var heading_1 = boundary_1 === min ? -1 : 1;\n        var prev_1;\n        var current_1;\n        var checkBoundary = function (v) {\n            prev_1 = current_1;\n            current_1 = v;\n            velocity = velocityPerSecond(v - prev_1, getFrameData().delta);\n            if (heading_1 === 1 && v > boundary_1 || heading_1 === -1 && v < boundary_1) {\n                startSpring({ from: v, to: boundary_1, velocity: velocity });\n            }\n        };\n        startAnimation({\n            type: \"decay\",\n            from: from,\n            velocity: velocity,\n            timeConstant: timeConstant,\n            power: power,\n            restDelta: restDelta,\n            modifyTarget: modifyTarget,\n            onUpdate: isOutOfBounds(target) ? checkBoundary : undefined\n        });\n    }\n    return {\n        stop: function () {\n            return currentAnimation === null || currentAnimation === void 0 ? void 0 : currentAnimation.stop();\n        }\n    };\n}\n\nvar radiansToDegrees = function (radians) {\n    return radians * 180 / Math.PI;\n};\n\nvar angle = function (a, b) {\n    if (b === void 0) {\n        b = zeroPoint;\n    }\n    return radiansToDegrees(Math.atan2(b.y - a.y, b.x - a.x));\n};\n\nvar applyOffset = function (from, to) {\n    var hasReceivedFrom = true;\n    if (to === undefined) {\n        to = from;\n        hasReceivedFrom = false;\n    }\n    return function (v) {\n        if (hasReceivedFrom) {\n            return v - from + to;\n        } else {\n            from = v;\n            hasReceivedFrom = true;\n            return to;\n        }\n    };\n};\n\nvar identity = function (v) {\n    return v;\n};\nvar createAttractor = function (alterDisplacement) {\n    if (alterDisplacement === void 0) {\n        alterDisplacement = identity;\n    }\n    return function (constant, origin, v) {\n        var displacement = origin - v;\n        var springModifiedDisplacement = -(0 - constant + 1) * (0 - alterDisplacement(Math.abs(displacement)));\n        return displacement <= 0 ? origin + springModifiedDisplacement : origin - springModifiedDisplacement;\n    };\n};\nvar attract = /*#__PURE__*/createAttractor();\nvar attractExpo = /*#__PURE__*/createAttractor(Math.sqrt);\n\nvar degreesToRadians = function (degrees) {\n    return degrees * Math.PI / 180;\n};\n\nvar isPoint = function (point) {\n    return point.hasOwnProperty('x') && point.hasOwnProperty('y');\n};\n\nvar isPoint3D = function (point) {\n    return isPoint(point) && point.hasOwnProperty('z');\n};\n\nvar distance1D = function (a, b) {\n    return Math.abs(a - b);\n};\nfunction distance(a, b) {\n    if (isNum(a) && isNum(b)) {\n        return distance1D(a, b);\n    } else if (isPoint(a) && isPoint(b)) {\n        var xDelta = distance1D(a.x, b.x);\n        var yDelta = distance1D(a.y, b.y);\n        var zDelta = isPoint3D(a) && isPoint3D(b) ? distance1D(a.z, b.z) : 0;\n        return Math.sqrt(Math.pow(xDelta, 2) + Math.pow(yDelta, 2) + Math.pow(zDelta, 2));\n    }\n}\n\nvar pointFromVector = function (origin, angle, distance) {\n    angle = degreesToRadians(angle);\n    return {\n        x: distance * Math.cos(angle) + origin.x,\n        y: distance * Math.sin(angle) + origin.y\n    };\n};\n\nvar toDecimal = function (num, precision) {\n    if (precision === void 0) {\n        precision = 2;\n    }\n    precision = Math.pow(10, precision);\n    return Math.round(num * precision) / precision;\n};\n\nvar smoothFrame = function (prevValue, nextValue, duration, smoothing) {\n    if (smoothing === void 0) {\n        smoothing = 0;\n    }\n    return toDecimal(prevValue + duration * (nextValue - prevValue) / Math.max(smoothing, duration));\n};\n\nvar smooth = function (strength) {\n    if (strength === void 0) {\n        strength = 50;\n    }\n    var previousValue = 0;\n    var lastUpdated = 0;\n    return function (v) {\n        var currentFramestamp = getFrameData().timestamp;\n        var timeDelta = currentFramestamp !== lastUpdated ? currentFramestamp - lastUpdated : 0;\n        var newValue = timeDelta ? smoothFrame(previousValue, v, timeDelta, strength) : previousValue;\n        lastUpdated = currentFramestamp;\n        previousValue = newValue;\n        return newValue;\n    };\n};\n\nvar snap = function (points) {\n    if (typeof points === 'number') {\n        return function (v) {\n            return Math.round(v / points) * points;\n        };\n    } else {\n        var i_1 = 0;\n        var numPoints_1 = points.length;\n        return function (v) {\n            var lastDistance = Math.abs(points[0] - v);\n            for (i_1 = 1; i_1 < numPoints_1; i_1++) {\n                var point = points[i_1];\n                var distance = Math.abs(point - v);\n                if (distance === 0) return point;\n                if (distance > lastDistance) return points[i_1 - 1];\n                if (i_1 === numPoints_1 - 1) return point;\n                lastDistance = distance;\n            }\n        };\n    }\n};\n\nfunction velocityPerFrame(xps, frameDuration) {\n    return xps / (1000 / frameDuration);\n}\n\nvar wrap = function (min, max, v) {\n    var rangeSize = max - min;\n    return ((v - min) % rangeSize + rangeSize) % rangeSize + min;\n};\n\nvar a = function (a1, a2) {\n    return 1.0 - 3.0 * a2 + 3.0 * a1;\n};\nvar b = function (a1, a2) {\n    return 3.0 * a2 - 6.0 * a1;\n};\nvar c = function (a1) {\n    return 3.0 * a1;\n};\nvar calcBezier = function (t, a1, a2) {\n    return ((a(a1, a2) * t + b(a1, a2)) * t + c(a1)) * t;\n};\nvar getSlope = function (t, a1, a2) {\n    return 3.0 * a(a1, a2) * t * t + 2.0 * b(a1, a2) * t + c(a1);\n};\nvar subdivisionPrecision = 0.0000001;\nvar subdivisionMaxIterations = 10;\nfunction binarySubdivide(aX, aA, aB, mX1, mX2) {\n    var currentX;\n    var currentT;\n    var i = 0;\n    do {\n        currentT = aA + (aB - aA) / 2.0;\n        currentX = calcBezier(currentT, mX1, mX2) - aX;\n        if (currentX > 0.0) {\n            aB = currentT;\n        } else {\n            aA = currentT;\n        }\n    } while (Math.abs(currentX) > subdivisionPrecision && ++i < subdivisionMaxIterations);\n    return currentT;\n}\nvar newtonIterations = 8;\nvar newtonMinSlope = 0.001;\nfunction newtonRaphsonIterate(aX, aGuessT, mX1, mX2) {\n    for (var i = 0; i < newtonIterations; ++i) {\n        var currentSlope = getSlope(aGuessT, mX1, mX2);\n        if (currentSlope === 0.0) {\n            return aGuessT;\n        }\n        var currentX = calcBezier(aGuessT, mX1, mX2) - aX;\n        aGuessT -= currentX / currentSlope;\n    }\n    return aGuessT;\n}\nvar kSplineTableSize = 11;\nvar kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);\nfunction cubicBezier(mX1, mY1, mX2, mY2) {\n    if (mX1 === mY1 && mX2 === mY2) return linear;\n    var sampleValues = new Float32Array(kSplineTableSize);\n    for (var i = 0; i < kSplineTableSize; ++i) {\n        sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\n    }\n    function getTForX(aX) {\n        var intervalStart = 0.0;\n        var currentSample = 1;\n        var lastSample = kSplineTableSize - 1;\n        for (; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {\n            intervalStart += kSampleStepSize;\n        }\n        --currentSample;\n        var dist = (aX - sampleValues[currentSample]) / (sampleValues[currentSample + 1] - sampleValues[currentSample]);\n        var guessForT = intervalStart + dist * kSampleStepSize;\n        var initialSlope = getSlope(guessForT, mX1, mX2);\n        if (initialSlope >= newtonMinSlope) {\n            return newtonRaphsonIterate(aX, guessForT, mX1, mX2);\n        } else if (initialSlope === 0.0) {\n            return guessForT;\n        } else {\n            return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);\n        }\n    }\n    return function (t) {\n        return t === 0 || t === 1 ? t : calcBezier(getTForX(t), mY1, mY2);\n    };\n}\n\nvar steps = function (steps, direction) {\n    if (direction === void 0) {\n        direction = 'end';\n    }\n    return function (progress) {\n        progress = direction === 'end' ? Math.min(progress, 0.999) : Math.max(progress, 0.001);\n        var expanded = progress * steps;\n        var rounded = direction === 'end' ? Math.floor(expanded) : Math.ceil(expanded);\n        return clamp(0, 1, rounded / steps);\n    };\n};\n\nexport { angle, animate, anticipate, applyOffset, attract, attractExpo, backIn, backInOut, backOut, bounceIn, bounceInOut, bounceOut, circIn, circInOut, circOut, clamp, createAnticipate, createAttractor, createBackIn, createExpoIn, cubicBezier, decay, degreesToRadians, distance, easeIn, easeInOut, easeOut, inertia, interpolate, isPoint, isPoint3D, keyframes, linear, mirrorEasing, mix, mixColor, mixComplex, pipe, pointFromVector, progress, radiansToDegrees, reverseEasing, smooth, smoothFrame, snap, spring, steps, toDecimal, velocityPerFrame, velocityPerSecond, wrap };\n","import { gameData } from \"../GameManager\";\r\nimport { Particle, ParticleBreed } from \"../../engine/anims/Particle\";\r\nimport { SparseMap } from \"../../lib/sparseMap\";\r\n\r\nclass ParticleSystem {\r\n  id = 0;\r\n\r\n  startOfTurn: Particle<any>[] = [];\r\n  endOfTurn: Particle<any>[] = [];\r\n\r\n  constructor(private getData: () => SparseMap<Particle<any>>) {}\r\n  createParticle<T>(\r\n    breed: ParticleBreed<T>,\r\n    x: number,\r\n    y: number,\r\n    options?: T\r\n  ) {\r\n    const particles = this.getData();\r\n\r\n    const assigned = this.id;\r\n    const p = new Particle<T>(breed, assigned, x, y, options);\r\n    particles.add(assigned, p);\r\n    this.id += 1;\r\n    p.status.then(() => particles.remove(assigned));\r\n    return p;\r\n  }\r\n\r\n  async runThenDestroy<T>(\r\n    breed: ParticleBreed<T>,\r\n    x: number,\r\n    y: number,\r\n    options?: T\r\n  ) {\r\n    const p = this.createParticle(breed, x, y, options);\r\n    await p.status;\r\n  }\r\n\r\n  makeUntilEndOfTurn<T>(\r\n    breed: ParticleBreed<T>,\r\n    x: number,\r\n    y: number,\r\n    options?: T\r\n  ) {\r\n    const p = this.createParticle(breed, x, y, options);\r\n    this.endOfTurn.push(p);\r\n    return p;\r\n  }\r\n\r\n  makeUntilStartOfTurn<T>(\r\n    breed: ParticleBreed<T>,\r\n    x: number,\r\n    y: number,\r\n    options?: T\r\n  ) {\r\n    const p = this.createParticle(breed, x, y, options);\r\n    this.startOfTurn.push(p);\r\n    return p;\r\n  }\r\n\r\n  clearStartOfTurn() {\r\n    let p: Particle<any> | undefined;\r\n    // eslint-disable-next-line no-cond-assign\r\n    while ((p = this.startOfTurn.pop())) {\r\n      p.finish();\r\n    }\r\n  }\r\n\r\n  clearEndOfTurn() {\r\n    let p: Particle<any> | undefined;\r\n    // eslint-disable-next-line no-cond-assign\r\n    while ((p = this.endOfTurn.pop())) {\r\n      p.finish();\r\n    }\r\n  }\r\n}\r\n\r\nexport const ParticleManager = new ParticleSystem(() => gameData.particles);\r\nexport const GibManager = new ParticleSystem(() => gameData.gibs);\r\n","import {\r\n  awaitAnimate,\r\n  Particle,\r\n  ParticleModes,\r\n} from \"../../../engine/anims/Particle\";\r\n\r\nexport const HitParticle = {\r\n  mode: ParticleModes.DRAW_OVER_LAST,\r\n  char: null,\r\n  fg: null,\r\n  bg: \"rgba(255, 100, 200, 0.75)\",\r\n  animate: async (particle: Particle<void>) => {\r\n    await awaitAnimate({\r\n      driver: particle.driver,\r\n      from: \"rgba(255, 100, 200, 0.75)\",\r\n      to: \"rgba(255, 100, 200, 0.25)\",\r\n      duration: 100,\r\n      onUpdate: (latest) => {\r\n        particle.bg = latest;\r\n      },\r\n    });\r\n\r\n    await awaitAnimate({\r\n      driver: particle.driver,\r\n      from: \"rgba(255, 100, 200, 0.25)\",\r\n      to: \"rgba(255, 100, 200, 0.75)\",\r\n      duration: 100,\r\n      onUpdate: (latest) => {\r\n        particle.bg = latest;\r\n      },\r\n    });\r\n    await awaitAnimate({\r\n      driver: particle.driver,\r\n      from: \"rgba(255, 100, 200, 0.75)\",\r\n      to: \"rgba(255, 100, 200, 0.25)\",\r\n      duration: 100,\r\n      onUpdate: (latest) => {\r\n        particle.bg = latest;\r\n      },\r\n    });\r\n  },\r\n};\r\n","import { Breed } from \"./Breed\";\r\n\r\nexport class Entity<T extends Breed> {\r\n  constructor(\r\n    public id: number,\r\n    public breed: T,\r\n    public x: number = 0,\r\n    public y: number = 0\r\n  ) {}\r\n}\r\n","export class Breed {\r\n  fg: string | null = null;\r\n  bg: string | null = null;\r\n  ch: string | null = null;\r\n  name = \"\";\r\n  info = \"\";\r\n  description = \"\";\r\n  logName = \"\";\r\n  displayPriority = 1;\r\n\r\n  constructor(public key: string, breedData: any) {\r\n    Object.assign(this, breedData.glyph, breedData.text);\r\n    this.displayPriority = breedData.displayPriority || 1;\r\n  }\r\n}\r\n","import { Entity } from \"../../engine/entity/Entity\";\r\n\r\nimport { Breed } from \"../../engine/entity/Breed\";\r\nimport { ActionController } from \"./controllers/genericController\";\r\nimport { Attack, Item } from \"../items/Item\";\r\nimport { SparseMap } from \"../../lib/sparseMap\";\r\nimport { Particle } from \"../../engine/anims/Particle\";\r\n\r\nexport enum Encumbrance {\r\n  LIGHT,\r\n  MEDIUM,\r\n  HEAVY,\r\n}\r\nexport class Stat {\r\n  emptyTriggered = false;\r\n  current = 0;\r\n  constructor(\r\n    public max: number,\r\n    private trigger?: null | (() => void),\r\n    startFull?: boolean\r\n  ) {\r\n    if (startFull) {\r\n      this.current = max;\r\n    }\r\n  }\r\n\r\n  change(value: number) {\r\n    if (0 < value) {\r\n      this.emptyTriggered = false;\r\n      this.current = Math.min(this.max, this.current + value);\r\n    } else {\r\n      this.current = Math.max(0, this.current + value);\r\n    }\r\n    if (!this.current && this.trigger && !this.emptyTriggered) {\r\n      this.emptyTriggered = true;\r\n      this.trigger();\r\n    }\r\n  }\r\n\r\n  adjustMax(value: number, fill?: boolean) {\r\n    this.max = Math.max(0, this.max + value);\r\n    if (!fill) {\r\n      this.current = Math.min(this.max, this.current);\r\n    } else {\r\n      this.emptyTriggered = false;\r\n      this.change(value);\r\n    }\r\n  }\r\n\r\n  fill() {\r\n    this.emptyTriggered = false;\r\n    this.current = this.max;\r\n  }\r\n}\r\n\r\nconst EMPTY_BASE_STATS = {\r\n  level: 0,\r\n  health: 0,\r\n  stamina: 0,\r\n  poise: 0,\r\n  armor: 0,\r\n  weight: 0,\r\n  strength: 0,\r\n  force: 0,\r\n};\r\n\r\nexport enum WieldMode {\r\n  oneHanded,\r\n  twoHanded,\r\n}\r\n\r\nconst defaultAttack: Attack = {\r\n  damage: 1,\r\n  poise: 5,\r\n  stamina: 20,\r\n};\r\n\r\nexport class ActorBreed extends Breed {\r\n  baseStats = EMPTY_BASE_STATS;\r\n  statTriggers = {};\r\n  defaultWielding: { left?: string; right?: string; mode?: WieldMode } = {};\r\n  defaultWearing: { armor?: string } = {};\r\n  defaultContains: [string, number][] = [];\r\n  baseAttack: Attack;\r\n  controller: ActionController | null = null;\r\n\r\n  constructor(key: string, breedData: any) {\r\n    super(key, breedData);\r\n    this.controller = breedData.actionController;\r\n    this.baseStats = breedData.baseStats || EMPTY_BASE_STATS;\r\n    this.statTriggers = breedData.triggers || {};\r\n    this.defaultWielding = breedData.wielding;\r\n    this.defaultWearing = breedData.wearing;\r\n    this.defaultContains = breedData.contains;\r\n    this.baseAttack = breedData.baseAttack || defaultAttack;\r\n  }\r\n}\r\n\r\nexport enum Hands {\r\n  LEFT,\r\n  RIGHT,\r\n}\r\n\r\nexport class Actor extends Entity<ActorBreed> {\r\n  alive = true;\r\n  level: number;\r\n  health: Stat;\r\n  stamina: Stat;\r\n  poise: Stat;\r\n  wielding: {\r\n    left?: Item | null;\r\n    right?: Item | null;\r\n    mode: WieldMode;\r\n    activeHand: Hands;\r\n  } = { mode: WieldMode.oneHanded, activeHand: Hands.LEFT };\r\n  wearing: { armor?: Item | null } = {};\r\n  contains: SparseMap<Item> = new SparseMap();\r\n  attributes: {\r\n    force: number;\r\n    strength: number;\r\n    weight: number;\r\n    armor: number;\r\n  };\r\n  status: {\r\n    waited?: boolean;\r\n    moved?: boolean;\r\n    hit?: boolean;\r\n    staggered?: boolean;\r\n    staggeredCount?: number;\r\n    blocking?: boolean;\r\n    replanned?: boolean;\r\n    sprinted?: boolean;\r\n  } = {};\r\n  ownedParticles: Map<number, Particle<any>> = new Map();\r\n\r\n  controllerProps: any;\r\n  seenPlayer = 0; //Turns since last seen player\r\n\r\n  constructor(id: number, breed: ActorBreed, x: number, y: number) {\r\n    super(id, breed, x, y);\r\n    this.level = breed.baseStats.level;\r\n    this.health = new Stat(\r\n      breed.baseStats.health,\r\n      breed.statTriggers.health && breed.statTriggers.health.bind(null, this),\r\n      true\r\n    );\r\n    this.stamina = new Stat(\r\n      breed.baseStats.stamina,\r\n      breed.statTriggers.stamina && breed.statTriggers.stamina.bind(null, this),\r\n      true\r\n    );\r\n    this.poise = new Stat(\r\n      breed.baseStats.poise,\r\n      breed.statTriggers.poise && breed.statTriggers.poise.bind(null, this),\r\n      true\r\n    );\r\n\r\n    this.attributes = {\r\n      force: breed.baseStats.force,\r\n      strength: breed.baseStats.strength,\r\n      weight: breed.baseStats.weight,\r\n      armor: breed.baseStats.armor,\r\n    };\r\n  }\r\n  plan() {\r\n    return this.breed.controller && this.breed.controller(this);\r\n  }\r\n\r\n  end() {\r\n    this.alive = false;\r\n    this.ownedParticles.forEach((p) => p.finish());\r\n  }\r\n\r\n  async addParticle(p: Particle<any>) {\r\n    this.ownedParticles.set(p.id, p);\r\n    await p.status;\r\n    this.ownedParticles.delete(p.id);\r\n  }\r\n}\r\n","export class SparseMap<R> {\r\n  public size = 0;\r\n  private keys: Map<number, number> = new Map();\r\n  private data: Array<R> = [];\r\n  private idRef: Array<number> = [];\r\n\r\n  clear() {\r\n    this.size = 0;\r\n    this.keys.clear();\r\n    this.data = [];\r\n    this.idRef = [];\r\n  }\r\n\r\n  add(key: number, value: R) {\r\n    this.size += 1;\r\n    this.keys.set(key, this.data.push(value) - 1);\r\n    this.idRef.push(key);\r\n  }\r\n\r\n  remove(key: number) {\r\n    this.size -= 1;\r\n    const idx = this.keys.get(key);\r\n    if (idx != null) {\r\n      const removed = this.data[idx];\r\n      this.keys.delete(key);\r\n      const lastIdx = this.data.length - 1;\r\n      if (idx === lastIdx) {\r\n        this.data.pop();\r\n        this.idRef.pop();\r\n      } else {\r\n        const last = this.data.pop()!;\r\n        const lastId = this.idRef.pop()!;\r\n        this.data[idx] = last;\r\n        this.idRef[idx] = lastId;\r\n        this.keys.set(lastId, idx);\r\n      }\r\n      return removed;\r\n    }\r\n  }\r\n\r\n  get(key: number) {\r\n    const idx = this.keys.get(key);\r\n    if (idx == null) {\r\n      console.warn(`Entity ${key} not found!`);\r\n      return;\r\n    }\r\n    return this.data[idx];\r\n  }\r\n\r\n  forEach(callback: (value: R, index: number, array: R[]) => void) {\r\n    this.data.forEach(callback);\r\n  }\r\n\r\n  map<M>(callback: (value: R, index: number, array: R[]) => M) {\r\n    this.data.map<M>(callback);\r\n  }\r\n\r\n  filter(callback: (value: R, index: number, array: R[]) => boolean) {\r\n    return this.data.filter(callback);\r\n  }\r\n\r\n  find(callback: (value: R, index: number, array: R[]) => boolean) {\r\n    return this.data.find(callback);\r\n  }\r\n}\r\n","import { ActionSpeed } from \"../actions/Action\";\r\nimport { Actor, Encumbrance } from \"../actors/Actor\";\r\nimport { Attack } from \"./Item\";\r\n\r\nexport const damageWithForce = (baseDamage: number, force: number) => {\r\n  return (baseDamage + 2 * force) * (1 + 0.05 * force);\r\n};\r\n\r\nexport const getDamageReduction = (armor: number) => {\r\n  return 1 - (0.05 * armor) / (1 + 0.05 * Math.abs(armor));\r\n};\r\n\r\nexport const getEquipmentWeight = (actor: Actor) => {\r\n  return (\r\n    (actor.wielding.left?.breed.stats.weight || 0) +\r\n    (actor.wielding.right?.breed.stats.weight || 0) +\r\n    (actor.wearing.armor?.breed.stats.weight || 0)\r\n  );\r\n};\r\n\r\nexport const getActorArmor = (actor: Actor) => {\r\n  return (\r\n    (actor.attributes.armor || 0) +\r\n    (actor.wielding.left?.breed.stats.armor || 0) +\r\n    (actor.wielding.right?.breed.stats.armor || 0) +\r\n    (actor.wearing.armor?.breed.stats.armor || 0)\r\n  );\r\n};\r\n\r\nexport const getActorWeight = (actor: Actor) => {\r\n  return (\r\n    (actor.wielding.left?.breed.stats.weight || 0) +\r\n    (actor.wielding.right?.breed.stats.weight || 0) +\r\n    (actor.wearing.armor?.breed.stats.weight || 0)\r\n  );\r\n};\r\n\r\nexport const getWeightLoad = (weight: number, max: number) => {\r\n  return Math.floor((100 * weight) / max);\r\n};\r\n\r\nexport const getWeightLevel = (weight: number, max: number) => {\r\n  const pct = getWeightLoad(weight, max);\r\n  if (pct <= 25) {\r\n    return Encumbrance.LIGHT;\r\n  } else if (pct <= 75) {\r\n    return Encumbrance.MEDIUM;\r\n  }\r\n  return Encumbrance.HEAVY;\r\n};\r\n\r\nexport const weightToActionSpeed = (weightLevel: Encumbrance) => {\r\n  switch (weightLevel) {\r\n    case Encumbrance.LIGHT:\r\n      return ActionSpeed.FAST;\r\n    case Encumbrance.MEDIUM:\r\n      return ActionSpeed.MEDIUM;\r\n    case Encumbrance.HEAVY:\r\n      return ActionSpeed.SLOW;\r\n  }\r\n};\r\n\r\nexport const reduceDamage = (damage: number, reduction: number) => {\r\n  return Math.max(Math.round(damage * reduction), 1);\r\n};\r\n\r\nexport const hasStrength = (a: Actor, attack: Attack) => {\r\n  return (attack.strength || 0) <= a.attributes.strength;\r\n};\r\n","import { log } from \"../../engine/logger/logger\";\r\nimport { Actor } from \"../actors/Actor\";\r\nimport Colors from \"../Colors\";\r\nimport { gameData } from \"../GameManager\";\r\n\r\nexport const attackMsg = (actor: Actor, target: Actor, damage: number) => {\r\n  log(\r\n    actor === gameData.player\r\n      ? `%c{${Colors.B_GREY_4}}${actor.breed.logName} hit ${target.breed.logName} for %c{${Colors.RED_4}}${damage}`\r\n      : `%c{${Colors.B_GREY_4}}${actor.breed.logName} hits ${target.breed.logName} for %c{${Colors.RED_4}}${damage}`\r\n  );\r\n};\r\n\r\nexport const staggeredMsg = (actor: Actor) => {\r\n  log(\r\n    actor === gameData.player\r\n      ? `${actor.breed.logName} are %c{${Colors.BLUE_1}}staggered%c{} and unable to react.`\r\n      : `${actor.breed.logName} is %c{${Colors.BLUE_1}}staggered%c{} and unable to react.`\r\n  );\r\n};\r\n\r\nexport const diedMsg = (actor: Actor) => {\r\n  log(\r\n    actor === gameData.player\r\n      ? `${actor.breed.logName} have fallen in battle.`\r\n      : `%c{${Colors.B_GREY_4}}${actor.breed.logName} has fallen in battle.`\r\n  );\r\n};\r\n\r\nexport const blockMsg = (actor: Actor, target: Actor, damage: number) => {\r\n  log(\r\n    target === gameData.player\r\n      ? `${target.breed.logName} take %c{${Colors.RED_4}}${damage}%c{} damage blocking ${actor.breed.logName}'s attack.`\r\n      : `${target.breed.logName} takes %c{${Colors.RED_4}}${damage}%c{} damage blocking your attack.`\r\n  );\r\n};\r\n\r\nexport const blockFailMsg = (actor: Actor) => {\r\n  log(\r\n    actor === gameData.player\r\n      ? `The mighty blow is too much for you to block.`\r\n      : `The might blow is too much for ${actor.breed.logName} to block`\r\n  );\r\n};\r\n\r\nexport const blockSuccMsg = (actor: Actor) => {\r\n  log(\r\n    actor === gameData.player\r\n      ? `${actor.breed.logName} recoil from being blocked.`\r\n      : `${actor.breed.logName} recoils from being blocked.`\r\n  );\r\n};\r\n","import { Actor, Hands, WieldMode } from \"./Actor\";\r\n\r\nexport const getActiveAttack = (actor: Actor) => {\r\n  if (actor.wielding.mode === WieldMode.twoHanded) {\r\n    return (\r\n      actor.wielding.left?.breed.attacks?.twohanded ||\r\n      actor.wielding.right?.breed.attacks?.twohanded ||\r\n      actor.breed.baseAttack\r\n    );\r\n  } else if (actor.wielding.activeHand === Hands.LEFT) {\r\n    const left = actor.wielding.left;\r\n    return left?.breed.attacks?.onehanded || actor.breed.baseAttack;\r\n  } else {\r\n    const right = actor.wielding.right;\r\n    return right?.breed.attacks?.onehanded || actor.breed.baseAttack;\r\n  }\r\n};\r\n","import { CheckMovement } from \"../map/Movement\";\r\nimport { Point } from \"../../engine/space/bounds\";\r\nimport { Directions, getDirectionTowards } from \"../../engine/space/directions\";\r\nimport { Actor } from \"../actors/Actor\";\r\nimport { findActorForPosition, gameData } from \"../GameManager\";\r\nimport { GibManager } from \"../anims/particleSystem\";\r\nimport { HitParticle } from \"../anims/particles/HitParticle\";\r\nimport {\r\n  damageWithForce,\r\n  getActorArmor,\r\n  getDamageReduction,\r\n  reduceDamage,\r\n} from \"../items/formulas\";\r\nimport {\r\n  attackMsg,\r\n  blockFailMsg,\r\n  blockMsg,\r\n  blockSuccMsg,\r\n} from \"../messages/AttackMessages\";\r\nimport { getActiveAttack } from \"../actors/weaponHelper\";\r\n\r\nexport const attackTo = (actor: Actor, options: { target: Point }) => {\r\n  const dir = getDirectionTowards(actor, options.target);\r\n  return attackTowards(actor, { dir });\r\n};\r\n\r\nexport const attackTowards = async (\r\n  actor: Actor,\r\n  options: { dir: Directions }\r\n) => {\r\n  const tile =\r\n    gameData.current.tiles[actor.x + actor.y * gameData.current.width];\r\n  let x = actor.x;\r\n  let y = actor.y;\r\n  if (!CheckMovement[options.dir](tile)) {\r\n    return { valid: false };\r\n  }\r\n  switch (options.dir) {\r\n    case Directions.Up:\r\n      y -= 1;\r\n      break;\r\n    case Directions.Right:\r\n      x += 1;\r\n      break;\r\n    case Directions.Down:\r\n      y += 1;\r\n      break;\r\n    case Directions.Left:\r\n      x -= 1;\r\n      break;\r\n  }\r\n  const target = findActorForPosition(x, y);\r\n  if (target) {\r\n    const attack = getActiveAttack(actor);\r\n\r\n    await GibManager.runThenDestroy(HitParticle, x, y);\r\n    const dmgReduction = getDamageReduction(getActorArmor(target));\r\n    const rawDamage = damageWithForce(\r\n      attack.damage || 1,\r\n      actor.attributes.force || 0\r\n    );\r\n    if (target.status.blocking) {\r\n      const shieldAttack = getActiveAttack(target);\r\n      if (shieldAttack && shieldAttack.blocks) {\r\n        const postShieldDamage = reduceDamage(\r\n          rawDamage,\r\n          1 - shieldAttack.blocks\r\n        );\r\n        const rawStaminaDamage = attack.stamina || 0;\r\n        const staminaDamage = reduceDamage(\r\n          rawStaminaDamage,\r\n          1 - (shieldAttack.stability || 0) / 100\r\n        );\r\n        const tCurStamina = actor.stamina.current;\r\n        const oSpillover = staminaDamage - tCurStamina;\r\n        const dSpillover =\r\n          2 * (shieldAttack.stability || 0) - (rawDamage + rawStaminaDamage);\r\n\r\n        const attackDamage = reduceDamage(postShieldDamage, dmgReduction);\r\n        blockMsg(actor, target, attackDamage);\r\n        //If not enough sta to cover, take remainder as poise damage + attack poise damage\r\n        if (0 < oSpillover) {\r\n          target.poise.change(-1 * (oSpillover + (attack.poise || 0)));\r\n          blockFailMsg(target);\r\n          //If shield can cover, deal poise damage back to target\r\n        } else if (0 < dSpillover) {\r\n          blockSuccMsg(actor);\r\n          actor.poise.change(-1 * dSpillover);\r\n          actor.status.hit = true;\r\n        }\r\n        target.stamina.change(-1 * staminaDamage);\r\n        target.health.change(-1 * attackDamage);\r\n      } else {\r\n        console.warn(\"blocked attack without a blocking attack.\");\r\n      }\r\n    } else {\r\n      const attackDamage = reduceDamage(rawDamage, dmgReduction);\r\n      target.health.change(-1 * attackDamage);\r\n      target.poise.change(-1 * (attack.poise || 0));\r\n      attackMsg(actor, target, attackDamage);\r\n    }\r\n    actor.stamina.change(-1 * attack.stamina);\r\n    target.status.hit = true;\r\n    return { valid: true };\r\n  }\r\n\r\n  return { valid: true };\r\n};\r\n\r\nexport const blockAttacks = (actor: Actor) => {\r\n  actor.status.blocking = true;\r\n  return { valid: true };\r\n};\r\n","import {\r\n  awaitAnimate,\r\n  Particle,\r\n  ParticleModes,\r\n} from \"../../../engine/anims/Particle\";\r\nimport Colors from \"../../Colors\";\r\n\r\nconst FULL_OPAC = Colors.B_GREY_4;\r\nconst NO_OPAC = Colors.B_GREY_2;\r\nexport const FootstepParticle = {\r\n  mode: ParticleModes.DRAW_APPEND,\r\n  char: \".\",\r\n  fg: FULL_OPAC,\r\n  bg: \"transparent\",\r\n  animate: async (particle: Particle<void>) => {\r\n    await awaitAnimate({\r\n      driver: particle.driver,\r\n      from: FULL_OPAC,\r\n      to: NO_OPAC,\r\n      duration: 300,\r\n      onUpdate: (latest) => {\r\n        particle.fg = latest;\r\n      },\r\n    });\r\n  },\r\n};\r\n","import { Breed } from \"../../engine/entity/Breed\";\r\nimport { Entity } from \"../../engine/entity/Entity\";\r\nimport { Actor, Stat } from \"../actors/Actor\";\r\n\r\nexport type Attack = {\r\n  stamina: number;\r\n  poise?: number;\r\n  damage?: number;\r\n  blocks?: number;\r\n  stability?: number;\r\n  strength?: number;\r\n};\r\n\r\nexport class ItemBreed extends Breed {\r\n  mandatory = false;\r\n  furniture = false;\r\n  stackLimit = 1;\r\n  stats: any | null;\r\n  wearable?: string;\r\n  usable?: any;\r\n  interact?: (actor: Actor) => Promise<void> | void;\r\n  attacks?: { onehanded: Attack; twohanded: Attack };\r\n\r\n  constructor(key: string, breedData: any) {\r\n    super(key, breedData);\r\n    this.stats = breedData.stats;\r\n    this.wearable = breedData.wearable;\r\n    this.furniture = breedData.furniture;\r\n    this.mandatory = breedData.mandatory;\r\n    this.usable = breedData.usable;\r\n    this.interact = breedData.interact;\r\n    this.attacks = breedData.attacks;\r\n  }\r\n}\r\n\r\nexport const BASIC_STATS = [\"health\", \"stamina\", \"poise\"] as const;\r\n\r\nexport class Item extends Entity<ItemBreed> {\r\n  everHeld = false; //If item was ever held for loot spawn purposes\r\n  uses: Stat | null = null;\r\n  constructor(id: number, breed: ItemBreed, x?: number, y?: number) {\r\n    super(id, breed, x, y);\r\n    if (breed.usable) {\r\n      this.uses = new Stat(breed.usable.uses, null, true);\r\n    }\r\n  }\r\n\r\n  useItem(actor: Actor) {\r\n    if (this.uses) {\r\n      this.uses.change(-1);\r\n      const usable = this.breed.usable;\r\n      if (usable) {\r\n        if (usable.consumeOnEmpty && this.uses.current <= 0) {\r\n          actor.contains.remove(this.id);\r\n        }\r\n        if (usable.stats.health) {\r\n          actor.health.change(usable.stats.health);\r\n        }\r\n        if (usable.stats.stamina) {\r\n          actor.health.change(usable.stats.stamina);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  async interact(actor: Actor) {\r\n    if (this.breed.interact) {\r\n      await this.breed.interact(actor);\r\n    }\r\n  }\r\n\r\n  applyStats(actor: Actor, fill?: boolean) {\r\n    if (!this.breed.stats) {\r\n      return;\r\n    }\r\n\r\n    BASIC_STATS.forEach((s) => {\r\n      this.breed.stats[s] != null &&\r\n        actor[s].adjustMax(this.breed.stats[s], fill);\r\n    });\r\n  }\r\n\r\n  removeStats(actor: Actor) {\r\n    if (!this.breed.stats) {\r\n      return;\r\n    }\r\n\r\n    BASIC_STATS.forEach((s) => {\r\n      this.breed.stats[s] != null &&\r\n        actor[s].adjustMax(-1 * this.breed.stats[s]);\r\n    });\r\n  }\r\n}\r\n","import Colors from \"../Colors\";\r\n\r\nconst baseArmor = {\r\n  glyph: {\r\n    fg: Colors.B_GREY_4,\r\n    ch: \"&\",\r\n  },\r\n};\r\n\r\nexport const armors = {\r\n  frock: {\r\n    ...baseArmor,\r\n    text: {\r\n      name: \"An Unadorned Frock\",\r\n      info: \"A light robe, provides minimal poise\",\r\n      description:\r\n        \"These unassuming frocks are worn the world over. The monks of the floating abbey first popularized their use.\",\r\n      logName: \"Frock\",\r\n    },\r\n    wearable: \"armor\",\r\n    stats: {\r\n      weight: 2,\r\n      armor: 0,\r\n      poise: 20,\r\n    },\r\n  },\r\n  tunic: {\r\n    ...baseArmor,\r\n    text: {\r\n      name: \"A Threadbare Tunic\",\r\n      info: \"Light and easy to wear\",\r\n      description: \"A well worn garment made of cloth and linen.\",\r\n      logName: \"Tunic\",\r\n    },\r\n    wearable: \"armor\",\r\n    stats: {\r\n      weight: 6,\r\n      armor: 5,\r\n      poise: 20,\r\n    },\r\n  },\r\n  bCoat: {\r\n    ...baseArmor,\r\n    text: {\r\n      name: \"Buff Coat\",\r\n      logName: \"Coat\",\r\n      info: \"Solid protection from attacks without much weight.\",\r\n      description:\r\n        \"The war for which this was made is long forgotten. Features an emblem of a divine horse over trampled men.\",\r\n    },\r\n    wearable: \"armor\",\r\n    stats: {\r\n      weight: 8,\r\n      armor: 8,\r\n      poise: 40,\r\n    },\r\n  },\r\n  gambeson: {\r\n    ...baseArmor,\r\n    text: {\r\n      name: \"Gambeson\",\r\n      logName: \"Gambeson\",\r\n      info: \"Strong protection without inhibiting movement\",\r\n      description:\r\n        \"Deemed contraband by the church, this armor has been passed down through generations.\",\r\n    },\r\n    wearable: \"armor\",\r\n    stats: {\r\n      weight: 10,\r\n      armor: 15,\r\n      poise: 60,\r\n    },\r\n  },\r\n  curiass: {\r\n    ...baseArmor,\r\n    text: {\r\n      name: \"Linen Curiass\",\r\n      logName: \"Cuirass\",\r\n      info: \"Its heft offers good protection.\",\r\n      description:\r\n        \"Strongly woven linen, but still breathable. A rare relic of the Long Wars.\",\r\n    },\r\n    wearable: \"armor\",\r\n    stats: {\r\n      weight: 15,\r\n      armor: 20,\r\n      poise: 80,\r\n    },\r\n  },\r\n  bouilli: {\r\n    ...baseArmor,\r\n    text: {\r\n      name: \"Cuir bouilli\",\r\n      logName: \"Cuir bouilli\",\r\n      info: \"Heavy and bulky, but can stop even a dedicated blow.\",\r\n      description:\r\n        \"Layers of glue and boiled leather hastily assembled into an armor. Worn often by those wishing to challenge the church's armaments\",\r\n    },\r\n    wearable: \"armor\",\r\n    stats: {\r\n      weight: 30,\r\n      armor: 40,\r\n      poise: 120,\r\n    },\r\n  },\r\n};\r\n","import Colors from \"../Colors\";\r\n\r\nexport const consumables = {\r\n  flask: {\r\n    glyph: {\r\n      fg: Colors.RED_4,\r\n      ch: \"X\",\r\n    },\r\n    text: {\r\n      name: \"Flask of Restoration\",\r\n      info:\r\n        \"Heals %c{#FF0000} 40%c{} health. Restore uses by resting (%c{#e0c270}z%c{}) at a shrine (%c{#e0c270}_%c{})\",\r\n      description:\r\n        \"A drink to sooth your wounds and forget the world for a moment. Just don't forget too long or you may never remember\",\r\n      logName: \"flask\",\r\n    },\r\n    mandatory: true,\r\n    usable: {\r\n      uses: 5,\r\n      consumeOnEmpty: false,\r\n      fillOnRest: true,\r\n      stats: {\r\n        health: 40,\r\n      },\r\n    },\r\n  },\r\n} as const;\r\n","import {\r\n  awaitAnimate,\r\n  Particle,\r\n  ParticleModes,\r\n} from \"../../../engine/anims/Particle\";\r\n\r\nexport const FontParticle = {\r\n  mode: ParticleModes.DRAW_OVER_LAST,\r\n  char: null,\r\n  fg: null,\r\n  bg: \"rgba(100, 100, 200, 0.25)\",\r\n  animate: async (particle: Particle<void>) => {\r\n    await awaitAnimate({\r\n      driver: particle.driver,\r\n      from: \"rgba(100, 100, 200, 0.75)\",\r\n      to: \"rgba(100, 100, 200, 0.25)\",\r\n      duration: 200,\r\n      onUpdate: (latest) => {\r\n        particle.bg = latest;\r\n      },\r\n    });\r\n\r\n    await awaitAnimate({\r\n      driver: particle.driver,\r\n      from: \"rgba(255, 100, 200, 0.25)\",\r\n      to: \"rgba(255, 255, 255, 0.75)\",\r\n      duration: 200,\r\n      onUpdate: (latest) => {\r\n        particle.bg = latest;\r\n      },\r\n    });\r\n    await awaitAnimate({\r\n      driver: particle.driver,\r\n      from: \"rgba(255, 255, 255, 0.75)\",\r\n      to: \"rgba(255, 100, 200, 0.25)\",\r\n      duration: 200,\r\n      onUpdate: (latest) => {\r\n        particle.bg = latest;\r\n      },\r\n    });\r\n  },\r\n};\r\n","import { openModal } from \"../../ui/containers/Modal\";\r\nimport { createElement } from \"../../ui/ui\";\r\nimport { Actor } from \"../actors/Actor\";\r\nimport { FontParticle } from \"../anims/particles/FontParticle\";\r\nimport { ParticleManager } from \"../anims/particleSystem\";\r\nimport Colors from \"../Colors\";\r\nimport { gameData } from \"../GameManager\";\r\nimport { generateMap } from \"../map/generation\";\r\nimport { ShrineMap } from \"../map/ShrineMap\";\r\nimport { VictoryModal } from \"../ui/endConds/victory\";\r\n\r\nconst MAP_DEPTH_SIZES = [0, 25, 33, 33, 33, 25]; //0 & 1 depths aren't used\r\n\r\nconst fontRest = async (actor: Actor, newLevel = false) => {\r\n  actor.health.fill();\r\n  actor.stamina.fill();\r\n  actor.poise.fill();\r\n  actor.contains.forEach((i) => {\r\n    if (i.uses && i.breed.usable && i.breed.usable.fillOnRest) {\r\n      i.uses.fill();\r\n    }\r\n  });\r\n  if (actor === gameData.player) {\r\n    await ParticleManager.runThenDestroy(FontParticle, actor.x, actor.y);\r\n    gameData.items.clear();\r\n    gameData.actors.clear();\r\n    gameData.gibs.clear();\r\n    gameData.particles.clear();\r\n    gameData.actors.add(gameData.player.id, gameData.player);\r\n    if (newLevel) {\r\n      gameData.current = new ShrineMap(\r\n        MAP_DEPTH_SIZES[gameData.current.depth + 1],\r\n        MAP_DEPTH_SIZES[gameData.current.depth + 1],\r\n        gameData.seedRng.getGenerator(),\r\n        gameData.current.depth + 1\r\n      );\r\n    }\r\n    generateMap(\r\n      gameData.current.rng.getRNG(),\r\n      gameData.current,\r\n      gameData.player\r\n    );\r\n  }\r\n};\r\n\r\nexport const furniture = {\r\n  oldFont: {\r\n    displayPriority: 15,\r\n    glyph: {\r\n      fg: Colors.RED_4,\r\n      ch: \"_\",\r\n    },\r\n    text: {\r\n      name: \"A tended shrine\",\r\n      info:\r\n        \"Interact with the shrine to rest, restoring your health and flask.\",\r\n      description:\r\n        \"Among the shifting planes those that came before have built shrines dedicated to their cause. This one has been visited recently.\",\r\n      logName: \"font\",\r\n    },\r\n    furniture: true,\r\n    interact: async (actor: Actor) => {\r\n      await fontRest(actor);\r\n    },\r\n  },\r\n  newFont: {\r\n    displayPriority: 15,\r\n    glyph: {\r\n      fg: Colors.RED_4,\r\n      ch: \"_\",\r\n    },\r\n    text: {\r\n      name: \"A neglected shrine\",\r\n      info: \"Interact with the shrine to rest and journey onwards.\",\r\n      description:\r\n        \"Among the shifting planes those that came before have built shrines dedicated to their cause. You are the first one to find this shrine in a long time.\",\r\n      logName: \"shrine\",\r\n    },\r\n    furniture: true,\r\n    interact: async (actor: Actor) => {\r\n      if (gameData.current.depth === 5) {\r\n        openModal(createElement(VictoryModal, { x: 0, y: 0, w: 32, h: 32 }));\r\n      } else {\r\n        await fontRest(actor, true);\r\n      }\r\n    },\r\n  },\r\n} as const;\r\n","import {\r\n  awaitAnimate,\r\n  Particle,\r\n  ParticleModes,\r\n} from \"../../../engine/anims/Particle\";\r\n\r\nconst HIGHLIGHT_COLOR = \"rgba(100, 100, 255, 1.0)\";\r\nexport const StaggeredParticle = {\r\n  mode: ParticleModes.DRAW_OVER_LAST,\r\n  char: null,\r\n  fg: HIGHLIGHT_COLOR,\r\n  bg: null,\r\n  animate: async (particle: Particle<string | null>) => {\r\n    const baseColor = particle.options || \"rgba(100, 100, 100, 1.0)\";\r\n    // eslint-disable-next-line no-constant-condition\r\n    while (true) {\r\n      await awaitAnimate({\r\n        driver: particle.driver,\r\n        from: baseColor,\r\n        to: HIGHLIGHT_COLOR,\r\n        duration: 1000,\r\n        onUpdate: (latest) => {\r\n          particle.fg = latest;\r\n        },\r\n      });\r\n\r\n      await awaitAnimate({\r\n        driver: particle.driver,\r\n        from: HIGHLIGHT_COLOR,\r\n        to: baseColor,\r\n        duration: 1000,\r\n        onUpdate: (latest) => {\r\n          particle.fg = latest;\r\n        },\r\n      });\r\n    }\r\n  },\r\n};\r\n","import { log } from \"../../engine/logger/logger\";\r\nimport { openModal } from \"../../ui/containers/Modal\";\r\nimport { createElement } from \"../../ui/ui\";\r\nimport { StaggeredParticle } from \"../anims/particles/StaggeredParticle\";\r\nimport { ParticleManager } from \"../anims/particleSystem\";\r\nimport Colors from \"../Colors\";\r\nimport { gameData } from \"../GameManager\";\r\nimport { diedMsg, staggeredMsg } from \"../messages/AttackMessages\";\r\nimport { DeathModal } from \"../ui/endConds/death\";\r\nimport { Actor, ActorBreed, WieldMode } from \"./Actor\";\r\nimport {\r\n  genericController,\r\n  surroundController,\r\n} from \"./controllers/genericController\";\r\nimport { canXPOnFloor, hasLevelUp, XPForDepth } from \"./xpLevels\";\r\n\r\nconst standardTriggers = {\r\n  health: (actor: Actor) => {\r\n    diedMsg(actor);\r\n    actor.end();\r\n    gameData.actors.remove(actor.id);\r\n    if (canXPOnFloor(gameData.xp, gameData.current.depth)) {\r\n      gameData.xp += XPForDepth(actor.level || 0, gameData.current.depth);\r\n      if (hasLevelUp(gameData.player.level, gameData.xp)) {\r\n        log(\r\n          `%c{${Colors.RED_4}}Level Up%c{} Press %c{${Colors.RED_4}}x%c{} to level.`\r\n        );\r\n      } else {\r\n        log(\r\n          `%c{${Colors.B_GREY_4}}You gain %c{${Colors.RED_4}}${actor.level}%c{${Colors.B_GREY_4}}xp for the victory`\r\n        );\r\n      }\r\n    } else {\r\n      log(`You feel nothing, delve deeper for more XP.`);\r\n    }\r\n  },\r\n  poise: (actor: Actor) => {\r\n    if (actor.alive) {\r\n      staggeredMsg(actor);\r\n      actor.status.staggeredCount = 0;\r\n      actor.status.staggered = true;\r\n    }\r\n  },\r\n};\r\n\r\nconst breeds = {\r\n  player: {\r\n    displayPriority: 100,\r\n    glyph: {\r\n      fg: Colors.B_GREY_5,\r\n      bg: \"transparent\",\r\n      ch: \"@\",\r\n    },\r\n    baseStats: {\r\n      level: 1,\r\n      health: 100,\r\n      stamina: 100,\r\n      poise: 10,\r\n      force: 1,\r\n      strength: 1,\r\n      weight: 20,\r\n    },\r\n    triggers: {\r\n      health: (actor: Actor) => {\r\n        diedMsg(actor);\r\n        actor.end();\r\n        openModal(createElement(DeathModal, { x: 0, y: 0, w: 32, h: 16 }, {}));\r\n      },\r\n      poise: (actor: Actor) => {\r\n        staggeredMsg(actor);\r\n        actor.addParticle(\r\n          ParticleManager.makeUntilStartOfTurn(\r\n            StaggeredParticle,\r\n            actor.x,\r\n            actor.y,\r\n            actor.breed.fg\r\n          )\r\n        );\r\n        actor.status.staggeredCount = 0;\r\n        actor.status.staggered = true;\r\n      },\r\n    },\r\n    text: {\r\n      name: \"A Pilgrim (You)\",\r\n      description: \"You've journeyed far to get here. But why have you come?\",\r\n      logName: \"You\",\r\n    },\r\n    wielding: { left: \"spade\", right: \"bLid\", mode: WieldMode.oneHanded },\r\n    wearing: { armor: \"tunic\" },\r\n    contains: [[\"flask\", 1]],\r\n  },\r\n  faithless: {\r\n    displayPriority: 100,\r\n    glyph: {\r\n      fg: Colors.B_GREY_4,\r\n      bg: \"transparent\",\r\n      ch: \"F\",\r\n    },\r\n    text: {\r\n      name: \"Faithless\",\r\n      description:\r\n        \"Those left empty without a cause to live for. They keep to the shadows, but are quick to strike when the chance arises.\",\r\n      logName: \"Faithless\",\r\n    },\r\n    baseStats: {\r\n      level: 1,\r\n      health: 30,\r\n      stamina: 100,\r\n      poise: 15,\r\n    },\r\n    baseAttack: {\r\n      stamina: 50,\r\n      poise: 10,\r\n      damage: 16,\r\n    },\r\n    triggers: standardTriggers,\r\n    actionController: surroundController,\r\n  },\r\n  heretic: {\r\n    displayPriority: 100,\r\n    glyph: {\r\n      fg: Colors.B_GREY_4,\r\n      bg: \"transparent\",\r\n      ch: \"H\",\r\n    },\r\n    text: {\r\n      name: \"Heretic\",\r\n      description:\r\n        \"Outcast long ago heretics seek only vengence from those that wronged them.\",\r\n      logName: \"Heretic\",\r\n    },\r\n    baseStats: {\r\n      level: 2,\r\n      health: 45,\r\n      stamina: 100,\r\n      poise: 20,\r\n    },\r\n    baseAttack: {\r\n      stamina: 50,\r\n      poise: 14,\r\n      damage: 18,\r\n    },\r\n    triggers: standardTriggers,\r\n    actionController: genericController,\r\n  },\r\n  defiler: {\r\n    displayPriority: 100,\r\n    glyph: {\r\n      fg: Colors.B_GREY_4,\r\n      bg: \"transparent\",\r\n      ch: \"D\",\r\n    },\r\n    text: {\r\n      name: \"Defiler\",\r\n      description:\r\n        \"They have betrayed their cause for their own ends. Carved out a piece of their soul for some coin in their purse.\",\r\n      logName: \"Defiler\",\r\n    },\r\n    baseStats: {\r\n      level: 4,\r\n      health: 60,\r\n      stamina: 100,\r\n      poise: 40,\r\n    },\r\n    baseAttack: {\r\n      stamina: 30,\r\n      poise: 20,\r\n      damage: 20,\r\n    },\r\n    triggers: standardTriggers,\r\n    actionController: surroundController,\r\n  },\r\n  apostate: {\r\n    displayPriority: 100,\r\n    glyph: {\r\n      fg: Colors.B_GREY_4,\r\n      bg: \"transparent\",\r\n      ch: \"A\",\r\n    },\r\n    text: {\r\n      name: \"Apostate\",\r\n      description:\r\n        \"They've turned their back on their cause in exchange for great power.\",\r\n      logName: \"Apostate\",\r\n    },\r\n    baseStats: {\r\n      level: 4,\r\n      health: 80,\r\n      stamina: 100,\r\n      poise: 40,\r\n    },\r\n    baseAttack: {\r\n      stamina: 30,\r\n      poise: 15,\r\n      damage: 25,\r\n    },\r\n    triggers: standardTriggers,\r\n    actionController: genericController,\r\n  },\r\n  cultist: {\r\n    displayPriority: 100,\r\n    glyph: {\r\n      fg: Colors.B_GREY_4,\r\n      bg: \"transparent\",\r\n      ch: \"c\",\r\n    },\r\n    text: {\r\n      name: \"Cultist\",\r\n      description:\r\n        \"A true believer of a false cause. Unwilling to act alone, but quick to defend their leaders.\",\r\n      logName: \"Cultist\",\r\n    },\r\n    baseStats: {\r\n      level: 2,\r\n      health: 40,\r\n      stamina: 100,\r\n      poise: 30,\r\n    },\r\n    baseAttack: {\r\n      stamina: 60,\r\n      poise: 5,\r\n      damage: 30,\r\n    },\r\n    triggers: standardTriggers,\r\n    actionController: surroundController,\r\n  },\r\n  falseProphet: {\r\n    displayPriority: 100,\r\n    glyph: {\r\n      fg: Colors.B_GREY_4,\r\n      bg: \"transparent\",\r\n      ch: \"P\",\r\n    },\r\n    text: {\r\n      name: \"False Prophet\",\r\n      description:\r\n        \"There are many ignobile causes in the world and each has their prophet.\",\r\n      logName: \"False Prophet\",\r\n    },\r\n    baseStats: {\r\n      level: 1,\r\n      health: 80,\r\n      stamina: 100,\r\n      poise: 50,\r\n    },\r\n    baseAttack: {\r\n      stamina: 40,\r\n      poise: 15,\r\n      damage: 25,\r\n    },\r\n    triggers: standardTriggers,\r\n    actionController: surroundController,\r\n  },\r\n} as const;\r\n\r\nexport const BreedTypes = Object.entries(breeds).reduce((r, [key, value]) => {\r\n  r[key as keyof typeof breeds] = new ActorBreed(key, value);\r\n  return r;\r\n}, {} as Record<keyof typeof breeds, ActorBreed>);\r\n","import { ComponentF } from \"../ui\";\r\nexport enum ALIGN_TYPE {\r\n  left,\r\n  center,\r\n  right,\r\n}\r\nexport enum VERT_TYPE {\r\n  top,\r\n  middle,\r\n  bottom,\r\n}\r\nexport const TextType: ComponentF<{\r\n  title: string;\r\n  align: ALIGN_TYPE;\r\n  vert: VERT_TYPE;\r\n}> = (\r\n  C,\r\n  props = { title: \"\", align: ALIGN_TYPE.left, vert: VERT_TYPE.top }\r\n) => {\r\n  let x, y;\r\n  switch (props.align) {\r\n    case ALIGN_TYPE.right:\r\n      x = C.bounds.x + C.bounds.w - props.title.length;\r\n      break;\r\n    case ALIGN_TYPE.center:\r\n      x = C.bounds.x + Math.floor((C.bounds.w - props.title.length) / 2);\r\n      break;\r\n    default:\r\n      x = C.bounds.x;\r\n  }\r\n  switch (props.vert) {\r\n    case VERT_TYPE.middle:\r\n      y = C.bounds.y + Math.floor((C.bounds.h - 1) / 2);\r\n      break;\r\n    case VERT_TYPE.bottom:\r\n      y = C.bounds.y + C.bounds.h - 1;\r\n      break;\r\n    default:\r\n      y = C.bounds.y;\r\n  }\r\n  C.display.drawText(x, y, props.title, C.bounds.w);\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { ButtonComp } from \"../../../ui/input/Button\";\r\nimport { setScene } from \"../../../ui/scene\";\r\nimport { ALIGN_TYPE, TextType } from \"../../../ui/type/TextType\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\nimport { Main } from \"../../scenes/main\";\r\n\r\nexport const DeathModal: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  C.handlers.keypress = (key: string) => {\r\n    if (key === \"Enter\") {\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  return [\r\n    createElement(\r\n      TextType,\r\n      { x: 1, y: 0, w: C.bounds.w - 2, h: 1 },\r\n      { title: \"DEFEAT\", align: ALIGN_TYPE.center }\r\n    ),\r\n    createElement(\r\n      TextType,\r\n      { x: 1, y: 1, w: C.bounds.w - 2, h: 1 },\r\n      {\r\n        title:\r\n          \"Unwaivering was your faith, but it wasn't enough to overcome despair. Your wounds are fatal.\",\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 1, y: C.bounds.h - 2, w: C.bounds.w - 2, h: 1 },\r\n      {\r\n        title: \"(Enter) Restart\",\r\n        keys: [\"Escape\", \"Enter\"],\r\n        onClick: () => {\r\n          closeModal();\r\n          setScene(new Main());\r\n        },\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import {\r\n  awaitAnimate,\r\n  Particle,\r\n  ParticleModes,\r\n} from \"../../../engine/anims/Particle\";\r\n\r\nconst HIGHLIGHT_COLOR = \"rgba(255, 180, 180, 1.0)\";\r\nexport const AttackingParticle = {\r\n  mode: ParticleModes.DRAW_OVER_LAST,\r\n  char: null,\r\n  fg: HIGHLIGHT_COLOR,\r\n  bg: null,\r\n  animate: async (particle: Particle<string | null>) => {\r\n    const baseColor = particle.options || \"rgba(100, 100, 100, 1.0)\";\r\n    // eslint-disable-next-line no-constant-condition\r\n    while (true) {\r\n      await awaitAnimate({\r\n        driver: particle.driver,\r\n        from: baseColor,\r\n        to: HIGHLIGHT_COLOR,\r\n        duration: 1000,\r\n        onUpdate: (latest) => {\r\n          particle.fg = latest;\r\n        },\r\n      });\r\n\r\n      await awaitAnimate({\r\n        driver: particle.driver,\r\n        from: HIGHLIGHT_COLOR,\r\n        to: baseColor,\r\n        duration: 1000,\r\n        onUpdate: (latest) => {\r\n          particle.fg = latest;\r\n        },\r\n      });\r\n    }\r\n  },\r\n};\r\n","import { Point } from \"../../engine/space/bounds\";\r\nimport { Directions, getDirectionTowards } from \"../../engine/space/directions\";\r\nimport { gameData } from \"../GameManager\";\r\nimport { adjInCheck, adjOutCheck } from \"./Movement\";\r\n\r\nexport const moveIn = (to: Point, from: Point) => {\r\n  const tile = gameData.current.tiles[from.x + from.y * gameData.current.width];\r\n\r\n  switch (getDirectionTowards(from, to)) {\r\n    case Directions.Left:\r\n      return adjInCheck(tile.adj.left);\r\n    case Directions.Up:\r\n      return adjInCheck(tile.adj.up);\r\n    case Directions.Right:\r\n      return adjInCheck(tile.adj.right);\r\n    case Directions.Down:\r\n      return adjInCheck(tile.adj.down);\r\n  }\r\n};\r\nexport const moveOut = (to: Point, from: Point) => {\r\n  const tile = gameData.current.tiles[from.x + from.y * gameData.current.width];\r\n\r\n  switch (getDirectionTowards(from, to)) {\r\n    case Directions.Left:\r\n      return adjOutCheck(tile.adj.left);\r\n    case Directions.Up:\r\n      return adjOutCheck(tile.adj.up);\r\n    case Directions.Right:\r\n      return adjOutCheck(tile.adj.right);\r\n    case Directions.Down:\r\n      return adjOutCheck(tile.adj.down);\r\n  }\r\n};\r\n","import { RNG } from \"rot-js\";\r\nimport { Point } from \"../../../engine/space/bounds\";\r\nimport { genAllDirections } from \"../../../engine/space/directions\";\r\nimport { createAction } from \"../../actions/Action\";\r\nimport { attackTo } from \"../../actions/ActionAttacks\";\r\nimport { moveTo, wait } from \"../../actions/ActionMovement\";\r\nimport { AttackingParticle } from \"../../anims/particles/AttackingParticle\";\r\nimport { StaggeredParticle } from \"../../anims/particles/StaggeredParticle\";\r\nimport { ParticleManager } from \"../../anims/particleSystem\";\r\nimport { findActorForPosition, gameData } from \"../../GameManager\";\r\nimport { moveOut } from \"../../map/Pathfinding\";\r\nimport { Actor } from \"../Actor\";\r\nimport { getActiveAttack } from \"../weaponHelper\";\r\n\r\nexport const updateSeen = (actor: Actor) => {\r\n  const visible = gameData.fov.get(actor.x + actor.y * gameData.current.width);\r\n  if (visible) {\r\n    actor.seenPlayer = 10; //Turns the monster will chase enemy out of line of sight\r\n  } else if (actor.seenPlayer) {\r\n    actor.seenPlayer -= 1;\r\n  }\r\n  return visible;\r\n};\r\n\r\nexport const staggered = (actor: Actor) => {\r\n  if (actor.status.staggered) {\r\n    actor.addParticle(\r\n      ParticleManager.makeUntilEndOfTurn(\r\n        StaggeredParticle,\r\n        actor.x,\r\n        actor.y,\r\n        actor.breed.fg\r\n      )\r\n    );\r\n    return createAction(wait, actor, null);\r\n  }\r\n};\r\n\r\nexport const bestMoveTowardsPlayer = (actor: Actor) => {\r\n  const points = gameData.dMapPlayer?.getSortedAdjacent(actor, moveOut);\r\n  if (points) {\r\n    for (let i = 0; i < points.length; i++) {\r\n      const target = points[i];\r\n      const at = findActorForPosition(target.x, target.y);\r\n      if (!at || at === gameData.player) {\r\n        return [target, at] as const;\r\n      }\r\n    }\r\n  }\r\n  return [];\r\n};\r\n\r\nexport const bestMoveOrAttackPlayer = (actor: Actor) => {\r\n  const [target, at] = bestMoveTowardsPlayer(actor);\r\n  if (target) {\r\n    if (at === gameData.player) {\r\n      const attack = getActiveAttack(actor);\r\n      if (attack.stamina <= actor.stamina.current) {\r\n        addAttackParticle(actor);\r\n        return createAction(attackTo, actor, { target });\r\n      }\r\n    } else if (!at) {\r\n      return createAction(moveTo, actor, { target });\r\n    }\r\n  }\r\n};\r\n\r\nexport const getMoveAway = (actor: Actor) => {\r\n  const points = gameData.dMapPlayer?.getSortedAdjacent(\r\n    { x: actor.x, y: actor.y },\r\n    moveOut\r\n  );\r\n  if (points) {\r\n    for (let i = points.length - 1; 0 <= i; i--) {\r\n      const target = points[i];\r\n      const at = findActorForPosition(target.x, target.y);\r\n      if (!at) {\r\n        return createAction(moveTo, actor, { target });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const conditionalApproach = (\r\n  actor: Actor,\r\n  distanceOnFail: number,\r\n  approach: boolean\r\n) => {\r\n  let action;\r\n  const distance = getDistance(actor);\r\n  if (distance && distance <= distanceOnFail) {\r\n    if (approach) {\r\n      action = bestMoveOrAttackPlayer(actor);\r\n      if (action) {\r\n        return action;\r\n      }\r\n    } else {\r\n      if (distance === 1) {\r\n        const attack = getActiveAttack(actor);\r\n        if (attack.stamina <= actor.stamina.current) {\r\n          addAttackParticle(actor);\r\n          return createAction(attackTo, actor, {\r\n            target: { x: gameData.player.x, y: gameData.player.y },\r\n          });\r\n        }\r\n      }\r\n      action = getMoveAway(actor);\r\n      if (action) {\r\n        return action;\r\n      }\r\n    }\r\n  } else {\r\n    action = bestMoveOrAttackPlayer(actor);\r\n    if (action) {\r\n      return action;\r\n    }\r\n  }\r\n};\r\n\r\nexport const getRandomOpen = (rng: typeof RNG, actor: Actor) => {\r\n  const result: Record<string, Point> = {};\r\n  const weights: Record<string, number> = {};\r\n  const i = 0;\r\n  for (const next of genAllDirections(actor)) {\r\n    if (moveOut(next, actor) && !findActorForPosition(next.x, next.y)) {\r\n      const dValue = gameData.dMapPlayer?.get(next);\r\n      if (dValue) {\r\n        result[i] = next;\r\n        weights[i] = dValue;\r\n      }\r\n    }\r\n  }\r\n  const choice = rng.getWeightedValue(weights);\r\n  if (choice) {\r\n    return result[choice];\r\n  }\r\n};\r\n\r\nexport const addAttackParticle = (actor: Actor) => {\r\n  actor.addParticle(\r\n    ParticleManager.makeUntilStartOfTurn(\r\n      AttackingParticle,\r\n      actor.x,\r\n      actor.y,\r\n      actor.breed.fg\r\n    )\r\n  );\r\n};\r\n\r\nexport const getDistance = (actor: Actor) => {\r\n  return gameData.dMapPlayer?.get(actor);\r\n};\r\n\r\nexport const getAdjacentToPlayer = (actor: Actor) => {\r\n  return gameData.actors.filter((a) => {\r\n    return (\r\n      a !== actor &&\r\n      a !== gameData.player &&\r\n      Math.max(\r\n        Math.pow(a.x - gameData.player.x, 2),\r\n        Math.pow(a.y - gameData.player.y, 2)\r\n      ) <= 1\r\n    );\r\n  });\r\n};\r\n","import { Action, createAction } from \"../../actions/Action\";\r\nimport { wait } from \"../../actions/ActionMovement\";\r\nimport { Actor } from \"../Actor\";\r\nimport {\r\n  bestMoveOrAttackPlayer,\r\n  conditionalApproach,\r\n  getAdjacentToPlayer,\r\n  staggered,\r\n  updateSeen,\r\n} from \"./aiHelpers\";\r\n\r\nexport type ActionController = (actor: Actor) => Action<any> | void;\r\n\r\nexport const genericController = (actor: Actor) => {\r\n  const visible = updateSeen(actor);\r\n\r\n  let action: Action<any> | undefined | null = staggered(actor);\r\n  if (action) {\r\n    return action;\r\n  }\r\n\r\n  if (visible || actor.seenPlayer) {\r\n    action = bestMoveOrAttackPlayer(actor);\r\n    if (action) {\r\n      return action;\r\n    }\r\n  }\r\n  return createAction(wait, actor, null);\r\n};\r\n\r\nexport const surroundController = (actor: Actor) => {\r\n  const visible = updateSeen(actor);\r\n\r\n  let action: Action<any> | undefined = staggered(actor);\r\n  if (action) {\r\n    return action;\r\n  }\r\n\r\n  if (visible || actor.seenPlayer) {\r\n    const adj = getAdjacentToPlayer(actor);\r\n    action = conditionalApproach(actor, 3, 0 < adj.length);\r\n    if (action) {\r\n      return action;\r\n    }\r\n  }\r\n  return createAction(wait, actor, null);\r\n};\r\n\r\nexport const onlyIfTypeAdjacentController = (actor: Actor) => {\r\n  const visible = updateSeen(actor);\r\n\r\n  let action: Action<any> | undefined = staggered(actor);\r\n  if (action) {\r\n    return action;\r\n  }\r\n\r\n  if (visible || actor.seenPlayer) {\r\n    const adj = getAdjacentToPlayer(actor);\r\n    action = conditionalApproach(\r\n      actor,\r\n      2,\r\n      0 < adj.length &&\r\n        adj.find((a) => a.breed === actor.controllerProps.aggressor) != null\r\n    );\r\n    if (action) {\r\n      return action;\r\n    }\r\n  }\r\n  return createAction(wait, actor, null);\r\n};\r\n","export const XPThresholds = [\r\n  2,\r\n  4,\r\n  6,\r\n  8,\r\n  10,\r\n  12,\r\n  15,\r\n  18,\r\n  22,\r\n  26,\r\n  30,\r\n  40,\r\n  50,\r\n  60,\r\n  80,\r\n  100,\r\n  130,\r\n  160,\r\n  190,\r\n  200,\r\n  240,\r\n];\r\n\r\nconst XPMaxPerFloor = [10, 40, 80, 160, 240];\r\n\r\nexport const isMaxLevel = (level: number) => {\r\n  return XPThresholds.length - 1 <= level;\r\n};\r\n\r\nexport const hasLevelUp = (level: number, xp: number) => {\r\n  return XPThresholds[level - 1] <= xp;\r\n};\r\n\r\nexport const getXPProgress = (level: number, xp: number) => {\r\n  const thresh = XPThresholds[level - 1];\r\n  return `${xp}/${thresh}`;\r\n};\r\n\r\nexport const canXPOnFloor = (xp: number, floor: number) => {\r\n  return xp < (XPMaxPerFloor[floor - 1] || 0);\r\n};\r\nexport const XPForDepth = (level: number, floor: number) => {\r\n  return level + Math.floor(0.5 * (floor - 1) * level);\r\n};\r\n","import { RNG } from \"rot-js\";\r\nimport { Actor } from \"../actors/Actor\";\r\nimport { BreedTypes } from \"../actors/breeds\";\r\nimport EntityManager from \"../EntityManager\";\r\nimport { gameData } from \"../GameManager\";\r\nimport {\r\n  carveShared,\r\n  carveZDifference,\r\n  makeDoor,\r\n  makeRect,\r\n  makeZRamp,\r\n} from \"./carving/Carving\";\r\nimport { BSPGenerate } from \"./graph/BSPGenerator\";\r\nimport { GraphNode } from \"./graph/buildMinSpanTree\";\r\nimport { placeMonsters } from \"./placement/MonsterPlacement\";\r\nimport { placeShrines } from \"./placement/ShrinePlacement\";\r\nimport { ShrineMap } from \"./ShrineMap\";\r\n\r\nexport const generateMap = (\r\n  rng: typeof RNG,\r\n  map: ShrineMap,\r\n  player?: Actor\r\n) => {\r\n  const rooms = BSPGenerate(rng, map.width - 1, map.height - 1);\r\n  map.generate(rng);\r\n  let room: GraphNode;\r\n  for (room of rooms.values()) {\r\n    makeRect(map, room.bounds, room.z);\r\n  }\r\n\r\n  let index: number;\r\n  for ([index, room] of rooms.entries()) {\r\n    room.adj.forEach((idx) => {\r\n      if (index < idx) {\r\n        const adjRoom = rooms.get(idx);\r\n        if (adjRoom) {\r\n          if (room.z !== adjRoom.z) {\r\n            carveZDifference(\r\n              map,\r\n              room.bounds,\r\n              adjRoom.bounds,\r\n              adjRoom.z < room.z\r\n            );\r\n          } else if (rng.getUniformInt(0, 1)) {\r\n            carveShared(map, room.bounds, adjRoom.bounds);\r\n          } else {\r\n            makeDoor(rng, map, room.bounds, adjRoom.bounds);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  connectZLevels(rng, map, rooms);\r\n\r\n  const [oldPos, startingRoom] = placeShrines(rng, map, rooms);\r\n  if (player) {\r\n    player.x = oldPos.x;\r\n    player.y = oldPos.y;\r\n  } else {\r\n    gameData.player = EntityManager.createActor(\r\n      BreedTypes.player,\r\n      oldPos.x,\r\n      oldPos.y\r\n    );\r\n  }\r\n  placeMonsters(rng, map, rooms, startingRoom);\r\n};\r\n\r\nconst connectZLevels = (\r\n  rng: typeof RNG,\r\n  map: ShrineMap,\r\n  rooms: Map<number, GraphNode>\r\n) => {\r\n  const start = rooms.keys().next().value;\r\n  const queued: boolean[] = [];\r\n  const visited: boolean[] = [];\r\n  const horizon: number[] = [start];\r\n  queued[start] = true;\r\n\r\n  let room: GraphNode | undefined;\r\n  let next: number;\r\n  while (0 < horizon.length) {\r\n    next = horizon.pop() as number;\r\n    if (!visited[next]) {\r\n      room = rooms.get(next);\r\n      if (room) {\r\n        if (1 < room.z) {\r\n          const platformAdjs: [number, number][] = [];\r\n          let platformCurIdx: number, fromIdx: number | null;\r\n          let platformCur;\r\n          const platformQueue: [number, number | null][] = [[next, null]];\r\n          while (0 < platformQueue.length) {\r\n            [platformCurIdx, fromIdx] = platformQueue.pop() as [\r\n              number,\r\n              number | null\r\n            ];\r\n            platformCur = rooms.get(platformCurIdx);\r\n\r\n            if (platformCur) {\r\n              if (room.z === platformCur.z) {\r\n                visited[platformCurIdx] = true;\r\n                queued[platformCurIdx] = true;\r\n                platformCur.adj.forEach((index) => {\r\n                  if (!visited[index]) {\r\n                    platformQueue.push([index, platformCurIdx]);\r\n                  }\r\n                });\r\n              } else {\r\n                if (!visited[platformCurIdx] && !queued[platformCurIdx]) {\r\n                  queued[platformCurIdx] = true;\r\n                  horizon.push(platformCurIdx);\r\n                }\r\n                if (fromIdx) {\r\n                  platformAdjs.push([platformCurIdx, fromIdx]);\r\n                }\r\n              }\r\n            }\r\n          }\r\n          const targetConnection = platformAdjs.length\r\n            ? rng.getItem(platformAdjs)\r\n            : ([rng.getItem(room.adj) as number, next] as const);\r\n          if (targetConnection) {\r\n            const a = rooms.get(targetConnection[0]);\r\n            const b = rooms.get(targetConnection[1]);\r\n            if (a && b) {\r\n              makeZRamp(map, a.bounds, b.bounds, false);\r\n            }\r\n          } else {\r\n            console.warn(\"No target connection found\");\r\n          }\r\n        } else {\r\n          //Ground level, just queue all unseen adjacent\r\n          room.adj.forEach((adj) => {\r\n            if (!visited[adj] && !queued[adj]) {\r\n              queued[adj] = true;\r\n              horizon.push(adj);\r\n            }\r\n          });\r\n        }\r\n      } else {\r\n        console.warn(\"Room not found for z-diff\");\r\n      }\r\n    }\r\n  }\r\n};\r\n","import { RNG } from \"rot-js\";\r\nimport { LevelMap } from \"../../../engine/map/LevelMap\";\r\nimport { Bounds } from \"../../../engine/space/bounds\";\r\nimport { AdjTypes, FloorTypes } from \"../Map\";\r\nimport { ShrineMap } from \"../ShrineMap\";\r\n\r\nexport const fillEdges = (map: ShrineMap) => {\r\n  const botRow = (map.height - 1) * map.width;\r\n  const oneMinusBot = (map.height - 2) * map.width;\r\n  const right = map.width - 1;\r\n  const oneMinusRight = map.width - 2;\r\n\r\n  for (let x = 0; x < map.width; x++) {\r\n    map.tiles[x].adj.up = AdjTypes.WALL;\r\n    map.tiles[x + oneMinusBot].adj.down = AdjTypes.WALL;\r\n    map.tiles[x + botRow].adj.up = AdjTypes.WALL;\r\n    map.tiles[x + botRow].type = FloorTypes.OOB;\r\n  }\r\n\r\n  for (let y = 0; y < map.height; y++) {\r\n    map.tiles[y * map.width].adj.left = AdjTypes.WALL;\r\n    map.tiles[oneMinusRight + y * map.width].adj.right = AdjTypes.WALL;\r\n    map.tiles[right + y * map.width].adj.left = AdjTypes.WALL;\r\n    map.tiles[right + y * map.width].type = FloorTypes.OOB;\r\n  }\r\n};\r\n\r\nexport const setAreaZLevel = (map: ShrineMap, bounds: Bounds, z: number) => {\r\n  for (let y = bounds.y; y < bounds.h + bounds.y; y++) {\r\n    for (let x = bounds.x; x < bounds.w + bounds.x; x++) {\r\n      map.tiles[x + y * map.width].z = z;\r\n    }\r\n  }\r\n};\r\n\r\nexport const raiseAndDivideArea = (\r\n  map: LevelMap<FloorTypes, AdjTypes>,\r\n  bounds: Bounds,\r\n  z: number\r\n) => {\r\n  const bot = bounds.h + bounds.y - 1;\r\n  for (let y = bounds.y; y < bounds.h + bounds.y; y++) {\r\n    map.tiles[y * map.width + bounds.x].adj.left = AdjTypes.ONE_OUT;\r\n    map.tiles[y * map.width + bounds.x - 1].adj.right = AdjTypes.ONE_IN;\r\n\r\n    map.tiles[y * map.width + bounds.x + bounds.w - 1].adj.right =\r\n      AdjTypes.WALL;\r\n    map.tiles[y * map.width + bounds.x + bounds.w].adj.left = AdjTypes.WALL;\r\n\r\n    for (let x = bounds.x; x < bounds.w + bounds.x; x++) {\r\n      map.tiles[x + y * map.width].z = z;\r\n      if (y === bounds.y) {\r\n        map.tiles[x + y * map.width].adj.up = AdjTypes.ONE_OUT;\r\n        map.tiles[x + (y - 1) * map.width].adj.down = AdjTypes.ONE_IN;\r\n      }\r\n\r\n      if (y === bot) {\r\n        map.tiles[x + y * map.width].adj.down = AdjTypes.WALL;\r\n        map.tiles[x + (y + 1) * map.width].adj.up = AdjTypes.WALL;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const makeRect = (\r\n  map: LevelMap<FloorTypes, AdjTypes>,\r\n  bounds: Bounds,\r\n  z: number\r\n) => {\r\n  const bot = bounds.h + bounds.y - 1;\r\n  for (let y = bounds.y; y < bounds.h + bounds.y; y++) {\r\n    map.tiles[y * map.width + bounds.x].adj.left = AdjTypes.WALL;\r\n    if (0 < bounds.x) {\r\n      map.tiles[y * map.width + bounds.x - 1].adj.right = AdjTypes.WALL;\r\n    }\r\n\r\n    map.tiles[y * map.width + bounds.x + bounds.w - 1].adj.right =\r\n      AdjTypes.WALL;\r\n    map.tiles[y * map.width + bounds.x + bounds.w].adj.left = AdjTypes.WALL;\r\n\r\n    for (let x = bounds.x; x < bounds.w + bounds.x; x++) {\r\n      map.tiles[y * map.width + x].type = FloorTypes.EMPTY;\r\n      map.tiles[y * map.width + x].z = z;\r\n\r\n      if (y === bounds.y) {\r\n        map.tiles[x + y * map.width].adj.up = AdjTypes.WALL;\r\n        if (0 < y) {\r\n          map.tiles[x + (y - 1) * map.width].adj.down = AdjTypes.WALL;\r\n        }\r\n      }\r\n\r\n      if (y === bot) {\r\n        map.tiles[x + y * map.width].adj.down = AdjTypes.WALL;\r\n        map.tiles[x + (y + 1) * map.width].adj.up = AdjTypes.WALL;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nconst getHorzRandom = (rng: typeof RNG, a: Bounds, b: Bounds) => {\r\n  const minX = Math.max(a.x, b.x);\r\n  const maxX = Math.min(a.x + a.w, b.x + b.w);\r\n  if (maxX - minX < 3) {\r\n    return rng.getUniformInt(minX, maxX);\r\n  } else {\r\n    return rng.getUniformInt(minX + 1, maxX - 1);\r\n  }\r\n};\r\nconst getVertRandom = (rng: typeof RNG, a: Bounds, b: Bounds) => {\r\n  const minY = Math.max(a.y, b.y);\r\n  const maxY = Math.min(a.y + a.h, b.y + b.h);\r\n  if (maxY - minY < 3) {\r\n    return rng.getUniformInt(minY, maxY);\r\n  } else {\r\n    return rng.getUniformInt(minY + 1, maxY - 1);\r\n  }\r\n};\r\n\r\nconst openSharedVert = (a: Bounds, b: Bounds, cb: (y: number) => void) => {\r\n  let y = Math.max(a.y, b.y);\r\n  const maxY = Math.min(a.y + a.h, b.y + b.h);\r\n  for (; y < maxY; y++) {\r\n    cb(y);\r\n  }\r\n};\r\n\r\nconst openSharedHorz = (a: Bounds, b: Bounds, cb: (x: number) => void) => {\r\n  let x = Math.max(a.x, b.x);\r\n  const maxX = Math.min(a.x + a.w, b.x + b.w);\r\n  for (; x < maxX; x++) {\r\n    cb(x);\r\n  }\r\n};\r\n\r\nexport const carveShared = (map: ShrineMap, a: Bounds, b: Bounds) => {\r\n  if (a.x === b.x + b.w) {\r\n    //Left-Right aligned\r\n    openSharedVert(a, b, (y) => {\r\n      map.tiles[a.x + y * map.width].adj.left = AdjTypes.OPEN;\r\n      map.tiles[a.x - 1 + y * map.width].adj.right = AdjTypes.OPEN;\r\n    });\r\n  } else if (a.x + a.w === b.x) {\r\n    //Right-Left aligned\r\n    openSharedVert(a, b, (y) => {\r\n      map.tiles[b.x + y * map.width].adj.right = AdjTypes.OPEN;\r\n      map.tiles[b.x - 1 + y * map.width].adj.left = AdjTypes.OPEN;\r\n    });\r\n  } else if (a.y === b.y + b.h) {\r\n    //Bot-Top aligned\r\n    openSharedHorz(a, b, (x) => {\r\n      map.tiles[x + a.y * map.width].adj.up = AdjTypes.OPEN;\r\n      map.tiles[x + (a.y - 1) * map.width].adj.down = AdjTypes.OPEN;\r\n    });\r\n  } else if (a.y + a.h === b.y) {\r\n    //Top-bot aligned\r\n    openSharedHorz(a, b, (x) => {\r\n      map.tiles[x + b.y * map.width].adj.up = AdjTypes.OPEN;\r\n      map.tiles[x + (b.y - 1) * map.width].adj.down = AdjTypes.OPEN;\r\n    });\r\n  }\r\n};\r\n\r\n//The rooms must pass AABB already\r\nexport const makeDoor = (\r\n  rng: typeof RNG,\r\n  map: ShrineMap,\r\n  a: Bounds,\r\n  b: Bounds\r\n) => {\r\n  if (a.x === b.x + b.w) {\r\n    //Left-Right aligned\r\n    const x = a.x;\r\n    const y = getVertRandom(rng, a, b);\r\n    map.tiles[x + y * map.width].adj.left = AdjTypes.OPEN;\r\n    map.tiles[x - 1 + y * map.width].adj.right = AdjTypes.OPEN;\r\n  } else if (a.x + a.w === b.x) {\r\n    //Right-Left aligned\r\n    const x = b.x;\r\n    const y = getVertRandom(rng, a, b);\r\n    map.tiles[x + y * map.width].adj.right = AdjTypes.OPEN;\r\n    map.tiles[x - 1 + y * map.width].adj.left = AdjTypes.OPEN;\r\n  } else if (a.y === b.y + b.h) {\r\n    //Bot-Top aligned\r\n    const x = getHorzRandom(rng, a, b);\r\n    const y = a.y;\r\n    map.tiles[x + y * map.width].adj.up = AdjTypes.OPEN;\r\n    map.tiles[x + (y - 1) * map.width].adj.down = AdjTypes.OPEN;\r\n  } else if (a.y + a.h === b.y) {\r\n    //Top-bot aligned\r\n    const x = getHorzRandom(rng, a, b);\r\n    const y = b.y;\r\n    map.tiles[x + y * map.width].adj.up = AdjTypes.OPEN;\r\n    map.tiles[x + (y - 1) * map.width].adj.down = AdjTypes.OPEN;\r\n  }\r\n};\r\n\r\nexport const carveZDifference = (\r\n  map: ShrineMap,\r\n  a: Bounds,\r\n  b: Bounds,\r\n  aHigher: boolean\r\n) => {\r\n  if (a.x === b.x + b.w) {\r\n    //Left-Right aligned\r\n    openSharedVert(a, b, (y) => {\r\n      map.tiles[a.x + y * map.width].adj.left = aHigher\r\n        ? AdjTypes.ONE_OUT\r\n        : AdjTypes.ONE_IN;\r\n      map.tiles[a.x - 1 + y * map.width].adj.right = aHigher\r\n        ? AdjTypes.ONE_IN\r\n        : AdjTypes.ONE_OUT;\r\n    });\r\n  } else if (a.x + a.w === b.x) {\r\n    //Right-Left aligned\r\n    openSharedVert(a, b, (y) => {\r\n      map.tiles[b.x + y * map.width].adj.right = aHigher\r\n        ? AdjTypes.ONE_IN\r\n        : AdjTypes.ONE_OUT;\r\n      map.tiles[b.x - 1 + y * map.width].adj.left = aHigher\r\n        ? AdjTypes.ONE_OUT\r\n        : AdjTypes.ONE_IN;\r\n    });\r\n  } else if (a.y === b.y + b.h) {\r\n    //Bot-Top aligned\r\n    openSharedHorz(a, b, (x) => {\r\n      map.tiles[x + a.y * map.width].adj.up = aHigher\r\n        ? AdjTypes.ONE_OUT\r\n        : AdjTypes.ONE_IN;\r\n      map.tiles[x + (a.y - 1) * map.width].adj.down = aHigher\r\n        ? AdjTypes.ONE_IN\r\n        : AdjTypes.ONE_OUT;\r\n    });\r\n  } else if (a.y + a.h === b.y) {\r\n    //Top-bot aligned\r\n    openSharedHorz(a, b, (x) => {\r\n      map.tiles[x + b.y * map.width].adj.up = aHigher\r\n        ? AdjTypes.ONE_IN\r\n        : AdjTypes.ONE_OUT;\r\n      map.tiles[x + (b.y - 1) * map.width].adj.down = aHigher\r\n        ? AdjTypes.ONE_OUT\r\n        : AdjTypes.ONE_IN;\r\n    });\r\n  }\r\n};\r\n\r\nexport const makeSubsetLedge = (\r\n  rng: typeof RNG,\r\n  map: ShrineMap,\r\n  room: Bounds,\r\n  minSize = 2\r\n) => {\r\n  const w = rng.getUniformInt(minSize, room.w - 1);\r\n  const h = rng.getUniformInt(minSize, room.h - 1);\r\n  const x = rng.getUniformInt(0, room.w - w) + room.x;\r\n  const y = rng.getUniformInt(0, room.h - h) + room.y;\r\n  setAreaZLevel(map, { x, y, w, h }, 2);\r\n};\r\n\r\n//The rooms must pass AABB already\r\nexport const makeZRamp = (\r\n  map: ShrineMap,\r\n  a: Bounds,\r\n  b: Bounds,\r\n  aHigher: boolean\r\n) => {\r\n  if (a.x === b.x + b.w) {\r\n    //Left-Right aligned\r\n    openSharedVert(a, b, (y) => {\r\n      map.tiles[a.x + y * map.width].adj.left = aHigher\r\n        ? AdjTypes.Z_OUT\r\n        : AdjTypes.Z_IN;\r\n      map.tiles[a.x - 1 + y * map.width].adj.right = aHigher\r\n        ? AdjTypes.Z_IN\r\n        : AdjTypes.Z_OUT;\r\n    });\r\n  } else if (a.x + a.w === b.x) {\r\n    //Right-Left aligned\r\n    openSharedVert(a, b, (y) => {\r\n      map.tiles[b.x + y * map.width].adj.left = aHigher\r\n        ? AdjTypes.Z_IN\r\n        : AdjTypes.Z_OUT;\r\n      map.tiles[b.x - 1 + y * map.width].adj.right = aHigher\r\n        ? AdjTypes.Z_OUT\r\n        : AdjTypes.Z_IN;\r\n    });\r\n  } else if (a.y === b.y + b.h) {\r\n    //Bot-Top aligned\r\n    openSharedHorz(a, b, (x) => {\r\n      map.tiles[x + a.y * map.width].adj.up = aHigher\r\n        ? AdjTypes.Z_OUT\r\n        : AdjTypes.Z_IN;\r\n      map.tiles[x + (a.y - 1) * map.width].adj.down = aHigher\r\n        ? AdjTypes.Z_IN\r\n        : AdjTypes.Z_OUT;\r\n    });\r\n  } else if (a.y + a.h === b.y) {\r\n    //Top-bot aligned\r\n    openSharedHorz(a, b, (x) => {\r\n      map.tiles[x + b.y * map.width].adj.up = aHigher\r\n        ? AdjTypes.Z_IN\r\n        : AdjTypes.Z_OUT;\r\n      map.tiles[x + (b.y - 1) * map.width].adj.down = aHigher\r\n        ? AdjTypes.Z_OUT\r\n        : AdjTypes.Z_IN;\r\n    });\r\n  }\r\n};\r\n","import { Bounds } from \"../../../engine/space/bounds\";\r\nimport MinHeap from \"../../../lib/heap/heap\";\r\nexport type GraphNode = {\r\n  weight: number;\r\n  bounds: Bounds;\r\n  adj: number[];\r\n  z: number;\r\n};\r\nexport default function buildMinSpanTree(\r\n  adjacency: Map<number, GraphNode>,\r\n  target: number\r\n) {\r\n  const included: boolean[] = [];\r\n  const weights: number[] = [];\r\n  const edges = new MinHeap<[number, number, GraphNode]>(\r\n    (val) => val[2].weight,\r\n    adjacency.size\r\n  );\r\n\r\n  const newAdjacency = new Map<number, GraphNode>();\r\n\r\n  included[target] = true;\r\n\r\n  const nTarget = adjacency.get(target);\r\n  if (nTarget) {\r\n    newAdjacency.set(target, {\r\n      bounds: nTarget.bounds,\r\n      weight: 1,\r\n      adj: [],\r\n      z: 1,\r\n    });\r\n\r\n    nTarget.adj.forEach((e) => {\r\n      const eTarget = adjacency.get(e);\r\n      if (eTarget) {\r\n        edges.push([target, e, eTarget]);\r\n        weights[e] = eTarget.weight;\r\n      }\r\n    });\r\n\r\n    let from: number,\r\n      to: number,\r\n      data: GraphNode,\r\n      numEdges = 1;\r\n    while (numEdges <= adjacency.size && edges.size()) {\r\n      [from, to, data] = edges.pop();\r\n      if (!included[to]) {\r\n        const fromExisting = newAdjacency.get(from);\r\n        if (fromExisting) {\r\n          fromExisting.adj.push(to);\r\n        } else {\r\n          console.warn(\"mst: from node not found\");\r\n        }\r\n        newAdjacency.set(to, {\r\n          weight: data.weight,\r\n          bounds: data.bounds,\r\n          adj: [from],\r\n          z: 1,\r\n        });\r\n\r\n        included[to] = true;\r\n        numEdges += 1;\r\n        data.adj.forEach((e) => {\r\n          if (!included[e] || (weights[e] && weights[e] < e)) {\r\n            const eTarget = adjacency.get(e);\r\n            if (eTarget) {\r\n              edges.push([to, e, eTarget]);\r\n              weights[to] = eTarget.weight;\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n  return newAdjacency;\r\n}\r\n","export default class MinHeap<T> {\r\n  tree: T[];\r\n  comparator: (value: T) => T | number;\r\n\r\n  constructor(comparator: (a: T) => T | number, capacity = 20) {\r\n    this.tree = [];\r\n    this.comparator = comparator;\r\n  }\r\n\r\n  push(element: T) {\r\n    this.tree.push(element);\r\n    this.bubbleUp(this.tree.length - 1);\r\n  }\r\n\r\n  pushAll(elements: T[]) {\r\n    elements.forEach((e) => this.push(e));\r\n  }\r\n\r\n  pop() {\r\n    const result = this.tree[0];\r\n    const end = this.tree.pop();\r\n    if (end !== undefined && this.tree.length > 0) {\r\n      this.tree[0] = end;\r\n      this.sinkDown(0);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  size() {\r\n    return this.tree.length;\r\n  }\r\n\r\n  bubbleUp(current: number) {\r\n    const element = this.tree[current];\r\n    const weight = this.comparator(element);\r\n\r\n    let parent, parentIndex;\r\n    while (current > 0) {\r\n      parentIndex = Math.floor((current + 1) / 2) - 1;\r\n      parent = this.tree[parentIndex];\r\n\r\n      if (weight >= this.comparator(parent)) {\r\n        break;\r\n      }\r\n\r\n      this.tree[current] = parent;\r\n      this.tree[parentIndex] = element;\r\n      current = parentIndex;\r\n    }\r\n  }\r\n\r\n  sinkDown(current: number) {\r\n    const length = this.tree.length;\r\n    const element = this.tree[current];\r\n    const weight = this.comparator(element);\r\n\r\n    let child, childIndex, childWeight, b, bIndex, bWeight;\r\n    while (true) {\r\n      bIndex = (current + 1) * 2;\r\n      childIndex = bIndex - 1;\r\n\r\n      if (length > childIndex) {\r\n        child = this.tree[childIndex];\r\n        childWeight = this.comparator(child);\r\n        if (length > bIndex) {\r\n          b = this.tree[bIndex];\r\n          bWeight = this.comparator(b);\r\n          if (bWeight < childWeight) {\r\n            child = b;\r\n            childWeight = bWeight;\r\n            childIndex = bIndex;\r\n          }\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n\r\n      if (childWeight < weight) {\r\n        this.tree[current] = child;\r\n        this.tree[childIndex] = element;\r\n        current = childIndex;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Bounds } from \"../../../engine/space/bounds\";\r\nimport { RNG } from \"rot-js\";\r\nimport buildMinSpanTree, { GraphNode } from \"./buildMinSpanTree\";\r\n\r\nexport const BSPGenerate = (rng: typeof RNG, width: number, height: number) => {\r\n  const graph = graphRooms(rng, makeInitialRooms(rng, 8, width, height));\r\n  const mstgraph = buildMinSpanTree(graph, 0);\r\n  raiseLeafs(mstgraph);\r\n  addLoops(rng, 0.45, graph, mstgraph);\r\n  pruneLeafs(rng, 1, mstgraph);\r\n  return mstgraph;\r\n};\r\n\r\nconst makeInitialRooms = (\r\n  rng: typeof RNG,\r\n  maxDepth: number,\r\n  width: number,\r\n  height: number\r\n) => {\r\n  const result: Bounds[] = [];\r\n  const container = { x: 0, y: 0, w: width, h: height };\r\n  const queue: [Bounds, number][] = [[container, 0]];\r\n\r\n  let next: [Bounds, number] | undefined, area, depth, l, r;\r\n  // eslint-disable-next-line no-cond-assign\r\n  while ((next = queue.pop())) {\r\n    [area, depth] = next;\r\n    if (depth <= maxDepth && (8 <= area.w || 8 <= area.h)) {\r\n      [l, r] = splitArea(rng, area);\r\n      queue.push([l, depth + 1], [r, depth + 1]);\r\n    } else {\r\n      result.push(area);\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nconst splitArea = (rng: typeof RNG, bounds: Bounds) => {\r\n  let l, r;\r\n  if (8 <= bounds.w && 0.45 < bounds.w / bounds.h) {\r\n    const min = Math.floor(bounds.w * 0.45);\r\n    const max = Math.ceil(bounds.w * 0.55);\r\n    l = {\r\n      x: bounds.x,\r\n      y: bounds.y,\r\n      w: rng.getUniformInt(min, max),\r\n      h: bounds.h,\r\n    };\r\n    r = { x: bounds.x + l.w, y: bounds.y, w: bounds.w - l.w, h: bounds.h };\r\n  } else {\r\n    const min = Math.floor(bounds.h * 0.45);\r\n    const max = Math.ceil(bounds.h * 0.55);\r\n    l = {\r\n      x: bounds.x,\r\n      y: bounds.y,\r\n      w: bounds.w,\r\n      h: rng.getUniformInt(min, max),\r\n    };\r\n    r = { x: bounds.x, y: bounds.y + l.h, w: bounds.w, h: bounds.h - l.h };\r\n  }\r\n  return [l, r] as const;\r\n};\r\n\r\nconst graphRooms = (rng: typeof RNG, rooms: Bounds[]) => {\r\n  const result: Map<number, GraphNode> = new Map();\r\n\r\n  let iRoom, jRoom, iResult, jResult;\r\n  for (let i = 0; i < rooms.length; i++) {\r\n    iRoom = rooms[i];\r\n    iResult =\r\n      result.get(i) ||\r\n      result\r\n        .set(i, { bounds: iRoom, adj: [], weight: rng.getUniform(), z: 1 })\r\n        .get(i);\r\n    for (let j = i + 1; j < rooms.length; j++) {\r\n      jRoom = rooms[j];\r\n      if (compareRooms(iRoom, jRoom)) {\r\n        jResult =\r\n          result.get(j) ||\r\n          result\r\n            .set(j, { bounds: jRoom, adj: [], weight: rng.getUniform(), z: 1 })\r\n            .get(j);\r\n        iResult?.adj.push(j);\r\n        jResult?.adj.push(i);\r\n      }\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nconst compareRooms = (a: Bounds, b: Bounds) => {\r\n  const xTouch = a.x <= b.x + b.w && b.x <= a.x + a.w;\r\n  const yTouch = a.y <= b.y + b.h && b.y <= a.y + a.h;\r\n  const xOverlap = a.x < b.x + b.w && b.x < a.x + a.w;\r\n  const yOverlap = a.y < b.y + b.h && b.y < a.y + a.h;\r\n  return (xTouch && yOverlap) || (yTouch && xOverlap);\r\n};\r\n\r\nconst addLoops = (\r\n  rng: typeof RNG,\r\n  loopPct: number,\r\n  fullGraph: ReturnType<typeof graphRooms>,\r\n  mstGraph: ReturnType<typeof graphRooms>\r\n) => {\r\n  const tLoops = Math.floor(mstGraph.size * loopPct);\r\n  for (let i = 0; i <= tLoops; i++) {\r\n    for (let bail = 0; bail <= 100; bail++) {\r\n      const id = rng.getUniformInt(0, mstGraph.size - 1);\r\n      const room = mstGraph.get(id);\r\n      if (room) {\r\n        const fullRoom = fullGraph.get(id);\r\n        if (fullRoom) {\r\n          if (room.adj.length < fullRoom.adj.length) {\r\n            const diff = fullRoom.adj.filter((num) => !room.adj.includes(num));\r\n            const tId = rng.getItem(diff);\r\n            if (tId != null) {\r\n              const target = mstGraph.get(tId);\r\n              target?.adj.push(id);\r\n              room.adj.push(tId);\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          console.log(\"no full room found\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nconst pruneLeafs = (\r\n  rng: typeof RNG,\r\n  maxDepth: number,\r\n  graph: ReturnType<typeof graphRooms>\r\n) => {\r\n  const queue = [];\r\n  let room: GraphNode, i: number, depth: number;\r\n  for ([i, room] of graph.entries()) {\r\n    if (room.adj.length === 1) {\r\n      queue.push([i, room, 0]);\r\n    }\r\n  }\r\n\r\n  let next: [number, GraphNode, number];\r\n  // eslint-disable-next-line no-cond-assign\r\n  while ((next = queue.pop())) {\r\n    [i, room, depth] = next;\r\n    graph.delete(i);\r\n    const adjRoom = graph.get(room.adj[0]);\r\n    if (adjRoom) {\r\n      adjRoom.adj = adjRoom.adj.filter((j) => j !== i);\r\n      if (adjRoom.adj.length === 1 && depth <= maxDepth) {\r\n        queue.push([room.adj[0], adjRoom, depth + 1]);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nconst raiseLeafs = (graph: ReturnType<typeof graphRooms>) => {\r\n  let room: GraphNode, i: number, depth: number;\r\n  for ([i, room] of graph.entries()) {\r\n    if (room.adj.length === 1) {\r\n      room.z = 2;\r\n    }\r\n  }\r\n};\r\n","export function shuffle<T>(list: T[]): T[] {\r\n  if (!list.length) {\r\n    return list;\r\n  }\r\n\r\n  let rSelection, temp;\r\n  let i = list.length;\r\n  while (--i) {\r\n    rSelection = Math.floor(Math.random() * (i + 1));\r\n    temp = list[i];\r\n    list[i] = list[rSelection];\r\n    list[rSelection] = temp;\r\n  }\r\n  return list;\r\n}\r\n\r\nexport function removeShuffled<T>(list: T[]): T | undefined {\r\n  let result, rSelection;\r\n\r\n  if (list.length) {\r\n    rSelection = (Math.random() * list.length) << 0;\r\n    if (rSelection === list.length - 1) {\r\n      return list.pop();\r\n    }\r\n    const temp = list.pop() as T;\r\n    result = list[rSelection];\r\n    list[rSelection] = temp;\r\n    return result;\r\n  }\r\n}\r\n\r\nexport function* shuffleGenerator<T>(list: T[]) {\r\n  if (!list.length) {\r\n    return;\r\n  }\r\n\r\n  let rSelection, next;\r\n  let i = list.length;\r\n  while (--i) {\r\n    rSelection = Math.floor(Math.random() * (i + 1));\r\n    if (rSelection >= list.length) {\r\n      console.log(\"hit it!\");\r\n    }\r\n    next = list[rSelection];\r\n    list[rSelection] = list[i];\r\n    list[i] = next;\r\n    yield next;\r\n  }\r\n  return;\r\n}\r\n","import { RNG } from \"rot-js\";\r\nimport { Bounds } from \"../../../engine/space/bounds\";\r\nimport { shuffle } from \"../../../lib/shuffle\";\r\nimport { ActorBreed } from \"../../actors/Actor\";\r\nimport { BreedTypes } from \"../../actors/breeds\";\r\nimport EntityManager from \"../../EntityManager\";\r\nimport { ItemTypes } from \"../../items/itemsTypes\";\r\nimport { GraphNode } from \"../graph/buildMinSpanTree\";\r\nimport { ShrineMap } from \"../ShrineMap\";\r\nimport { getRandomInBounds } from \"./placement\";\r\n\r\ntype SpawnOption = {\r\n  min: number;\r\n  max: number;\r\n  breed: ActorBreed;\r\n};\r\n\r\ntype Encounter = {\r\n  readonly cost: number;\r\n  readonly monsters: readonly SpawnOption[];\r\n  readonly iChance: number;\r\n};\r\n\r\nconst encounters: Record<string, Encounter> = {\r\n  none: {\r\n    cost: 0,\r\n    monsters: [],\r\n    iChance: 0.15,\r\n  },\r\n  faithlessBasic: {\r\n    cost: 1,\r\n    monsters: [{ min: 1, max: 2, breed: BreedTypes.faithless }],\r\n    iChance: 0.75,\r\n  },\r\n  faithlessDense: {\r\n    cost: 1,\r\n    monsters: [{ min: 2, max: 3, breed: BreedTypes.faithless }],\r\n    iChance: 1.0,\r\n  },\r\n  faithlessHeretic: {\r\n    cost: 2,\r\n    monsters: [\r\n      { min: 2, max: 2, breed: BreedTypes.heretic },\r\n      { min: 1, max: 1, breed: BreedTypes.faithless },\r\n    ],\r\n    iChance: 1.0,\r\n  },\r\n  simpleHeretic: {\r\n    cost: 2,\r\n    monsters: [{ min: 1, max: 2, breed: BreedTypes.heretic }],\r\n    iChance: 0.25,\r\n  },\r\n  defilerSimple: {\r\n    cost: 4,\r\n    monsters: [{ min: 1, max: 1, breed: BreedTypes.defiler }],\r\n    iChance: 0.5,\r\n  },\r\n  defilerDense: {\r\n    cost: 4,\r\n    monsters: [{ min: 2, max: 2, breed: BreedTypes.defiler }],\r\n    iChance: 0.5,\r\n  },\r\n  apostateSimple: {\r\n    cost: 4,\r\n    monsters: [{ min: 1, max: 1, breed: BreedTypes.apostate }],\r\n    iChance: 0.75,\r\n  },\r\n  apostateDefiler: {\r\n    cost: 4,\r\n    monsters: [\r\n      { min: 1, max: 1, breed: BreedTypes.defiler },\r\n      { min: 1, max: 1, breed: BreedTypes.apostate },\r\n    ],\r\n    iChance: 0.75,\r\n  },\r\n  apostateDense: {\r\n    cost: 4,\r\n    monsters: [{ min: 2, max: 2, breed: BreedTypes.apostate }],\r\n    iChance: 0.75,\r\n  },\r\n  simpleProphet: {\r\n    cost: 4,\r\n    monsters: [\r\n      { min: 1, max: 1, breed: BreedTypes.falseProphet },\r\n      { min: 2, max: 5, breed: BreedTypes.cultist },\r\n    ],\r\n    iChance: 1.0,\r\n  },\r\n} as const;\r\n\r\nconst depthWeights: Partial<{ [key in keyof typeof encounters]: number }>[] = [\r\n  {\r\n    none: 26,\r\n    faithlessBasic: 20,\r\n    faithlessDense: 5,\r\n  },\r\n  {\r\n    none: 40,\r\n    faithlessDense: 5,\r\n    hereticSimple: 10,\r\n    faithlessHeretic: 20,\r\n    defilerSimple: 5,\r\n  },\r\n  {\r\n    none: 40,\r\n    faithlessHeretic: 20,\r\n    defilerSimple: 20,\r\n    defilerDense: 2,\r\n    apostateSimple: 5,\r\n  },\r\n  {\r\n    none: 40,\r\n    faithlessHeretic: 15,\r\n    defilerSimple: 10,\r\n    defilerDense: 5,\r\n    apostateDefiler: 5,\r\n    apostateDense: 5,\r\n    simpleProphet: 5,\r\n  },\r\n  {\r\n    none: 18,\r\n    simpleProphet: 25,\r\n    defilerDense: 3,\r\n    apostateDefiler: 3,\r\n    apostateDense: 3,\r\n  },\r\n];\r\n\r\nexport const placeMonsters = (\r\n  rng: typeof RNG,\r\n  map: ShrineMap,\r\n  graph: Map<number, GraphNode>,\r\n  starting: Bounds\r\n) => {\r\n  let used = 0;\r\n  const spawnLocs: Record<number, boolean> = {};\r\n  let iType: string;\r\n  let quantity: number;\r\n\r\n  let iChoices = [];\r\n  for ([iType, quantity] of map.lootTable.entries()) {\r\n    for (let i = 0; i < quantity; i++) {\r\n      iChoices.push(iType);\r\n    }\r\n  }\r\n\r\n  iChoices = shuffle(iChoices);\r\n  console.log(depthWeights[map.depth - 1]);\r\n\r\n  for (const room of graph.values()) {\r\n    if (!room || room.bounds === starting) {\r\n      continue;\r\n    }\r\n    const encounterType = rng.getWeightedValue(\r\n      (depthWeights[map.depth - 1] ||\r\n        depthWeights[depthWeights.length - 1]) as any\r\n    ) as keyof typeof encounters;\r\n    if (encounterType) {\r\n      const encounter = encounters[encounterType];\r\n      if (encounter) {\r\n        used += encounter.cost;\r\n        encounter.monsters.forEach((spawn) => {\r\n          const total = rng.getUniformInt(spawn.min, spawn.max);\r\n          for (let i = 0; i < total; i++) {\r\n            for (let fail = 0; fail < 100; fail++) {\r\n              const pos = getRandomInBounds(rng, room.bounds);\r\n              if (!spawnLocs[pos.x + pos.y * map.width]) {\r\n                spawnLocs[pos.x + pos.y * map.width] = true;\r\n                EntityManager.createActor(spawn.breed, pos.x, pos.y);\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        });\r\n\r\n        //Item Spawn\r\n        if (iChoices.length && rng.getUniform() <= encounter.iChance) {\r\n          const pos = getRandomInBounds(rng, room.bounds);\r\n          EntityManager.createItem(ItemTypes[iChoices.pop()], pos.x, pos.y);\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n","import { RNG } from \"rot-js\";\r\nimport { Bounds } from \"../../../engine/space/bounds\";\r\n\r\nexport const getRandomInBounds = (rng: typeof RNG, bounds: Bounds) => {\r\n  return {\r\n    x: rng.getUniformInt(bounds.x + 1, bounds.x + bounds.w - 2),\r\n    y: rng.getUniformInt(bounds.y + 1, bounds.y + bounds.h - 2),\r\n  };\r\n};\r\n","import { RNG } from \"rot-js\";\r\nimport { Bounds } from \"../../../engine/space/bounds\";\r\nimport EntityManager from \"../../EntityManager\";\r\nimport { ItemTypes } from \"../../items/itemsTypes\";\r\nimport { GraphNode } from \"../graph/buildMinSpanTree\";\r\nimport { ShrineMap } from \"../ShrineMap\";\r\nimport { getRandomInBounds } from \"./placement\";\r\n\r\nexport const placeShrines = (\r\n  rng: typeof RNG,\r\n  map: ShrineMap,\r\n  graph: Map<number, GraphNode>\r\n) => {\r\n  let bestStart: Bounds | null = null;\r\n  let bestEnd: Bounds | null = null;\r\n  let room: GraphNode;\r\n\r\n  while (!bestStart || !bestEnd) {\r\n    const leftY = rng.getUniformInt(5, map.height - 5);\r\n    const rightY =\r\n      leftY < map.height / 2\r\n        ? rng.getUniformInt(Math.floor(map.height / 2), map.height - 5)\r\n        : rng.getUniformInt(5, Math.floor(map.height / 2));\r\n\r\n    for (room of graph.values()) {\r\n      if (room.bounds.y <= leftY && leftY <= room.bounds.y + room.bounds.h) {\r\n        if (!bestStart || room.bounds.x <= bestStart.x) {\r\n          bestStart = room.bounds;\r\n        }\r\n      }\r\n\r\n      if (room.bounds.y <= rightY && rightY <= room.bounds.y + room.bounds.h) {\r\n        if (!bestEnd || bestEnd.x <= room.bounds.x) {\r\n          bestEnd = room.bounds;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  const one = getRandomInBounds(rng, bestStart);\r\n  const two = getRandomInBounds(rng, bestEnd);\r\n  if (rng.getUniformInt(0, 1)) {\r\n    EntityManager.createItem(ItemTypes.oldFont, one.x, one.y);\r\n    EntityManager.createItem(ItemTypes.newFont, two.x, two.y);\r\n    return [one, bestStart] as const;\r\n  } else {\r\n    EntityManager.createItem(ItemTypes.newFont, one.x, one.y);\r\n    EntityManager.createItem(ItemTypes.oldFont, two.x, two.y);\r\n    return [two, bestEnd] as const;\r\n  }\r\n};\r\n","import { RNG } from \"rot-js\";\r\nimport { ItemTypes } from \"../../items/itemsTypes\";\r\nimport { ShrineMap } from \"../ShrineMap\";\r\n\r\nconst depthBudget = [10, 20, 20, 20, 20];\r\n\r\ntype ItemKeyTyping = keyof typeof ItemTypes;\r\nconst depthWeights: Partial<{ [key in ItemKeyTyping]: number }>[] = [\r\n  {\r\n    shears: 10,\r\n    knife: 5,\r\n    spade: 5,\r\n    mallet: 10,\r\n\r\n    staff: 10,\r\n    pitchfork: 10,\r\n    scythe: 1,\r\n\r\n    frock: 20,\r\n    bCoat: 20,\r\n    gambeson: 10,\r\n    curiass: 1,\r\n\r\n    buckler: 10,\r\n    barricade: 1,\r\n  },\r\n  {\r\n    shears: 5,\r\n    spade: 1,\r\n    knife: 10,\r\n    cleaver: 5,\r\n    mallet: 5,\r\n    needle: 5,\r\n    flail: 5,\r\n\r\n    staff: 5,\r\n    pitchfork: 5,\r\n    scythe: 5,\r\n    sledgehammer: 1,\r\n\r\n    frock: 10,\r\n    bCoat: 10,\r\n    gambeson: 20,\r\n    curiass: 10,\r\n    bouilli: 2,\r\n\r\n    buckler: 10,\r\n    barricade: 5,\r\n  },\r\n  {\r\n    shears: 1,\r\n    knife: 1,\r\n    cleaver: 10,\r\n    mallet: 1,\r\n    needle: 10,\r\n    flail: 10,\r\n\r\n    staff: 1,\r\n    pitchfork: 1,\r\n    scythe: 5,\r\n    sledgehammer: 10,\r\n\r\n    frock: 2,\r\n    bCoat: 2,\r\n    gambeson: 2,\r\n    curiass: 20,\r\n    bouilli: 20,\r\n\r\n    buckler: 2,\r\n    barricade: 20,\r\n  },\r\n  {\r\n    shears: 1,\r\n    knife: 1,\r\n    cleaver: 10,\r\n    mallet: 1,\r\n    needle: 10,\r\n    flail: 10,\r\n\r\n    staff: 1,\r\n    pitchfork: 1,\r\n    scythe: 5,\r\n    sledgehammer: 10,\r\n\r\n    frock: 2,\r\n    bCoat: 2,\r\n    gambeson: 10,\r\n    curiass: 20,\r\n    bouilli: 20,\r\n\r\n    buckler: 5,\r\n    barricade: 10,\r\n  },\r\n  {\r\n    shears: 1,\r\n    knife: 1,\r\n    cleaver: 10,\r\n    mallet: 1,\r\n    needle: 10,\r\n    flail: 10,\r\n\r\n    staff: 1,\r\n    pitchfork: 1,\r\n    scythe: 5,\r\n    sledgehammer: 10,\r\n\r\n    frock: 2,\r\n    bCoat: 2,\r\n    gambeson: 10,\r\n    curiass: 20,\r\n    bouilli: 20,\r\n\r\n    buckler: 5,\r\n    barricade: 10,\r\n  },\r\n];\r\n\r\nexport const generateLootTable = (rng: typeof RNG, map: ShrineMap) => {\r\n  for (let i = 0; i < depthBudget[map.depth - 1] || 0; i++) {\r\n    const itemType = rng.getWeightedValue(\r\n      depthWeights[0] as any\r\n    ) as ItemKeyTyping;\r\n    if (itemType) {\r\n      const cur = map.lootTable.get(itemType);\r\n      map.lootTable.set(itemType, (cur || 0) + 1);\r\n    }\r\n  }\r\n};\r\n","import { RNG } from \"rot-js\";\r\nimport { LevelMap, WorldTile } from \"../../engine/map/LevelMap\";\r\nimport { RNGGenerator } from \"../../lib/rng\";\r\nimport { AdjTypes, drawTile, FloorTypes } from \"./Map\";\r\nimport { generateLootTable } from \"./placement/ItemPlacement\";\r\n\r\nexport class ShrineMap extends LevelMap<FloorTypes, AdjTypes> {\r\n  lootTable: Map<string, number> = new Map();\r\n  hasGenerated = false;\r\n  constructor(\r\n    width: number,\r\n    height: number,\r\n    public rng: RNGGenerator,\r\n    public depth = 1\r\n  ) {\r\n    super(drawTile, width, height);\r\n  }\r\n\r\n  generate(rng: typeof RNG) {\r\n    if (!this.hasGenerated) {\r\n      generateLootTable(rng, this);\r\n    }\r\n    this.hasGenerated = true;\r\n    this.fillAll(\r\n      () =>\r\n        new WorldTile(FloorTypes.OOB, {\r\n          left: AdjTypes.OPEN,\r\n          up: AdjTypes.OPEN,\r\n          right: AdjTypes.OPEN,\r\n          down: AdjTypes.OPEN,\r\n        })\r\n    );\r\n  }\r\n}\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { ButtonComp } from \"../../../ui/input/Button\";\r\nimport { setScene } from \"../../../ui/scene\";\r\nimport { ALIGN_TYPE, TextType } from \"../../../ui/type/TextType\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\nimport { Main } from \"../../scenes/main\";\r\n\r\nexport const VictoryModal: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  C.handlers.keypress = (key: string) => {\r\n    if (key === \"Enter\") {\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  return [\r\n    createElement(\r\n      TextType,\r\n      { x: 1, y: 0, w: C.bounds.w - 2, h: 1 },\r\n      { title: \"Atonement\", align: ALIGN_TYPE.center }\r\n    ),\r\n    createElement(\r\n      TextType,\r\n      { x: 1, y: 1, w: C.bounds.w - 2, h: C.bounds.h - 2 },\r\n      {\r\n        title:\r\n          \"You have found peace among the ruins. As you make your final rest the world begins to stabilize around you.\",\r\n      }\r\n    ),\r\n    createElement(\r\n      TextType,\r\n      { x: 1, y: 8, w: C.bounds.w - 2, h: C.bounds.h - 2 },\r\n      {\r\n        title:\r\n          \"Thank you for playing, find me on Twitter @IAmSlogo or in the Roguelike Discord.\",\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 1, y: C.bounds.h - 2, w: C.bounds.w - 2, h: 1 },\r\n      {\r\n        title: \"(Enter) End Game\",\r\n        keys: [\"Escape\", \"Enter\"],\r\n        onClick: () => {\r\n          closeModal();\r\n          setScene(new Main());\r\n        },\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import Colors from \"../Colors\";\r\n\r\nconst baseWeapon = {\r\n  displayPriority: 10,\r\n  glyph: {\r\n    fg: Colors.B_GREY_4,\r\n    ch: \"}\",\r\n  },\r\n};\r\n\r\nexport const shields = {\r\n  bLid: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Barrel Lid\",\r\n      info:\r\n        \"Blocks stability can leave you staggered if you block too many attacks.\",\r\n      description:\r\n        \"One leather strap poorly latched to the wood is all it takes to make a shield.\",\r\n      logName: \"B. Lid\",\r\n    },\r\n    stats: {\r\n      weight: 2,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        blocks: 0.65,\r\n        stability: 80,\r\n        stamina: 0,\r\n        strength: 1,\r\n      },\r\n      twohanded: {\r\n        blocks: 0.65,\r\n        stability: 80,\r\n        stamina: 0,\r\n        strength: 1,\r\n      },\r\n    },\r\n  },\r\n  buckler: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Ornamental Buckler\",\r\n      info: \"A modest stability makes for an effective block.\",\r\n      description:\r\n        \"The church has turned a blind eye to these defensive instruments. Perhaps because many feature religious symbolism.\",\r\n      logName: \"Buckler\",\r\n    },\r\n    stats: {\r\n      weight: 6,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        blocks: 0.8,\r\n        stability: 90,\r\n        stamina: 0,\r\n        strength: 2,\r\n      },\r\n      twohanded: {\r\n        blocks: 0.8,\r\n        stability: 90,\r\n        stamina: 0,\r\n        strength: 1,\r\n      },\r\n    },\r\n  },\r\n  barricade: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Fortified Barricade\",\r\n      info: \"Total defense but heavy as a house.\",\r\n      description:\r\n        \"Unclear if any single person should even be carrying this around alone.\",\r\n      logName: \"Barricade\",\r\n    },\r\n    stats: {\r\n      weight: 14,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        blocks: 0.5,\r\n        stability: 95,\r\n        stamina: 0,\r\n        strength: 6,\r\n      },\r\n      twohanded: {\r\n        blocks: 0.95,\r\n        stability: 95,\r\n        stamina: 0,\r\n        strength: 3,\r\n      },\r\n    },\r\n  },\r\n} as const;\r\n","import Colors from \"../Colors\";\r\n\r\nconst baseWeapon = {\r\n  displayPriority: 10,\r\n  glyph: {\r\n    fg: Colors.B_GREY_4,\r\n    ch: \"%\",\r\n  },\r\n};\r\n\r\nexport const weapons = {\r\n  needle: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Large Steel Sowing Needle\",\r\n      info: \"Swift and deadly, but offers no poise damage\",\r\n      description:\r\n        \"The chipping paint was once used to conceal the item's material. Far deadlier than a permitted wooden needle.\",\r\n      logName: \"Needle\",\r\n    },\r\n    stats: {\r\n      weight: 1,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 1,\r\n        stamina: 10,\r\n        poise: 0,\r\n        damage: 18,\r\n      },\r\n      twohanded: {\r\n        strength: 1,\r\n        stamina: 20,\r\n        poise: 4,\r\n        damage: 18,\r\n      },\r\n    },\r\n  },\r\n  shears: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Halfshears\",\r\n      info:\r\n        \"A strong slash, but the crude craftsmanship makes it clumsy to wield\",\r\n      description:\r\n        \"One half of a hand shear, rusted over then crudely sharpened. A favorite of brigands who could arm two by splitting the shears.\",\r\n      logName: \"Halfshears\",\r\n    },\r\n    stats: {\r\n      weight: 2,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 2,\r\n        stamina: 30,\r\n        poise: 10,\r\n        damage: 17,\r\n      },\r\n      twohanded: {\r\n        strength: 1,\r\n        stamina: 20,\r\n        poise: 10,\r\n        damage: 17,\r\n      },\r\n    },\r\n  },\r\n  knife: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Kitchen knife\",\r\n      info: \"Well balanced and serviceable weapon\",\r\n      description:\r\n        \"A long kitchen knife. Blacksmiths supplying these knives undergo strict watch by the church's guards to comply with size limits.\",\r\n      logName: \"Knife\",\r\n    },\r\n    stats: {\r\n      weight: 4,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 3,\r\n        stamina: 25,\r\n        poise: 10,\r\n        damage: 22,\r\n      },\r\n      twohanded: {\r\n        strength: 1,\r\n        stamina: 25,\r\n        poise: 15,\r\n        damage: 22,\r\n      },\r\n    },\r\n  },\r\n  cleaver: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Butcher's Cleaver\",\r\n      info: \"Hard hitting and versitile, but requires a lot of stamina.\",\r\n      description:\r\n        'Despite strict licensing ineveitably butcher cleaver\\'s go \"missing\" and wind up in the wrong hands.',\r\n      logName: \"Cleaver\",\r\n    },\r\n    stats: {\r\n      weight: 5,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 4,\r\n        stamina: 30,\r\n        poise: 20,\r\n        damage: 26,\r\n      },\r\n      twohanded: {\r\n        strength: 2,\r\n        stamina: 30,\r\n        poise: 20,\r\n        damage: 32,\r\n      },\r\n    },\r\n  },\r\n  spade: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Digging Spade\",\r\n      info: \"A decent punch, but unwieldy and heavy\",\r\n      description:\r\n        \"Garden tools are a common choice for a weapon when one has no other choice.\",\r\n      logName: \"Spade\",\r\n    },\r\n    stats: {\r\n      weight: 7,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 1,\r\n        stamina: 30,\r\n        poise: 15,\r\n        damage: 14,\r\n      },\r\n      twohanded: {\r\n        strength: 1,\r\n        stamina: 30,\r\n        poise: 20,\r\n        damage: 20,\r\n      },\r\n    },\r\n  },\r\n  mallet: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Wooden Mallet\",\r\n      info: \"A good swing that can stagger enemies easily.\",\r\n      description:\r\n        \"Common among carpenters, these mallets are easy to find and difficult to control the supply of.\",\r\n      logName: \"Mallet\",\r\n    },\r\n    stats: {\r\n      weight: 4,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 2,\r\n        stamina: 25,\r\n        poise: 25,\r\n        damage: 16,\r\n      },\r\n      twohanded: {\r\n        strength: 1,\r\n        stamina: 25,\r\n        poise: 25,\r\n        damage: 16,\r\n      },\r\n    },\r\n  },\r\n  flail: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Threshing Flail\",\r\n      info: \"A heavy strong blow that can rival metal weapons\",\r\n      description:\r\n        \"Commonly used the thresh wheat, these tools are deadly when swung with a good strong blow\",\r\n      logName: \"Flail\",\r\n    },\r\n    stats: {\r\n      weight: 8,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 4,\r\n        stamina: 40,\r\n        poise: 30,\r\n        damage: 28,\r\n      },\r\n      twohanded: {\r\n        strength: 2,\r\n        stamina: 40,\r\n        poise: 30,\r\n        damage: 28,\r\n      },\r\n    },\r\n  },\r\n  staff: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Wooden Staff\",\r\n      info: \"Quick to strike and easy to stagger a foe.\",\r\n      description:\r\n        \"Often concealed as a walking stick, when carried it's important to know which guard will give you trouble over its length.\",\r\n      logName: \"Staff\",\r\n    },\r\n    stats: {\r\n      weight: 8,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 6,\r\n        stamina: 25,\r\n        poise: 30,\r\n        damage: 26,\r\n      },\r\n      twohanded: {\r\n        strength: 3,\r\n        stamina: 25,\r\n        poise: 30,\r\n        damage: 26,\r\n      },\r\n    },\r\n  },\r\n  pitchfork: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Three Pronged Pitchfork\",\r\n      info: \"High stabbing damage, but not as much impact in the strike.\",\r\n      description:\r\n        \"Symbology of the pitchfork is banned after the three pronged rebellion of 712cs, but the tool itself is still permitted for farming.\",\r\n      logName: \"Pitchfork\",\r\n    },\r\n    stats: {\r\n      weight: 10,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 6,\r\n        stamina: 30,\r\n        poise: 15,\r\n        damage: 44,\r\n      },\r\n      twohanded: {\r\n        strength: 3,\r\n        stamina: 30,\r\n        poise: 15,\r\n        damage: 44,\r\n      },\r\n    },\r\n  },\r\n  scythe: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Scythe\",\r\n      info: \"Deadly and sharp, but requires great effort to swing.\",\r\n      description:\r\n        \"Not as effective as a purpose built polearm, but the blade has been repositioned for ease of use\",\r\n      logName: \"Scythe\",\r\n    },\r\n    stats: {\r\n      weight: 14,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 8,\r\n        stamina: 40,\r\n        poise: 30,\r\n        damage: 70,\r\n      },\r\n      twohanded: {\r\n        strength: 4,\r\n        stamina: 40,\r\n        poise: 30,\r\n        damage: 70,\r\n      },\r\n    },\r\n  },\r\n  sledgehammer: {\r\n    ...baseWeapon,\r\n    text: {\r\n      name: \"Sledgehammer\",\r\n      info: \"Crush any enemy in a single blow, if you can swing it.\",\r\n      description:\r\n        \"Only used in earnest as a show of force, the few that can wield a sledgehammer in combat strike fear in their foes.\",\r\n      logName: \"Sledgehammer\",\r\n    },\r\n    stats: {\r\n      weight: 20,\r\n    },\r\n    attacks: {\r\n      onehanded: {\r\n        strength: 12,\r\n        stamina: 60,\r\n        poise: 60,\r\n        damage: 160,\r\n      },\r\n      twohanded: {\r\n        strength: 6,\r\n        stamina: 60,\r\n        poise: 60,\r\n        damage: 160,\r\n      },\r\n    },\r\n  },\r\n} as const;\r\n","import { armors } from \"./armorTypes\";\r\nimport { consumables } from \"./consumableTypes\";\r\nimport { furniture } from \"./furnitureTypes\";\r\nimport { ItemBreed } from \"./Item\";\r\nimport { shields } from \"./shieldTypes\";\r\nimport { weapons } from \"./weaponTypes\";\r\n\r\nexport const items = {\r\n  ...armors,\r\n  ...weapons,\r\n  ...furniture,\r\n  ...consumables,\r\n  ...shields,\r\n} as const;\r\n\r\nexport const ItemTypes = Object.entries(items).reduce((r, [key, value]) => {\r\n  r[key as keyof typeof items] = new ItemBreed(key, value);\r\n  return r;\r\n}, {} as Record<keyof typeof items, ItemBreed>);\r\n","import { Bounds } from \"../engine/space/bounds\";\r\nimport { RDisplay } from \"../ui/RotDisplay\";\r\nimport { gameData } from \"./GameManager\";\r\nimport { Item, ItemBreed } from \"./items/Item\";\r\nimport { Actor, ActorBreed } from \"./actors/Actor\";\r\nimport { Entity } from \"../engine/entity/Entity\";\r\nimport { ItemTypes } from \"./items/itemsTypes\";\r\nimport { ActionSpeed } from \"./actions/Action\";\r\n\r\nclass EntityManager {\r\n  private id = 1;\r\n\r\n  private getId() {\r\n    const r = this.id;\r\n    this.id += 1;\r\n    return r;\r\n  }\r\n\r\n  resetIds() {\r\n    this.id = 1;\r\n  }\r\n\r\n  addActorChildren(actor: Actor) {\r\n    const breed = actor.breed;\r\n    if (breed.defaultWielding) {\r\n      if (breed.defaultWielding.left) {\r\n        actor.wielding.left = this.createItem(\r\n          ItemTypes[breed.defaultWielding.left as keyof typeof ItemTypes]\r\n        );\r\n        actor.wielding.left.everHeld = true;\r\n        actor.wielding.left.applyStats(actor, true);\r\n      }\r\n      if (breed.defaultWielding.right) {\r\n        actor.wielding.right = this.createItem(\r\n          ItemTypes[breed.defaultWielding.right as keyof typeof ItemTypes]\r\n        );\r\n        actor.wielding.right.everHeld = true;\r\n        actor.wielding.right.applyStats(actor, true);\r\n      }\r\n      if (breed.defaultWielding.mode) {\r\n        actor.wielding.mode =\r\n          breed.defaultWielding.mode || breed.defaultWielding.mode;\r\n      }\r\n    }\r\n\r\n    if (breed.defaultWearing) {\r\n      if (breed.defaultWearing.armor) {\r\n        actor.wearing.armor = this.createItem(\r\n          ItemTypes[breed.defaultWearing.armor as keyof typeof ItemTypes]\r\n        );\r\n        actor.wearing.armor.everHeld = true;\r\n        actor.wearing.armor.applyStats(actor, true);\r\n      }\r\n    }\r\n    breed.defaultContains &&\r\n      breed.defaultContains.forEach(([type, quantity]) => {\r\n        const containing = this.createItem(\r\n          ItemTypes[type as keyof typeof ItemTypes]\r\n        );\r\n        containing.everHeld = true;\r\n        actor.contains.add(containing.id, containing);\r\n      });\r\n  }\r\n\r\n  createActor(breed: ActorBreed, x?: number, y?: number) {\r\n    const newId = this.getId();\r\n    const actor = new Actor(newId, breed, x, y);\r\n    if (x != null || y != null) {\r\n      gameData.actors.add(newId, actor);\r\n    }\r\n\r\n    this.addActorChildren(actor);\r\n\r\n    return actor;\r\n  }\r\n\r\n  createItem(breed: ItemBreed, x?: number, y?: number) {\r\n    const newId = this.getId();\r\n    const actor = new Item(newId, breed, x, y);\r\n    if (x != null || y != null) {\r\n      gameData.items.add(newId, actor);\r\n    }\r\n    return actor;\r\n  }\r\n\r\n  drawEntities = (display: RDisplay, bounds: Bounds, view: Bounds) => {\r\n    const result: Record<number, [Entity<any>, boolean]> = {};\r\n    let existing, pos;\r\n\r\n    gameData.items.forEach((item) => {\r\n      if (\r\n        item.x < view.x ||\r\n        view.x + view.w <= item.x ||\r\n        item.y < view.y ||\r\n        view.y + view.h <= item.y\r\n      ) {\r\n        return;\r\n      }\r\n      pos = item.x + item.y * gameData.current.width;\r\n      if (!gameData.seeAll && !gameData.fov.has(pos)) {\r\n        return;\r\n      }\r\n      existing = result[pos];\r\n      if (existing) {\r\n        existing[1] = true;\r\n        if (existing[0].breed.displayPriority < item.breed.displayPriority) {\r\n          existing[0] = item;\r\n        }\r\n      } else {\r\n        result[pos] = [item, false];\r\n      }\r\n    });\r\n\r\n    gameData.actors.forEach((actor) => {\r\n      if (\r\n        actor.x < view.x ||\r\n        view.x + view.w <= actor.x ||\r\n        actor.y < view.y ||\r\n        view.y + view.h <= actor.y\r\n      ) {\r\n        return;\r\n      }\r\n      pos = actor.x + actor.y * gameData.current.width;\r\n      existing = result[pos];\r\n      if (!gameData.seeAll && !gameData.fov.has(pos)) {\r\n        return;\r\n      }\r\n      if (existing) {\r\n        existing[1] = true;\r\n        if (existing[0].breed.displayPriority < actor.breed.displayPriority) {\r\n          existing[0] = actor;\r\n        }\r\n      } else {\r\n        result[pos] = [actor, false];\r\n      }\r\n    });\r\n\r\n    Object.values(result).forEach(([actor]) => {\r\n      display.drawAppend(\r\n        actor.x + bounds.x - view.x,\r\n        actor.y + bounds.y - view.y,\r\n        actor.breed.ch,\r\n        actor.breed.fg,\r\n        actor.breed.bg || \"transparent\"\r\n      );\r\n    });\r\n  };\r\n\r\n  actorPlan() {\r\n    gameData.actors.forEach((a) => {\r\n      const action = a.plan();\r\n      if (action) {\r\n        switch (action.speed) {\r\n          case ActionSpeed.FAST:\r\n            gameData.quickActionQueue.unshift(action);\r\n            break;\r\n          case ActionSpeed.MEDIUM:\r\n            gameData.actionQueue.unshift(action);\r\n            break;\r\n          case ActionSpeed.SLOW:\r\n            gameData.slowActionQueue.unshift(action);\r\n            break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  actorReplan(a: Actor) {\r\n    const action = a.plan();\r\n    if (action) {\r\n      //This action always goes into slow so it's done this turn\r\n      gameData.slowActionQueue.push(action);\r\n    }\r\n  }\r\n}\r\n\r\nexport default new EntityManager();\r\n","import { CheckMovement } from \"../map/Movement\";\r\nimport { Point } from \"../../engine/space/bounds\";\r\nimport {\r\n  Directions,\r\n  getDirectionTowards,\r\n  getInDirection,\r\n} from \"../../engine/space/directions\";\r\nimport { Actor, Encumbrance } from \"../actors/Actor\";\r\nimport { findActorForPosition, gameData } from \"../GameManager\";\r\nimport { GibManager } from \"../anims/particleSystem\";\r\nimport { FootstepParticle } from \"../anims/particles/FootstepParticle\";\r\nimport { getActorWeight, getWeightLevel, hasStrength } from \"../items/formulas\";\r\nimport EntityManager from \"../EntityManager\";\r\nimport {\r\n  bestMoveTowardsPlayer,\r\n  getAdjacentToPlayer,\r\n} from \"../actors/controllers/aiHelpers\";\r\nimport { createDMap } from \"../../lib/dMap\";\r\nimport { moveIn } from \"../map/Pathfinding\";\r\nimport { attackTowards } from \"./ActionAttacks\";\r\nimport { getActiveAttack } from \"../actors/weaponHelper\";\r\n\r\nexport const wait = (actor: Actor) => {\r\n  actor.status.waited = true;\r\n  return { valid: true };\r\n};\r\n\r\nexport const sprintTowards = (actor: Actor, options: { dir: Directions }) => {\r\n  const weightLevel = getWeightLevel(\r\n    getActorWeight(actor),\r\n    actor.attributes.weight\r\n  );\r\n\r\n  if (weightLevel === Encumbrance.HEAVY) {\r\n    return { valid: false };\r\n  }\r\n\r\n  actor.stamina.change(weightLevel === Encumbrance.LIGHT ? -15 : -30);\r\n  moveTowards(actor, options);\r\n\r\n  const { x, y } = getInDirection(actor, options.dir);\r\n  if (findActorForPosition(x, y)) {\r\n    if (weightLevel === Encumbrance.LIGHT) {\r\n      const attack = getActiveAttack(actor);\r\n      if (\r\n        attack.stamina <= actor.stamina.current &&\r\n        hasStrength(actor, attack)\r\n      ) {\r\n        attackTowards(actor, options);\r\n      }\r\n    }\r\n  } else {\r\n    moveTowards(actor, options);\r\n  }\r\n  actor.status.sprinted = true;\r\n\r\n  return { valid: true };\r\n};\r\n\r\nexport const moveTo = (actor: Actor, options: { target: Point }) => {\r\n  const dir = getDirectionTowards(actor, options.target);\r\n  return moveTowards(actor, { dir });\r\n};\r\n\r\nexport const moveTowards = (actor: Actor, options: { dir: Directions }) => {\r\n  const tile =\r\n    gameData.current.tiles[actor.x + actor.y * gameData.current.width];\r\n  if (!CheckMovement[options.dir](tile)) {\r\n    return { valid: false };\r\n  }\r\n  const { x, y } = getInDirection(actor, options.dir);\r\n\r\n  const playerWeight = getWeightLevel(\r\n    getActorWeight(gameData.player),\r\n    gameData.player.attributes.weight\r\n  );\r\n\r\n  if (playerWeight !== Encumbrance.LIGHT && actor !== gameData.player) {\r\n    const [target, at] = bestMoveTowardsPlayer(actor);\r\n    if (\r\n      !actor.status.replanned &&\r\n      gameData.player.status.moved &&\r\n      at &&\r\n      at === gameData.player\r\n    ) {\r\n      actor.status.replanned = true;\r\n      EntityManager.actorReplan(actor);\r\n      return { valid: true };\r\n    }\r\n  }\r\n\r\n  if (!findActorForPosition(x, y)) {\r\n    GibManager.runThenDestroy(FootstepParticle, actor.x, actor.y);\r\n    actor.x = x;\r\n    actor.y = y;\r\n  }\r\n  if (playerWeight !== Encumbrance.LIGHT && actor === gameData.player) {\r\n    gameData.dMapPlayer = createDMap([actor], moveIn, 5); //Small dMap, only used for adjacency checks\r\n  }\r\n  actor.status.moved = true;\r\n  return { valid: true };\r\n};\r\n","import { Point } from \"../../engine/space/bounds\";\r\nimport {\r\n  allDirections,\r\n  genAllDirections,\r\n  getInDirection,\r\n} from \"../../engine/space/directions\";\r\n\r\nconst KEY_N = 10000;\r\n\r\nexport class DMap {\r\n  map: { [key: number]: number };\r\n\r\n  constructor(map: { [key: number]: number }) {\r\n    this.map = map;\r\n  }\r\n\r\n  get(pos: Point) {\r\n    return this.map[pos.x * KEY_N + pos.y];\r\n  }\r\n\r\n  getLowestAdjacent(\r\n    pos: Point,\r\n    openness: (pos: Point, from: Point) => boolean\r\n  ) {\r\n    let lowest: Point[] = [],\r\n      nextValue;\r\n    let lowValue = Number.MAX_SAFE_INTEGER;\r\n    for (const next of genAllDirections(pos)) {\r\n      nextValue = this.get(next);\r\n      if (nextValue < lowValue && openness(next, pos)) {\r\n        lowValue = nextValue;\r\n        lowest = [next];\r\n      } else if (nextValue === lowValue) {\r\n        lowest.push(next);\r\n      }\r\n    }\r\n    return lowest;\r\n  }\r\n\r\n  getHighestAdjacent(\r\n    pos: Point,\r\n    openness: (pos: Point, from: Point) => boolean\r\n  ) {\r\n    let highest: Point[] = [],\r\n      nextValue;\r\n    let highValue = Number.MAX_SAFE_INTEGER;\r\n    for (const next of genAllDirections(pos)) {\r\n      nextValue = this.get(next);\r\n      if (highValue < nextValue && openness(next, pos)) {\r\n        highValue = nextValue;\r\n        highest = [next];\r\n      } else if (nextValue === highValue) {\r\n        highest.push(next);\r\n      }\r\n    }\r\n    return highest;\r\n  }\r\n\r\n  getSortedAdjacent(\r\n    pos: Point,\r\n    openness: (pos: Point, from: Point) => boolean\r\n  ) {\r\n    const result: Point[] = [];\r\n    for (const next of genAllDirections(pos)) {\r\n      if (openness(next, pos)) {\r\n        result.push(next);\r\n      }\r\n    }\r\n    return result.sort((a, b) => {\r\n      const av = this.get(a);\r\n      const bv = this.get(b);\r\n      return av == null ? 1 : bv == null ? -1 : av - bv;\r\n    });\r\n  }\r\n}\r\n\r\nexport function createDMap(\r\n  goals: Point[],\r\n  openCallback: (pos: Point, from: Point) => boolean,\r\n  max = 50\r\n) {\r\n  const result: { [key: number]: number } = {};\r\n\r\n  const queue: Array<{ position: Point; weight: number }> = [];\r\n  for (const goal of goals) {\r\n    result[goal.x * KEY_N + goal.y] = 0;\r\n    queue.push({ position: goal, weight: 0 });\r\n  }\r\n\r\n  let next;\r\n  while (queue.length) {\r\n    const { position, weight } = queue.shift()!;\r\n    if (weight < max) {\r\n      allDirections.forEach((dir) => {\r\n        next = getInDirection(position, dir);\r\n        if (\r\n          openCallback(next, position) &&\r\n          result[next.x * KEY_N + next.y] == null\r\n        ) {\r\n          result[next.x * KEY_N + next.y] = weight + 1;\r\n          queue.push({ position: next, weight: weight + 1 });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  return new DMap(result);\r\n}\r\n","import {\r\n  awaitAnimate,\r\n  Particle,\r\n  ParticleModes,\r\n} from \"../../../engine/anims/Particle\";\r\n\r\nexport const LookParticle = {\r\n  mode: ParticleModes.DRAW_OVER_LAST,\r\n  char: null,\r\n  fg: null,\r\n  bg: \"rgba(100, 100, 200, 0.75)\",\r\n  animate: async (particle: Particle<void>) => {\r\n    // eslint-disable-next-line no-constant-condition\r\n    while (true) {\r\n      await awaitAnimate({\r\n        driver: particle.driver,\r\n        from: \"rgba(100, 100, 200, 0.75)\",\r\n        to: \"rgba(125, 125, 225, 0.75)\",\r\n        duration: 1000,\r\n        onUpdate: (latest) => {\r\n          particle.bg = latest;\r\n        },\r\n      });\r\n\r\n      await awaitAnimate({\r\n        driver: particle.driver,\r\n        from: \"rgba(125, 125, 225, 0.75)\",\r\n        to: \"rgba(100, 100, 200, 0.75)\",\r\n        duration: 1000,\r\n        onUpdate: (latest) => {\r\n          particle.bg = latest;\r\n        },\r\n      });\r\n    }\r\n  },\r\n};\r\n","import { closeModal, openModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { ButtonComp } from \"../../../ui/input/Button\";\r\nimport { TextType } from \"../../../ui/type/TextType\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\nimport { PlayerPosition } from \"./PlayerPosition\";\r\nimport { LevelModal } from \"../level/LevelModal\";\r\n\r\nexport const CheatModal: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  return [\r\n    createElement(\r\n      TextType,\r\n      { x: 0, y: 0, w: 24, h: 1 },\r\n      { title: \"Cheat Menu Options\" }\r\n    ),\r\n    createElement(PlayerPosition, { x: 0, y: 1, w: 40, h: 1 }),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 2, y: 14, w: 6, h: 1 },\r\n      {\r\n        title: \"Level\",\r\n        onClick: () => {\r\n          closeModal();\r\n          openModal(\r\n            createElement(LevelModal, { x: 0, y: 0, w: 48, h: 24 }, {})\r\n          );\r\n        },\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 2, y: 16, w: 6, h: 1 },\r\n      { title: \"Close\", onClick: () => closeModal() }\r\n    ),\r\n  ];\r\n};\r\n","import { ComponentF } from \"../ui\";\r\n\r\nexport const Input: ComponentF<{\r\n  initialValue: string;\r\n  onSubmit: (value: string) => void;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({ entry: props.initialValue });\r\n  C.display.drawText(C.bounds.x, C.bounds.y, state.entry);\r\n  C.handlers.keypress = (key) => {\r\n    if (key === \"Delete\" || key === \"Backspace\") {\r\n      setState({ entry: state.entry.substr(0, state.entry.length - 1) });\r\n    } else if (key === \"Enter\") {\r\n      props.onSubmit(state.entry);\r\n    } else if (key.length === 1) {\r\n      setState({ entry: state.entry + key });\r\n    } else {\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n};\r\n","import { closeModal, openModal } from \"../containers/Modal\";\r\nimport { TextType } from \"../type/TextType\";\r\nimport { ComponentF, createElement } from \"../ui\";\r\nimport { Input } from \"./Input\";\r\n\r\nexport const InputPrompt: ComponentF<{\r\n  title: string;\r\n  initial: string;\r\n  onSubmit: (value: string) => void;\r\n}> = (C, props) => {\r\n  return [\r\n    createElement(\r\n      TextType,\r\n      { x: 0, y: 0, h: 1, w: 24 },\r\n      { title: props.title }\r\n    ),\r\n    createElement(\r\n      Input,\r\n      { x: 0, y: 1, h: 1, w: 24 },\r\n      {\r\n        initialValue: props.initial || \"\",\r\n        onSubmit: (value: string) => {\r\n          closeModal();\r\n          props.onSubmit(value);\r\n        },\r\n      }\r\n    ),\r\n  ];\r\n};\r\n\r\nexport const promptInput = (options: {\r\n  title: string;\r\n  initial?: string;\r\n  onSubmit: (value: string) => void;\r\n}) => {\r\n  openModal(createElement(InputPrompt, { x: 0, y: 0, h: 3, w: 24 }, options));\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { ButtonComp } from \"../../../ui/input/Button\";\r\nimport { promptInput } from \"../../../ui/input/PromptInput\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport { gameData } from \"../../GameManager\";\r\n\r\nexport const PlayerPosition: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({ x: 0, y: 0 });\r\n\r\n  return [\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 0, w: 6, h: 1 },\r\n      {\r\n        title: `X: ${state.x}`,\r\n        onClick: () =>\r\n          promptInput({\r\n            title: \"X\",\r\n            initial: state.x,\r\n            onSubmit: (v) => setState({ x: parseInt(v) }),\r\n          }),\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 8, y: 0, w: 6, h: 1 },\r\n      {\r\n        title: `Y: ${state.y}`,\r\n        onClick: () =>\r\n          promptInput({\r\n            title: \"Y\",\r\n            initial: state.y,\r\n            onSubmit: (v) => setState({ y: parseInt(v) }),\r\n          }),\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 34, y: 0, w: 6, h: 1 },\r\n      {\r\n        title: \"Move\",\r\n        onClick: () => {\r\n          gameData.player.x = state.x;\r\n          gameData.player.y = state.y;\r\n          closeModal();\r\n        },\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { ComponentF } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\nimport { gameData } from \"../../GameManager\";\r\nimport { isDownKey, isUpKey } from \"../keyHelper\";\r\n\r\nconst levelOptions = [\r\n  {\r\n    title: \"Health (+20)\",\r\n    description: \"How much punishment you can take\",\r\n    apply: () => {\r\n      gameData.player.level = gameData.player.level + 1;\r\n      gameData.player.health.adjustMax(20, false);\r\n    },\r\n  },\r\n  {\r\n    title: \"Stamina (+20)\",\r\n    description: \"How much you can do before tiring\",\r\n    apply: () => {\r\n      gameData.player.level = gameData.player.level + 1;\r\n      gameData.player.stamina.adjustMax(20);\r\n    },\r\n  },\r\n  {\r\n    title: \"Max Weight (+5)\",\r\n    description: \"How much equipment load you can wear\",\r\n    apply: () => {\r\n      gameData.player.level = gameData.player.level + 1;\r\n      gameData.player.attributes.weight = gameData.player.attributes.weight + 5;\r\n    },\r\n  },\r\n  {\r\n    title: \"Force (+1)\",\r\n    description: \"How impactful your blows are\",\r\n    apply: () => {\r\n      gameData.player.level = gameData.player.level + 1;\r\n      gameData.player.attributes.force = gameData.player.attributes.force + 1;\r\n    },\r\n  },\r\n\r\n  {\r\n    title: \"Strength (+1)\",\r\n    description: \"How big a weapon you can wield\",\r\n    apply: () => {\r\n      gameData.player.level = gameData.player.level + 1;\r\n      gameData.player.attributes.strength =\r\n        gameData.player.attributes.strength + 1;\r\n    },\r\n  },\r\n];\r\nexport const LevelModal: ComponentF<{\r\n  title: string;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({\r\n    selected: 0,\r\n  });\r\n\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  let y = C.bounds.y;\r\n  C.display.drawText(C.bounds.x, y, \"Level Up\");\r\n  y += 1;\r\n  C.display.drawText(C.bounds.x, y, \"Select a stat to improve\");\r\n  y += 2;\r\n\r\n  levelOptions.forEach((opt, index) => {\r\n    let color = Colors.B_GREY_3;\r\n    let subColor = Colors.B_GREY_2;\r\n    if (state.selected === index) {\r\n      color = Colors.B_GREY_5;\r\n      subColor = Colors.B_GREY_4;\r\n      C.display.drawText(C.bounds.x, y, \">\");\r\n    }\r\n    C.display.drawText(C.bounds.x + 1, y, `%c{${color}}${opt.title}`);\r\n    y += 1;\r\n    C.display.drawText(C.bounds.x + 2, y, `%c{${subColor}}${opt.description}`);\r\n    y += 2;\r\n  });\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + C.bounds.h - 1,\r\n    `%c{${Colors.RED_4}} Enter %c{}Confirm %c{${Colors.RED_4}}Esc%c{} Cancel`\r\n  );\r\n\r\n  C.handlers.keypress = (key: string) => {\r\n    if (isUpKey(key) && 0 < state.selected) {\r\n      setState({ selected: state.selected - 1 });\r\n    } else if (isDownKey(key) && state.selected < levelOptions.length - 1) {\r\n      setState({ selected: state.selected + 1 });\r\n    } else if (key === \"Enter\") {\r\n      levelOptions[state.selected].apply();\r\n      closeModal();\r\n      return true;\r\n    } else if (key === \"Escape\") {\r\n      closeModal();\r\n      return true;\r\n    }\r\n    return true;\r\n  };\r\n};\r\n","export const isUpKey = (key: string) =>\r\n  key === \"ArrowUp\" || key === \"w\" || key === \"k\";\r\n\r\nexport const isRightKey = (key: string) =>\r\n  key === \"ArrowRight\" || key === \"d\" || key === \"l\";\r\n\r\nexport const isLeftKey = (key: string) =>\r\n  key === \"ArrowLeft\" || key === \"a\" || key === \"h\";\r\n\r\nexport const isDownKey = (key: string) =>\r\n  key === \"ArrowDown\" || key === \"s\" || key === \"j\";\r\n","import { RNG } from \"rot-js\";\r\n\r\nexport class RNGGenerator {\r\n  private rng: typeof RNG;\r\n\r\n  constructor(seed: number) {\r\n    this.rng = RNG.clone().setSeed(seed);\r\n  }\r\n\r\n  getRNG() {\r\n    return RNG.clone().setSeed(this.rng.getUniform());\r\n  }\r\n\r\n  getGenerator() {\r\n    return new RNGGenerator(this.rng.getUniform());\r\n  }\r\n}\r\n","import { Particle } from \"../engine/anims/Particle\";\r\nimport { DMap } from \"../lib/dMap/dMap\";\r\nimport { RNGGenerator } from \"../lib/rng\";\r\nimport { SparseMap } from \"../lib/sparseMap\";\r\nimport { Action } from \"./actions/Action\";\r\nimport { Actor, ActorBreed } from \"./actors/Actor\";\r\nimport { Item } from \"./items/Item\";\r\n\r\nimport { ShrineMap } from \"./map/ShrineMap\";\r\n\r\nexport const buildState = (seed?: number) => {\r\n  const seedRng = new RNGGenerator(seed || Date.now());\r\n  const level = new ShrineMap(25, 25, seedRng.getGenerator());\r\n\r\n  return {\r\n    seedRng,\r\n    current: level,\r\n    actors: new SparseMap<Actor>(),\r\n    items: new SparseMap<Item>(),\r\n    gibs: new SparseMap<Particle<any>>(),\r\n    particles: new SparseMap<Particle<any>>(),\r\n    quickActionQueue: [] as Action<any>[],\r\n    actionQueue: [] as Action<any>[],\r\n    slowActionQueue: [] as Action<any>[],\r\n    player: new Actor(-1, new ActorBreed(\"\", {}), 0, 0),\r\n    fov: new Map<number, boolean>(),\r\n\r\n    //Player XP\r\n    xp: 0,\r\n    //AI & Navigaiton\r\n    dMapPlayer: null as DMap | null,\r\n\r\n    //UI Properties\r\n    actionPending: false,\r\n    looking: false,\r\n    targetFocus: null as Particle<any> | null,\r\n\r\n    seeAll: false,\r\n  };\r\n};\r\n\r\nexport type GameState = ReturnType<typeof buildState>;\r\n","class AsyncManager {\r\n  pending: Promise<any>[] = [];\r\n\r\n  addPending(p: Promise<any>) {\r\n    this.pending.push(p);\r\n  }\r\n\r\n  waitForPending() {\r\n    const waiting = Promise.all(this.pending);\r\n    this.pending = [];\r\n    return waiting;\r\n  }\r\n}\r\n\r\nexport default new AsyncManager();\r\n","import { AdjTypes } from \"./Map\";\r\nimport { gameData } from \"../GameManager\";\r\n\r\nconst isOpen = (adj: AdjTypes) => {\r\n  return adj !== AdjTypes.WALL;\r\n};\r\n\r\n/** Octants used for translating recursive shadowcasting offsets */\r\nconst OCTANTS = [\r\n  [-1, 0, 0, 1], //2 R->L (B->T) oy -1 -1 ** yy | iy 0\r\n  [0, -1, 1, 0], //3 T->B (L->R) oy 0 | iy 1 yx\r\n  [0, -1, -1, 0], //4 B->T (L->R) oy 0 | iy yx\r\n  [-1, 0, 0, -1], //5 R->L (T->B) oy 1 -1 ** yy | iy 0\r\n  [1, 0, 0, -1], //6 L->R (T->B)  oy -1 * yy | iy 0\r\n  [0, 1, -1, 0], //7 B->T (R->L)  oy 0 | iy -1 yx\r\n  [0, 1, 1, 0], //8 T->B (R->L)\r\n  [1, 0, 0, 1], //1 L->R (B->T)\r\n];\r\n\r\n//dx -> axis of row clear\r\n//dy -> axis of row transition\r\n//[0] == xx = x difference for \"row\"/inner scan\r\n//[1] == xy = -1 * x difference for outer scan\r\n//[2] == yx = y diff for \"row\"/inner scan\r\n//[3] == yy = -1 * y diff for \"col\"/outer scan\r\n//const mapX = startX + dx * xx + dy * xy;\r\n//const mapY = startY + dx * yx + dy * yy;\r\n\r\ntype RVisiblity = (x: number, y: number, R: number, visible: number) => void;\r\ntype RLightPasses = (\r\n  x: number,\r\n  y: number,\r\n  xx: number,\r\n  xy: number,\r\n  yx: number,\r\n  yy: number\r\n) => boolean;\r\n/**\r\n * @class Recursive shadowcasting algorithm\r\n * Currently only supports 4/8 topologies, not hexagonal.\r\n * Based on Peter Harkins' implementation of Björn Bergström's algorithm described here: http://www.roguebasin.com/index.php?title=FOV_using_recursive_shadowcasting\r\n * @augments ROT.FOV\r\n */\r\nexport class SkinnyRecursiveShadowcasting {\r\n  _lightCasts: RLightPasses;\r\n  _lightPasses: RLightPasses;\r\n\r\n  constructor(\r\n    lightCastsCallback: RLightPasses,\r\n    lightPassesCallback: RLightPasses\r\n  ) {\r\n    this._lightCasts = lightCastsCallback;\r\n    this._lightPasses = lightPassesCallback;\r\n  }\r\n\r\n  /**\r\n   * Compute visibility for a 360-degree circle\r\n   * @param {int} x\r\n   * @param {int} y\r\n   * @param {int} R Maximum visibility radius\r\n   * @param {function} callback\r\n   */\r\n  compute(x: number, y: number, R: number, callback: RVisiblity) {\r\n    //You can always see your own tile\r\n    callback(x, y, 0, 1);\r\n    for (let i = 0; i < OCTANTS.length; i++) {\r\n      this._renderOctant(x, y, OCTANTS[i], R, callback);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute visibility for a 180-degree arc\r\n   * @param {int} x\r\n   * @param {int} y\r\n   * @param {int} R Maximum visibility radius\r\n   * @param {int} dir Direction to look in (expressed in a ROT.DIRS value);\r\n   * @param {function} callback\r\n   */\r\n  compute180(\r\n    x: number,\r\n    y: number,\r\n    R: number,\r\n    dir: number,\r\n    callback: RVisiblity\r\n  ) {\r\n    //You can always see your own tile\r\n    callback(x, y, 0, 1);\r\n    const previousOctant = (dir - 1 + 8) % 8; //Need to retrieve the previous octant to render a full 180 degrees\r\n    const nextPreviousOctant = (dir - 2 + 8) % 8; //Need to retrieve the previous two octants to render a full 180 degrees\r\n    const nextOctant = (dir + 1 + 8) % 8; //Need to grab to next octant to render a full 180 degrees\r\n    this._renderOctant(x, y, OCTANTS[nextPreviousOctant], R, callback);\r\n    this._renderOctant(x, y, OCTANTS[previousOctant], R, callback);\r\n    this._renderOctant(x, y, OCTANTS[dir], R, callback);\r\n    this._renderOctant(x, y, OCTANTS[nextOctant], R, callback);\r\n  }\r\n\r\n  /**\r\n   * Compute visibility for a 90-degree arc\r\n   * @param {int} x\r\n   * @param {int} y\r\n   * @param {int} R Maximum visibility radius\r\n   * @param {int} dir Direction to look in (expressed in a ROT.DIRS value);\r\n   * @param {function} callback\r\n   */\r\n  compute90(\r\n    x: number,\r\n    y: number,\r\n    R: number,\r\n    dir: number,\r\n    callback: RVisiblity\r\n  ) {\r\n    //You can always see your own tile\r\n    callback(x, y, 0, 1);\r\n    const previousOctant = (dir - 1 + 8) % 8; //Need to retrieve the previous octant to render a full 90 degrees\r\n    this._renderOctant(x, y, OCTANTS[dir], R, callback);\r\n    this._renderOctant(x, y, OCTANTS[previousOctant], R, callback);\r\n  }\r\n\r\n  /**\r\n   * Render one octant (45-degree arc) of the viewshed\r\n   * @param {int} x\r\n   * @param {int} y\r\n   * @param {int} octant Octant to be rendered\r\n   * @param {int} R Maximum visibility radius\r\n   * @param {function} callback\r\n   */\r\n  _renderOctant(\r\n    x: number,\r\n    y: number,\r\n    octant: number[],\r\n    R: number,\r\n    callback: RVisiblity\r\n  ) {\r\n    if (\r\n      this._lightPasses(\r\n        x,\r\n        y,\r\n        octant[0],\r\n        -1 * octant[1],\r\n        octant[2],\r\n        -1 * octant[3]\r\n      )\r\n    ) {\r\n      //Radius incremented by 1 to provide same coverage area as other shadowcasting radiuses\r\n      this._castVisibility(\r\n        x,\r\n        y,\r\n        1,\r\n        1.0,\r\n        0.0,\r\n        R + 1,\r\n        octant[0],\r\n        octant[1],\r\n        octant[2],\r\n        octant[3],\r\n        callback\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Actually calculates the visibility\r\n   * @param {int} startX The starting X coordinate\r\n   * @param {int} startY The starting Y coordinate\r\n   * @param {int} row The row to render\r\n   * @param {float} visSlopeStart The slope to start at\r\n   * @param {float} visSlopeEnd The slope to end at\r\n   * @param {int} radius The radius to reach out to\r\n   * @param {int} xx\r\n   * @param {int} xy\r\n   * @param {int} yx\r\n   * @param {int} yy\r\n   * @param {function} callback The callback to use when we hit a block that is visible\r\n   */\r\n  _castVisibility(\r\n    startX: number,\r\n    startY: number,\r\n    row: number,\r\n    visSlopeStart: number,\r\n    visSlopeEnd: number,\r\n    radius: number,\r\n    xx: number,\r\n    xy: number,\r\n    yx: number,\r\n    yy: number,\r\n    callback: RVisiblity\r\n  ) {\r\n    if (visSlopeStart < visSlopeEnd) {\r\n      return;\r\n    }\r\n    for (let i = row; i <= radius; i++) {\r\n      let dx = -i - 1;\r\n      const dy = -i;\r\n      let blocked = false;\r\n      let newStart = 0;\r\n\r\n      //'Row' could be column, names here assume octant 0 and would be flipped for half the octants\r\n      while (dx <= 0) {\r\n        dx += 1;\r\n\r\n        //Translate from relative coordinates to map coordinates\r\n        const mapX = startX + dx * xx + dy * xy;\r\n        const mapY = startY + dx * yx + dy * yy;\r\n\r\n        //Range of the row\r\n        const slopeStart = (dx - 0.5) / (dy + 0.5);\r\n        const slopeEnd = (dx + 0.5) / (dy - 0.5);\r\n\r\n        //Ignore if not yet at left edge of Octant\r\n        if (slopeEnd > visSlopeStart) {\r\n          continue;\r\n        }\r\n\r\n        //Done if past right edge\r\n        if (slopeStart < visSlopeEnd) {\r\n          break;\r\n        }\r\n\r\n        const casts = this._lightCasts(mapX, mapY, xx, -1 * xy, yx, -1 * yy);\r\n        //If it's in range, it's visible\r\n        if (dx * dx + dy * dy < radius * radius && (casts || dx === 0)) {\r\n          //&& this._lightHits(mapX, mapY, xx, xy, yx, yy)) {\r\n          callback(mapX, mapY, i, 1);\r\n        }\r\n\r\n        if (!blocked) {\r\n          //If tile is a blocking tile, cast around it\r\n          const passes =\r\n            this._lightPasses(mapX, mapY, xx, -1 * xy, yx, -1 * yy) &&\r\n            i < radius;\r\n          if (!passes) {\r\n            this._castVisibility(\r\n              startX,\r\n              startY,\r\n              i + 1,\r\n              visSlopeStart,\r\n              slopeStart,\r\n              radius,\r\n              xx,\r\n              xy,\r\n              yx,\r\n              yy,\r\n              callback\r\n            );\r\n            newStart = slopeEnd;\r\n            blocked = true;\r\n          } else if (!casts && dx < 0) {\r\n            this._castVisibility(\r\n              startX,\r\n              startY,\r\n              i + 1,\r\n              visSlopeStart,\r\n              slopeStart,\r\n              radius,\r\n              xx,\r\n              xy,\r\n              yx,\r\n              yy,\r\n              callback\r\n            );\r\n            newStart = slopeEnd;\r\n            blocked = true;\r\n          }\r\n        } else {\r\n          //Keep narrowing if scanning across a block\r\n          if (!this._lightPasses(mapX, mapY, xx, -1 * xy, yx, -1 * yy)) {\r\n            newStart = slopeEnd;\r\n            continue;\r\n          }\r\n\r\n          //Block has ended\r\n          blocked = false;\r\n          visSlopeStart = newStart;\r\n        }\r\n      }\r\n      if (blocked) {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const PlayerVisibility = new SkinnyRecursiveShadowcasting(\r\n  (x, y, innerX, outerX, innerY, outerY) => {\r\n    //  [0, -1, 1, 0], //3 T->B (L->R)\r\n    //[0, -1, -1, 0], //4 B->T (L->R)\r\n    const map = gameData.current;\r\n    if (0 <= x && x < map.width && 0 <= y && y < map.height) {\r\n      if (innerX === -1) {\r\n        return map.tiles[x + y * map.width].adj.left !== AdjTypes.WALL;\r\n      } else if (innerX === 1) {\r\n        return map.tiles[x + y * map.width].adj.right !== AdjTypes.WALL;\r\n      }\r\n\r\n      if (innerY === -1) {\r\n        return map.tiles[x + y * map.width].adj.up !== AdjTypes.WALL;\r\n      } else if (innerY === 1) {\r\n        return map.tiles[x + y * map.width].adj.down !== AdjTypes.WALL;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n  (x, y, innerX, outerX, innerY, outerY) => {\r\n    const map = gameData.current;\r\n    if (0 <= x && x < map.width && 0 <= y && y < map.height) {\r\n      if (outerX === -1) {\r\n        return map.tiles[x + y * map.width].adj.left !== AdjTypes.WALL;\r\n      } else if (outerX === 1) {\r\n        return map.tiles[x + y * map.width].adj.right !== AdjTypes.WALL;\r\n      }\r\n\r\n      if (outerY === -1) {\r\n        return map.tiles[x + y * map.width].adj.up !== AdjTypes.WALL;\r\n      } else if (outerY === 1) {\r\n        return map.tiles[x + y * map.width].adj.down !== AdjTypes.WALL;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n);\r\n\r\nexport const getPlayerVisibility = (\r\n  width: number,\r\n  x: number,\r\n  y: number,\r\n  range: number,\r\n  result = new Map<number, boolean>()\r\n) => {\r\n  result.clear();\r\n  PlayerVisibility.compute(x, y, range, (x, y, _, visible) => {\r\n    if (visible) {\r\n      result.set(x + y * width, true);\r\n    }\r\n  });\r\n  /**result.set(gameData.player.x + gameData.player.y * width, true);\r\n  PlayerVisibility._renderOctant(\r\n    x,\r\n    y,\r\n    OCTANTS[7],\r\n    range,\r\n    (x, y, _, visible) => {\r\n      if (visible) {\r\n        result.set(x + y * width, true);\r\n      }\r\n    }\r\n  );**/\r\n};\r\n","import { Point } from \"../../engine/space/bounds\";\r\nimport { Directions, getDirectionTowards } from \"../../engine/space/directions\";\r\nimport { gameData } from \"../GameManager\";\r\nimport { adjInCheck, adjOutCheck } from \"./Movement\";\r\n\r\nexport const moveIn = (to: Point, from: Point) => {\r\n  const tile = gameData.current.tiles[from.x + from.y * gameData.current.width];\r\n\r\n  switch (getDirectionTowards(from, to)) {\r\n    case Directions.Left:\r\n      return adjInCheck(tile.adj.left);\r\n    case Directions.Up:\r\n      return adjInCheck(tile.adj.up);\r\n    case Directions.Right:\r\n      return adjInCheck(tile.adj.right);\r\n    case Directions.Down:\r\n      return adjInCheck(tile.adj.down);\r\n  }\r\n};\r\nexport const moveOut = (to: Point, from: Point) => {\r\n  const tile = gameData.current.tiles[from.x + from.y * gameData.current.width];\r\n\r\n  switch (getDirectionTowards(from, to)) {\r\n    case Directions.Left:\r\n      return adjOutCheck(tile.adj.left);\r\n    case Directions.Up:\r\n      return adjOutCheck(tile.adj.up);\r\n    case Directions.Right:\r\n      return adjOutCheck(tile.adj.right);\r\n    case Directions.Down:\r\n      return adjOutCheck(tile.adj.down);\r\n  }\r\n};\r\n","import { gameData } from \"../../GameManager\";\r\nimport { getActorWeight, getWeightLoad } from \"../../items/formulas\";\r\nimport { Actor } from \"../Actor\";\r\n\r\nexport const endOfTurnEffects = () => {\r\n  gameData.actors.forEach((a) => {\r\n    accumulateStagger(a);\r\n    regenStats(a);\r\n    expireStatuses(a);\r\n    clearStates(a);\r\n  });\r\n};\r\n\r\nexport const accumulateStagger = (a: Actor) => {\r\n  if (a.status.staggered) {\r\n    a.status.staggeredCount = 1 + (a.status.staggeredCount || 0);\r\n  }\r\n};\r\n\r\nexport const regenStats = (a: Actor) => {\r\n  if (!a.status.hit) {\r\n    a.poise.change(Math.ceil(a.poise.max * 0.33333));\r\n  }\r\n\r\n  const staminaMultiplier =\r\n    100 <= getWeightLoad(getActorWeight(a), a.attributes.weight) ? 0 : 1;\r\n  if (100 <= getWeightLoad(getActorWeight(a), a.attributes.weight)) {\r\n    a.stamina.change(-2);\r\n  } else if (a.status.sprinted || a.status.staggered) {\r\n    return;\r\n  } else if (a.status.waited) {\r\n    a.stamina.change(staminaMultiplier * 40);\r\n  } else if (a.status.moved) {\r\n    a.stamina.change(staminaMultiplier * 20);\r\n  }\r\n};\r\n\r\nexport const expireStatuses = (a: Actor) => {\r\n  if (a.poise.current) {\r\n    a.status.staggeredCount = 0;\r\n    a.status.staggered = false;\r\n  } else if (gameData.player === a && 3 <= (a.status.staggeredCount || 0)) {\r\n    a.status.staggeredCount = 0;\r\n    a.status.staggered = false;\r\n    a.poise.fill();\r\n  }\r\n};\r\n\r\nexport const clearStates = (a: Actor) => {\r\n  a.status.waited = false;\r\n  a.status.hit = false;\r\n  a.status.moved = false;\r\n  a.status.blocking = false;\r\n  a.status.replanned = false;\r\n  a.status.sprinted = false;\r\n};\r\n","import { LevelMap } from \"../../engine/map/LevelMap\";\r\nimport { ComponentF } from \"../ui\";\r\nimport { drawWorld, gameData, handleInput } from \"../../core/GameManager\";\r\nimport { Bounds, Point } from \"../../engine/space/bounds\";\r\n\r\nconst getViewport = (map: LevelMap<any, any>, focus: Point, bounds: Bounds) => {\r\n  const halfw = bounds.w / 2;\r\n  const halfh = bounds.h / 2;\r\n  return {\r\n    x: Math.floor(Math.max(0, Math.min(map.width - bounds.w, focus.x - halfw))),\r\n    y: Math.floor(\r\n      Math.max(0, Math.min(map.height - bounds.h, focus.y - halfh))\r\n    ),\r\n    w: Math.min(bounds.w, map.width),\r\n    h: Math.min(bounds.h, map.height),\r\n  };\r\n};\r\n\r\nexport const MapUI: ComponentF<{ title: string; onClick: () => void }> = (\r\n  C\r\n) => {\r\n  C.handlers.keypress = handleInput;\r\n\r\n  const target = gameData.targetFocus;\r\n  drawWorld(\r\n    C.display,\r\n    C.bounds,\r\n    getViewport(\r\n      gameData.current,\r\n      target\r\n        ? { x: target.x, y: target.y }\r\n        : { x: gameData.player.x, y: gameData.player.y },\r\n      C.bounds\r\n    )\r\n  );\r\n};\r\n","import Colors from \"../../core/Colors\";\r\nimport { ComponentF } from \"../ui\";\r\nexport const Bar: ComponentF<{\r\n  current: number;\r\n  fillColor: string;\r\n  max: number;\r\n}> = (C, props = { current: 0, max: 0, fillColor: \"#FFFFFF\" }) => {\r\n  const pct = props.current / props.max;\r\n  let l = 0;\r\n  const text = `${props.current} / ${props.max}`;\r\n  const tLen = text.length;\r\n  C.display.drawText(C.bounds.x, C.bounds.y, `%c{${Colors.B_GREY_5}}${text}`);\r\n\r\n  for (; l / C.bounds.w < pct; l++) {\r\n    C.display.drawOver(\r\n      l + C.bounds.x,\r\n      C.bounds.y,\r\n      tLen <= l ? \" \" : null,\r\n      null,\r\n      props.fillColor\r\n    );\r\n  }\r\n  for (; l < C.bounds.w; l++) {\r\n    C.display.drawOver(\r\n      l + C.bounds.x,\r\n      C.bounds.y,\r\n      tLen <= l ? \" \" : null,\r\n      null,\r\n      Colors.B_GREY_2\r\n    );\r\n  }\r\n};\r\n","import { TextType } from \"../type/TextType\";\r\nimport { ComponentF, createElement } from \"../ui\";\r\nimport { Bar } from \"./Bar\";\r\nexport const LabeledBar: ComponentF<{\r\n  current: number;\r\n  max?: number;\r\n  title: string;\r\n  fillColor: string;\r\n}> = (C, props = { current: 0, title: \"\", fillColor: \"#FFFFFF\" }) => {\r\n  return [\r\n    createElement(\r\n      TextType,\r\n      { x: 0, y: 0, w: C.bounds.w, h: 1 },\r\n      { title: props.title }\r\n    ),\r\n    createElement(Bar, { x: 0, y: 1, w: C.bounds.w, h: 1 }, props),\r\n  ];\r\n};\r\n","import { LabeledBar } from \"../../../../ui/dataInfo/LabeledBar\";\r\nimport { ComponentF, createElement } from \"../../../../ui/ui\";\r\nimport { Encumbrance } from \"../../../actors/Actor\";\r\nimport Colors from \"../../../Colors\";\r\nimport { gameData } from \"../../../GameManager\";\r\nimport {\r\n  getActorWeight,\r\n  getWeightLevel,\r\n  getWeightLoad,\r\n} from \"../../../items/formulas\";\r\nimport { XPBar } from \"./XPBar\";\r\n\r\nexport const StatsPanel: ComponentF<void> = (C, props) => {\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + 3,\r\n    `FRC: ${gameData.player.attributes.force}`\r\n  );\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + 4,\r\n    `STR: ${gameData.player.attributes.strength}`\r\n  );\r\n\r\n  const weight = getActorWeight(gameData.player);\r\n  const maxWeight = gameData.player.attributes.weight;\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + 7,\r\n    `WEIGHT: ${weight}/${maxWeight} (${getWeightLoad(weight, maxWeight)}%)`\r\n  );\r\n  const eLevel = getWeightLevel(weight, maxWeight);\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + 8,\r\n    eLevel === Encumbrance.HEAVY\r\n      ? \"Slow movement\"\r\n      : eLevel === Encumbrance.MEDIUM\r\n      ? \"Medium Movement\"\r\n      : \"Fast Movement\"\r\n  );\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + 9,\r\n    eLevel === Encumbrance.HEAVY\r\n      ? `%c{${Colors.RED_2}}No Sprinting`\r\n      : eLevel === Encumbrance.MEDIUM\r\n      ? \"Shift Move Sprint\"\r\n      : \"Shift Move Sprint Atk\"\r\n  );\r\n  return [\r\n    createElement(XPBar, { x: 0, y: 0, w: C.bounds.w - 11, h: 3 }),\r\n    createElement(\r\n      LabeledBar,\r\n      { x: C.bounds.w - 10, y: 0, w: 10, h: 1 },\r\n      {\r\n        title: \"Health\",\r\n        fillColor: \"#702931\",\r\n        current: gameData.player.health.current,\r\n        max: gameData.player.health.max,\r\n      }\r\n    ),\r\n    createElement(\r\n      LabeledBar,\r\n      { x: C.bounds.w - 10, y: 2, w: 10, h: 1 },\r\n      {\r\n        title: \"Stamina\",\r\n        fillColor: \"#2b4147\",\r\n        current: gameData.player.stamina.current,\r\n        max: gameData.player.stamina.max,\r\n      }\r\n    ),\r\n    createElement(\r\n      LabeledBar,\r\n      { x: C.bounds.w - 10, y: 4, w: 10, h: 1 },\r\n      {\r\n        title: \"Poise\",\r\n        fillColor: \"#45538f\",\r\n        current: gameData.player.poise.current,\r\n        max: gameData.player.poise.max,\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import { openModal } from \"../../../../ui/containers/Modal\";\r\nimport { ButtonComp } from \"../../../../ui/input/Button\";\r\nimport { ComponentF, createElement } from \"../../../../ui/ui\";\r\nimport {\r\n  getXPProgress,\r\n  hasLevelUp,\r\n  isMaxLevel,\r\n} from \"../../../actors/xpLevels\";\r\nimport { gameData } from \"../../../GameManager\";\r\nimport { LevelModal } from \"../../level/LevelModal\";\r\n\r\nexport const XPBar: ComponentF<void> = (C, props) => {\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y,\r\n    `Level: ${gameData.player.level}`,\r\n    C.bounds.w - 11\r\n  );\r\n  if (isMaxLevel(gameData.player.level)) {\r\n    C.display.drawText(C.bounds.x, C.bounds.y + 1, \"XP: Max\");\r\n  } else if (!hasLevelUp(gameData.player.level, gameData.xp)) {\r\n    C.display.drawText(\r\n      C.bounds.x,\r\n      C.bounds.y + 1,\r\n      `XP: ${getXPProgress(gameData.player.level, gameData.xp)}`\r\n    );\r\n  } else {\r\n    return [\r\n      createElement(\r\n        ButtonComp,\r\n        { x: 0, y: 1, w: C.bounds.w, h: 1 },\r\n        {\r\n          title: \"Lvl Up\",\r\n          keys: \"x\",\r\n          showKey: true,\r\n          onClick: () => {\r\n            if (!gameData.actionPending) {\r\n              openModal(\r\n                createElement(LevelModal, { x: 0, y: 0, w: 48, h: 24 }, {})\r\n              );\r\n            }\r\n          },\r\n        }\r\n      ),\r\n    ];\r\n  }\r\n};\r\n","import { ComponentF } from \"../../ui/ui\";\r\nimport Colors from \"../Colors\";\r\nimport {\r\n  findActorForPosition,\r\n  gameData,\r\n  getItemsForPosition,\r\n} from \"../GameManager\";\r\n\r\nconst withColor = (c: string, s: string) => {\r\n  return `%c{${c}}${s}%c{}`;\r\n};\r\n\r\nexport const TileContents: ComponentF<void> = (C) => {\r\n  let x, y;\r\n  if (gameData.targetFocus != null) {\r\n    x = gameData.targetFocus.x;\r\n    y = gameData.targetFocus.y;\r\n  } else {\r\n    x = gameData.player.x;\r\n    y = gameData.player.y;\r\n  }\r\n\r\n  const visible = gameData.fov.get(x + y * gameData.current.width);\r\n  const items = getItemsForPosition(x, y);\r\n  const actor = findActorForPosition(x, y);\r\n\r\n  if (visible) {\r\n    const bot = C.bounds.y + C.bounds.h - 3;\r\n\r\n    let row = C.bounds.y + 1;\r\n    if (actor && actor != gameData.player) {\r\n      if (row < bot) {\r\n        row += C.display.drawText(\r\n          C.bounds.x,\r\n          row,\r\n          withColor(Colors.B_GREY_4, actor.breed.name),\r\n          C.bounds.w - 1\r\n        );\r\n        if (actor.breed.info && row < bot) {\r\n          row += C.display.drawText(\r\n            C.bounds.x,\r\n            row,\r\n            withColor(Colors.B_GREY_3, actor.breed.info),\r\n            C.bounds.w - 1\r\n          );\r\n        }\r\n        row += 1;\r\n        if (actor.breed.description && row < bot) {\r\n          row += C.display.drawText(\r\n            C.bounds.x,\r\n            row,\r\n            withColor(Colors.B_GREY_2, actor.breed.description),\r\n            C.bounds.w - 1\r\n          );\r\n        }\r\n        row += 1;\r\n      }\r\n    }\r\n\r\n    if (items.length) {\r\n      items.forEach((item) => {\r\n        if (row < bot) {\r\n          row += C.display.drawText(\r\n            C.bounds.x,\r\n            row,\r\n            withColor(Colors.B_GREY_4, item.breed.name),\r\n            C.bounds.w - 1\r\n          );\r\n          if (item.breed.info && row < bot) {\r\n            row += C.display.drawText(\r\n              C.bounds.x,\r\n              row,\r\n              withColor(Colors.B_GREY_3, item.breed.info),\r\n              C.bounds.w - 1\r\n            );\r\n          }\r\n          row += 1;\r\n          if (item.breed.description && row < bot) {\r\n            row += C.display.drawText(\r\n              C.bounds.x,\r\n              row,\r\n              withColor(Colors.B_GREY_2, item.breed.description),\r\n              C.bounds.w - 1\r\n            );\r\n          }\r\n          row += 1;\r\n        }\r\n      });\r\n    }\r\n  } else {\r\n    C.display.drawText(C.bounds.x, C.bounds.y, \"You cannot see here\");\r\n  }\r\n\r\n  if (gameData.looking) {\r\n    C.display.drawText(\r\n      C.bounds.x,\r\n      C.bounds.y + C.bounds.h - 1,\r\n      `%c{${Colors.RED_4}}v%c{} to stop looking`,\r\n      C.bounds.w - 1\r\n    );\r\n  } else {\r\n    C.display.drawText(\r\n      C.bounds.x,\r\n      C.bounds.y + C.bounds.h - 1,\r\n      `%c{${Colors.RED_4}}v%c{} to look`,\r\n      C.bounds.w - 1\r\n    );\r\n  }\r\n};\r\n","import Colors from \"../../core/Colors\";\r\nimport { handleKeyOnClick } from \"../input/keyOnClick\";\r\nimport { ComponentF, ComponentO, createElement } from \"../ui\";\r\n\r\nconst TabHeader: ComponentF<{\r\n  title: string;\r\n  keys: string;\r\n  selected: boolean;\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  const firstKey = Array.isArray(props.keys) ? props.keys[0] : props.keys;\r\n\r\n  const [state, setState] = C.useState({ hover: false });\r\n  const color =\r\n    props.selected || state.hover ? Colors.B_GREY_5 : Colors.B_GREY_3;\r\n  if (firstKey) {\r\n    C.display.drawText(\r\n      C.bounds.x,\r\n      C.bounds.y,\r\n      `%c{${Colors.RED_4}}${firstKey}`\r\n    );\r\n  }\r\n  C.display.drawText(\r\n    C.bounds.x + (firstKey ? 1 : 0),\r\n    C.bounds.y,\r\n    `%c{${color}}${props.title}`\r\n  );\r\n  C.handlers.hover = () => {\r\n    setState({ hover: true });\r\n  };\r\n  C.handlers.out = () => {\r\n    setState({ hover: false });\r\n  };\r\n\r\n  C.handlers.press = () => {\r\n    props.onClick();\r\n  };\r\n\r\n  handleKeyOnClick(C, props);\r\n};\r\n\r\nconst TabContents: ComponentF<{ children: ComponentO[] }> = (C, props) => {\r\n  return props.children;\r\n};\r\nexport const TabbedContents: ComponentF<{\r\n  children: { title: string; keys: string | string[]; value: ComponentO }[];\r\n}> = (C, { children }) => {\r\n  const [state, setState] = C.useState({ selected: 0 });\r\n\r\n  let left = 0;\r\n  const tabList = children.map((tab, index) => {\r\n    const tWidth = tab.title.length + (tab.keys ? 2 : 1);\r\n\r\n    const tabElement = createElement(\r\n      TabHeader,\r\n      {\r\n        x: left,\r\n        y: 0,\r\n        w: tWidth,\r\n        h: 1,\r\n      },\r\n      {\r\n        selected: index === state.selected,\r\n        title: tab.title,\r\n        keys: tab.keys,\r\n        onClick: () => setState({ selected: index }),\r\n      }\r\n    );\r\n    left += tWidth;\r\n    return tabElement;\r\n  });\r\n\r\n  return [\r\n    ...tabList,\r\n    createElement(\r\n      TabContents,\r\n      { x: 0, y: 2, w: C.bounds.w, h: C.bounds.h - 2 },\r\n      {\r\n        children: [\r\n          children[state.selected < children.length ? state.selected : 0].value,\r\n        ],\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import { log } from \"../../../engine/logger/logger\";\r\nimport { TextType } from \"../../../ui/type/TextType\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport { Hands, WieldMode } from \"../../actors/Actor\";\r\nimport Colors from \"../../Colors\";\r\nimport { gameData } from \"../../GameManager\";\r\nimport { getActorArmor, hasStrength } from \"../../items/formulas\";\r\nimport {\r\n  drawAttackDetails,\r\n  drawShieldDetails,\r\n} from \"./wieldable/attackDetails\";\r\n\r\nexport const EquipmentPanel: ComponentF<void> = (C) => {\r\n  let y = C.bounds.y + 2;\r\n  const twoHanded = gameData.player.wielding.mode === WieldMode.twoHanded;\r\n  const left = gameData.player.wielding.left;\r\n  const right = gameData.player.wielding.right;\r\n\r\n  y += C.display.drawText(C.bounds.x, y, \"Wielding:\");\r\n\r\n  const leftColor = !left ? Colors.B_GREY_2 : Colors.B_GREY_5;\r\n  const leftString = `L: %c{${leftColor}}${left?.breed.logName || \"None\"} ${\r\n    left && twoHanded ? \"(2h)\" : \"\"\r\n  }`;\r\n  y += C.display.drawText(C.bounds.x, y, leftString);\r\n\r\n  const rightColor =\r\n    !right || (twoHanded && left) ? Colors.B_GREY_2 : Colors.B_GREY_5;\r\n  const rightString = `R: %c{${rightColor}}${right?.breed.logName || \"None\"} ${\r\n    right && !left && twoHanded ? \"(2h)\" : \"\"\r\n  }`;\r\n  y += 1 + C.display.drawText(C.bounds.x, y, rightString);\r\n\r\n  if (twoHanded) {\r\n    const attackingWeapon =\r\n      gameData.player.wielding.left || gameData.player.wielding.right;\r\n    if (attackingWeapon) {\r\n      const twoHandAttack = attackingWeapon.breed.attacks?.twohanded;\r\n      if (twoHandAttack) {\r\n        if (twoHandAttack.blocks) {\r\n          y += C.display.drawText(\r\n            C.bounds.x,\r\n            y,\r\n            \"Two Handed Block\",\r\n            C.bounds.w\r\n          );\r\n          y += drawShieldDetails(\r\n            C.display,\r\n            gameData.player,\r\n            twoHandAttack,\r\n            C.bounds.x,\r\n            y,\r\n            C.bounds.w,\r\n            hasStrength(gameData.player, twoHandAttack)\r\n              ? Colors.B_GREY_5\r\n              : Colors.B_GREY_4\r\n          );\r\n        } else {\r\n          y += C.display.drawText(\r\n            C.bounds.x,\r\n            y,\r\n            \"Two Handed Attack\",\r\n            C.bounds.w\r\n          );\r\n          y += drawAttackDetails(\r\n            C.display,\r\n            gameData.player,\r\n            twoHandAttack,\r\n            C.bounds.x,\r\n            y,\r\n            C.bounds.w,\r\n            hasStrength(gameData.player, twoHandAttack)\r\n              ? Colors.B_GREY_5\r\n              : Colors.B_GREY_4\r\n          );\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if (left && left.breed.attacks?.onehanded) {\r\n      const lAttack = left.breed.attacks.onehanded;\r\n      const lColor =\r\n        gameData.player.wielding.activeHand === Hands.LEFT\r\n          ? hasStrength(gameData.player, lAttack)\r\n            ? Colors.B_GREY_5\r\n            : Colors.B_GREY_4\r\n          : Colors.B_GREY_2;\r\n\r\n      if (lAttack.blocks) {\r\n        y += C.display.drawText(\r\n          C.bounds.x,\r\n          y,\r\n          `%c{${Colors.RED_4}}1%c{${lColor}} Left Hand Block`,\r\n          C.bounds.w\r\n        );\r\n        y += drawShieldDetails(\r\n          C.display,\r\n          gameData.player,\r\n          left.breed.attacks.onehanded,\r\n          C.bounds.x,\r\n          y,\r\n          C.bounds.w,\r\n          lColor\r\n        );\r\n        y += 1;\r\n      } else {\r\n        y += C.display.drawText(\r\n          C.bounds.x,\r\n          y,\r\n          `%c{${Colors.RED_4}}1%c{${lColor}} Left Hand Attack`,\r\n          C.bounds.w\r\n        );\r\n        y += drawAttackDetails(\r\n          C.display,\r\n          gameData.player,\r\n          left.breed.attacks.onehanded,\r\n          C.bounds.x,\r\n          y,\r\n          C.bounds.w,\r\n          lColor\r\n        );\r\n        y += 1;\r\n      }\r\n    }\r\n    if (right && right.breed.attacks?.onehanded) {\r\n      const rAttack = right.breed.attacks.onehanded;\r\n      const rColor =\r\n        gameData.player.wielding.activeHand === Hands.RIGHT\r\n          ? hasStrength(gameData.player, rAttack)\r\n            ? Colors.B_GREY_5\r\n            : Colors.B_GREY_4\r\n          : Colors.B_GREY_2;\r\n\r\n      if (rAttack.blocks) {\r\n        y += C.display.drawText(\r\n          C.bounds.x,\r\n          y,\r\n          `%c{${Colors.RED_4}}2%c{${rColor}} Right Hand Block`,\r\n          C.bounds.w\r\n        );\r\n        y += drawShieldDetails(\r\n          C.display,\r\n          gameData.player,\r\n          rAttack,\r\n          C.bounds.x,\r\n          y,\r\n          C.bounds.w,\r\n          rColor\r\n        );\r\n      } else {\r\n        y += C.display.drawText(\r\n          C.bounds.x,\r\n          y,\r\n          `%c{${Colors.RED_4}}2%c{${rColor}} Right Hand Attack`,\r\n          C.bounds.w\r\n        );\r\n        y += drawAttackDetails(\r\n          C.display,\r\n          gameData.player,\r\n          rAttack,\r\n          C.bounds.x,\r\n          y,\r\n          C.bounds.w,\r\n          rColor\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  C.handlers.keypress = (key: string) => {\r\n    if (key === \"1\") {\r\n      gameData.player.wielding.activeHand = Hands.LEFT;\r\n      if (gameData.player.wielding.left?.breed.attacks?.onehanded.blocks) {\r\n        log(\"Shield Active, Move into enemy to block all incoming attacks\");\r\n      }\r\n      return true;\r\n    } else if (key === \"2\") {\r\n      gameData.player.wielding.activeHand = Hands.RIGHT;\r\n      if (gameData.player.wielding.right?.breed.attacks?.onehanded.blocks) {\r\n        log(\"Shield Active, Move into enemy to block all incoming attacks\");\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  return [\r\n    createElement(\r\n      TextType,\r\n      { x: 0, y: 0, w: C.bounds.w - 2, h: 1 },\r\n      {\r\n        title: `Armor: ${\r\n          gameData.player.wearing.armor?.breed.logName || \"None\"\r\n        } (${getActorArmor(gameData.player)})`,\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import { RDisplay } from \"../../../../ui/RotDisplay\";\r\nimport { Actor } from \"../../../actors/Actor\";\r\nimport Colors from \"../../../Colors\";\r\nimport {\r\n  damageWithForce,\r\n  hasStrength,\r\n  reduceDamage,\r\n} from \"../../../items/formulas\";\r\nimport { Attack } from \"../../../items/Item\";\r\n\r\nexport const drawShieldDetails = (\r\n  display: RDisplay,\r\n  actor: Actor,\r\n  attack: Attack,\r\n  x: number,\r\n  y: number,\r\n  maxWidth: number,\r\n  color: string\r\n) => {\r\n  let o = 1;\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${hasStrength(actor, attack) ? color : Colors.RED_2}}Str Req: ${\r\n      attack.strength || 0\r\n    }`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${color}}Stability: ${attack.stability || 0}`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${color}}Block:    ${(attack.blocks || 0) * 100}`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${color}}STA Cost: ${attack.stamina || 0}`,\r\n    maxWidth\r\n  );\r\n  return o;\r\n};\r\n\r\nexport const drawAttackDetails = (\r\n  display: RDisplay,\r\n  actor: Actor,\r\n  attack: Attack,\r\n  x: number,\r\n  y: number,\r\n  maxWidth: number,\r\n  color: string\r\n) => {\r\n  let o = 1;\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${hasStrength(actor, attack) ? color : Colors.RED_2}}Str Req: ${\r\n      attack.strength || 0\r\n    }`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${color}}DMG:      ${reduceDamage(\r\n      damageWithForce(attack.damage || 0, actor.attributes.force),\r\n      1\r\n    )}`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${color}}Poise:    ${attack.poise}`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${color}}STA Cost: ${attack.stamina || 0}`,\r\n    maxWidth\r\n  );\r\n  return o;\r\n};\r\n","import { ComponentF } from \"../../../ui/ui\";\r\nimport { gameData } from \"../../GameManager\";\r\n\r\nexport const ContainsPanel: ComponentF<void> = (C) => {\r\n  let y = C.bounds.y;\r\n  gameData.player.contains.forEach((item) => {\r\n    C.display.drawText(C.bounds.x, y, item.breed.name, C.bounds.w - 1);\r\n    y += 1;\r\n  });\r\n};\r\n","import { log } from \"../../engine/logger/logger\";\r\nimport { Actor, WieldMode } from \"../actors/Actor\";\r\nimport Colors from \"../Colors\";\r\nimport { gameData, getItemsForPosition } from \"../GameManager\";\r\nimport { getActorWeight, getWeightLoad } from \"../items/formulas\";\r\nimport {\r\n  dropMsg,\r\n  pickupMsg,\r\n  takeOffMsg,\r\n  wearArmorMsg,\r\n  wield1hMsg,\r\n  wield2hMsg,\r\n} from \"../messages/ItemMessages\";\r\n\r\nconst weightCheck = (actor: Actor) => {\r\n  const load = getWeightLoad(getActorWeight(actor), actor.attributes.weight);\r\n  if (actor === gameData.player && 100 <= load) {\r\n    log(\r\n      `%c{${Colors.B_GREY_5}}You are overencumbered (${load}%). Exhaustion drains your stamina.`\r\n    );\r\n  }\r\n};\r\n\r\nexport const stanceChange = (actor: Actor) => {\r\n  if (actor.wielding.mode === WieldMode.oneHanded) {\r\n    wield2hMsg(actor);\r\n    actor.wielding.mode = WieldMode.twoHanded;\r\n  } else {\r\n    wield1hMsg(actor);\r\n    actor.wielding.mode = WieldMode.oneHanded;\r\n  }\r\n  return { valid: true };\r\n};\r\n\r\nexport const wieldWeapon = (\r\n  actor: Actor,\r\n  { left, right }: { left?: number; right?: number }\r\n) => {\r\n  const swapToRight = right != null && right === actor.wielding.left?.id;\r\n  const swapToLeft = left != null && left === actor.wielding.right?.id;\r\n  let newLeft =\r\n    left != null &&\r\n    (swapToLeft ? actor.wielding.right : actor.contains.remove(left as number));\r\n  let newRight =\r\n    right != null &&\r\n    (swapToRight\r\n      ? actor.wielding.left\r\n      : actor.contains.remove(right as number));\r\n  const oldRight = actor.wielding.right;\r\n  const oldLeft = actor.wielding.left;\r\n\r\n  if (oldRight?.id === right) {\r\n    newRight = oldRight;\r\n  }\r\n\r\n  if (oldLeft?.id === left) {\r\n    newLeft = oldLeft;\r\n  }\r\n\r\n  console.log(\r\n    left,\r\n    right,\r\n    swapToRight,\r\n    swapToLeft,\r\n    oldLeft,\r\n    newLeft,\r\n    oldRight,\r\n    newRight\r\n  );\r\n  if (oldLeft && oldLeft !== newLeft) {\r\n    oldLeft.removeStats(actor);\r\n    if (!swapToRight) {\r\n      actor.contains.add(oldLeft.id, oldLeft);\r\n    }\r\n  }\r\n\r\n  if (oldRight && (swapToRight || oldRight !== newRight)) {\r\n    oldRight.removeStats(actor);\r\n    if (!swapToLeft) {\r\n      actor.contains.add(oldRight.id, oldRight);\r\n    }\r\n  }\r\n\r\n  actor.wielding.left = newLeft || null;\r\n  if (newLeft) {\r\n    newLeft.applyStats(actor);\r\n  }\r\n  actor.wielding.right = newRight || null;\r\n  if (newRight) {\r\n    newRight.applyStats(actor);\r\n  }\r\n\r\n  const newSecond =\r\n    (oldLeft && !oldRight && left == null && newRight) ||\r\n    (oldRight && !oldLeft && right == null && newLeft);\r\n\r\n  if ((left != null && right != null) || newSecond) {\r\n    actor.wielding.mode = WieldMode.oneHanded;\r\n  }\r\n\r\n  if (actor.wielding.mode === WieldMode.oneHanded) {\r\n    wield1hMsg(actor);\r\n  } else {\r\n    wield2hMsg(actor);\r\n  }\r\n\r\n  weightCheck(actor);\r\n  return { valid: true };\r\n};\r\n\r\nexport const wearArmor = (actor: Actor, { id }: { id: number }) => {\r\n  const holding = actor.wearing.armor;\r\n  if (holding) {\r\n    takeOffMsg(actor, holding);\r\n    holding.removeStats(actor);\r\n    actor.contains.add(holding.id, holding);\r\n  }\r\n\r\n  const item = actor.contains.remove(id);\r\n  if (item) {\r\n    actor.wearing.armor = item;\r\n    wearArmorMsg(actor);\r\n    item.applyStats(actor);\r\n  } else {\r\n    actor.wearing.armor = null;\r\n  }\r\n  weightCheck(actor);\r\n  return { valid: true };\r\n};\r\n\r\nexport const pickupItem = (actor: Actor, { id }: { id: number }) => {\r\n  const item = gameData.items.remove(id);\r\n  if (item) {\r\n    if (!item.everHeld) {\r\n      const q = gameData.current.lootTable.get(item.breed.key);\r\n      if (q) {\r\n        gameData.current.lootTable.set(item.breed.key, q - 1);\r\n      } else {\r\n        console.warn(\"wanted to adjust loot table for item with no quantity\");\r\n      }\r\n    }\r\n    item.everHeld = true;\r\n    actor.contains.add(item.id, item);\r\n    pickupMsg(actor, item);\r\n    return { valid: true };\r\n  }\r\n  return { valid: false };\r\n};\r\n\r\nexport const dropItem = (actor: Actor, { id }: { id: number }) => {\r\n  const item = actor.contains.remove(id);\r\n  if (item) {\r\n    item.x = actor.x;\r\n    item.y = actor.y;\r\n    gameData.items.add(item.id, item);\r\n    dropMsg(actor, item);\r\n    return { valid: true };\r\n  }\r\n  return { valid: false };\r\n};\r\n\r\nexport const useItem = (actor: Actor, { id }: { id: number }) => {\r\n  const item = actor.contains.get(id);\r\n  if (item) {\r\n    item.useItem(actor);\r\n    return { valid: true };\r\n  }\r\n  return { valid: false };\r\n};\r\n\r\nexport const interact = async (actor: Actor) => {\r\n  const items = getItemsForPosition(actor.x, actor.y).filter(\r\n    (item) => item.breed.interact\r\n  );\r\n  if (items.length) {\r\n    for (let i = 0; i < items.length; i++) {\r\n      log(\r\n        `You pray at the shrine, but no one answers. The world shifts around you.`\r\n      );\r\n      log(`You fill your flask of restoration (%c{${Colors.RED_4}}u%c{})`);\r\n      await items[i].interact(actor);\r\n    }\r\n  }\r\n  return { valid: true };\r\n};\r\n","import { log } from \"../../engine/logger/logger\";\r\nimport { Actor } from \"../actors/Actor\";\r\nimport { gameData } from \"../GameManager\";\r\nimport { Item } from \"../items/Item\";\r\n\r\nexport const wield2hMsg = (actor: Actor) => {\r\n  const weapon = actor.wielding.left || actor.wielding.right;\r\n  log(\r\n    actor === gameData.player\r\n      ? `${actor.breed.logName} wield ${weapon?.breed.logName} in both hands`\r\n      : `${actor.breed.logName} wields ${weapon?.breed.logName} in both hands`\r\n  );\r\n};\r\n\r\nexport const wield1hMsg = (actor: Actor) => {\r\n  const rightWeapon = actor.wielding.right;\r\n  const leftWeapon = actor.wielding.left;\r\n  if (rightWeapon) {\r\n    log(\r\n      gameData.player\r\n        ? `${actor.breed.logName} wield ${rightWeapon.breed.logName} with your right hand`\r\n        : `${actor.breed.logName} wields ${rightWeapon.breed.logName} with their right hand`\r\n    );\r\n  }\r\n  if (leftWeapon) {\r\n    log(\r\n      gameData.player\r\n        ? `${actor.breed.logName} wield ${leftWeapon.breed.logName} with your left hand`\r\n        : `${actor.breed.logName} wields ${leftWeapon.breed.logName} with their left hand`\r\n    );\r\n  }\r\n};\r\n\r\nexport const wearArmorMsg = (actor: Actor) => {\r\n  const armor = actor.wearing.armor;\r\n  if (armor) {\r\n    log(\r\n      gameData.player\r\n        ? `${actor.breed.logName} wear the ${armor.breed.logName}`\r\n        : `${actor.breed.logName} wears the ${armor.breed.logName}`\r\n    );\r\n  }\r\n};\r\n\r\nexport const takeOffMsg = (actor: Actor, item: Item) => {\r\n  log(\r\n    gameData.player\r\n      ? `${actor.breed.logName} take off the ${item.breed.logName}`\r\n      : `${actor.breed.logName} takes the ${item.breed.logName}`\r\n  );\r\n};\r\n\r\nexport const pickupMsg = (actor: Actor, item: Item) => {\r\n  log(\r\n    gameData.player\r\n      ? `${actor.breed.logName} pick up the ${item.breed.logName}`\r\n      : `${actor.breed.logName} picks up the ${item.breed.logName}`\r\n  );\r\n};\r\n\r\nexport const dropMsg = (actor: Actor, item: Item) => {\r\n  log(\r\n    gameData.player\r\n      ? `${actor.breed.logName} drop up the ${item.breed.logName}`\r\n      : `${actor.breed.logName} drops up the ${item.breed.logName}`\r\n  );\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill, lineDraw } from \"../../../ui/helpers\";\r\nimport { TextType } from \"../../../ui/type/TextType\";\r\nimport { bound, ComponentF, ComponentO, createElement } from \"../../../ui/ui\";\r\nimport { createAction } from \"../../actions/Action\";\r\nimport { wearArmor } from \"../../actions/ActionItems\";\r\nimport Colors from \"../../Colors\";\r\nimport { gameData, runPlayerAction } from \"../../GameManager\";\r\nimport { Item } from \"../../items/Item\";\r\nimport { isDownKey, isUpKey } from \"../keyHelper\";\r\nimport { drawArmorDetails, drawArmorText } from \"./wearable/ArmorDisplay\";\r\n\r\nconst Y_SPLIT = 12;\r\n\r\nconst getWearable = () => {\r\n  const player = gameData.player;\r\n  const items = player.contains.filter(\r\n    (i) => i.breed.wearable != null\r\n  ) as (Item | null)[];\r\n  if (player.wearing.armor) {\r\n    items.unshift(player.wearing.armor);\r\n  }\r\n  items.push(null);\r\n  return items;\r\n};\r\n\r\nexport const WearableModal: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  const items = getWearable();\r\n  const [state, setState] = C.useState({\r\n    selected: gameData.player.wearing.armor?.id || (items[0] as Item).id || -1,\r\n    wearing: gameData.player.wearing.armor?.id || -1,\r\n  });\r\n\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  let y = Y_SPLIT;\r\n\r\n  lineDraw(\r\n    C.display,\r\n    bound(C.bounds, { x: 0, y: Y_SPLIT - 1, w: C.bounds.w, h: C.bounds.h }),\r\n    \"-\"\r\n  );\r\n\r\n  const result: ComponentO[] = [];\r\n\r\n  const wearing = state.wearing && items.find((i) => i?.id === state.wearing);\r\n  if (wearing) {\r\n    drawArmorText(C.display, wearing, C.bounds.x, C.bounds.y, 24);\r\n    drawArmorDetails(\r\n      C.display,\r\n      wearing,\r\n      C.bounds.x + 24,\r\n      C.bounds.y,\r\n      C.bounds.w - 24\r\n    );\r\n  } else {\r\n    C.display.drawText(C.bounds.x, C.bounds.y, `Wearing: None`);\r\n  }\r\n\r\n  items.forEach((item) => {\r\n    if (item == null) {\r\n      if (state.selected == null) {\r\n        result.push(\r\n          createElement(TextType, { x: 0, y, w: 1, h: 1 }, { title: \">\" })\r\n        );\r\n      }\r\n      C.display.drawText(\r\n        C.bounds.x + 1,\r\n        C.bounds.y + y,\r\n        `%c{${\r\n          state.selected === null\r\n            ? Colors.B_GREY_5\r\n            : state.wearing === null\r\n            ? Colors.RED_4\r\n            : Colors.B_GREY_3\r\n        }}None`,\r\n        C.bounds.w - 24\r\n      );\r\n    } else if (item.breed.wearable) {\r\n      if (state.selected === item.id) {\r\n        result.push(\r\n          createElement(TextType, { x: 0, y, w: 1, h: 1 }, { title: \">\" })\r\n        );\r\n        const o = drawArmorText(\r\n          C.display,\r\n          item,\r\n          C.bounds.x + 24,\r\n          C.bounds.y + Y_SPLIT,\r\n          24\r\n        );\r\n        drawArmorDetails(\r\n          C.display,\r\n          item,\r\n          C.bounds.x + 24,\r\n          C.bounds.y + Y_SPLIT + o,\r\n          C.bounds.w - 24\r\n        );\r\n      }\r\n      result.push(\r\n        createElement(\r\n          TextType,\r\n          { x: 1, y, w: 30, h: 1 },\r\n          {\r\n            title: `%c{${\r\n              state.selected === item.id\r\n                ? Colors.B_GREY_5\r\n                : state.wearing === item.id\r\n                ? Colors.RED_4\r\n                : Colors.B_GREY_3\r\n            }}${item.breed.logName}${\r\n              state.wearing === item.id ? \" (Wearing)\" : \"\"\r\n            }`,\r\n          }\r\n        )\r\n      );\r\n      y += 1;\r\n    }\r\n  });\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + C.bounds.h - 1,\r\n    `%c{${Colors.RED_4}} Enter %c{}Select %c{${Colors.RED_4}}Esc%c{} Cancel`\r\n  );\r\n\r\n  C.handlers.keypress = (key: string) => {\r\n    if (isUpKey(key)) {\r\n      const idx = items.findIndex((i) => (i?.id || null) === state.selected);\r\n      if (0 < idx) {\r\n        setState({ selected: items[idx - 1]?.id || null });\r\n      }\r\n    } else if (isDownKey(key)) {\r\n      const idx = items.findIndex((i) => (i?.id || null) === state.selected);\r\n      if (idx < items.length - 1) {\r\n        setState({ selected: items[idx + 1]?.id || null });\r\n      }\r\n    } else if (key === \"Enter\") {\r\n      if (state.selected !== gameData.player.wearing.armor?.id) {\r\n        runPlayerAction(\r\n          createAction(wearArmor, gameData.player, {\r\n            id: state.selected,\r\n          })\r\n        );\r\n      }\r\n      closeModal();\r\n      return true;\r\n    } else if (key === \"Escape\") {\r\n      closeModal();\r\n      return true;\r\n    }\r\n    return true;\r\n  };\r\n  return result;\r\n};\r\n","import { Item } from \"../../../items/Item\";\r\nimport Colors from \"../../../Colors\";\r\nimport { RDisplay } from \"../../../../ui/RotDisplay\";\r\n\r\nconst withColor = (c: string, s: string) => {\r\n  return `%c{${c}}${s}%c{}`;\r\n};\r\n\r\nexport const drawArmorText = (\r\n  display: RDisplay,\r\n  item: Item,\r\n  x: number,\r\n  y: number,\r\n  maxWidth: number\r\n) => {\r\n  let o = 0;\r\n  o += display.drawText(\r\n    x,\r\n    o + y,\r\n    withColor(Colors.B_GREY_5, item.breed.name),\r\n    maxWidth\r\n  );\r\n  if (item.breed.info) {\r\n    o += display.drawText(x, o + y, item.breed.info, maxWidth);\r\n  }\r\n  o += 1;\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `%c{${Colors.B_GREY_3}}${item.breed.description}`,\r\n    maxWidth\r\n  );\r\n  return o;\r\n};\r\n\r\nexport const drawArmorDetails = (\r\n  display: RDisplay,\r\n  item: Item,\r\n  x: number,\r\n  y: number,\r\n  maxWidth: number\r\n) => {\r\n  let o = 1;\r\n\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `Weight: ${item.breed.stats.weight}`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `Armor:  ${item.breed.stats.armor}`,\r\n    maxWidth\r\n  );\r\n  o += display.drawText(\r\n    x,\r\n    y + o,\r\n    `Poise:  ${item.breed.stats.poise}`,\r\n    maxWidth\r\n  );\r\n  return o;\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill, lineDraw } from \"../../../ui/helpers\";\r\nimport { TextType } from \"../../../ui/type/TextType\";\r\nimport { bound, ComponentF, ComponentO, createElement } from \"../../../ui/ui\";\r\nimport { createAction } from \"../../actions/Action\";\r\nimport { wieldWeapon } from \"../../actions/ActionItems\";\r\nimport Colors from \"../../Colors\";\r\nimport { gameData, runPlayerAction } from \"../../GameManager\";\r\nimport { isDownKey, isLeftKey, isRightKey, isUpKey } from \"../keyHelper\";\r\nimport { WeaponDisplay, weaponInfoDraw } from \"./wieldable/WeaponDisplay\";\r\n\r\nconst Y_SPLIT = 24;\r\n\r\nconst getWieldable = () => {\r\n  const player = gameData.player;\r\n  const items = player.contains.filter((i) => i.breed.attacks);\r\n  if (player.wielding.left) {\r\n    items.unshift(player.wielding.left);\r\n  }\r\n  if (player.wielding.right) {\r\n    items.unshift(player.wielding.right);\r\n  }\r\n  return items;\r\n};\r\n\r\nexport const WieldableModal: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  const items = getWieldable();\r\n  const [state, setState] = C.useState({\r\n    selected:\r\n      gameData.player.wielding.left?.id ||\r\n      gameData.player.wielding.right?.id ||\r\n      items[0].id ||\r\n      -1,\r\n    left: gameData.player.wielding.left?.id || -1,\r\n    right: gameData.player.wielding.right?.id || -1,\r\n  });\r\n\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  let y = Y_SPLIT;\r\n\r\n  lineDraw(\r\n    C.display,\r\n    bound(C.bounds, { x: 0, y: Y_SPLIT - 1, w: C.bounds.w, h: C.bounds.h }),\r\n    \"-\"\r\n  );\r\n\r\n  const result: ComponentO[] = [];\r\n\r\n  const leftItem = state.left && items.find((i) => i.id === state.left);\r\n  const rightItem = state.right && items.find((i) => i.id === state.right);\r\n  result.push(\r\n    createElement(\r\n      WeaponDisplay,\r\n      { x: 0, y: 0, w: C.bounds.w, h: Y_SPLIT - 1 },\r\n      { left: leftItem, right: rightItem }\r\n    )\r\n  );\r\n\r\n  items.forEach((item) => {\r\n    if (item.breed.attacks) {\r\n      if (state.selected === item.id) {\r\n        result.push(\r\n          createElement(TextType, { x: 0, y, w: 1, h: 1 }, { title: \">\" })\r\n        );\r\n        weaponInfoDraw(\r\n          C.display,\r\n          C.bounds.x + 32,\r\n          C.bounds.y + Y_SPLIT,\r\n          C.bounds.w - 33,\r\n          item\r\n        );\r\n      }\r\n      result.push(\r\n        createElement(\r\n          TextType,\r\n          { x: 1, y, w: 30, h: 1 },\r\n          {\r\n            title: `%c{${\r\n              state.selected === item.id\r\n                ? Colors.B_GREY_5\r\n                : state.left === item.id || state.right === item.id\r\n                ? Colors.RED_4\r\n                : Colors.B_GREY_3\r\n            }}${item.breed.name}${\r\n              state.right === item.id\r\n                ? \" (Right Hand)\"\r\n                : state.left === item.id\r\n                ? \" (Left Hand)\"\r\n                : \"\"\r\n            }`,\r\n          }\r\n        )\r\n      );\r\n      y += 1;\r\n    }\r\n  });\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + C.bounds.h - 2,\r\n    `Use Left & Right to select weapon for that hand`\r\n  );\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + C.bounds.h - 1,\r\n    `%c{${Colors.RED_4}} Enter %c{}Confirm %c{${Colors.RED_4}}Esc%c{} Cancel`\r\n  );\r\n\r\n  C.handlers.keypress = (key: string) => {\r\n    if (isUpKey(key)) {\r\n      const idx = items.findIndex((i) => i.id === state.selected);\r\n      if (0 < idx) {\r\n        setState({ selected: items[idx - 1].id });\r\n      }\r\n    } else if (isDownKey(key)) {\r\n      const idx = items.findIndex((i) => i.id === state.selected);\r\n      if (idx < items.length - 1) {\r\n        setState({ selected: items[idx + 1].id });\r\n      }\r\n    } else if (isLeftKey(key)) {\r\n      if (state.left === state.selected) {\r\n        setState({ left: null });\r\n      } else {\r\n        setState({\r\n          left: state.selected,\r\n          right: state.selected === state.right ? null : state.right,\r\n        });\r\n      }\r\n    } else if (isRightKey(key)) {\r\n      if (state.right === state.selected) {\r\n        setState({ right: null });\r\n      } else {\r\n        setState({\r\n          right: state.selected,\r\n          left: state.selected === state.left ? null : state.left,\r\n        });\r\n      }\r\n    } else if (key === \"Enter\") {\r\n      if (\r\n        state.left !== gameData.player.wielding.left?.id ||\r\n        state.right !== gameData.player.wielding.right?.id\r\n      ) {\r\n        runPlayerAction(\r\n          createAction(wieldWeapon, gameData.player, {\r\n            left: state.left,\r\n            right: state.right,\r\n          })\r\n        );\r\n      }\r\n      closeModal();\r\n      return true;\r\n    } else if (key === \"Escape\") {\r\n      closeModal();\r\n      return true;\r\n    }\r\n    return true;\r\n  };\r\n  return result;\r\n};\r\n","import { Item } from \"../../../items/Item\";\r\nimport { ComponentF } from \"../../../../ui/ui\";\r\nimport { vertLineDraw } from \"../../../../ui/helpers\";\r\nimport { RDisplay } from \"../../../../ui/RotDisplay\";\r\nimport Colors from \"../../../Colors\";\r\nimport { drawAttackDetails, drawShieldDetails } from \"./attackDetails\";\r\nimport { gameData } from \"../../../GameManager\";\r\n\r\nconst withColor = (c: string, s: string) => {\r\n  return `%c{${c}}${s}%c{}`;\r\n};\r\nexport const weaponInfoDraw = (\r\n  display: RDisplay,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  item: Item\r\n) => {\r\n  const breed = item.breed;\r\n  y += display.drawText(x, y, withColor(Colors.B_GREY_5, breed.name), width);\r\n  const stats = breed.stats;\r\n  if (stats) {\r\n    y += display.drawText(\r\n      x,\r\n      y,\r\n      withColor(Colors.B_GREY_5, `Weight: ${stats.weight}`),\r\n      width\r\n    );\r\n  }\r\n\r\n  y += 1;\r\n  y += display.drawText(x, y, breed.info, width);\r\n  y += 1;\r\n  y += display.drawText(\r\n    x,\r\n    y,\r\n    `%c{${Colors.B_GREY_3}}${item.breed.description}`,\r\n    width\r\n  );\r\n  y += 1;\r\n  const attacks = item.breed.attacks;\r\n  if (attacks) {\r\n    display.drawText(x, y, \"One Handed\");\r\n    if (item.breed.attacks?.onehanded.blocks) {\r\n      drawShieldDetails(\r\n        display,\r\n        gameData.player,\r\n        attacks.onehanded,\r\n        x,\r\n        y,\r\n        Math.floor(width / 2),\r\n        Colors.B_GREY_5\r\n      );\r\n    } else {\r\n      display.drawText(x, y, \"One Handed\");\r\n      drawAttackDetails(\r\n        display,\r\n        gameData.player,\r\n        attacks.onehanded,\r\n        x,\r\n        y,\r\n        Math.floor(width / 2),\r\n        Colors.B_GREY_5\r\n      );\r\n    }\r\n    if (item.breed.attacks?.twohanded.blocks) {\r\n      display.drawText(x + Math.floor(width / 2) + 1, y, \"Two Handed\");\r\n      drawShieldDetails(\r\n        display,\r\n        gameData.player,\r\n        attacks.twohanded,\r\n        x + Math.floor(width / 2) + 1,\r\n        y,\r\n        Math.floor(width / 2),\r\n        Colors.B_GREY_5\r\n      );\r\n    } else {\r\n      display.drawText(x + Math.floor(width / 2) + 1, y, \"Two Handed\");\r\n      drawAttackDetails(\r\n        display,\r\n        gameData.player,\r\n        attacks.twohanded,\r\n        x + Math.floor(width / 2) + 1,\r\n        y,\r\n        Math.floor(width / 2),\r\n        Colors.B_GREY_5\r\n      );\r\n    }\r\n  }\r\n};\r\n\r\nexport const WeaponDisplay: ComponentF<{\r\n  left: Item | null;\r\n  right: Item | null;\r\n}> = (C, { left, right }) => {\r\n  const rightPane = Math.floor(C.bounds.w / 2) + C.bounds.x + 1;\r\n  vertLineDraw(C.display, {\r\n    x: rightPane - 1,\r\n    y: C.bounds.y,\r\n    w: 1,\r\n    h: C.bounds.h,\r\n  });\r\n\r\n  if (left == null) {\r\n    C.display.drawText(C.bounds.x, C.bounds.y, \"Left Hand:\");\r\n    C.display.drawText(\r\n      C.bounds.x,\r\n      C.bounds.y + 1,\r\n      `%c{${Colors.B_GREY_3}} None`\r\n    );\r\n  } else {\r\n    C.display.drawText(C.bounds.x, C.bounds.y, `Left Hand:`);\r\n    weaponInfoDraw(\r\n      C.display,\r\n      C.bounds.x,\r\n      C.bounds.y + 2,\r\n      rightPane - C.bounds.x,\r\n      left\r\n    );\r\n  }\r\n  if (right == null) {\r\n    C.display.drawText(rightPane, C.bounds.y, \"Right Hand:\");\r\n    C.display.drawText(\r\n      rightPane,\r\n      C.bounds.y + 1,\r\n      `%c{${Colors.B_GREY_3}} None`\r\n    );\r\n  } else {\r\n    C.display.drawText(rightPane, C.bounds.y, `Right Hand:`);\r\n    weaponInfoDraw(\r\n      C.display,\r\n      rightPane,\r\n      C.bounds.y + 1,\r\n      C.bounds.w - 1 - rightPane,\r\n      right\r\n    );\r\n  }\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { TextType } from \"../../../ui/type/TextType\";\r\nimport { ComponentF, ComponentO, createElement } from \"../../../ui/ui\";\r\nimport { createAction } from \"../../actions/Action\";\r\nimport { dropItem } from \"../../actions/ActionItems\";\r\nimport Colors from \"../../Colors\";\r\nimport { gameData, runPlayerAction } from \"../../GameManager\";\r\nimport { isDownKey, isUpKey } from \"../keyHelper\";\r\nimport { ItemInfoDisplay } from \"./ItemInfoDisplay\";\r\n\r\nexport const DropModal: ComponentF<{\r\n  onItemSelected: (id: string) => void;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({ selected: 0, id: null });\r\n\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  let y = 0;\r\n\r\n  C.display.draw(\r\n    C.bounds.x,\r\n    C.bounds.y + y + state.selected,\r\n    \">\",\r\n    Colors.B_GREY_5,\r\n    null\r\n  );\r\n  const result: ComponentO[] = [];\r\n\r\n  const ids: number[] = [];\r\n  gameData.player.contains.forEach((item, index) => {\r\n    if (!item.breed.mandatory) {\r\n      ids.push(item.id);\r\n      result.push(\r\n        createElement(\r\n          TextType,\r\n          { x: 1, y, w: 20, h: 1 },\r\n          {\r\n            title: `%c{${\r\n              state.selected === index ? Colors.B_GREY_5 : Colors.B_GREY_3\r\n            }}${item.breed.name}`,\r\n          }\r\n        )\r\n      );\r\n      if (index === state.selected) {\r\n        result.push(\r\n          createElement(\r\n            ItemInfoDisplay,\r\n            {\r\n              x: 30,\r\n              y: 0,\r\n              w: C.bounds.w - 31,\r\n              h: C.bounds.h - 1,\r\n            },\r\n            { item }\r\n          )\r\n        );\r\n      }\r\n      y += 1;\r\n    }\r\n  });\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + C.bounds.h - 1,\r\n    `%c{${Colors.RED_4}} Enter %c{}Confirm %c{${Colors.RED_4}}Esc%c{} Cancel`\r\n  );\r\n\r\n  C.handlers.keypress = (key: string) => {\r\n    if (isUpKey(key) && 0 < state.selected) {\r\n      setState({ selected: state.selected - 1 });\r\n    } else if (isDownKey(key) && state.selected < ids.length - 1) {\r\n      setState({ selected: state.selected + 1 });\r\n    } else if (key === \"Enter\") {\r\n      runPlayerAction(\r\n        createAction(dropItem, gameData.player, { id: ids[state.selected] })\r\n      );\r\n      closeModal();\r\n      return true;\r\n    } else if (key === \"Escape\") {\r\n      closeModal();\r\n      return true;\r\n    }\r\n    return true;\r\n  };\r\n  return result;\r\n};\r\n","import { ComponentF } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\nimport { Item } from \"../../items/Item\";\r\n\r\nexport const ItemInfoDisplay: ComponentF<{ item: Item | null }> = (\r\n  C,\r\n  { item }\r\n) => {\r\n  if (item === null) {\r\n    C.display.drawText(C.bounds.x, C.bounds.y, `None`);\r\n    return;\r\n  }\r\n\r\n  let lines = C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y,\r\n    item.breed.info,\r\n    C.bounds.w - 1\r\n  );\r\n\r\n  lines += 1;\r\n  lines += C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + lines,\r\n    `%c{${Colors.B_GREY_3}}${item.breed.description}`,\r\n    C.bounds.w - 1\r\n  );\r\n\r\n  let statY = lines + C.bounds.y + 1;\r\n  const breed = item.breed;\r\n\r\n  if (item.uses) {\r\n    C.display.drawText(\r\n      C.bounds.x,\r\n      statY,\r\n      `Uses: ${item.uses.current} / ${item.uses.max}`\r\n    );\r\n    statY += 1;\r\n  }\r\n\r\n  if (breed.stats) {\r\n    breed.stats.weight != null &&\r\n      C.display.drawText(C.bounds.x, statY, `Weight: ${breed.stats.weight}`);\r\n    breed.stats.armor != null &&\r\n      C.display.drawText(C.bounds.x, statY + 1, `Armor:  ${breed.stats.armor}`);\r\n    breed.stats.poise != null &&\r\n      C.display.drawText(C.bounds.x, statY + 2, `Poise:  ${breed.stats.poise}`);\r\n  }\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { TextType } from \"../../../ui/type/TextType\";\r\nimport { ComponentF, ComponentO, createElement } from \"../../../ui/ui\";\r\nimport { createAction } from \"../../actions/Action\";\r\nimport { pickupItem, wearArmor } from \"../../actions/ActionItems\";\r\nimport Colors from \"../../Colors\";\r\nimport {\r\n  gameData,\r\n  getItemsForPosition,\r\n  runPlayerAction,\r\n} from \"../../GameManager\";\r\nimport { isDownKey, isUpKey } from \"../keyHelper\";\r\nimport { ItemInfoDisplay } from \"./ItemInfoDisplay\";\r\n\r\nexport const PickupModal: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({ selected: 0, id: null });\r\n\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  let y = 0;\r\n\r\n  C.display.draw(\r\n    C.bounds.x,\r\n    C.bounds.y + y + state.selected,\r\n    \">\",\r\n    Colors.B_GREY_5,\r\n    null\r\n  );\r\n  const result: ComponentO[] = [];\r\n\r\n  const ids: number[] = [];\r\n  const items = getItemsForPosition(gameData.player.x, gameData.player.y);\r\n  items.forEach((item, index) => {\r\n    if (!item.breed.furniture) {\r\n      ids.push(item.id);\r\n      result.push(\r\n        createElement(\r\n          TextType,\r\n          { x: 1, y, w: 20, h: 1 },\r\n          {\r\n            title: `%c{${\r\n              state.selected === index ? Colors.B_GREY_5 : Colors.B_GREY_3\r\n            }}${item.breed.name}`,\r\n          }\r\n        )\r\n      );\r\n      if (index === state.selected) {\r\n        result.push(\r\n          createElement(\r\n            ItemInfoDisplay,\r\n            {\r\n              x: 30,\r\n              y: 0,\r\n              w: C.bounds.w - 31,\r\n              h: C.bounds.h - 7,\r\n            },\r\n            { item }\r\n          )\r\n        );\r\n      }\r\n      y += 1;\r\n    }\r\n  });\r\n\r\n  C.display.drawText(\r\n    C.bounds.x,\r\n    C.bounds.y + C.bounds.h - 1,\r\n    `%c{${Colors.RED_4}} Enter %c{}Confirm %c{${Colors.RED_4}}Esc%c{} Cancel`\r\n  );\r\n\r\n  C.handlers.keypress = (key: string) => {\r\n    if (isUpKey(key) && 0 < state.selected) {\r\n      setState({ selected: state.selected - 1 });\r\n    } else if (isDownKey(key) && state.selected < ids.length - 1) {\r\n      setState({ selected: state.selected + 1 });\r\n    } else if (key === \"Enter\") {\r\n      runPlayerAction(\r\n        createAction(pickupItem, gameData.player, { id: ids[state.selected] })\r\n      );\r\n      closeModal();\r\n      return true;\r\n    } else if (key === \"Escape\") {\r\n      closeModal();\r\n      return true;\r\n    }\r\n    return true;\r\n  };\r\n  return result;\r\n};\r\n","import { log } from \"../../../engine/logger/logger\";\r\nimport { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { TextType } from \"../../../ui/type/TextType\";\r\nimport { ComponentF, ComponentO, createElement } from \"../../../ui/ui\";\r\nimport { createAction } from \"../../actions/Action\";\r\nimport { useItem } from \"../../actions/ActionItems\";\r\nimport Colors from \"../../Colors\";\r\nimport { gameData, runPlayerAction } from \"../../GameManager\";\r\nimport { items } from \"../../items/itemsTypes\";\r\nimport { isDownKey, isUpKey } from \"../keyHelper\";\r\nimport { ItemInfoDisplay } from \"./ItemInfoDisplay\";\r\n\r\nexport const UseModal: ComponentF<{\r\n  onItemSelected: (id: string) => void;\r\n}> = (C, props) => {\r\n  const [state, setState] = C.useState({ selected: 0, id: null });\r\n\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  let y = 0;\r\n\r\n  C.display.draw(\r\n    C.bounds.x,\r\n    C.bounds.y + y + state.selected,\r\n    \">\",\r\n    Colors.B_GREY_5,\r\n    null\r\n  );\r\n  const result: ComponentO[] = [];\r\n\r\n  const ids: number[] = [];\r\n  gameData.player.contains.forEach((item, index) => {\r\n    if (item.breed.usable != null) {\r\n      ids.push(item.id);\r\n      result.push(\r\n        createElement(\r\n          TextType,\r\n          { x: 1, y, w: 20, h: 1 },\r\n          {\r\n            title: `%c{${\r\n              state.selected === index ? Colors.B_GREY_5 : Colors.B_GREY_3\r\n            }}${item.breed.name}`,\r\n          }\r\n        )\r\n      );\r\n      if (index === state.selected) {\r\n        result.push(\r\n          createElement(\r\n            ItemInfoDisplay,\r\n            {\r\n              x: 30,\r\n              y: 0,\r\n              w: C.bounds.w - 31,\r\n              h: C.bounds.h - 1,\r\n            },\r\n            { item }\r\n          )\r\n        );\r\n      }\r\n      y += 1;\r\n    }\r\n  });\r\n\r\n  C.handlers.keypress = (key: string) => {\r\n    if (isUpKey(key) && 0 < state.selected) {\r\n      setState({ selected: state.selected - 1 });\r\n    } else if (isDownKey(key) && state.selected < ids.length - 1) {\r\n      setState({ selected: state.selected + 1 });\r\n    } else if (key === \"Enter\") {\r\n      const item = gameData.player.contains.get(ids[state.selected]);\r\n      if (item?.uses?.current) {\r\n        runPlayerAction(\r\n          createAction(useItem, gameData.player, { id: ids[state.selected] })\r\n        );\r\n      } else if (item) {\r\n        log(`No uses remaining for ${item.breed.logName}`);\r\n      }\r\n      closeModal();\r\n      return true;\r\n    } else if (key === \"Escape\") {\r\n      closeModal();\r\n      return true;\r\n    }\r\n    return true;\r\n  };\r\n  return result;\r\n};\r\n","import { log } from \"../../../engine/logger/logger\";\r\nimport { openModal } from \"../../../ui/containers/Modal\";\r\nimport { ButtonComp } from \"../../../ui/input/Button\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport { createAction } from \"../../actions/Action\";\r\nimport { interact, stanceChange } from \"../../actions/ActionItems\";\r\nimport {\r\n  gameData,\r\n  getItemsForPosition,\r\n  runPlayerAction,\r\n} from \"../../GameManager\";\r\nimport { WearableModal } from \"../info/WearableModal\";\r\nimport { WieldableModal } from \"../info/WieldableModal\";\r\nimport { DropModal } from \"./DropModal\";\r\nimport { PickupModal } from \"./PickupModal\";\r\nimport { UseModal } from \"./UseModal\";\r\n\r\nexport const InventoryControls: ComponentF<void> = (C) => {\r\n  return [\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 0, w: C.bounds.w, h: 1 },\r\n      {\r\n        title: \"Use Item\",\r\n        keys: \"u\",\r\n        showKey: true,\r\n        onClick: () => {\r\n          if (!gameData.actionPending) {\r\n            openModal(createElement(UseModal, { x: 0, y: 0, w: 60, h: 32 }));\r\n          }\r\n          return;\r\n        },\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 1, w: C.bounds.w, h: 1 },\r\n      {\r\n        title: \"Pickup Item\",\r\n        keys: \"p\",\r\n        showKey: true,\r\n        onClick: () => {\r\n          if (!gameData.actionPending) {\r\n            if (16 < gameData.player.contains.size) {\r\n              log(\"Cannot pick up items, inventory full\");\r\n              return;\r\n            }\r\n            const items = getItemsForPosition(\r\n              gameData.player.x,\r\n              gameData.player.y\r\n            );\r\n            if (items.find((i) => !i.breed.furniture)) {\r\n              openModal(\r\n                createElement(PickupModal, { x: 0, y: 0, w: 60, h: 32 })\r\n              );\r\n            } else {\r\n              log(\"Nothing here to pick up.\");\r\n            }\r\n          }\r\n        },\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 2, w: C.bounds.w, h: 1 },\r\n      {\r\n        title: \"Equip Weapon\",\r\n        keys: \"r\",\r\n        showKey: true,\r\n        onClick: () => {\r\n          if (!gameData.actionPending) {\r\n            openModal(\r\n              createElement(WieldableModal, { x: 0, y: 0, w: 78, h: 46 })\r\n            );\r\n          }\r\n          return;\r\n        },\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 3, w: C.bounds.w, h: 1 },\r\n      {\r\n        title: \"Wear Armor\",\r\n        keys: \"q\",\r\n        showKey: true,\r\n        onClick: () => {\r\n          if (!gameData.actionPending) {\r\n            openModal(\r\n              createElement(WearableModal, { x: 0, y: 0, w: 48, h: 36 })\r\n            );\r\n          }\r\n        },\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 4, w: C.bounds.w, h: 1 },\r\n      {\r\n        title: \"Drop Item\",\r\n        keys: \"o\",\r\n        showKey: true,\r\n        onClick: () => {\r\n          if (!gameData.actionPending) {\r\n            if (gameData.player.contains.find((i) => !i.breed.mandatory)) {\r\n              openModal(createElement(DropModal, { x: 0, y: 0, w: 60, h: 32 }));\r\n            } else {\r\n              log(\"Nothing to drop\");\r\n            }\r\n          }\r\n        },\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 5, w: C.bounds.w, h: 1 },\r\n      {\r\n        title: \"Swap 1h/2h stance\",\r\n        keys: \"t\",\r\n        showKey: true,\r\n        onClick: () => {\r\n          if (!gameData.actionPending) {\r\n            runPlayerAction(createAction(stanceChange, gameData.player, null));\r\n          }\r\n        },\r\n      }\r\n    ),\r\n    createElement(\r\n      ButtonComp,\r\n      { x: 0, y: 6, w: C.bounds.w, h: 1 },\r\n      {\r\n        title: \"Interact\",\r\n        keys: \"z\",\r\n        showKey: true,\r\n        onClick: () => {\r\n          if (!gameData.actionPending) {\r\n            const items = getItemsForPosition(\r\n              gameData.player.x,\r\n              gameData.player.y\r\n            ).filter((item) => item.breed.interact);\r\n            if (items.length) {\r\n              runPlayerAction(createAction(interact, gameData.player, null));\r\n            } else {\r\n              log(\"There is nothing to interact with here\");\r\n            }\r\n          }\r\n        },\r\n      }\r\n    ),\r\n  ];\r\n};\r\n","import { TabbedContents } from \"../../../ui/containers/TabbedContent\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport { EquipmentPanel } from \"../info/EquipmentPanel\";\r\nimport { ContainsPanel } from \"./ContainsPanel\";\r\nimport { InventoryControls } from \"./InventoryControls\";\r\n\r\nexport const InventoryPanel: ComponentF<void> = (C) => {\r\n  const tabbedHeight = C.bounds.h - 8;\r\n  return [\r\n    createElement(\r\n      TabbedContents,\r\n      { x: 0, y: 0, w: C.bounds.w, h: tabbedHeight },\r\n      {\r\n        children: [\r\n          {\r\n            keys: [\"E\", \"e\"],\r\n            title: \"quip\",\r\n            value: createElement(EquipmentPanel, {\r\n              x: 0,\r\n              y: 0,\r\n              w: C.bounds.w,\r\n              h: tabbedHeight - 1,\r\n            }),\r\n          },\r\n          {\r\n            keys: [\"I\", \"i\"],\r\n            title: \"nventory\",\r\n            value: createElement(ContainsPanel, {\r\n              x: 0,\r\n              y: 0,\r\n              w: C.bounds.w,\r\n              h: tabbedHeight - 1,\r\n            }),\r\n          },\r\n        ],\r\n      }\r\n    ),\r\n    createElement(InventoryControls, {\r\n      x: 0,\r\n      y: tabbedHeight + 1,\r\n      w: C.bounds.w,\r\n      h: C.bounds.h - tabbedHeight,\r\n    }),\r\n  ];\r\n};\r\n","import { openModal } from \"../../ui/containers/Modal\";\r\nimport { ComponentF, createElement } from \"../../ui/ui\";\r\nimport Colors from \"../Colors\";\r\nimport { gameData } from \"../GameManager\";\r\nimport { HelpModal } from \"./home/HelpModal\";\r\n\r\nexport const TopInfo: ComponentF<{\r\n  title: string;\r\n  keys: string | string[];\r\n  onClick: () => void;\r\n}> = (C, props) => {\r\n  C.display.drawText(\r\n    C.bounds.x + 5,\r\n    C.bounds.y,\r\n    `Depth ${gameData.current.depth} of 5`\r\n  );\r\n\r\n  C.display.drawText(\r\n    C.bounds.x + C.bounds.w - 11,\r\n    C.bounds.y,\r\n    `%c{${Colors.RED_4}}?%c{} Help`\r\n  );\r\n\r\n  C.handlers.keypress = (key) => {\r\n    if (key === \"/\" || key === \"?\") {\r\n      openModal(createElement(HelpModal, { x: 0, y: 0, w: 78, h: 46 }));\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n};\r\n","import { closeModal } from \"../../../ui/containers/Modal\";\r\nimport { floodFill } from \"../../../ui/helpers\";\r\nimport { ComponentF, createElement } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\nimport { HelpComponent } from \"./helpComponent\";\r\n\r\nexport const HelpModal: ComponentF<void> = (C) => {\r\n  floodFill(C.display, C.bounds, Colors.BLACK);\r\n  C.display.drawText(\r\n    C.bounds.x + C.bounds.w / 2 - 26,\r\n    C.bounds.y + C.bounds.h - 2,\r\n    `%c{${Colors.RED_4}}Enter%c{} or %c{${Colors.RED_4}}Escape%c{} Close Help`\r\n  );\r\n\r\n  C.handlers.keypress = (key) => {\r\n    if (key === \"Enter\" || key === \"Escape\") {\r\n      closeModal();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  return [\r\n    createElement(HelpComponent, {\r\n      x: 0,\r\n      y: 0,\r\n      w: C.bounds.w,\r\n      h: C.bounds.h - 2,\r\n    }),\r\n  ];\r\n};\r\n","import { TILE_TYPES } from \"../../../tiles\";\r\nimport { ComponentF } from \"../../../ui/ui\";\r\nimport Colors from \"../../Colors\";\r\n\r\nconst keyify = (key: string) => `%c{${Colors.RED_4}}${key}%c{}`;\r\n\r\nconst WASD_KEYS = `%c{${Colors.RED_4}}w%c{}/%c{${Colors.RED_4}}a%c{}/%c{${Colors.RED_4}}s%c{}/%c{${Colors.RED_4}}d%c{}`;\r\nconst HJKL_KEYS = `%c{${Colors.RED_4}}h%c{}/%c{${Colors.RED_4}}j%c{}/%c{${Colors.RED_4}}k%c{}/%c{${Colors.RED_4}}l%c{}`;\r\nconst ARROW_KEYS = `%c{${Colors.RED_4}}Arrows%c{}`;\r\n\r\nconst WGHT_HELP =\r\n  \"Carry weight affects your capabilities, under 25% and you can sprint attack and move freely, over 75% and you will move after enemies and cannot sprint\";\r\nconst BIG_HELP = `Each Shrine(%c{${Colors.RED_4}}_%c{}) can be used to rest as often as you need. But beware, as you rest the world will shift around you. `;\r\nconst HLT_HELP = `Health  %c{${Colors.B_GREY_3}}Determines how big a weapon you can swing`;\r\nconst STA_HELP = `Stamina %c{${Colors.B_GREY_3}}Used to attack, move or wait to restore`;\r\nconst POS_HELP = `Poise   %c{${Colors.B_GREY_3}}Losing all poise causes staggered, making you unable to act (. or any command to advance turn)`;\r\nconst STR_HELP = `Strength (STR) %c{${Colors.B_GREY_3}}Determines how big a weapon you can swing`;\r\nconst FRC_HELP = `Force (FRC)    %c{${Colors.B_GREY_3}}Improves ability to strike, causing more damage`;\r\n\r\nconst WEAPON_HELP = `Weapons can be wielded in one or two hands. Use ${keyify(\r\n  \"1\"\r\n)} or ${keyify(\r\n  \"2\"\r\n)} to select which hand to attack with. Two hand usage reduces strength requirements. Shields can be used to block attack by moving into an enemy to block all attacks that turn.`;\r\nconst keys = [\r\n  `${WASD_KEYS} Movement (Also supported: ${HJKL_KEYS} or ${ARROW_KEYS})`,\r\n  `${keyify(\"Shift Movement\")} Sprint 2 tiles in a direction`,\r\n  `${keyify(\".\")} Wait a turn, restoring stamina`,\r\n  `${keyify(\"?\")} Open this help dialogue`,\r\n];\r\n\r\nconst HEIGHT_HELP = `The map features two levels of terrain, use ramps (%b{${Colors.BROWN_4}} %b{${Colors.BROWN_2}}%c{${Colors.BROWN_4}}${TILE_TYPES._L}%c{}%b{}) to go between levels or jump down anywhere.`;\r\n\r\nexport const HelpComponent: ComponentF<void> = (C) => {\r\n  let y = C.bounds.y;\r\n  keys.forEach((k) => {\r\n    y += C.display.drawText(C.bounds.x, y, k, C.bounds.w);\r\n  });\r\n  y += 1;\r\n  y += 1 + C.display.drawText(C.bounds.x, y, BIG_HELP, C.bounds.w);\r\n  y += 1 + C.display.drawText(C.bounds.x, y, WGHT_HELP, C.bounds.w);\r\n\r\n  y += C.display.drawText(C.bounds.x, y, HLT_HELP, C.bounds.w);\r\n  y += C.display.drawText(C.bounds.x, y, STA_HELP, C.bounds.w);\r\n  y += C.display.drawText(C.bounds.x, y, POS_HELP, C.bounds.w);\r\n  y += 1;\r\n  y += C.display.drawText(C.bounds.x, y, STR_HELP, C.bounds.w);\r\n  y += C.display.drawText(C.bounds.x, y, FRC_HELP, C.bounds.w);\r\n\r\n  y += 1;\r\n  y += 1 + C.display.drawText(C.bounds.x, y, WEAPON_HELP, C.bounds.w);\r\n\r\n  y += C.display.drawText(C.bounds.x, y, HEIGHT_HELP, C.bounds.w);\r\n};\r\n","import { LogList } from \"../../engine/logger/LogList\";\r\nimport { Container } from \"../../ui/containers/Container\";\r\nimport { Modal } from \"../../ui/containers/Modal\";\r\nimport { Panel } from \"../../ui/panels/Panel\";\r\nimport { PanelGroup } from \"../../ui/panels/PanelGroup\";\r\nimport { RDisplay } from \"../../ui/RotDisplay\";\r\nimport { Scene } from \"../../ui/scene\";\r\nimport { ALIGN_TYPE, TextType, VERT_TYPE } from \"../../ui/type/TextType\";\r\nimport { createElement } from \"../../ui/ui\";\r\nimport { initializeState, gameData } from \"../GameManager\";\r\nimport { MapUI } from \"../../ui/map/MapUI\";\r\nimport { StatsPanel } from \"../ui/info/stats/StatsPanel\";\r\nimport { TileContents } from \"../ui/TileContents\";\r\nimport { InventoryPanel } from \"../ui/inventory/InventoryPanel\";\r\nimport { TopInfo } from \"../ui/TopInfo\";\r\nexport class GameScene extends Scene {\r\n  ui = createElement(\r\n    Container,\r\n    { x: 0, y: 0, w: 80, h: 48 },\r\n    {\r\n      children: [\r\n        createElement(TopInfo, { x: 24, w: 30, y: 0, h: 1 }),\r\n        createElement(MapUI, { x: 24, w: 32, y: 1, h: 35 }),\r\n        createElement(\r\n          PanelGroup,\r\n          { x: 0, y: 0, w: 24, h: 48 },\r\n          {\r\n            children: [\r\n              {\r\n                title: \"Stats\",\r\n                value: createElement(StatsPanel, { x: 0, y: 0, w: 22, h: 12 }),\r\n              },\r\n\r\n              {\r\n                value: createElement(InventoryPanel, {\r\n                  x: 0,\r\n                  y: 0,\r\n                  w: 22,\r\n                  h: 32,\r\n                }),\r\n              },\r\n            ],\r\n          }\r\n        ),\r\n        createElement(\r\n          Panel,\r\n          { x: 23, y: 48 - 12, w: 80 - 23, h: 12 },\r\n          {\r\n            children: [\r\n              createElement(LogList, { x: 0, y: 0, w: 80 - 25, h: 10 }),\r\n            ],\r\n          }\r\n        ),\r\n        createElement(\r\n          Panel,\r\n          { x: 80 - 24, y: 0, w: 24, h: 48 - 11 },\r\n          {\r\n            children: [\r\n              createElement(TileContents, { x: 0, y: 0, w: 22, h: 48 - 13 }),\r\n            ],\r\n          }\r\n        ),\r\n        createElement(Modal, { x: 0, y: 0, w: 80, h: 48 }),\r\n      ],\r\n    }\r\n  );\r\n\r\n  constructor() {\r\n    super();\r\n    initializeState();\r\n  }\r\n\r\n  update(display: RDisplay, elapsed: number) {\r\n    gameData.gibs.forEach((p) => p.update(elapsed));\r\n    gameData.particles.forEach((p) => p.update(elapsed));\r\n  }\r\n}\r\n","import { Container } from \"../../ui/containers/Container\";\r\nimport { ButtonComp } from \"../../ui/input/Button\";\r\nimport { Scene, setScene } from \"../../ui/scene\";\r\nimport { createElement } from \"../../ui/ui\";\r\nimport { HomeComponent } from \"../ui/home/homeComponent\";\r\nimport { GameScene } from \"./game\";\r\nimport { MapGenScene } from \"./mapgen\";\r\n\r\nexport class Main extends Scene {\r\n  ui = createElement(HomeComponent, { x: 0, y: 0, w: 80, h: 48 });\r\n}\r\n","import { handleHover, handleKeyEvent, handleMouseEvent } from \"./ui/handlers\";\r\nimport { RDisplay } from \"./ui/RotDisplay\";\r\nimport { getScene, setScene } from \"./ui/scene\";\r\nimport { getTileOptions } from \"./tiles\";\r\nimport { Main } from \"./core/scenes/main\";\r\nimport { MapGenScene } from \"./core/scenes/mapgen\";\r\n\r\nstartGame();\r\n\r\nlet rotDisplay: RDisplay;\r\n\r\nasync function startGame() {\r\n  const tileOptions = await getTileOptions();\r\n  rotDisplay = new RDisplay({\r\n    width: 80,\r\n    height: 48,\r\n    ...tileOptions,\r\n  });\r\n\r\n  setScene(new Main());\r\n  //setScene(new MapGenScene());\r\n\r\n  window.onmousedown = (event: MouseEvent | TouchEvent) => {\r\n    handleMouseEvent(getScene().ui, \"press\", rotDisplay.eventToPosition(event));\r\n  };\r\n\r\n  window.onmouseup = (event: MouseEvent | TouchEvent) => {\r\n    handleMouseEvent(\r\n      getScene().ui,\r\n      \"release\",\r\n      rotDisplay.eventToPosition(event)\r\n    );\r\n  };\r\n\r\n  window.onmousemove = (event: MouseEvent | TouchEvent) => {\r\n    handleHover(getScene().ui, rotDisplay.eventToPosition(event));\r\n  };\r\n\r\n  window.onkeydown = (event: KeyboardEvent) => {\r\n    handleKeyEvent(getScene().ui, \"keypress\", event.key, event.shiftKey);\r\n  };\r\n\r\n  const container = rotDisplay.getContainer();\r\n  if (container) {\r\n    document.getElementById(\"app\")?.append(container);\r\n    requestAnimationFrame(renderUI);\r\n  }\r\n}\r\n\r\nconst MS_PER_FRAME = 1000 / 30;\r\nlet last = 0;\r\nlet accumulated = MS_PER_FRAME;\r\nfunction renderUI(timestamp: number) {\r\n  if (!document.hidden) {\r\n    const scene = getScene();\r\n    accumulated += timestamp - (last || timestamp);\r\n    last = timestamp;\r\n    if (accumulated >= MS_PER_FRAME) {\r\n      while (accumulated >= MS_PER_FRAME) {\r\n        accumulated -= MS_PER_FRAME;\r\n        scene.update(rotDisplay, MS_PER_FRAME);\r\n      }\r\n      rotDisplay.clear();\r\n      scene.render(rotDisplay);\r\n    }\r\n  }\r\n  requestAnimationFrame(renderUI);\r\n}\r\n"],"names":["mapping","id","resolved","Error","pairs","keys","Object","i","length","$a233bec1047945676222d642315e7e6$export$register","JSON","parse","ui","eventType","pos","handlers","findHandlers","com","o","b","$d6c076b78c33d6b971c376a88$exports","bound","bounds","isOver","push","getChildren","forEach","c","findMouseHandlers","hovered","elements","findHovered","children","getHovered","over","filter","el","hoveredTiles","find","t","type","boundsAreSame","out","hover","key","shift","findKeyHandlers","x","y","w","h","BLACK","GREY_1","GREY_2","GREY_3","B_GREY_1","B_GREY_2","B_GREY_3","B_GREY_4","B_GREY_5","RED_1","RED_2","RED_4","BROWN_4","BLUE_1","BROWN_1","BROWN_2","BROWN_3","$a2994ea1631e92fbc93d8a735647c2bf$var$_Colors","$c15dfb20524a873c70add29c461f7280$exports","display","bg","right","bottom","draw","text","center","Math","floor","lx","max","drawText","bot","C","props","keypress","Array","isArray","onClick","state","setState","useState","$b7bf072c92af39cfbbe6e53782926c83$exports","floodFill","Colors","showKey","drawOver","title","press","$eacc1e42b87ea1f9e5cd0e9997b4bae$exports","handleKeyOnClick","result","borderFill","createElement","Container","p","Panel","ButtonComp","initialized","value","assign","initialValue","mounted","useMount","f","origin","prevState","worldBounds","newChildren","child","index","setChildren","getState","root","current","pop","uiFocus","RNG","constructor","this","_seed","_s0","_s1","_s2","_c","getSeed","setSeed","seed","getUniform","getUniformInt","lowerBound","upperBound","min","getNormal","mean","stddev","u","v","r","sqrt","log","getPercentage","getItem","array","shuffle","clone","slice","indexOf","splice","getWeightedValue","data","total","random","part","Date","now","Backend","getContainer","setOptions","options","_options","Canvas","$d389a7310b06447e0ea1e14efb87994$export$default","super","_ctx","document","getContext","schedule","cb","requestAnimationFrame","canvas","opts","font","fontStyle","fontSize","fontFamily","_updateSize","textAlign","textBaseline","clear","fillStyle","fillRect","width","height","eventToPosition","rect","getBoundingClientRect","left","top","_normalizedEventToPosition","Hex","$e894030ecea524aa6520b49e12dd78fa$export$default","_spacingX","_spacingY","_hexSize","clearBefore","ch","fg","px","transpose","reverse","_fill","chars","concat","fillText","ceil","computeSize","availWidth","availHeight","computeFontSize","hexSizeWidth","hexSizeHeight","hexSize","oldFont","measureText","ratio","spacing","nodeSize","size","n","$cc638d0d813bc3c384c7b6191f19f1a$export$mod","cx","cy","a","border","ctx","beginPath","moveTo","lineTo","fill","charWidth","xprop","yprop","Rect","_canvasCache","cache","_drawWithCache","_drawNoCache","hash","drawImage","boxWidth","boxHeight","widthFraction","forceSquareRatio","Tile","_colorCanvas","tileWidth","tileHeight","tileColorize","clearRect","fgs","bgs","tile","tileMap","context","globalCompositeOperation","tileSet","fromString","str","cached","CACHE","charAt","values","match","map","parseInt","split","black","navy","darkblue","mediumblue","blue","darkgreen","green","teal","darkcyan","deepskyblue","darkturquoise","mediumspringgreen","lime","springgreen","aqua","cyan","midnightblue","dodgerblue","forestgreen","seagreen","darkslategray","darkslategrey","limegreen","mediumseagreen","turquoise","royalblue","steelblue","darkslateblue","mediumturquoise","indigo","darkolivegreen","cadetblue","cornflowerblue","mediumaquamarine","dimgray","dimgrey","slateblue","olivedrab","slategray","slategrey","lightslategray","lightslategrey","mediumslateblue","lawngreen","chartreuse","aquamarine","maroon","purple","olive","gray","grey","skyblue","lightskyblue","blueviolet","darkred","darkmagenta","saddlebrown","darkseagreen","lightgreen","mediumpurple","darkviolet","palegreen","darkorchid","yellowgreen","sienna","brown","darkgray","darkgrey","lightblue","greenyellow","paleturquoise","lightsteelblue","powderblue","firebrick","darkgoldenrod","mediumorchid","rosybrown","darkkhaki","silver","mediumvioletred","indianred","peru","chocolate","tan","lightgray","lightgrey","palevioletred","thistle","orchid","goldenrod","crimson","gainsboro","plum","burlywood","lightcyan","lavender","darksalmon","violet","palegoldenrod","lightcoral","khaki","aliceblue","honeydew","azure","sandybrown","wheat","beige","whitesmoke","mintcream","ghostwhite","salmon","antiquewhite","linen","lightgoldenrodyellow","oldlace","red","fuchsia","magenta","deeppink","orangered","tomato","hotpink","coral","darkorange","lightsalmon","orange","lightpink","pink","gold","peachpuff","navajowhite","moccasin","bisque","mistyrose","blanchedalmond","papayawhip","lavenderblush","seashell","cornsilk","lemonchiffon","floralwhite","snow","yellow","lightyellow","ivory","white","TileGL","_uniforms","_gl","_initWebGL","e","alert","message","[object Object]","preserveDrawingBuffer","complete","addEventListener","_updateTexture","gl","scissorY","scissor","clearColor","parseColor","COLOR_BUFFER_BIT","uniform2fv","uniform1f","uniform4fv","drawArrays","TRIANGLE_STRIP","window","program","vss","fss","vs","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","fs","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","VS","FS","useProgram","Float32Array","buf","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","createQuad","UNIFORMS","name","getUniformLocation","_program","enable","BLEND","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","SCISSOR_TEST","canvasSize","viewport","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","trim","colorCache","color","parsed","Number","$db2404881cd34f112c1e8c865344d1d6$export$fromString","$","cachedSetTimeout","cachedClearTimeout","process","$b9d5a5bf7543b160727888bafa0f6859$exports","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","call","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","timeout","len","run","marker","runClearTimeout","Item","noop","termcolor","rgb","nextTick","args","arguments","prototype","apply","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","Term","_offset","_cursor","_lastColor","avail","val","stdout","write","dx","dy","positionToAnsi","newColor","colorToAnsi","columns","rows","RE_COLORS","measure","maxWidth","tokens","tokenize","lineWidth","token","offset","replace","substring","Infinity","lineLength","lastTokenWithSpace","breakInsideToken","arr","join","nextIndex","breakIndex","lastIndexOf","lastTextToken","breakLines","tokenIndex","removeBreakChar","newBreakToken","newTextToken","BACKENDS","hex","$c8fdb4cbd037fc0d7ffabeab9$export$default","$a6b032834e1b4517ad7dea555529002$export$default","$dbf893dcedb327a662e4fa18b91a98f$export$default","tile-gl","$aef1f6818e0e58b2bea33c8f70$export$default","term","$d7fab7342ed8631e9a92b173d175e38$export$default","DEFAULT_OPTIONS","layout","Display","_data","_dirty","DEBUG","bind","_tick","_backend","what","colors","ctor","getOptions","computeTileSize","touches","clientX","clientY","lines","$f20cf48ca6dccc78d66311637c5eb5$export$tokenize","isSpace","isPrevSpace","isFullWidth","isPrevFullWidth","cc","charCodeAt","cch","_draw","$a3cd0adc5d6c23e5d091cdedd367b$export$default","existing","drawAppend","drawOverFirst","drawOverLast","idx","scene","currentScene","destroy","create","Scene","update","rotDisplay","elapsed","render","bundleURL","err","matches","stack","getBundleURL","resolve","$a233bec1047945676222d642315e7e6$export$resolve","dirname","_filePath","filePath","slashIndex","relative","from","to","fromParts","divergeIndex","toParts","parts","$db31145148f70dfbf2c1f9df2d977c41$exports","fromId","toId","_dirname","_relative","$ab0ff07e9cdc72e74ed7967f6a5edb3c$var$_x16_sm","$ab0ff07e9cdc72e74ed7967f6a5edb3c$var$_interopRequireDefault","$f150e28f109febbdd007f10d2b0413d8$export$getBundleURL","$ab0ff07e9cdc72e74ed7967f6a5edb3c$var$_Colors","EMPTY","String","fromCharCode","UL_","U_","SET_START","L_","_L","_U","_R","_D","src","tiles","tileSetPromise","Promise","onload","async","$bb3c0666f573c5ecfef071c7934b89$var$_Colors","$bb3c0666f573c5ecfef071c7934b89$var$_interopRequireDefault","disabled","logs","msg","unshift","$f20cf48ca6dccc78d66311637c5eb5$export$measure","LogContents","entries","$d0773382360d257e12fb8a5867d58283$exports","getLog","logIndex","lineCount","logSize","getLogSize","canScrollUp","canScrollDown","scrollUp","scrollDown","CharButton","modals","content","used","m","ModalContents","PanelContents","curHeight","lineDraw","$de3050e338e9603e4266c2d9afb48744$var$_ifDev","$de3050e338e9603e4266c2d9afb48744$var$_interopRequireDefault","$ffb26bf5d2a92412c2eab9206fcc670$exports","console","error","base","look","move","up","down","mouseTile","sUp","sLeft","sRight","sDown","focusMove","playerActions","cheat","wait","$e432b8b867018622c712663a1ddb4a27$var$_commandNames","$e432b8b867018622c712663a1ddb4a27$var$_interopRequireDefault","$a046ab197da7de216cd86846544c6b$exports","buildDirectional","handlerNames","directionSet","cancel","Escape","Backspace","advance"," ","Enter","graphMovement","baseActions","\\",".","DEBUG_MENUS","$e432b8b867018622c712663a1ddb4a27$var$_inputKeys","$a33cb885368034ad84552eae17fa4e3$exports","getEntryFromConfig","config","bindings","any","$de3050e338e9603e4266c2d9afb48744$exports","warnInDev","keyCode","keybinds","input","actions","keyHandlers","inputHandlers","addMouseHandler","fn","mouseHandler","pushKeyHandler","logInDev","popKeyHandler","pushInputHandler","popInputHandler","keyToAction","$e432b8b867018622c712663a1ddb4a27$exports","getActionNameFromInput","getInputNameForKey","inputToActionName","inputName","triggerMouseAction","$f7a5d749e89dc7d3a8946ee687a03fe$var$_InputState","$f7a5d749e89dc7d3a8946ee687a03fe$var$_interopRequireDefault","$beb21592526521f6a3ad3108694b46e9$exports","$cb6f6649303344f5ae750336d0$var$_InputState","$cb6f6649303344f5ae750336d0$var$_interopRequireDefault","direction","Directions","Up","Down","Left","Right","UpLeft","DownRight","UpRight","DownLeft","position","source","target","vector","performer","actor","speed","ActionSpeed","MEDIUM","perform","action","alive","status","staggered","TileVisibility","seen","z","adj","drawTile","view","visible","has","VISIBLE","SEEN","HIDDEN","fillAll","makeFillTile","$a0fbf2c168bfa80d8a978720ee1e7023$var$_Colors","$a0fbf2c168bfa80d8a978720ee1e7023$var$_interopRequireDefault","FloorTypes","AdjTypes","VISIBLE_THEME","wall","SEEN_THEME","visibility","theme","gameData","seeAll","TILE_TYPES","OOB","wallType","WALL","Z_IN","ONE_OUT","adjOutCheck","ONE_IN","$e7222e1786c8864038af36422b830c$export$animate","onComplete","__assign","s","hasOwnProperty","__rest","getOwnPropertySymbols","propertyIsEnumerable","warning","invariant","clamp","sanitize","toFixed","floatRegex","colorRegex","singleColorRegex","isString","number","test","parseFloat","transform","alpha","$dc63c4b00e787c6e645334a59d4084e8$export$__assign","createUnitType","default","unit","endsWith","percent","isColorString","testProp","startsWith","splitColor","aName","bName","cName","_a","_b","undefined","hsla","hue","saturation","lightness","alpha$1","round","clampRgbUnit","rgbUnit","rgba","g","substr","analyse","numColors","numbers","tokenised","createTransformer","numValues","output","convertNumbersToZero","complex","_d","isNaN","getAnimatableNone","transformer","maxDefaults","Set","applyDefaultFilter","defaultValue","functionRegex","getCurrentTime","functions","performance","onNextFrame","callback","useDefaultElapsed","runNextFrame","isProcessing","frame","delta","timestamp","stepsOrder","steps","reduce","acc","toRun","toRunNextFrame","numToRun","toKeepAlive","step","WeakSet","keepAlive","immediate","addToCurrentFrame","buffer","add","delete","frameData","sync","startLoop","cancelSync","processStep","stepId","processFrame","findSpring","envelope","derivative","duration","bounce","velocity","_e","mass","$e5a60c4f685edf5ad2e5dc19e01f556$export$warning","maxDuration","dampingRatio","undampedFreq","exponentialDecay","calcAngularFreq","exp","d","pow","initialGuess","approximateRoot","stiffness","damping","durationKeys","physicsKeys","isSpringType","some","spring","restSpeed","restDelta","$dc63c4b00e787c6e645334a59d4084e8$export$__rest","done","springOptions","isResolvedFromDuration","derived","getSpringOptions","resolveSpring","zero","resolveVelocity","createSpring","initialVelocity","initialDelta","undampedAngularFreq","abs","angularFreq_1","sin","cos","dampedAngularFreq_1","freqForT","sinh","cosh","next","currentVelocity","isBelowVelocityThreshold","isBelowDisplacementThreshold","flipTarget","needsInterpolation","_t","progress","toFromDifference","mix","mixLinearColor","fromExpo","toExpo","colorTypes","$ef8e69dda4511bac50c34da8ec64d8a$export$hex","$ef8e69dda4511bac50c34da8ec64d8a$export$rgba","$ef8e69dda4511bac50c34da8ec64d8a$export$hsla","getColorType","notAnimatable","mixColor","fromColorType","toColorType","$e5a60c4f685edf5ad2e5dc19e01f556$export$invariant","fromColor","toColor","blended","mixFunc","combineFunctions","pipe","transformers","_i","getMixer","$ef8e69dda4511bac50c34da8ec64d8a$export$color","mixComplex","mixArray","il","k","j","jl","$dc63c4b00e787c6e645334a59d4084e8$export$__spreadArrays","blendValue","fromThis","mixObject","$ef8e69dda4511bac50c34da8ec64d8a$export$complex","numNumbers","numRGB","numHSL","template","originStats","targetStats","mixNumber","createMixers","ease","customMixer","mixers","mixerFactory","numMixers","mixer","easingFunction","interpolate","isClamp","inputLength","interpolator","fastInterpolate","lastInputIndex","mixerIndex","foundMixerIndex","progressInRange","slowInterpolate","mirrorEasing","easing","easeIn","power","createExpoIn","easeInOut","defaultEasing","keyframes","times","convertOffsetToTimes","_value","defaultOffset","createInterpolator","types","decay","timeConstant","_f","modifyTarget","amplitude","ideal","loopElapsed","delay","framesync","passTimestamp","start","$b40097b007eac17943f62e5aa1f000d4$export$default","stop","$b40097b007eac17943f62e5aa1f000d4$export$cancelSync","animate","driverControls","latest","interpolateFromNumber","autoplay","driver","_g","repeat","repeatMax","_h","repeatType","_j","repeatDelay","onPlay","onStop","onRepeat","onUpdate","repeatCount","computedDuration","isComplete","isForwardPlayback","animator","detectAnimationFromOptions","animation","reverseElapsed","hasRepeatDelayElapsed","identity","createAttractor","alterDisplacement","constant","displacement","springModifiedDisplacement","FINISHED","Animatable","updatable","updateFn","ParticleModes","breed","mode","char","endSwitch","_end","race","finish","drawFn","DRAW","DRAW_OVER","DRAW_APPEND","DRAW_OVER_FIRST","DRAW_OVER_LAST","ParticleSystem","startOfTurn","endOfTurn","getData","createParticle","particles","assigned","Particle","then","remove","makeUntilEndOfTurn","makeUntilStartOfTurn","clearStartOfTurn","clearEndOfTurn","gibs","$caa543d655cf9cb634119da006ca1f32$exports","awaitAnimate","particle","info","description","logName","displayPriority","breedData","glyph","Encumbrance","Map","idRef","set","get","removed","last","lastId","warn","Stat","emptyTriggered","trigger","startFull","change","adjustMax","EMPTY_BASE_STATS","level","health","stamina","poise","armor","weight","strength","force","WieldMode","defaultAttack","damage","ActorBreed","Breed","baseStats","statTriggers","defaultWielding","defaultWearing","defaultContains","controller","actionController","triggers","wielding","wearing","contains","baseAttack","Hands","Actor","Entity","oneHanded","activeHand","LEFT","SparseMap","ownedParticles","seenPlayer","attributes","plan","end","baseDamage","_actor$wielding$left","_actor$wielding$right","_actor$wearing$armor","stats","_actor$wielding$left2","_actor$wielding$right2","_actor$wearing$armor2","_actor$wielding$left3","_actor$wielding$right3","_actor$wearing$armor3","getWeightLoad","pct","LIGHT","HEAVY","weightLevel","FAST","SLOW","reduction","attack","$db6a15c85559d91af3f250caadbaf$var$_Colors","$db6a15c85559d91af3f250caadbaf$var$_interopRequireDefault","player","_actor$wielding$left$","twoHanded","attacks","twohanded","_left$breed$attacks","onehanded","_right$breed$attacks","$f2c5826f810ccc3210d8e1b636d954b2$exports","getDirectionTowards","attackTowards","CheckMovement","valid","$f7a5d749e89dc7d3a8946ee687a03fe$exports","findActorForPosition","$cbefed8ed41161debd442f6bdb7983c$exports","getActiveAttack","GibManager","runThenDestroy","HitParticle","dmgReduction","$d6f7fdbdaf032671938a8747f5f54f$exports","getDamageReduction","getActorArmor","rawDamage","damageWithForce","blocking","shieldAttack","blocks","postShieldDamage","reduceDamage","rawStaminaDamage","staminaDamage","stability","oSpillover","dSpillover","attackDamage","$db6a15c85559d91af3f250caadbaf$exports","blockMsg","blockFailMsg","blockSuccMsg","hit","attackMsg","$da6ee84285307466aeea02039e317eef$var$_Colors","$da6ee84285307466aeea02039e317eef$var$_interopRequireDefault","FULL_OPAC","NO_OPAC","ItemBreed","mandatory","furniture","stackLimit","wearable","usable","interact","BASIC_STATS","everHeld","uses","useItem","consumeOnEmpty","applyStats","removeStats","baseArmor","$f1f7581f515e4abc2715c115276$var$_interopRequireDefault","frock","tunic","bCoat","gambeson","curiass","bouilli","flask","$f9eafbafa0faf3916c201409b3425549$var$_interopRequireDefault","fillOnRest","$c5629747e3261aea39d9f11444d7$var$_Colors","$c5629747e3261aea39d9f11444d7$var$_interopRequireDefault","baseColor","$bfead5ee16bb8b27e0b81f086be37$var$_Colors","$bfead5ee16bb8b27e0b81f086be37$var$_interopRequireDefault","ALIGN_TYPE","VERT_TYPE","align","vert","middle","$d9d719d874e9eb099560f513b0206d$var$_Colors","$d9d719d874e9eb099560f513b0206d$var$_interopRequireDefault","TextType","$fa6a9823f8eb5e02302234c4d65833e3$exports","closeModal","$bb30eb9bf963e2c71b8a1c2c916$exports","setScene","Main","$dbe1ac457faf2b956ef714b4a2ea5589$exports","adjInCheck","fov","addParticle","ParticleManager","StaggeredParticle","$ad1e4f178d7b7f88408fb7dbd225c59a$exports","createAction","bestMoveTowardsPlayer","_gameData$dMapPlayer","points","dMapPlayer","getSortedAdjacent","moveOut","at","bestMoveOrAttackPlayer","addAttackParticle","attackTo","getMoveAway","_gameData$dMapPlayer2","distanceOnFail","approach","distance","getDistance","rng","weights","genAllDirections","$f57440a53f7528f9044cd4ff87f745f$exports","_gameData$dMapPlayer3","dValue","choice","AttackingParticle","_gameData$dMapPlayer4","actors","$b9fa042c78325d078f538a02ee345cf$exports","updateSeen","getAdjacentToPlayer","conditionalApproach","controllerProps","aggressor","XPThresholds","XPMaxPerFloor","xp","standardTriggers","diedMsg","$b5303ec7e11528cec35285f6a0b222$exports","canXPOnFloor","depth","XPForDepth","hasLevelUp","staggeredMsg","staggeredCount","breeds","openModal","DeathModal","faithless","surroundController","heretic","genericController","defiler","apostate","cultist","falseProphet","$d8a4c52d68cb98128528f1859d38c$var$_EntityManager","$d8a4c52d68cb98128528f1859d38c$var$_interopRequireDefault","$efda984f68a448c57ab7391e561bf68$exports","botRow","oneMinusBot","oneMinusRight","setAreaZLevel","getHorzRandom","minX","maxX","getVertRandom","minY","maxY","openSharedVert","openSharedHorz","OPEN","aHigher","room","minSize","Z_OUT","adjacency","included","edges","MinHeap","newAdjacency","nTarget","eTarget","numEdges","fromExisting","comparator","capacity","tree","element","bubbleUp","pushAll","sinkDown","parent","parentIndex","childIndex","childWeight","bIndex","bWeight","$f784d9d9c6140933ec330b9696e411$var$_heap","$f784d9d9c6140933ec330b9696e411$var$_interopRequireDefault","$a9d43b8cb6947008bb1c784d0f5593ea$exports","$e6cade016062e4b435bb5eafd0cbb1f$var$_buildMinSpanTree","$e6cade016062e4b435bb5eafd0cbb1f$var$_interopRequireDefault","$f784d9d9c6140933ec330b9696e411$exports","graph","graphRooms","makeInitialRooms","mstgraph","raiseLeafs","addLoops","pruneLeafs","maxDepth","area","l","splitArea","rooms","iRoom","jRoom","iResult","jResult","_iResult","_jResult","compareRooms","xTouch","yTouch","xOverlap","yOverlap","loopPct","fullGraph","mstGraph","tLoops","bail","fullRoom","diff","num","includes","tId","adjRoom","list","rSelection","temp","$d99754ce9ab373592876832269ca8d45$var$_EntityManager","$d99754ce9ab373592876832269ca8d45$var$_interopRequireDefault","encounters","none","cost","monsters","iChance","faithlessBasic","BreedTypes","faithlessDense","faithlessHeretic","simpleHeretic","defilerSimple","defilerDense","apostateSimple","apostateDefiler","apostateDense","simpleProphet","depthWeights","hereticSimple","starting","spawnLocs","iType","quantity","iChoices","lootTable","$c1d70a9febed1741c45d3079275f$exports","encounterType","encounter","spawn","fail","$ec68e9ebcc5a9eceee6745bd2850$exports","getRandomInBounds","EntityManager","createActor","createItem","ItemTypes","$fdbcff570715baf3472ba723f5147782$var$_EntityManager","$fdbcff570715baf3472ba723f5147782$var$_interopRequireDefault","bestStart","bestEnd","leftY","rightY","one","two","newFont","$e6cade016062e4b435bb5eafd0cbb1f$exports","BSPGenerate","generate","$efca56ff98bac0593d4c94b637a194d$exports","makeRect","carveZDifference","carveShared","makeDoor","connectZLevels","oldPos","startingRoom","$fdbcff570715baf3472ba723f5147782$exports","placeShrines","$d99754ce9ab373592876832269ca8d45$exports","placeMonsters","queued","visited","horizon","platformAdjs","platformCurIdx","fromIdx","platformCur","platformQueue","targetConnection","makeZRamp","depthBudget","shears","knife","spade","mallet","staff","pitchfork","scythe","buckler","barricade","cleaver","needle","flail","sledgehammer","itemType","cur","ShrineMap","LevelMap","hasGenerated","$f677f1055d5b5607c48d36b3458ac288$exports","generateLootTable","WorldTile","$fa5c6cc7fce9e3efce0478c19313ecb$var$_Colors","$fa5c6cc7fce9e3efce0478c19313ecb$var$_interopRequireDefault","MAP_DEPTH_SIZES","fontRest","newLevel","FontParticle","items","seedRng","getGenerator","$d8a4c52d68cb98128528f1859d38c$exports","generateMap","getRNG","VictoryModal","baseWeapon","$ead6350701fb221c03562a5219faec$var$_interopRequireDefault","bLid","$b8ef5f2367a50944ad4f21fe8108d7a$var$_interopRequireDefault","armors","weapons","consumables","shields","getId","resetIds","addActorChildren","containing","newId","drawEntities","item","actorPlan","quickActionQueue","actionQueue","slowActionQueue","actorReplan","$ab604b6a47259bd2b49a35dff$var$_EntityManager","$ab604b6a47259bd2b49a35dff$var$_interopRequireDefault","goals","openCallback","goal","allDirections","getInDirection","DMap","getLowestAdjacent","openness","nextValue","lowest","lowValue","MAX_SAFE_INTEGER","getHighestAdjacent","highest","highValue","sort","av","bv","waited","getWeightLevel","getActorWeight","moveTowards","hasStrength","$d364dda0553c9b7e64b6742921dc34c$exports","sprinted","playerWeight","replanned","moved","FootstepParticle","$bbf1ea6e253b58fee051cddaa88$exports","createDMap","moveIn","$a38fe777ba11506426a440be8324df2$var$_Colors","$a38fe777ba11506426a440be8324df2$var$_interopRequireDefault","entry","onSubmit","InputPrompt","Input","initial","$b3460c22bbf27f2cd70e210f172eca$exports","promptInput","$a287ee72bbe77bdb5223e302a61e7d$var$_Colors","$a287ee72bbe77bdb5223e302a61e7d$var$_interopRequireDefault","levelOptions","selected","opt","subColor","$ab553b33aa373282abf5b67cb1e59dfc$exports","isUpKey","isDownKey","PlayerPosition","LevelModal","CheatModal","getDirectionFromVector","weightToActionSpeed","blockAttacks","sprint","sprintTowards","_gameData$targetFocus","looking","InputState","targetFocus","LookParticle","RNGGenerator","$cce217ed4f94b499af165f6acc60ba9a$export$default","actionPending","$f7a5d749e89dc7d3a8946ee687a03fe$var$_EntityManager","pending","addPending","waitForPending","waiting","all","$f7a5d749e89dc7d3a8946ee687a03fe$var$_AsyncManager","$d226548b3f0034e251396b29b1c4750$exports","OCTANTS","SkinnyRecursiveShadowcasting","lightCastsCallback","lightPassesCallback","_lightCasts","_lightPasses","compute","R","_renderOctant","compute180","previousOctant","nextPreviousOctant","nextOctant","compute90","octant","_castVisibility","startX","startY","row","visSlopeStart","visSlopeEnd","radius","xx","xy","yx","yy","blocked","newStart","mapX","mapY","slopeStart","slopeEnd","casts","PlayerVisibility","innerX","outerX","innerY","outerY","range","_","accumulateStagger","regenStats","expireStatuses","clearStates","staminaMultiplier","$f7a5d749e89dc7d3a8946ee687a03fe$var$_Colors","$ea0995a45fb82aaf58bc9ceb0775b232$exports","buildState","clearLog","$f7a5d749e89dc7d3a8946ee687a03fe$export$gameData","$c94975e7245efb92fd2c6e9051162$exports","getPlayerVisibility","shiftKey","mapArrows","actionResult","actionName","Commands","advanceTurn","runActionQueue","$b59c8074127680d5f5233e2a1e7a547c$exports","endOfTurnEffects","runAction","AsyncManager","handleInput","drawWorld","focus","halfw","halfh","getViewport","$f962c902b5c73bf942801aab8be40b79$var$_Colors","$f962c902b5c73bf942801aab8be40b79$var$_interopRequireDefault","fillColor","tLen","Bar","$c787b544326f7df8df11aef893808104$var$_Colors","$c787b544326f7df8df11aef893808104$var$_interopRequireDefault","isMaxLevel","getXPProgress","maxWeight","eLevel","XPBar","LabeledBar","$d943cca6f76d5ed391744c2f9f7bd17d$var$_Colors","$d943cca6f76d5ed391744c2f9f7bd17d$var$_interopRequireDefault","withColor","getItemsForPosition","$efdc005f9bf8accf37090eafd455c$var$_Colors","$efdc005f9bf8accf37090eafd455c$var$_interopRequireDefault","TabHeader","firstKey","TabContents","tab","tWidth","tabElement","$bdee6b3aaf51039d69281eeb9aca4b0$var$_Colors","$bdee6b3aaf51039d69281eeb9aca4b0$var$_interopRequireDefault","$c54010709596e1c5bddbf9d00c0a99dc$var$_Colors","$c54010709596e1c5bddbf9d00c0a99dc$var$_interopRequireDefault","_gameData$player$wear","leftString","rightString","attackingWeapon","_attackingWeapon$bree","twoHandAttack","$c54010709596e1c5bddbf9d00c0a99dc$exports","drawShieldDetails","drawAttackDetails","lAttack","lColor","rAttack","rColor","RIGHT","_gameData$player$wiel","_gameData$player$wiel2","_gameData$player$wiel3","_gameData$player$wiel4","$d3a538ccfeae3647baa914bc55b66$var$_Colors","$d3a538ccfeae3647baa914bc55b66$var$_interopRequireDefault","weapon","rightWeapon","leftWeapon","weightCheck","load","$e6f81b043044d93edf8c0abba9a6a8$exports","wield2hMsg","wield1hMsg","swapToRight","swapToLeft","newLeft","newRight","oldRight","oldLeft","holding","takeOffMsg","wearArmorMsg","q","pickupMsg","dropMsg","$e3f15a0463b16bb5c83b35683c6b63c1$var$_Colors","$e3f15a0463b16bb5c83b35683c6b63c1$var$_interopRequireDefault","$cc98049d5d32127faf0ab1274352bed2$var$_Colors","$cc98049d5d32127faf0ab1274352bed2$var$_interopRequireDefault","_gameData$player$wear2","getWearable","Y_SPLIT","$cc98049d5d32127faf0ab1274352bed2$exports","drawArmorText","drawArmorDetails","findIndex","_items","_items2","_gameData$player$wear3","runPlayerAction","wearArmor","$fc5ddf445a7bae654c3ad35f50bb6877$var$_Colors","$fc5ddf445a7bae654c3ad35f50bb6877$var$_interopRequireDefault","$d6308540a2e8f705f498f4b535185$var$_Colors","$d6308540a2e8f705f498f4b535185$var$_interopRequireDefault","weaponInfoDraw","_item$breed$attacks","_item$breed$attacks2","rightPane","vertLineDraw","getWieldable","leftItem","rightItem","WeaponDisplay","$d6308540a2e8f705f498f4b535185$exports","isLeftKey","isRightKey","_gameData$player$wiel5","_gameData$player$wiel6","wieldWeapon","$ca2483c9f9d34def83bf376fedc61eda$var$_Colors","$ca2483c9f9d34def83bf376fedc61eda$var$_interopRequireDefault","$f433f521b02d91d5163ade2eb1c04b$var$_Colors","$f433f521b02d91d5163ade2eb1c04b$var$_interopRequireDefault","statY","ids","ItemInfoDisplay","dropItem","$c87cdce442c0658b3eded004238$var$_Colors","$c87cdce442c0658b3eded004238$var$_interopRequireDefault","pickupItem","$ca5928d635e9a41fa13ebd72b51ed460$var$_Colors","$ca5928d635e9a41fa13ebd72b51ed460$var$_interopRequireDefault","_item$uses","UseModal","PickupModal","WieldableModal","WearableModal","DropModal","stanceChange","tabbedHeight","TabbedContents","EquipmentPanel","ContainsPanel","InventoryControls","$eb4431837bcffa001ae08d9a7e6c9$var$_Colors","$eb4431837bcffa001ae08d9a7e6c9$var$_interopRequireDefault","$c2f0a3ba48f85d14d3a2c0f3fb76ac53$var$_Colors","$c2f0a3ba48f85d14d3a2c0f3fb76ac53$var$_interopRequireDefault","$dbd0cfadd36e2db050c143653a7b7$var$_Colors","$dbd0cfadd36e2db050c143653a7b7$var$_interopRequireDefault","keyify","WASD_KEYS","HJKL_KEYS","ARROW_KEYS","BIG_HELP","HLT_HELP","STA_HELP","POS_HELP","STR_HELP","FRC_HELP","WEAPON_HELP","HEIGHT_HELP","HelpComponent","HelpModal","GameScene","TopInfo","MapUI","PanelGroup","StatsPanel","InventoryPanel","LogList","TileContents","Modal","initializeState","HomeComponent","tileOptions","$ab0ff07e9cdc72e74ed7967f6a5edb3c$exports","getTileOptions","RDisplay","onmousedown","event","$d3006ed19f68128faa539e44c471510a$exports","handleMouseEvent","getScene","onmouseup","onmousemove","handleHover","onkeydown","handleKeyEvent","container","_document$getElementB","getElementById","append","renderUI","startGame","accumulated","hidden"],"version":3,"file":"FourSouls.79ab49a7.js.map"}